[{"content":"Para adentrarte en el mundo del an√°lisis de datos, la visualizaci√≥n de datos, y la programaci√≥n, el primer paso es instalar R, el lenguaje, y RStudio, la interfaz que nos va a permitir trabajar con el lenguaje.\n1. Descargar e instalar R R es el lenguaje de programaci√≥n y an√°lisis estad√≠stico base, el cual se caracteriza por operar mediante paquetes o librer√≠as que expanden sus prestaciones.\nEl siguiente enlace es del sitio oficial de R, donde pueden descargarlo para el sistema operativo que utilicen: https://cran.r-project.org\nElige la descarga correspondiente a tu sistema operativo, e inst√°lalo. Si usas Windows, es probable que tengas que instalar otro software llamado Rtools, cuyo enlace aparece en el mismo enlace anterior cuando eliges Windows.\nR y RStudio R funciona a trav√©s de la l√≠nea de comandos (la l√≠nea de comandos es el nivel m√°s bajo de interacci√≥n con un computador), lo que significa que hay que escribirle instrucciones exactas para que trabaje, y retorna resultados en forma de texto. Como esto resulta un poco tedioso, se suele utilizar R a trav√©s de un entorno de desarrollo, RStudio, que facilita su uso.\n2. Descargar e instalar RStudio RStudio es el entorno de desarrollo integrado (IDE) que facilita el trabajo con R. Tambi√©n funciona con Python, y tambi√©n hay otras alternativas de IDE, pero RStudio es la m√°s usada.\nDescargar e instalar RStudio para su sistema operativo: https://posit.co/download/rstudio-desktop/#download\nPrincipalmente, lo que hace RStudio es presentarnos una consola de R junto a otros paneles: el panel de visualizaci√≥n, donde exploramos los gr√°ficos, la ventana de entorno (environment) donde vemos los elementos con los que estamos trabajando, y la ventana de script o source, donde podemos ir elaborando uno o varios documentos con instrucciones para R. Adem√°s de estos paneles, RStudio facilita tareas como la importaci√≥n de datos, la instalaci√≥n de paquetes, la gesti√≥n de cambios, y otros.\nTeniendo ambas cosas instaladas, podemos abrir RStudio y verificar est√° funcionando escribiendo en la consola: ‚Äú2+2‚Äù (sin comillas), y presionamos enter. Si obtenemos una respuesta, significa que la instalaci√≥n funciona.\n","date":"2024-11-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/instalar_r/","tags":"","title":"Primer paso: instalar R"},{"content":"¬øPor qu√© usar R para analizar datos?\nAnalizar datos mediante lenguajes de programaci√≥n (como R u otros) puede sonar complicado, pero trae muchos beneficios para tu an√°lisis.\nUsabilidad Facilidad de uso: A diferencia de otros lenguajes de programaci√≥n, R est√° dise√±ado por y para personas que no se especializan en computaci√≥n ni inform√°tica, sino que se enfoca en profesionales de distintas √°reas que requieren aplicar t√©cnicas computacionales a sus disciplinas. Por lo tanto, suele ser m√°s sencillo de usar que otros lenguajes, y por sobre todo m√°s \u0026ldquo;legible\u0026rdquo; que otros lenguajes, en el sentido de que la sintaxis de R es f√°cilmente interpretable como instrucciones en lenguaje natural, una vez que entiendes las reglas b√°sicas para escribirlo y leerlo. Por lo dem√°s, cada funci√≥n del lenguaje est√° ampliamente documentada, y existe una gran comunidad de usuarios y usuarios con mucha disposici√≥n para ayudar y ense√±ar. An√°lisis estad√≠sticos complejos: R es una herramienta poderosa para realizar an√°lisis estad√≠sticos complejos, como aplicar modelos estad√≠sticos a tus datos, herramientas de machine learning, o an√°lisis estad√≠sticos sofisticados. Muchas de estas herramientas vienen por defecto en R, y much√≠simas otras son f√°cilmente instalables mediante paquetes. Visualizaciones de datos: R cuenta con una amplia variedad de herramientas para visualizar datos. El paquete {ggplot2} permite crear gr√°ficos personalizables y complejos con una sintaxis clara y concisa, basada en capas. Puedes explorar visualmente tus datos en cuesti√≥n de segundos, o producir visualizaciones complejas y atractivas si lo requieres. Velocidad: Con R puedes procesar bases de datos de millones o miles de millones de filas. Existen m√∫ltiples estrategias para trabajar con grandes vol√∫menes de datos en R, y puedes elegir la que m√°s te convenga en cada situaci√≥n para encontrar el equilibrio entre desempe√±o y conveniencia que desees. Flujos de trabajo Tener todo tu proyecto a la vista: En vez de pensar el procesamiento de datos y la obtenci√≥n de resultados como un proceso continuo o una sucesi√≥n de pasos que realizamos uno despu√©s del otro, desde los datos iniciales hasta el producto final, vemos el proceso como una iteraci√≥n de pasos que van aumentando su complejidad en cada etapa, y donde se puede ir optimizando cada fase del mismo. No vas a tener que repetir cosas que ya has hecho: tendr√°s flujos de trabajo que puedes reutilizar con distintas fuentes de datos, distintas versiones de los datos, o variaciones en los c√°lculos. Esto te permite experimentar e iterar. Tus proyectos tendr√°n entradas y salidas claras. Podr√°s cambiar las entradas de datos sin tener que deshacer el trabajo que ya has hecho. Como vas procesando datos por pasos, siempre puedes cambiar un paso anterior y aplicar los cambios a los pasos siguientes, o hacer cambios en pasos intermedios y volver a obtener los nuevos resultados. Flexibilidad en tecnolog√≠as y m√©todos: un mismo proceso puede ser f√°cilmente actualizado para usar una tecnolog√≠a que mejore su desempe√±o; por ejemplo, pasar de leer un Excel a consultar una base de datos relacional como SQL. Podr√°s basarte en el progreso de otros: La comunidad de estad√≠sticos, analistas de datos, cient√≠ficos de datos, ge√≥grafos, y otros profesionales que usan R, usualmente comparten sus proyectos, herramientas y c√≥digo. Puedes basarte en eso para aplicarlo a tus necesidades. Procesos reutilizables Si lo haces una vez, puedes hacerlo 100 veces:\nAutomatizaci√≥n de tareas repetitivas, por ejemplo, realizar un mismo an√°lisis sobre cientos de archivos. Pero tambi√©n puedes automatizar la generaci√≥n de reportes, informes, visualizaciones y resultados. Si realizas tareas repetitivas, puedes especificar el procedimiento una sola vez, y aplicarlo cientos de veces.\nSi redactas reportes basados en datos que se actualizan peri√≥dicamente, o con informaci√≥n repetitiva, puedes programar un solo reporte que se actualice con informaci√≥n nueva de forma autom√°tica.\nSi llevas a cabo un mismo procedimiento a muchos datos similares, por ejemplo a muchas planillas de Excel, puedes programar un proceso una sola vez y aplicarlo a cientos o miles de casos, ahorr√°ndote tiempo para generar tus resultados.\nSi trabajas con m√∫ltiples unidades de informaci√≥n, como pueden ser empresas, clientes, pa√≠ses o comunas, puedes definir los resultados que requieres una sola vez, y obtener el resultado para cada una de las unidades; por ejemplo, una tabla para cada empresa, un reporte para cada cliente, un gr√°fico para cada comuna, etc.\nEjemplos: Si generas un reporte para varias empresas, programas un solo reporte y as√≠ puedes obtener los reportes que desees. Si recibes unos mismos datos cada cierto tiempo, puedes tener un flujo de trabajo listo para que solo lo apliques sobre el archivo nuevo y obtengas los resultados que esperas. Si est√°s haciendo gr√°ficos sobre datos de una comuna, y tienes cientos de comunas, basta hacer un solo gr√°fico para aplicarlos a todas las comunas. Si recibes decenas de planillas de datos de clientes y tienes que hacer cambios a cada uno, creas una funci√≥n que haga los cambios y la aplicas a todas las planillas que quieras. Reproducibilidad El an√°lisis por medio de programaci√≥n garantiza que otros usuarios pueden revisar todos los pasos de tu an√°lisis y obtener los mismos resultados que t√∫.\nEn R existe una tendencia a incentivar la creaci√≥n de flujos de trabajo reproducibles; es decir, que tus scripts abarquen desde la primera carga de los datos crudos u originales, avanzando por los pasos del an√°lisis, hasta llegar a los resultados. En otras palabras, puedes volver a repetir tu proyecto desde cero, y llegar√°s siempre a los mismos resultados. Esto ocurre porque los pasos que vamos realizando en R son no destructivos, dado que nunca modificamos los datos originales, sino que vamos generando nuevos datos en cada paso, y podemos repetir esos pasos o devolvernos en ellos y modificarlos/corregirlos. Esto se contrapone a otras formas de trabajo, como por ejemplo editar los datos directamente en Excel: una mala pr√°ctica que te hace alterar los datos originales, volviendo invisibles para los dem√°s los pasos que hiciste para llegar a tus resultados. En cambio, en R uno va dejando un registro de cada paso realizado, lo que permite que mantengamos los datos originales intactos, que otros puedan verificar y revisar nuestro trabajo, y que nosotres podamos tambi√©n volver atr√°s en los pasos y revisar nuestro avance o corregir errores. Creo que la mayor√≠a de los beneficios de R provienen de su origen: R es un lenguaje desarrollado por estad√≠sticos y profesionales de fuera de la inform√°tica, y es dirigido tambi√©n a personas fuera de la inform√°tica, por lo que es un len guaje enfocado en ser f√°cil de leer y aprender, y en obtener resultados. El hecho de que se dirija a usuarios variados hace que su dificultad de uso sea menor, y tambi√©n a que su comunidad de usuarios sea diversa.\n¬øNecesitas aprender a explorar tus datos? ¬øTienes datos pero no les puedes sacar provecho? ¬øQuieres presentar tus resultados de forma atractiva y/o interactiva? ¬°Considera aprender R!\n","date":"2024-11-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/por_que_r/","tags":"blog","title":"¬øPor qu√© usar R?"},{"content":" Introducci√≥n a R Esta gu√≠a contiene instrucciones paso a paso para aprender los aspectos m√°s b√°sicos del lenguaje R. Va dirigida a personas sin ning√∫n conocimiento previo de R, as√≠ que si quieres aprender R desde cero, ¬°sigue este tutorial!\nSi sigues estas instrucciones de principio a fin, aprender√°s a: trabajar con el programa RStudio, a gestionar tus scripts para el an√°lisis, a realizar las primeras operaciones matem√°ticas, a comprender los distintos tipos de datos que existen en R, y a manejar las operaciones fundamentales para todo an√°lisis posterior, ya sea b√°sico o avanzado: objetos, comparaciones, asignaciones, vectores, y funciones.\nEntender estos aspectos b√°sicos del lenguaje es fundamental para que, en un futuro cercano, puedas utilizar R para analizar datos, crear visualizaciones, generar reportes, desarrollar aplicaciones, y mucho m√°s.\nLa idea de esta gu√≠a es aproximarnos a los principios m√°s b√°sicos de R, en partes peque√±as y con ejemplos simples, para poder entenderlos m√°s f√°cilmente. Una vez que entendamos estos principios b√°sicos, veremos que son aplicables a bases de datos de cientos o millones de observaciones simult√°neamente, sin demasiada diferencia.\nInstalaci√≥n Para instalar R, el lenguaje de programaci√≥n, y adem√°s RStudio, el programa que te ayuda a trabajar con el lenguaje, dir√≠gete a este post donde doy todas las instrucciones: Primer paso: Instalar R\nUna vez que hayamos instalado R y R Studio, abrimos RStudio.\nEl programa deb√≠a haberse m√°s o menos as√≠:\nVemos que el estudio tiene cuatro paneles. De izquierda a derecha, y de arriba a abajo, los paneles principales son:\nPanel de scripts: aqu√≠ tenemos nuestros archivos de texto con nuestro c√≥digo. Podemos tener varias pesta√±as de distintos archivos de texto. Panel de entorno: ac√° veremos los objetos que vayamos creando, que pueden ser n√∫meros, texto, tablas de datos, funciones, gr√°ficos y otros. Panel de consola: en la consola se imprimen los resultados que arroja R a partir del c√≥digo que ejecutamos en los scripts. Tambi√©n podemos ejecutar c√≥digo directamente en la consola. Panel de archivos: en este panel podemos navegar los archivos y carpetas de nuestro proyecto y/o computador. Scripts Al trabajar en R, realizamos nuestros an√°lisis y pruebas mediante scripts. Los scripts son archivos de texto que terminan en .R. En estos archivos de texto escribimos nuestro c√≥digo, intentando tener una instrucci√≥n por l√≠nea. Dentro del script, ejecutamos las instrucciones l√≠nea por l√≠nea, poniendo el cursor de texto en la l√≠nea que deseamos ejecutar, y presionando el bot√≥n \u0026ldquo;Run\u0026rdquo; (arriba a la derecha en el panel de scripts), o bien, presionando las teclas comando + enter en Mac y control + enter en Windows.\nAl ejecutar una l√≠nea o instrucci√≥n, el comando se va a enviar a la consola, que es el panel de abajo donde se muestran las operaciones realizadas, y la consola va a retornar la respuesta o resultado.\nLa consola es la forma directa de interactuar con el lenguaje R. En ella, las instrucciones se escriben, un comando a la vez, y se presiona enter para enviar los comandos. La consola va a responder un resultado ef√≠mero, que sirve para que lo puedas revisar de forma r√°pida, pero no queda registrado en ninguna parte.\nSi escribimos nuestros comandos en scripts, los comandos van a quedar guardados en texto para que los puedas volver a ejecutar, revisar, etc. Una particularidad de los scripts, es que si una l√≠nea contiene un signo gato #, todo lo que est√© despu√©s del gato se transformar√° un comentario. Esto significa que lo que est√© despu√©s del signo no se ejecuta, y por lo tanto, puedes escribir lo que quieras. Es muy recomendable que a lo largo de tu script vayas dejando comentarios, iniciando una l√≠nea con el signo gato, para ir dejando registro de las cosas que est√°s haciendo, ideas al respecto, correcciones, preguntas, y aclaraciones, debido a que es muy f√°cil confundirse o olvidarse de lo que se est√° haciendo.\nPrimeras operaciones en R Ahora que tenemos nuestro R y RStudio preparados, empezaremos a utilizar R para entender sus aspectos m√°s b√°sicos. La idea es que vayas copiando estos c√≥digos y los vayas ejecutando uno a uno, para ver y entender c√≥mo funciona.\nTipos de datos Un dato es una unidad m√≠nima de informaci√≥n. Puede ser un n√∫mero, una palabra, o incluso puede ser nada. Esto es lo que se denomina el tipo de un dato, y el tipo de un dato determina, en cierto modo, lo que podemos hacer con un dato.\nLos tipos principales son:\nNum√©ricos:\n1 2 3.1 Con los datos num√©ricos se pueden realizar todo tipo de operaciones matem√°ticas y transformaciones num√©ricas.\nCaracter o texto:\n\u0026#34;hola\u0026#34; Los textos van entre comillas, y pueden contener cualquier caracter dentro.\nL√≥gicos:\nTRUE FALSE Los datos de tipo l√≥gico son una forma de representar una condici√≥n verdadera o falsa.\nEn el lenguaje R, todos los datos son tambi√©n denominados objetos, porque son elementos que contienen algo dentro de s√≠, aunque en lo que hemos visto hasta ahora, el objeto y su contenido son equivalentes (1 es igual a 1).\nOperaciones matem√°ticas Quiz√°s lo m√°s b√°sico que podemos hacer con un lenguaje de programaci√≥n es sacar c√°lculos matem√°ticos. En R, esto es tan sencillo como escribir la expresi√≥n matem√°tica, y teniendo el cursor de texto en la l√≠nea que queremos ejecutar, presionamos el bot√≥n Run (arriba a la derecha del script) o presionamos las teclas comando + enter.\nA lo largo de este tutorial, vamos a ir viendo bloques de c√≥digo, seguidos de su resultado.\n2 + 2 # suma [1] 4 En estos dos bloques, el primero es la operaci√≥n que hicimos, y el segundo es el resultado que entrega a la consola de R; en este caso, el resultado de 2 + 2.\n50 * 100 # multiplicaci√≥n [1] 5000 4556 - 1000 # resta [1] 3556 6565 / 89 # divisi√≥n [1] 73.76404 Si escribimos estas operaciones en un script, podemos ejecutar las instrucciones en cualquier orden y cuando deseemos. S√≥lo debemos ir poniendo el cursor de texto en la l√≠nea que queramos y ejecutarla. O bien, podemos seleccionar varias l√≠neas y ejecutarlas todas al mismo tiempo, teniendo cuidado de seleccionar las operaciones completas1.\nComo el tipo de los datos determina las operaciones que podemos realizar, veremos que hay ciertas operaciones que no podemos hacer conciertos datos. Si intentamos sumar dos datos de tipo caracter (texto), obtenemos un error, que dice que estamos usando un dato que no es num√©rico.\n\u0026#34;1\u0026#34; + \u0026#34;1\u0026#34; Error in \u0026quot;1\u0026quot; + \u0026quot;1\u0026quot;: non-numeric argument to binary operator Es importante saber con qu√© tipo de datos estamos trabajando, para poder saber las herramientas que tenemos de nuestra disposici√≥n, o bien, para planificar qu√© hacer para poder hacer lo que necesitamos con los datos que tenemos.\nCon esta primera operaciones matem√°ticas podemos entender que en un script escribimos instrucciones y las vamos ejecutando. Al ir ejecutando operaciones consecutivas vamos estructurando nuestro an√°lisis.\nComparaciones Las comparaciones son una de las operaciones computacionales m√°s b√°sicas, pero a su vez pueden ser muy poderosas.\nEn una comparaci√≥n, se utilizan s√≠mbolos espec√≠ficos que realizan operaciones, llamados operadores, para pedirle a R que compare distintos datos.\nAl comparar datos, la respuesta obtenida va a ser si la comparaci√≥n es igual o es distinta a lo establecido.\nPor ejemplo: ¬øes 1 igual a 1?\n1 == 1 [1] TRUE La igualdad se escribe ==, y se usa para evaluar si dos cifras son iguales. En este caso, la comparaci√≥n entre 1 y 1 retorna TRUE (verdadero), porque 1 es igual a 1.\n1 == 2 [1] FALSE 1 no es igual a 2, por lo que la comparaci√≥n retorna FALSE (falso).\nLa operaci√≥n inversa la igualdad es la desigualdad: evaluar si un dato es distinto de otro.\n40 != 30 [1] TRUE 40 es distinto a 30, por lo que la comparaci√≥n retorna FALSE. Si evaluamos si dos cifras iguales son distintas, l√≥gicamente la respuesta va a ser verdadero (TRUE).\n40 != 40 [1] FALSE Los operadores mayor que (\u0026gt;) y menor que (\u0026lt;) retorno si una cifra es mayor o menor, respectivamente.\n31 \u0026gt; 18 [1] TRUE 40 \u0026lt; 80 [1] TRUE Tambi√©n existen los operadores mayor o igual, y menor o igual:\n40 \u0026gt;= 40 [1] TRUE 50 \u0026gt;= 40 [1] TRUE 4 \u0026lt;= 5 [1] TRUE Asignaciones Anteriormente, mencionamos que los datos son objetos. Un objeto puede contener informaci√≥n de cualquier tipo, y lo relevante es que podemos crear todos los objetos que queramos para realizar nuestros an√°lisis.\n¬øC√≥mo crear un objeto? Creamos un objeto asignando un dato o valor a un nombre. Es decir, tenemos un dato, y queremos que ese dato est√© contenido en un nuevo objeto, el cual tendr√° un nombre espec√≠fico.\nPara crear un objeto usamos el operador de asignaci√≥n: \u0026lt;-\nAl crear un objeto nuevo, el objeto va a tener un nombre: el s√≠mbolo que va a contener el dato, y por medio del cual vamos a llamar el dato contenido en el objeto.\nTodos los objetos tienen un nombre, el cual puede ser solo una palabra sin separar por espacios, y puede contener s√≠mbolos como gui√≥n bajo, tildes, e√±es y n√∫meros.\nCrear objeto:\na√±o \u0026lt;- 1993 De este modo, podemos guardar un dato en un objeto para usarlo m√°s adelante.\nPara ver los contenidos del objeto, simplemente lo llamamos por su nombre:\na√±o [1] 1993 Al crear un objeto, aparece en el panel de entorno o Environment, en el panel superior derecho de RStudio.\nPodemos usar los objetos para realizar operaciones matem√°ticas, porque llamar a un objeto, es reutiliza el dato que est√° dentro de ese objeto:\na√±o + 10 [1] 2003 2024 - a√±o [1] 31 Podemos crear un nuevo objeto a partir de un c√°lculo, escribiendo un c√°lculo y asign√°ndolo a un nuevo objeto:\nedad \u0026lt;- 2024 - a√±o edad [1] 31 Ejemplos Para practicar con la idea de que los objetos son s√≠mbolos que contienen datos, crearemos distintos objetos los usaremos para hacer distintos c√°lculos sencillos.\nEjemplo 1 En este ejemplo, definiremos unas cifras que representan el c√°lculo de un presupuesto.\nPrimero, definimos varios datos. Cuando un dato hace referencia a un aspecto real de algo, ya sea una propiedad o cualidad, se le denomina variable, debido a que estas cualidades no son fijas, sino que cambian en las distintas situaciones, contextos o realidades.\npresupuesto \u0026lt;- 100000 pizza \u0026lt;- 12000 bebida \u0026lt;- 2500 Restamos todos los objetos para ver cu√°nto queda de presupuesto:\npresupuesto - pizza - bebida [1] 85500 Tambi√©n podemos usar par√©ntesis para ordenar nuestras operaciones:\npresupuesto - (pizza + bebida) [1] 85500 Ejemplo 2 Repetimos la creaci√≥n de un presupuesto al definir nuestras variables:\npresupuesto \u0026lt;- 100000 pizza \u0026lt;- 12000 bebida \u0026lt;- 2500 El objeto pizza representa el precio de una sola pizza. Pero en este ejemplo, necesitamos comprar varias pizzas, as√≠ que crearemos un objeto nuevo a partir de una operaci√≥n:\npizzas_totales \u0026lt;- pizza * 4 pizzas_totales [1] 48000 Tambi√©n tenemos que considerar la compra de bebidas:\nbebidas_totales \u0026lt;- bebida * 2 bebidas_totales [1] 5000 Ahora hacemos el c√°lculo del presupuesto considerando los dos objetos nuevos que creamos, y guardamos el resultado en otro objeto:\ntotal \u0026lt;- pizzas_totales + bebidas_totales total [1] 53000 Restamos el total de las compras con el presupuesto disponible:\nrestante \u0026lt;- presupuesto - total Ahora revisamos el resultado:\nrestante [1] 47000 La gracia de hacerlo as√≠ es que facilita la posiblidad de ir modificando los precios de los objetos, sus cantidades, y luego volver a ejecutar todas las l√≠neas para llegar al resultado actualizado.\nEjercicio:\nIntenta volver al principio del ejemplo, donde se definen las variables, y modifica el precio de alguna. Luego, vuelve a ejecutar los c√°lculos para llegar al nuevo monto restante. Intenta reescribir este √∫ltimo ejemplo, pero haciendo que las cantidades de pizzas y bebidas sean tambi√©n variables que se definan al principio del c√°lculo, junto con el resto de las variables. Define estas nuevas variables con valores distintos, y llega al nuevo resultado. Si bien estos ejemplos pueden parecer muy b√°sicos, la estructura de an√°lisis m√°s complejos sigue patrones bastante bastante similares a los que estamos viendo ahora.\nVectores Hasta este punto, hemos visto operaciones sobre un solo dato a la vez; es decir, sobre objetos que contienen un solo elemento. Pero en la vida real, probablemente queremos realizar c√°lculos sobre m√∫ltiples datos a la vez, ya sea desde hojas de c√°lculos, planillas o bases de datos.\nLos objetos en R pueden tener m√∫ltiples propiedades. Una de estas es su largo. Un objeto que contiene un solo dato es un objeto de largo 1. Los vectores en R son objetos que contienen una secuencia de datos, una cadena de valores.\nLos vectores tienen elementos, tienen un largo, y tienen un tipo.\nPodemos crear un vector de forma manual con la funci√≥n c():\nc(1, 2, 3, 4, 5, 6, 7, 8) [1] 1 2 3 4 5 6 7 8 En este bloque de c√≥digo hemos creado un vector, una secuencia de valores que tiene ocho elementos.\nEn un vector podemos almacenar datos arbitrarios, siempre y cuando sean todos del mismo tipo.\nc(40, 2, 7, 345) [1] 40 2 7 345 c(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;) [1] \u0026quot;a\u0026quot; \u0026quot;b\u0026quot; \u0026quot;c\u0026quot; \u0026quot;d\u0026quot; Si queremos crear un vector que contenga una secuencia continua de n√∫meros, podemos usar el operador : entre el n√∫mero de inicio y el n√∫mero final de la secuencia:\n1:10 # n√∫meros de 1 al 10 [1] 1 2 3 4 5 6 7 8 9 10 1990:2010 # a√±os del 1990 al 2010 [1] 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 [16] 2005 2006 2007 2008 2009 2010 Podemos realizar operaciones sobre los vectores, dado que son secuencias de datos, y la operaci√≥n se va a aplicar a todos sus elementos:\nc(1, 2, 4, 8) + 100 [1] 101 102 104 108 c(31, 32, 56, 74) - 2024 [1] -1993 -1992 -1968 -1950 1:10 * 20 [1] 20 40 60 80 100 120 140 160 180 200 Tambi√©n podemos hacer comparaciones sobre los elementos de un vector:\nc(3, 3, 4, 5, 4, 3) == 3 [1] TRUE TRUE FALSE FALSE FALSE TRUE c(\u0026#34;s√≠\u0026#34;, \u0026#34;no\u0026#34;, \u0026#34;s√≠\u0026#34;, \u0026#34;s√≠\u0026#34;) == \u0026#34;no\u0026#34; [1] FALSE TRUE FALSE FALSE Pero el potencial de los vectores es cuando est√°n asignados a un objeto. Asignamos a un objeto el vector de n√∫meros:\nedades \u0026lt;- c(25, 27, 30, 45, 37, 28, 46, 54) Teniendo un objeto que contiene una secuencia de datos, ahora podemos realizar operaciones escritas de una forma m√°s abstracta o resumida, y que se empiezan a acercar a casos de uso reales.\nedades - 40 [1] -15 -13 -10 5 -3 -12 6 14 edades \u0026gt; 30 [1] FALSE FALSE FALSE TRUE TRUE FALSE TRUE TRUE edades == 30 [1] FALSE FALSE TRUE FALSE FALSE FALSE FALSE FALSE Para acceder para acceder a uno de los valores espec√≠ficos de un vector, usamos las sintaxis de corchetes. Dentro de corchetes ponemos el elemento o elementos del vector que queremos extraer.\nedades[3] [1] 30 edades[1:3] [1] 25 27 30 Tipos de datos en vectores Por definici√≥n, los valores de los vectores en R son todos de un mismo tipo. Esto se debe a que queremos realizar operaciones sobre los factores, y como las operaciones dependen del tipo de cada dato (no podrmos sumar letras), garantizar que los vectores sean de un mismo tipo permite que siempre podamos realizar operaciones en todas sus elementos.\nCuando creamos un vector de distintos tipos de datos, R va a reducirlo por defecto a un solo tipo:\nc(1, 2, 3, 4, \u0026#34;cinco\u0026#34;) [1] \u0026quot;1\u0026quot; \u0026quot;2\u0026quot; \u0026quot;3\u0026quot; \u0026quot;4\u0026quot; \u0026quot;cinco\u0026quot; Si notamos la salida de la consola, podemos ver que los n√∫meros aparecen envueltos en comillas, porque la presencia de un elemento de tipo car√°cter dentro del vector hizo que todos los dem√°s elementos fueran convertidos a caracter.\nEjemplos Ejemplo 1 Un vector con a√±os de nacimiento, y luego restamos el a√±o actual al vector, para obtener las edades actuales de las personas que nacieron en esos a√±os.\na√±os \u0026lt;- c(1992, 1997, 1986, 1980, 1999) edades \u0026lt;- 2024 - a√±os edades [1] 32 27 38 44 25 Si el objeto resultante le sumamos 10, podemos obtener las edades que tendr√≠an estas personas 10 a√±os despu√©s.\nedades_en_10_a√±os \u0026lt;- edades + 10 edades_en_10_a√±os [1] 42 37 48 54 35 Ejemplo 2 Tenemos un vector con precios de productos, y un objeto que contiene un determinado valor, que ser√≠a el presupuesto que tenemos. Queremos saber qu√© productos son m√°s baratos que el presupuesto. Entonces, comparamos los elementos del vector precios con el presupuesto:\nprecios \u0026lt;- c(10500, 26990, 9900, 56700, 12350, 12000, 24990) presupuesto \u0026lt;- 15000 precios \u0026lt; presupuesto [1] TRUE FALSE TRUE FALSE TRUE TRUE FALSE El resultado es un vector de valores l√≥gicos que indican si que el precio es menor o no que el presupuesto.\nPodemos usar ese resultado para filtrar el vector precios, porque cada valor verdadero o falso se corresponde con el valor de la misma posici√≥n en el vector original. Es decir, el primer elemento del vector precios es menor al presupuesto, el segundo no, el tercero s√≠, etc. As√≠ podemos obtener exactamente los datos que cumplen la condici√≥n:\nprecios[precios \u0026lt; presupuesto] [1] 10500 9900 12350 12000 Esto funciona porque, como hab√≠amos mencionado antes, se pueden seleccionar elementos espec√≠ficos del vector usando corchetes, y en este caso, los elementos que est√°n siendo seleccionados son los que resultan TRUE de la comparaci√≥n precios \u0026lt; presupuesto.\nFunciones Las funciones son peque√±os programas que se aplican a nuestros objetos o vectores.\nEl uso de funciones es la ventana que nos abre posibilidades a nuevas herramientas y an√°lisis, porque dentro de ellas se pueden ejecutar operaciones e instrucciones mucho m√°s complejas que las que hemos visto hasta el momento.\nUna funci√≥n es simplemente un programa dentro del cual se entregan ciertos argumentos.\nfuncion(argumento_1, argumento_2, ...) Dependiendo de lo que haga la funci√≥n, dentro de ella podemos poner uno o varios vectores, un vector con algunas opciones definidas, u objetos m√°s complejos que veremos adelante.\nUna funci√≥n sencilla es la funci√≥n mean(), que calcula el promedio de los valores de un vector:\nmean(c(10, 20, 39)) [1] 23 cifras \u0026lt;- c(1, 5, 4, 7, 8, 4, 3, 2, 9, 0, 2) mean(cifras) [1] 4.090909 a√±os \u0026lt;- c(1992, 1997, 1986, 1980, 1999, 2010, 1993, 1976) edades \u0026lt;- 2024 - a√±os mean(edades) [1] 32.375 Como R es un lenguaje principalmente estad√≠stico, hay varias funciones matem√°ticas que operan sobre vectores de n√∫meros:\nmean(edades) # promedio [1] 32.375 min(edades) # m√≠nimo [1] 14 max(edades) # m√°ximo [1] 48 median(edades) # mediana [1] 31.5 sum(edades) # suma [1] 259 Tambi√©n hay funciones que no realizan c√°lculos sobre los datos, sino que nos dicen otra cosa sobre ellos:\nlength(edades) [1] 8 Algo que podr√≠a ser importante de confirmar, como hemos visto, ser√≠a el tipo de un vector. Para esto, existen varias funciones:\nclass(edades) [1] \u0026quot;numeric\u0026quot; La funci√≥n permite saber la clase de un objeto, que es una propiedad de los objetos relacionada a su tipo. En este caso retorna numeric, porque se trata de n√∫meros, pero en realidad el tipo es otro:\ntypeof(edades) [1] \u0026quot;double\u0026quot; Esto ocurre porque los n√∫meros pueden ser de distintos tipos: hay n√∫meros enteros (integer), n√∫meros decimales (double), entre otros, y tienen caracter√≠sticas distintas. Pero es suficiente con saber si es o no num√©rico para la mayor√≠a de los casos.\nOtras funciones permiten consultar si un objeto es de un tipo espec√≠fico:\nis.numeric(edades) [1] TRUE is.character(edades) [1] FALSE Si tenemos un vector de un tipo que no nos sirve, podemos convertirlo a uno que si nos sirva:\nnumeros \u0026lt;- c(1, 2, 3, 4, \u0026#34;perro\u0026#34;) numeros_2 \u0026lt;- as.numeric(numeros) # convertir a n√∫meros Warning: NAs introduced by coercion numeros_2 [1] 1 2 3 4 NA Notamos que R nos entrega una alerta! dice que hay NA introducidos por coerci√≥n. Los valores NA son tambi√©n llamados valores perdidos, y significa que es un elemento de un vector que no contiene nada. En este caso, el √∫ltimo elemento del vector es convertido a un dato perdido, porque el texto perro no se corresponde realmente con ning√∫n n√∫mero.\nis.character(\u0026#34;texto\u0026#34;) # retorna TRUE si el objeto es un texto [1] TRUE is.character(11111) # retorna FALSE si el objeto no es un texto [1] FALSE is.numeric(4985984) # retorna TRUE si el objeto es un n√∫mero [1] TRUE is.numeric(5555) [1] TRUE as.character(4444) [1] \u0026quot;4444\u0026quot; Si necesitamos saber qu√© hace una funci√≥n, o c√≥mo funciona, podemos escribir en la consola un ? seguido por el nombre de la funci√≥n ?as.numeric, o bien, entrar al panel de ayuda de RStudio, que se encuentra en la parte inferior derecha de la pantalla, y buscar la funci√≥n que queramos aclarar.\nEn la ayuda de R aparecen las funciones explicadas, con ejemplos, con detalles de cada uno de sus argumentos, y m√°s.\nN√∫meros al azar La funci√≥n sample() permite obtener una cantidad de elementos al azar desde otro conjunto de elementos. Por ejemplo, obtengamos un n√∫mero al azar entre uno y 10 millones:\nnumeros \u0026lt;- 1:10000000 sample(numeros, size = 1) [1] 8470837 La funci√≥n recibe como primer argumento el vector de elementos, y como segundo argumento la cantidad de elementos que queremos obtener al azar.\nIntenta cambiando el segundo argumento para que te entregue cuatro n√∫meros al azar.\nSecuencias Podemos utilizar la funci√≥n seq() para crear una secuencia de n√∫meros entre dos n√∫meros, definiendo en el argumento from el n√∫mero inicial, en to el n√∫mero final, y en by el salto entre cada cifra:\nseq(from = 10, to = 100, by = 5) [1] 10 15 20 25 30 35 40 45 50 55 60 65 70 75 80 85 90 95 100 El resultado es un vector que empieza desde el 10 y va hasta el 100, de 5 en 5.\nCreemos un vector del 1 al 2, avanzando en 0,1:\nseq(from = 1, to = 2, by = 0.1) [1] 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.0 Recordemos que tambi√©n podemos usar funciones para definir los argumentos de cualquier otra funci√≥n. En este caso, en vez de escribir los n√∫meros que queremos para el inicio del final de la secuencia, podemos usar n√∫meros que se obtienen desde aplicar una funci√≥n a un vector:\nseq(from = min(edades), to = max(edades), by = 10) [1] 14 24 34 44 Esta funci√≥n puede ser √∫til, por ejemplo, para crear una secuencia de a√±os:\na√±os \u0026lt;- seq(1900, 2020, 10) Redactar textos Otra funci√≥n b√°sica es paste(), que te permite unir varios elementos en un s√≥lo texto:\ntexto_1 \u0026lt;- \u0026#34;Hola\u0026#34; texto_2 \u0026lt;- \u0026#34;amigues\u0026#34; paste(texto_1, texto_2) [1] \u0026quot;Hola amigues\u0026quot; Podemos unir varios elementos, sacados de vectores o calculados con funciones, para generar un texto m√°s complejo:\na√±os \u0026lt;- c(1992, 1997, 1986, 1980, 1999, 2010, 1993, 1976) edades \u0026lt;- 2024 - a√±os promedio \u0026lt;- mean(edades) paste(\u0026#34;Entre las\u0026#34;, length(edades), \u0026#34;edades analizadas,\u0026#34;, \u0026#34;el promedio fue de\u0026#34;, promedio, \u0026#34;y la edad m√°xima fue de\u0026#34;, max(edades), \u0026#34;a√±os.\u0026#34; ) [1] \u0026quot;Entre las 8 edades analizadas, el promedio fue de 32.375 y la edad m√°xima fue de 48 a√±os.\u0026quot; Podemos usar esta funci√≥n combinada con sample() para obtener un muestreo aleatorio de cualquier tipo de elementos, lo que puede servir para hacer algunas cosas entretenidas:\nanimales \u0026lt;- c(\u0026#34;gato\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;castor\u0026#34;, \u0026#34;pollo\u0026#34;, \u0026#34;rat√≥n\u0026#34;, \u0026#34;pud√∫\u0026#34;) paste(\u0026#34;el animal m√°s lindo es el\u0026#34;, sample(animales, 1)) [1] \u0026quot;el animal m√°s lindo es el pollo\u0026quot; Redondear datos En el ejemplo anterior, obtuvimos que el promedio de edades era 32.375. Si queremos redondear este n√∫mero, podemos abusar la funci√≥n round(), cuyo primer argumento es el n√∫mero o n√∫meros que queremos redondear, y el segundo es la cantidad de decimales:\nround(mean(edades), digits = 1) [1] 32.4 Condicionales Una funci√≥n condicional permite hacer algo si se cumple o no una condici√≥n. Esto que puede sonar sencillo puede resultar tremendamente √∫til.\nEn la funci√≥n ifelse(), el primer argumento es una comparaci√≥n, y luego hay que especificar dos argumentos m√°s: el primero es lo que queremos si la comparaci√≥n es verdadera, y lo segundo es lo que queremos si la comparaci√≥n es falsa. La expresi√≥n \u0026ldquo;if else\u0026rdquo; significa en castellano \u0026ldquo;si pasa esto, entonces haz esto\u0026rdquo;. En una sentencia if else, se define una o m√°s condiciones que queremos que se cumplan para ejecutar un c√≥digo y, si esa condici√≥n no se cumple, ejecutamos otro c√≥digo (o no ejecutamos nada).\nPor ejemplo, evaluamos si un n√∫mero es mayor a 5, y si es as√≠, retornamos la palabra alto, y si no, retornamos la palabra bajo:\nnumero \u0026lt;- 10 ifelse(numero \u0026gt; 5, yes = \u0026#34;alto\u0026#34;, no = \u0026#34;bajo\u0026#34;) [1] \u0026quot;alto\u0026quot; numero \u0026lt;- 3 ifelse(numero \u0026gt; 5, yes = \u0026#34;alto\u0026#34;, no = \u0026#34;bajo\u0026#34;) [1] \u0026quot;bajo\u0026quot; Tenemos un vector de la cantidad de dulces que comieron unas personas. Si definimos que comer m√°s de 4 dulces es mucho, aplicamos la funci√≥n ifelse() para categorizar las cantidades de dulces que comieron las personas:\ndulces \u0026lt;- c(3, 2, 4, 3, 5, 6, 5, 7, 6, 2, 1, 2, 3, 2) dulces_2 \u0026lt;- ifelse(dulces \u0026gt;= 4, yes = \u0026#34;muchos\u0026#34;, no = \u0026#34;normal\u0026#34;) dulces_2 [1] \u0026quot;normal\u0026quot; \u0026quot;normal\u0026quot; \u0026quot;muchos\u0026quot; \u0026quot;normal\u0026quot; \u0026quot;muchos\u0026quot; \u0026quot;muchos\u0026quot; \u0026quot;muchos\u0026quot; \u0026quot;muchos\u0026quot; [9] \u0026quot;muchos\u0026quot; \u0026quot;normal\u0026quot; \u0026quot;normal\u0026quot; \u0026quot;normal\u0026quot; \u0026quot;normal\u0026quot; \u0026quot;normal\u0026quot; Luego, podemos usar una suma condicionada para saber cu√°ntas personas comieron muchos dulces:\nsum(dulces_2 == \u0026#34;muchos\u0026#34;) # cantidad de personas que comieron \u0026#34;muchos\u0026#34; dulces [1] 6 Con este otro ejemplo, aprenderemos a usar el operador de inclusi√≥n, %in%, qu√© es lo que hace es determinar si un elemento est√° dentro de otro conjunto de elementos. Creamos un vector de elementos, y un segundo actor que contiene un subgrupo de los elementos. Luego, usamos el operador de inclusi√≥n %in% para saber cu√°l de los primeros elementos est√°n dentro del segundo grupo de elementos. En este caso, tenemos un vector con los colores, y despu√©s los colores que yo considero que son m√°s lindos, y queremos saber cu√°l es est√°n dentro de este grupo de colores m√°s lindos:\ncolores \u0026lt;- c(\u0026#34;rojo\u0026#34;, \u0026#34;verde\u0026#34;, \u0026#34;azul\u0026#34;, \u0026#34;rosado\u0026#34;, \u0026#34;amarillo\u0026#34;, \u0026#34;morado\u0026#34;, \u0026#34;naranjo\u0026#34;, \u0026#34;gris\u0026#34;, \u0026#34;lavanda\u0026#34;, \u0026#34;celeste\u0026#34;) lindos \u0026lt;- c(\u0026#34;morado\u0026#34;, \u0026#34;rosado\u0026#34;) colores %in% lindos [1] FALSE FALSE FALSE TRUE FALSE TRUE FALSE FALSE FALSE FALSE Luego, aplicaremos el mismo principio, pero dentro de un if_else(), para asignarle la categor√≠a lindo o feo a cada uno de los colores:\nopini√≥n \u0026lt;- ifelse(colores %in% lindos, yes = \u0026#34;lindos\u0026#34;, no = \u0026#34;feos\u0026#34;) opini√≥n [1] \u0026quot;feos\u0026quot; \u0026quot;feos\u0026quot; \u0026quot;feos\u0026quot; \u0026quot;lindos\u0026quot; \u0026quot;feos\u0026quot; \u0026quot;lindos\u0026quot; \u0026quot;feos\u0026quot; \u0026quot;feos\u0026quot; [9] \u0026quot;feos\u0026quot; \u0026quot;feos\u0026quot; Finalmente, podemos hacer una tabla con los resultados, o una suma condicionada, para saber cu√°ntos colores caen en cada categor√≠a:\ntable(opini√≥n) opini√≥n feos lindos 8 2 paste(\u0026#34;Hay\u0026#34;, sum(opini√≥n == \u0026#34;feos\u0026#34;), \u0026#34;colores feos,\u0026#34;, \u0026#34;y\u0026#34;, sum(opini√≥n == \u0026#34;lindos\u0026#34;), \u0026#34;colores lindos\u0026#34;) [1] \u0026quot;Hay 8 colores feos, y 2 colores lindos\u0026quot; Conclusi√≥n Si bien en estas instrucciones no aprendimos a analizar datos, si considero que comprender estos principios es algo fundamental para poder pasar al an√°lisis de datos teniendo dudas recurrentes despejadas y una familiaridad con elementos b√°sicos del lenguaje que es necesaria. Por ejemplo, saber lo que es un vector, o entender las particularidades de los tipos o clases, ahorra caer en los errores m√°s recurrentes de personas que entran a R a trabajar directamente con tablas de datos sin entender qu√© est√° pasando internamente.\nEl entender c√≥mo funcionan estas peque√±as herramientas, y familiarizarse con su uso nos facilitar√° bastante la aplicaci√≥n del lenguaje al procesamiento de tablas, bases de datos, y otras situaciones en las que podemos aplicar R para ayudarnos y para producir resultados.\nSi entendiste este tutorial y quieres pasar al siguiente nivel, revisa Herramientas b√°sicas para programar con R para aprender c√≥mo aplicar lo que aprendiste dentro de flujos de procesamiento de datos m√°s complejos. Luego podr√≠as atreverte a intentar con este otro tutorial, en el cual se abarcan herramientas b√°sicas de manipulaci√≥n de datos: Introducci√≥n a {dplyr} con datos de poblaci√≥n.\nSi este tutorial te sirvi√≥, por favor considera hacerme una donaci√≥n, al menos para poder tomarme un cafecito ü•∫\nSi ejecutamos una l√≠nea incompleta, puede ser que la consola de R quede esperando que terminemos la expresi√≥n o que la completemos, y esto puede ser muy confuso para usuarios principiantes. Por ejemplo, si ejecutamos 1 +, la consola va a quedar esperando que le demos el n√∫mero que est√° esperando que venga, y cualquier otra cosa que le entreguemos va a intentar sum√°rsela a la operaci√≥n anterior que qued√≥ inconclusa.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-11-16T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/r_basico/","tags":"funciones","title":"Introducci√≥n al lenguaje de programaci√≥n R"},{"content":"Esta es la segunda gu√≠a introductoria para aprender el lenguaje de programaci√≥n R orientado al an√°lisis de datos. En la gu√≠a anterior vimos los principios m√°s fundamentales del lenguaje R, para familiarizarnos con R y entender su funcionamiento b√°sico. En esta segunda gu√≠a, seguiremos puliendo nuestros aprendizajes para aprender herramientas de programaci√≥n poderosas que flexibilizar√°n mucho nuestras capacidades de an√°lisis de datos, abriendo infinitas posibilidades.\nEn esta gu√≠a, aprenderemos herramientas que nos permitir√°n a:\nCrear herramientas que nos permitan hacer lo que necesitamos (crear funciones) Condicionar lo que queremos que ocurra en nuestros procesos (controlar el flujo) Hacer lo que necesitamos repetidamente (realizar iteraciones o loops) Crear funciones La creaci√≥n de funciones nos abre las puertas a todo el mundo nuevo en el uso de R para analizar nuestros datos, dado que, una vez que te familiarizas con la creaci√≥n de funciones, ya no depende solamente de las herramientas existentes, sino que empiezas a hacer t√∫ quien crea nuevas herramientas adaptadas a tus propias necesidades.\nLa anterior tiene el enorme beneficio de permitirte personalizar las herramientas que utilices para analizar datos a tu forma de trabajo, a las especificidades de tus datos, y a las particularidades del proceso que est√©s llevando a cabo. Quiz√°s el aspecto m√°s satisfactorio de la creaci√≥n de funciones sea poder englobar un proceso largo y complejo en una funci√≥n llamada procesar_datos(), o poder generar un gr√°fico detallado y atractivo tan s√≥lo con llamar graficar()!\nPara crear una funci√≥n se usa, valga la redundancia, la funci√≥n function(). Dentro de function() se definen los argumentos, que \u0026mdash;como sabemos\u0026mdash; son los elementos que pasamos dentro de la funci√≥n para que √©sta opere. Luego de function() se abren unos par√©ntesis de llave, dentro de los cuales definiremos qu√© har√° la funci√≥n con los argumentos que le entregamos, y que retornar√°. Con retornar nos referimos a el producto final de esta funci√≥n; es decir, lo que nos entrega al ejecutarla.\nDefinamos el nombre, los argumentos, y el cuerpo de una nueva funci√≥n:\nmultiplicar_mil \u0026lt;- function(cifra) { cifra * 1000 } En este ejemplo, estamos creando una funci√≥n que se llamar√° multiplicar_mil(). La funci√≥n tendr√° un solo argumento, llamado cifra. Dentro del cuerpo de la funci√≥n, vemos que el objeto cifra, que viene desde el argumento, se multiplica por 1000. Como esta es la √∫nica y √∫ltima operaci√≥n dentro del cuerpo de la funci√≥n, su resultado ser√° lo que se retorne al ejecutarla.\nProbemos nuestra primera funci√≥n y veamos su comportamiento:\nmultiplicar_mil(4) [1] 4000 multiplicar_mil(\u0026#34;hola\u0026#34;) Error in cifra * 1000: non-numeric argument to binary operator multiplicar_mil(c(32, 65, 87)) [1] 32000 65000 87000 Hagamos otro ejemplo:\npersonas \u0026lt;- c(\u0026#34;Basti\u0026#34;, \u0026#34;Paula\u0026#34;, \u0026#34;Catherine\u0026#34;, \u0026#34;Luis\u0026#34;, \u0026#34;Mar√≠a Jos√©\u0026#34;) saludar \u0026lt;- function(persona) { paste(\u0026#34;¬°Hola \u0026#34;, persona, \u0026#34;!\u0026#34;, sep = \u0026#34;\u0026#34;) } saludar(personas) [1] \u0026quot;¬°Hola Basti!\u0026quot; \u0026quot;¬°Hola Paula!\u0026quot; \u0026quot;¬°Hola Catherine!\u0026quot; [4] \u0026quot;¬°Hola Luis!\u0026quot; \u0026quot;¬°Hola Mar√≠a Jos√©!\u0026quot; saludar(\u0026#34;Caro\u0026#34;) [1] \u0026quot;¬°Hola Caro!\u0026quot; En esta funci√≥n, el argumento persona expuesto dentro de una funci√≥n paste() que genera un texto a partir de argumento. Como en el primer ejemplo se le entrega un vector a la funci√≥n, paste() produce m√∫ltiples textos con cada elemento del vector. O sea que nuestra funci√≥n funciona tanto para m√∫ltiples elementos como para uno solo.\nPasemos a una versi√≥n m√°s compleja de la funci√≥n anterior:\nsaludar \u0026lt;- function(persona) { # pasar el nombre a may√∫sculas nombre_mayuscula \u0026lt;- toupper(persona) # crear un saludo uniendo el texto con el argumento saludo \u0026lt;- paste(\u0026#34;¬°Hola \u0026#34;, nombre_mayuscula, \u0026#34;!\u0026#34;, sep = \u0026#34;\u0026#34;) # crear n√∫meros al azar n√∫meros \u0026lt;- sample(1:99, length(persona)) # uno por persona # agregar n√∫meros de la suerte saludo2 \u0026lt;- paste(saludo, \u0026#34;Tu n√∫mero de la suerte es\u0026#34;, n√∫meros) saludo2 } saludar(personas) [1] \u0026quot;¬°Hola BASTI! Tu n√∫mero de la suerte es 57\u0026quot; [2] \u0026quot;¬°Hola PAULA! Tu n√∫mero de la suerte es 21\u0026quot; [3] \u0026quot;¬°Hola CATHERINE! Tu n√∫mero de la suerte es 58\u0026quot; [4] \u0026quot;¬°Hola LUIS! Tu n√∫mero de la suerte es 10\u0026quot; [5] \u0026quot;¬°Hola MAR√çA JOS√â! Tu n√∫mero de la suerte es 24\u0026quot; En este caso, dentro del cuerpo de la funci√≥n estamos realizando varias operaciones. Dentro de una funci√≥n podemos crear nuevos objetos, y usar esos nuevos objetos para realizar otras operaciones sobre ellos. De este modo podemos llevar a cabo acciones m√°s complejas. En el ejemplo, el argumento de la funci√≥n es transformado a may√∫sculas con toupper(), luego se inserta dentro del texto con paste(). Despu√©s, se crea un vector de n√∫meros al azar que contenga una cantidad de n√∫meros igual a la cantidad de elementos del vector que viene del argumento de la funci√≥n, para que haya un n√∫mero por persona. Finalmente, se usa nuevamente paste() junto a sample() para agregar el n√∫mero aleatorio, y se entrega el objeto final, que ser√° lo que la funci√≥n retorna.\nLas funciones pueden tener m√°s de un argumento. Creemos una funci√≥n que use dos argumentos para calcular una estimaci√≥n de tiempo de viaje a partir de una velocidad y una distancia dados:\ncalcular_tiempo \u0026lt;- function(velocidad, distancia) { # el tiempo de viaje equivale a la distancia dividida por la velocidad tiempo \u0026lt;- distancia/(velocidad/60) # pasar km/h a km/minutos paste(\u0026#34;Tiempo de viaje:\u0026#34;, round(tiempo, 1), \u0026#34;minutos\u0026#34;) } calcular_tiempo(velocidad = 20, distancia = 5) [1] \u0026quot;Tiempo de viaje: 15 minutos\u0026quot; En este ejemplo, una funci√≥n que calcula el tiempo de viaje requiere dos argumentos: la velocidad y la distancia. Dentro de function() simplemente se definen los nombres de los argumentos, y se usan dentro del cuerpo de la funci√≥n para calcular lo necesario.\nAl momento de ejecutar una funci√≥n, si ponemos los argumentos en el orden en que se especifican en la funci√≥n, no es necesario que pongamos el nombre del argumento antes de el valor:\ncalcular_tiempo(velocidad = 22, distancia = 6) [1] \u0026quot;Tiempo de viaje: 16.4 minutos\u0026quot; calcular_tiempo(22, 6) [1] \u0026quot;Tiempo de viaje: 16.4 minutos\u0026quot; Tambi√©n podemos especificar valores por defecto para los argumentos al momento de crear la funci√≥n. √âstos valores por defecto ser√°n aplicados si es que el/la usuario/a no define los argumentos.\n# ejecutar funci√≥n sin argumentos calcular_tiempo() Error in calcular_tiempo(): argument \u0026quot;distancia\u0026quot; is missing, with no default Como no definimos los argumentos, la funci√≥n retorna un error. Modifiquemos la funci√≥n para que tenga argumentos por defecto:\n# actualizar funci√≥n con valores por defecto calcular_tiempo \u0026lt;- function(velocidad = 0, distancia = 1) { tiempo \u0026lt;- distancia/(velocidad/60) paste(\u0026#34;Tiempo de viaje:\u0026#34;, round(tiempo, 1), \u0026#34;minutos\u0026#34;) } # volver a ejecutar sin argumentos, por lo que usar√° los argumentos por defecto calcular_tiempo() [1] \u0026quot;Tiempo de viaje: Inf minutos\u0026quot; Ahora la funci√≥n no tira un error si no se definen los argumentos, aunque el resultado que entrega en estos casos no sea muy √∫til üòÖ\n¬øC√≥mo puede ayudarte la creaci√≥n de funciones para el an√°lisis de datos?\nSi realizas una misma tarea frecuentemente, puedes guardarla a una funci√≥n para as√≠ reutilizar la operaci√≥n en varios momentos de tu c√≥digo. Si realizas una operaci√≥n matem√°tica o estad√≠stica sobre una columna, puedes guardarla como una funci√≥n para simplificar la lectura del c√≥digo Puedes simplificar los pasos de tu procesamiento de datos guard√°ndolos como funciones, cuya entrada son los datos y la salida son los datos procesados. De este modo puedes ocultar la complejidad, lo que produce scripts m√°s legibles. Puedes definir todas tus funciones en otro script, permiti√©ndote as√≠ tener scripts m√°s ordenados y menos extensos. Control de flujo Las estructuras de control de flujo son el conjunto de reglas que hacen que, dentro de un proceso de an√°lisis de datos, se realicen (o no) ciertas acciones si es que condiciones espec√≠ficas se cumplen, o bien, que no ocurran ciertas cosas si es que las condiciones no lo permiten. En otras palabras, es una forma de hacer que tu proceso de an√°lisis de datos adquiera fluidez, al definir momentos en los que el flujo del procesamiento es determinado por las condiciones que tu definas.\n¬øEn qu√© situaciones podr√≠a ser √∫til el control de flujo del c√≥digo?\nSi un dato no cumple con un criterio espec√≠fico, corregirlo o descartarlo. Si los datos llegan en cierto estado, o con ciertas particularidades, realizar un paso extra de limpieza. Si dentro de los datos existen observaciones de ciertas caracter√≠sticas, visualizar los datos de una manera espec√≠fica. Si a la tabla de datos le falta una comuna columna, crearla. Si una columna viene en un tipo que no es el esperado, convertirla al apropiado. Si ocurre un error o el resultado no es aceptable, realizar la operaci√≥n de nuevo de una forma alternativa. En la pr√°ctica, esta t√©cnica permite crear condicionalidad en la ejecuci√≥n del c√≥digo usando una comparaci√≥n, cuyo resultado (TRUE/FALSE) decide si el c√≥digo siguiente se ejecutar√° o no. El c√≥digo dentro de la condici√≥n s√≥lo se ejecuta si la comparaci√≥n retorna TRUE.\nCreemos un ejemplo donde definimos un vector de n√∫meros, y si alguno de estos n√∫meros cumple con un criterio espec√≠fico, realizaremos una operaci√≥n que corrija la situaci√≥n:\nedades \u0026lt;- c(15, 17, 18, 24, 29, 31, 34, 36, 45, 49, 52) edades [1] 15 17 18 24 29 31 34 36 45 49 52 # si viene alguna edad que sea menor a 18 a√±os, ejecutar lo siguiente if (any(edades \u0026lt; 18)) { # filtrar vector menores \u0026lt;- edades[edades \u0026lt; 18] message(paste(\u0026#34;Se detectaron registros menores de 18 a√±os: eliminando\u0026#34;, length(menores), \u0026#34;registros\u0026#34;)) # dejar solamente las edades que son igual o mayor a 18 edades \u0026lt;- edades[edades \u0026gt;= 18] } Se detectaron registros menores de 18 a√±os: eliminando 2 registros edades [1] 18 24 29 31 34 36 45 49 52 En este ejemplo, creamos un flujo de control donde un conjunto de datos se filtra s√≥lo si se cumple un cierto criterio. Se usa la funci√≥n any() para detectar si es que existe alg√∫n elemento dentro del vector que cumpla con el criterio de ser menor de 18 a√±os. Si esto es as√≠, se ejecuta el c√≥digo dentro del if, que detecta las observaciones problem√°ticas, emite un mensaje, y finalmente filtra el vector para dejar solamente las observaciones v√°lidas, y lo retorna sobreescribiendo el vector original.\nProbemos nuevamente cambiando el dato, agregando un mensaje que tambi√©n confirma si la condici√≥n no se cumple:\nedades \u0026lt;- c(31, 34, 36, 45, 49, 52, 62, 63) edades [1] 31 34 36 45 49 52 62 63 # si viene alguna edad que sea menor a 18 a√±os, ejecutar lo siguiente if (any(edades \u0026lt; 18)) { menores \u0026lt;- edades[edades \u0026lt; 18] message(paste(\u0026#34;Se detectaron registros menores de 18 a√±os: eliminando\u0026#34;, length(menores), \u0026#34;registros\u0026#34;)) edades \u0026lt;- edades[edades \u0026gt;= 18] } else { # emitir un mensaje si la condici√≥n no se cumple message(\u0026#34;OK: todos los registros corresponden a mayores de 18 a√±os\u0026#34;) } OK: todos los registros corresponden a mayores de 18 a√±os En el apartado else podemos especificar el c√≥digo que se ejecutar√° si la condici√≥n que especificamos en el if retorna FALSE, o bien, simplemente podemos omitir el apartado else para que en cuyo caso no ocurra nada, como en el ejemplo anterior.\nEl control de flujo resulta particularmente √∫til para crear funciones m√°s complejas. Dentro de las funciones puedes crear condicionales que realizan operaciones espec√≠ficas dependiendo de lo que se le entregue a la funci√≥n.\nTambi√©n podemos crear nuevos argumentos en la funci√≥n que se usen en condicionales para alterar la operaci√≥n de la funci√≥n. As√≠ puedes hacer que tu funci√≥n trabaje de forma distinta dependiendo de lo que le especifiques.\nBucles Los bucles o loops son operaciones extremadamente √∫tiles. Permiten generalizar tu c√≥digo, en el sentido que una operaci√≥n u operaciones que definas pueden aplicarse repetidas veces sobre distintos objetos, con un alto grado de libertad en el proceso.\nEn un bucle, se realiza una operaci√≥n m√∫ltiples veces en base a un vector que entregues. Por cada elemento del vector que entregues al bucle, el c√≥digo se ejecutar√°. En este sentido, el bucle tendr√° tantos pasos como elementos tenga el vector. Cuando entregas un vector al bucle, tambi√©n indicas c√≥mo se va a llamar la variable que representa al paso; es decir, la variable que va a contener el valor del vector que se corresponde al paso que se est√° ejecutando.\nPor ejemplo:\nnumeros \u0026lt;- c(1, 2, 3, 4) for (paso in numeros) { print(paso) } [1] 1 [1] 2 [1] 3 [1] 4 En este ejemplo, creamos un vector numeros que contiene n√∫meros del 1 al 4. Luego, definimos un bucle con el operador for, que en espa√±ol se leer√≠a \u0026ldquo;por cada\u0026rdquo;. El primer argumento que definimos luego del for es el nombre que tendr√° cada paso, luego in, y luego el vector. Entonces, se leer√≠a \u0026ldquo;por cada paso en numeros, ejecutar\u0026hellip;\u0026rdquo;. En el ejemplo, lo que se ejecutar√° es solamente retornar el valor de cada paso. Es decir, en el primer paso se retorna el valor 1 de numeros, en el segundo paso el valor 2, y as√≠ sucesivamente.\nOtro ejemplo m√°s concreto:\npasos \u0026lt;- 10:20 for (i in pasos) { texto \u0026lt;- paste(\u0026#34;este es el paso:\u0026#34;, i) print(texto) } [1] \u0026quot;este es el paso: 10\u0026quot; [1] \u0026quot;este es el paso: 11\u0026quot; [1] \u0026quot;este es el paso: 12\u0026quot; [1] \u0026quot;este es el paso: 13\u0026quot; [1] \u0026quot;este es el paso: 14\u0026quot; [1] \u0026quot;este es el paso: 15\u0026quot; [1] \u0026quot;este es el paso: 16\u0026quot; [1] \u0026quot;este es el paso: 17\u0026quot; [1] \u0026quot;este es el paso: 18\u0026quot; [1] \u0026quot;este es el paso: 19\u0026quot; [1] \u0026quot;este es el paso: 20\u0026quot; En este caso, tenemos un vector de 10 n√∫meros, por lo que el c√≥digo especificado se aplica a cada uno de los n√∫meros, usando el objeto i como si fuera el objeto que contiene el valor de cada paso (10, 11, 12, etc.).\nDentro de una iteraci√≥n tambi√©n podemos controlar el flujo del c√≥digo con if else:\nfor (persona in personas) { saludo \u0026lt;- paste(\u0026#34;Hola\u0026#34;, persona) if (persona == \u0026#34;Mar√≠a Jos√©\u0026#34;) { saludo \u0026lt;- paste0(\u0026#34;¬°Hola amiguita \u0026#34;, persona, \u0026#34;!\u0026#34;) } print(saludo) } [1] \u0026quot;Hola Basti\u0026quot; [1] \u0026quot;Hola Paula\u0026quot; [1] \u0026quot;Hola Catherine\u0026quot; [1] \u0026quot;Hola Luis\u0026quot; [1] \u0026quot;¬°Hola amiguita Mar√≠a Jos√©!\u0026quot; En este caso, ponemos una excepci√≥n con un if para que, en un paso espec√≠fico del loop, el comportamiento sea distinto.\nEn este ejemplo, controlamos el flujo del c√≥digo para que hayan m√∫ltiples condiciones, y para que en cada condici√≥n se haga algo distinto. Podemos evaluar m√∫ltiples condiciones con else if, que es una forma de hacer que si la comparaci√≥n anterior no coincidi√≥ con el valor, se intente se nuevo con la siguiente. Se pueden encadenar varios else if, y de este modo, se puede hacer que un solo valor vaya siendo evaluado en m√∫ltiples condiciones, a ver si coincide con alguna. Si coincide con alguna, se ejecuta el c√≥digo correspondiente a ese paso, y se sale del flujo. Pero si no coincide con ninguna, no pasar√° nada a menos que al final pongas un else que capture todos los dem√°s casos.\nfor (persona in personas) { if (persona == \u0026#34;Basti\u0026#34;) { saludo \u0026lt;- paste(\u0026#34;¬°Hola a todes!\u0026#34;) } else if (persona == \u0026#34;Catherine\u0026#34;) { saludo \u0026lt;- paste(\u0026#34;Excelente pregunta, Catherine\u0026#34;) } else if (persona == \u0026#34;Luis\u0026#34;) { saludo \u0026lt;- sample(c(\u0026#34;Serpiente\u0026#34;, \u0026#34;Perro\u0026#34;, \u0026#34;Gato\u0026#34;, \u0026#34;Rata\u0026#34;, \u0026#34;Gallina\u0026#34;, \u0026#34;Pez\u0026#34;), 1) } else { saludo \u0026lt;- paste(\u0026#34;Hola\u0026#34;, persona) } print(saludo) } [1] \u0026quot;¬°Hola a todes!\u0026quot; [1] \u0026quot;Hola Paula\u0026quot; [1] \u0026quot;Excelente pregunta, Catherine\u0026quot; [1] \u0026quot;Gallina\u0026quot; [1] \u0026quot;Hola Mar√≠a Jos√©\u0026quot; Por cada paso, el objeto persona asume el valor del elemento correspondiente del vector personas. El c√≥digo avanza dentro del loop probando si persona coincide con alguna de las condiciones dadas, y si no coincide, prueba si coincide la siguiente con else if, y al final, si el valor no coincidi√≥ con ninguna de las comparaciones espec√≠ficas de los if, entonces se realiza una operaci√≥n general para todos los dem√°s casos en else.\n¬øEn qu√© casos ser√≠a √∫til usar bucles o loops?\nSi tienes m√∫ltiples objetos, observaciones, o tablas de datos, a las cuales quiera realizarles una misma operaci√≥n a todas al mismo tiempo. Si realizaste un an√°lisis, pero tienes que volver a realizar este mismo an√°lisis sobre muchas versiones distintas de un conjunto de datos (por ejemplo, cuando los datos vienen separados en distintos archivos por mes o por a√±o). Si tienes la ubicaci√≥n de muchos archivos, y quieres cargarlos todos al mismo tiempo. Si tienes un conjunto de datos que puedes filtrar por una variable, y quieres generar m√∫ltiples visualizaciones a partir de el filtrado de cada una de las categor√≠as de dicha variable. Por ejemplo, si tienes un conjunto de datos de 10 pa√≠ses, puedes enterar por los nombres de los pa√≠ses para generar 10 gr√°ficos, uno para cada pa√≠s. Si tienes un conjunto de datos con muchas variables, y a todas las variables quieres calcularle estad√≠sticos descriptivos, defines el c√°lculo de los estad√≠sticos descriptivos una vez, y lo pones dentro de una iteraci√≥n que vaya por todas las columnas del dataframe. C√≥mo puedes ver, la creaci√≥n de funciones, el control de flujo, y los bucles o iteraciones son herramientas complementarias. Muchas veces, lo que podemos hacer con una funci√≥n queda mejor dentro de un bucle, o un bucle que dise√±amos puede ser insertado en una funci√≥n para nuestra conveniencia, y dentro de funciones o de bucle siempre vamos a estar usando el control de flujo para poder adaptarnos a todos los casos posibles que encontremos en nuestros datos.\nLuego de haber aprendido los contenidos de este tutorial, creo que podemos dar el siguiente paso, que es adentrarnos a los datos tabulares o dataframes, e introducirnos al uso de R para el an√°lisis de datos!\n","date":"2025-02-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/r_intermedio/","tags":"funciones ; control de flujo ; loops","title":"Herramientas b√°sicas para programar con R"},{"content":" Proyectos Antes de hacer cualquier trabajo que involucre datos con R, se recomienda crear un Proyecto de RStudio. Un proyecto es una forma de definir la carpeta espec√≠fica donde vamos a guardar todos los scripts y archivos que vamos a necesitar. Se caracteriza por un archivo que termina en .Rproj, que marca nuestro espacio de trabajo: una sola carpeta que re√∫ne todas las piezas de nuestro an√°lisis.\nExiste un post cl√°sico en la comunidad de R que explica esto mucho mejor: Project-oriented workflow, mejor conocido como si usas setwd() voy a ir a tu oficina a incendiar tu computador! ¬øPor qu√© trabajar con Proyectos? El objetivo de un proyecto es tener todos nuestros datos y c√≥digo en un s√≥lo lugar, por lo que se vuelven autcontenidos; es decir, funcionar√°n sin depender de nada que est√© fuera del proyecto.\nUn efecto secundario de lo anterior es que nuestros proyectos ser√°n port√°tiles: podremos cambiarlos de lugar en nuestro computador, abrirlos en otro computador, correrlos en la nube, o envi√°rselos a alguien m√°s, y gracias a que son autocontenidos, seguir√°n funcionando.\nA trav√©s del tiempo vamos a trabajar con distintas fuentes de datos, para objetivos distintos, incluso para llevar a cabo ideas o trabajos completamente diferentes. Los proyectos de RStudio nos permiten separar distintos espacios de trabajo, sin que los resultados de un proyecto contagien a otro. Si tenemos m√∫ltiples proyectos en los que trabajamos con R, al delimitarlos por medio de proyectos de RStudio podremos cambiar entre proyectos de manera r√°pida y sencilla.\nTambi√©n podremos tener distintas sesiones de R abiertas al mismo tiempo, en distintas ventanas de RStudio, cada una con proyectos distintos. Esto significa que cada proyecto de R va a tener un entorno distinto y scripts distintos. De esta forma, no mezclamos cosas ni nos confundimos.\nBeneficios de trabajar con Proyectos El beneficio principal de trabajar con proyectos en R es que simplifican much√≠simo la gesti√≥n de las rutas de archivos. Todos los archivos con los que trabajamos nuestros computadores se encuentran en ubicaciones distintas, y estas ubicaciones var√≠an entre computador y computador, y entre distintas personas. Por ejemplo, los datos con lo que yo trabajo est√°n en una carpeta que t√∫ no tienes en tu computador, y estas carpetas est√°n a su vez dentro de una carpeta de usuario, que es distinto para cada persona. Peor a√∫n, las estructuras de archivos son distintas en los diferentes sistemas operativos. Al crear un proyecto de RStudio, las rutas de todos los archivos dentro del proyecto empezar√°n desde la carpeta del proyecto. Esto significa que, si trabajamos en un proyecto de RStudio, podemos omitir completamente las rutas completas del archivo en nuestros computadores.\nEn t√©rminos pr√°cticos, un archivo que est√° ubicado en una carpeta como /home/users/bastian/Documentos/An√°lisis de datos/Trabajo/Ejemplo/script.R podr√° ser cargado tan solo con la ruta script.R si abrimos un proyecto de R e la carpeta Ejemplo. Esto es bueno por dos razones: porque no tendremos que escribir la ruta del archivo completa, y porque si yo env√≠o este proyecto a otra persona, o lo subo a internet para compartirlo, cualquier persona podr√° ejecutar los scripts en sus computadores, porque los archivos dentro del proyecto podr√°n estar en cualquier lugar de su computador, pero gracias al proyecto, R encontrar√° los archivos.\nCrear un proyecto Para crear un proyecto nuevo, elegimos la opci√≥n New Project\u0026hellip; en el men√∫ File, o apretamos el √≠cono del cubo celeste ubicado en la esquina superior derecha de RStudio y elegimos la primera opci√≥n.\nUna vez que creamos el proyecto, podemos abrir nuestro proyecto haciendo doble clic en el archivo que termina en \u0026ldquo;.Rproj\u0026rdquo;, seleccionando en RStudio el men√∫ File y el √≠tem Open Project\u0026hellip; o Recent Projects, o en la esquina superior derecha de RStudio, donde aparece un icono celeste que contiene los proyectos recientes.\nEs muy importante que, antes de empezar a trabajar con R, te asegures de que est√°s dentro del proyecto correcto!\n","date":"2025-01-04T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/proyectos/","tags":"consejos","title":"Organizar el trabajo en Proyectos de RStudio"},{"content":"Luego de haber aprendido las funcionalidades b√°sicas del lenguaje R, y habernos familiarizado con herramientas un poco m√°s avanzadas de la programaci√≥n en este lenguaje, ahora podemos aplicar estos aprendizajes a los datos. Aprenderemos a explorar, comprender, y navegar tablas de datos, tanto en la forma nativa de trabajar con R, como con la ayuda del paquete {dplyr}.\n{dplyr} La herramienta que utilizaremos para explorar, manipular, y transformar datos ser√° el paquete {dplyr}. Este paquete, parte central del conjunto Tidyverse de herramientas para el an√°lisis de datos con R, es uno de los m√°s usados por la comunidad de R por su facilidad de uso.\nSe caracteriza porque casi todas sus funciones son escritas por medio de verbos, lo que hace que su sintaxis sea muy legible, ya que cada funci√≥n se corresponde con una acci√≥n que estamos realizando sobre nuestros datos.\nNota sobre el uso de {dplyr} Probablemente el 98% de las cosas que necesitemos hacer con tablas de datos en R puedan hacerse por medio de {dplyr} y otros paquetes adyacentes a √©l. En mi opini√≥n esto es bueno, porque creo que {dplyr} hace todo m√°s sencillo, ordenado y f√°cil de interpretar. Sin embargo, creo que tambi√©n es importante entender c√≥mo se realizan las operaciones b√°sicas sobre los datos con R base. Esto porque un entendimiento \u0026mdash;aunque sea b√°sico\u0026mdash; de R base nos va a ayudar a comprender mejor el funcionamiento del lenguaje, y nos puede sacar de posibles problemas que encontremos. Es por esto que en este tutorial iremos viendo c√≥mo realizar las operaciones b√°sicas de manipulaci√≥n de datos primero con R base y luego con {dplyr}.\nInstalaci√≥n Para usar el paquete {dplyr}, as√≠ como cualquier otro paquete de R que no venga instalado por defecto, tenemos que instalarlo desde internet. La instalaci√≥n de los paquetes en R se facilita por la funci√≥n install.packages(), que se conecta a un servidor centralizado donde todos los paquetes son revisados y verificados manualmente por revisores humanos, para garantizar que sean seguros de usar y funcionales.\nInstalamos {dplyr} con el siguiente comando:\ninstall.packages(\u0026#34;dplyr\u0026#34;) As√≠ como cuando instalamos una aplicaci√≥n en nuestro celular o computador, solamente necesitamos instalar el paquete una vez. Pero cuando queramos usar el paquete, debemos cargarlo, que ser√≠a equivalente a abrir una aplicaci√≥n ya instalada en tu celular o computador.\nPara cargar un paquete se utiliza la funci√≥n library():\nlibrary(\u0026#34;dplyr\u0026#34;) Attaching package: 'dplyr' The following objects are masked from 'package:stats': filter, lag The following objects are masked from 'package:base': intersect, setdiff, setequal, union Despu√©s de cargar un paquete puede ser que aparezcan mensajes en la consola, pero en general podemos ignorarlos.\nDatos Las tablas de datos, tambi√©n conocidas como dataframes, son formas de almacenar informaci√≥n por medio de filas y columnas. Usualmente, las filas corresponden a observaciones, y las columnas corresponden a variables, pero no siempre esto se cumple. Otra caracter√≠stica de las tablas o dataframes es que son rectangulares: todas las columnas tienen la misma cantidad de filas.\nUsemos {dplyr} para tener nuestra primera aproximaci√≥n a los datos en tablas construyendo una tabla. C√≥mo planteamos en el primer tutorial, las tablas de datos en R son construidas a partir de vectores, o dicho de otra forma, las columnas de las tablas son vectores.\nCrear una tabla Creemos unos vectores y luego hagamos una tabla a partir de ellos:\nanimal \u0026lt;- c(\u0026#34;gato\u0026#34;, \u0026#34;paloma\u0026#34;, \u0026#34;rana\u0026#34;, \u0026#34;pollo\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;serpiente\u0026#34;) tipo \u0026lt;- c(\u0026#34;mam√≠fero\u0026#34;, \u0026#34;ave\u0026#34;, \u0026#34;anfibio\u0026#34;, \u0026#34;ave\u0026#34;, \u0026#34;mam√≠fero\u0026#34;, \u0026#34;reptil\u0026#34;) patas \u0026lt;- c(4, 2, 4, 2, 4, 0) Creamos tres vectores, que ser√°n las columnas de nuestra tabla. Confirmemos que tienen el mismo largo:\n# confirmar que los tres casos se cumplen all(length(animal) == 6, length(tipo) == 6, length(patas) == 6) [1] TRUE Ahora, usemos los vectores para crear una tabla con {dplyr}:\n# crear una tabla con los vectores tabla \u0026lt;- tibble(animal, tipo, patas) tabla # A tibble: 6 √ó 3 animal tipo patas \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 gato mam√≠fero 4 2 paloma ave 2 3 rana anfibio 4 4 pollo ave 2 5 mapache mam√≠fero 4 6 serpiente reptil 0 Esta es la salida en la consola que tienen los dataframes creados con {dplyr}. En ella, podemos ver en la primera fila de texto en largo y ancho de la tabla (n√∫mero de filas y columnas). Luego vemos los nombres de las tres columnas, y debajo de ellos vemos el tipo de cada columna (caracter, caracter y num√©rico). Las siguientes filas corresponden a los datos mismos de la tabla.\nExplorar una tabla Exploremos un poco las caracter√≠sticas de una tabla o dataframe:\nclass(tabla) [1] \u0026quot;tbl_df\u0026quot; \u0026quot;tbl\u0026quot; \u0026quot;data.frame\u0026quot; Las tablas creadas con {dplyr} son de la clase \u0026quot;tbl_df\u0026quot;, que hace referencia a tibble, el tipo espec√≠fico de tablas de datos de este paquete, que son m√°s amigables y f√°ciles de leer.\nlength(tabla) [1] 3 Se consultamos el largo del objeto con length(), obtenemos el n√∫mero de columnas. Si queremos saber el n√∫mero de filas, usamos nrow():\nnrow(tabla) [1] 6 Si queremos saber los nombres de las columnas de una tabla, podemos usar names(), o bien, la funci√≥n glimpse(), que nos entrega un conveniente vistazo de los datos de nuestra tabla:\nnames(tabla) [1] \u0026quot;animal\u0026quot; \u0026quot;tipo\u0026quot; \u0026quot;patas\u0026quot; glimpse(tabla) Rows: 6 Columns: 3 $ animal \u0026lt;chr\u0026gt; \u0026quot;gato\u0026quot;, \u0026quot;paloma\u0026quot;, \u0026quot;rana\u0026quot;, \u0026quot;pollo\u0026quot;, \u0026quot;mapache\u0026quot;, \u0026quot;serpiente\u0026quot; $ tipo \u0026lt;chr\u0026gt; \u0026quot;mam√≠fero\u0026quot;, \u0026quot;ave\u0026quot;, \u0026quot;anfibio\u0026quot;, \u0026quot;ave\u0026quot;, \u0026quot;mam√≠fero\u0026quot;, \u0026quot;reptil\u0026quot; $ patas \u0026lt;dbl\u0026gt; 4, 2, 4, 2, 4, 0 Seleccionar datos Recordemos que podemos extraer subconjuntos de los vectores usando los corchetes []:\nanimal[5] [1] \u0026quot;mapache\u0026quot; animal[4:5] [1] \u0026quot;pollo\u0026quot; \u0026quot;mapache\u0026quot; animal[c(1, 2, 4)] [1] \u0026quot;gato\u0026quot; \u0026quot;paloma\u0026quot; \u0026quot;pollo\u0026quot; Con los vectores es sencillo, porque un vector es una unidad de datos unidimensional, donde con un n√∫mero podemos seleccionar cualquiera de los elementos contenidos en el vector.\nLas tablas de datos no son unidimensionales, sino bidimensionales, dado que tienen filas y columnas. Entonces, para poder extraer elementos de distintas posiciones de una tabla, dentro de los corchetes habr√° que indicar sus filas y/o columnas. Tenemos que indicar ya no s√≥lo uno, sino dos argumentos: el primero refiere a las filas, y el segundo a las columnas.\ntabla[2, 3] # A tibble: 1 √ó 1 patas \u0026lt;dbl\u0026gt; 1 2 En este caso, extrajimos la observaci√≥n que se encuentra en la fila 2 y en la columna 3.\nFilas Para extraer una fila de una tabla, dentro de los corchetes debemos indicar la posici√≥n de la fila, separado por una coma, y dejar en blanco el segundo argumento, que ser√≠a la selecci√≥n de columnas.\ntabla[1, ] # A tibble: 1 √ó 3 animal tipo patas \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 gato mam√≠fero 4 Indicando s√≥lo el n√∫mero de fila 1 y dejando en blanco la ubicaci√≥n de la columna, seleccionamos la fila 1 entera.\nTambi√©n podemos usar la funci√≥n slice() para extraer una fila de una tabla:\nslice(tabla, 5) # A tibble: 1 √ó 3 animal tipo patas \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 mapache mam√≠fero 4 Si queremos extraer la √∫ltima fila de una tabla, podemos combinar slice() con la funci√≥n nrow() que nos entrega la cantidad de filas de una tabla, resultando en extraer la fila que corresponde con el n√∫mero de filas; es decir, la √∫ltima:\nslice(tabla, nrow(tabla)) # A tibble: 1 √ó 3 animal tipo patas \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 serpiente reptil 0 Columnas Para extraer una columna, debemos indicar su posici√≥n en el segundo argumento dentro de los corchetes, dejando el primero vac√≠o:\ntabla[, 1] # A tibble: 6 √ó 1 animal \u0026lt;chr\u0026gt; 1 gato 2 paloma 3 rana 4 pollo 5 mapache 6 serpiente Tambi√©n podemos indicar el nombre de la columna, entre comillas, para seleccionarla:\ntabla[, \u0026#34;animal\u0026#34;] # A tibble: 6 √ó 1 animal \u0026lt;chr\u0026gt; 1 gato 2 paloma 3 rana 4 pollo 5 mapache 6 serpiente Puede para ser extra√±o dejar la coma por s√≠ sola dentro del corchete, as√≠ que en su lugar podemos usar la funci√≥n select() para seleccionar columnas:\nselect(tabla, 1) # A tibble: 6 √ó 1 animal \u0026lt;chr\u0026gt; 1 gato 2 paloma 3 rana 4 pollo 5 mapache 6 serpiente select(tabla, \u0026#34;tipo\u0026#34;) # A tibble: 6 √ó 1 tipo \u0026lt;chr\u0026gt; 1 mam√≠fero 2 ave 3 anfibio 4 ave 5 mam√≠fero 6 reptil Otra forma de extraer una columna de una tabla de datos es abrir la tabla usando el operador $. Al escribir el nombre de la tabla de datos seguido del operador $, RStudio sugerir√° los nombres de las columnas para que puedas extraerlas:\ntabla$animal [1] \u0026quot;gato\u0026quot; \u0026quot;paloma\u0026quot; \u0026quot;rana\u0026quot; \u0026quot;pollo\u0026quot; \u0026quot;mapache\u0026quot; \u0026quot;serpiente\u0026quot; A usar el operador $ para extraer columnas, se obtiene el vector que se us√≥ para crear la columna, as√≠ que recibimos los datos en forma de vector.\nLa misma extracci√≥n de una columna como vector puede hacerse con la funci√≥n pull() de {dplyr}, donde se entrega la tabla y la columna, y se obtiene la columna como vector:\npull(tabla, animal) [1] \u0026quot;gato\u0026quot; \u0026quot;paloma\u0026quot; \u0026quot;rana\u0026quot; \u0026quot;pollo\u0026quot; \u0026quot;mapache\u0026quot; \u0026quot;serpiente\u0026quot; Crear columnas Si queremos agregar una nueva columna a nuestro dataframe, tenemos que hacer una mezcla entre la extracci√≥n de columnas con el operador $ y la asignaci√≥n de nuevos objetos:\nSi intentamos extraer una columna que no existe, recibimos un error:\ntabla$habitat Warning: Unknown or uninitialised column: `habitat`. NULL Sin embargo, si creamos un vector encima de esta columna que a√∫n no existe, √©sta se crea:\ntabla$habitat \u0026lt;- c(\u0026#34;urbano\u0026#34;, \u0026#34;urbano\u0026#34;, \u0026#34;rural\u0026#34;, \u0026#34;rural\u0026#34;, \u0026#34;urbano\u0026#34;, \u0026#34;rural\u0026#34;) tabla # A tibble: 6 √ó 4 animal tipo patas habitat \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 urbano 2 paloma ave 2 urbano 3 rana anfibio 4 rural 4 pollo ave 2 rural 5 mapache mam√≠fero 4 urbano 6 serpiente reptil 0 rural En otras palabras, para crear una nueva columna simplemente especificamos su nombre como parte de la tabla existente, y asignamos los datos que queremos que se contengan en esta nueva columna.\nOtra forma de crear columnas es con la funci√≥n mutate(), que nos permite crear o modificar columnas existentes:\nmutate(tabla, cola = c(\u0026#34;s√≠\u0026#34;, \u0026#34;s√≠\u0026#34;, \u0026#34;no\u0026#34;, \u0026#34;no\u0026#34;, \u0026#34;s√≠\u0026#34;, \u0026#34;toda\u0026#34;)) # A tibble: 6 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 urbano s√≠ 2 paloma ave 2 urbano s√≠ 3 rana anfibio 4 rural no 4 pollo ave 2 rural no 5 mapache mam√≠fero 4 urbano s√≠ 6 serpiente reptil 0 rural toda La diferencia es que con mutate() solamente estamos previsualizando el cambio, dado que no hemos asignado nada. Si queremos que la columna realmente se guarde en el dataframe, debemos asignar el resultado a un objeto nuevo, o sobreescribir el actual:\n# sobreescribir la tabla con la columna nueva tabla \u0026lt;- mutate(tabla, cola = c(\u0026#34;s√≠\u0026#34;, \u0026#34;s√≠\u0026#34;, \u0026#34;no\u0026#34;, \u0026#34;no\u0026#34;, \u0026#34;s√≠\u0026#34;, \u0026#34;toda\u0026#34;)) Filtrar datos Una de las tareas m√°s recurrentes que vamos a hacer con tablas de datos, sobre todo cuando son muy grandes, es filtrar la informaci√≥n. El filtrado de datos funciona a partir de comparaciones, dado que al filtrar estamos especificando un criterio que deben cumplir los valores para mantenerse en la tabla, y todos los valores que no cumplan este criterio ser√°n removidos.\nEntonces, para filtrar datos, escribimos una comparaci√≥n que coincida (retorne TRUE) con los valores que deseamos recibir.\nSupongamos que queremos ver solamente las observaciones donde el valor de la variable patas sea mayor que 2. Primero, planteemos la comparaci√≥n:\n# extraer los valores de la columna `patas` tabla$patas [1] 4 2 4 2 4 0 # comparar los valores con el n√∫mero 2 tabla$patas \u0026gt; 2 [1] TRUE FALSE TRUE FALSE TRUE FALSE A partir de las comparaciones, recibimos una secuencia de valores l√≥gicos (TRUE/FALSE) que indican si cada elemento del vector cumpli√≥ o no con la comparaci√≥n planteada. Entonces, en principio, queremos mantener solamente las observaciones que retornaron TRUE.\nRecordemos que para filtrar filas de una tabla, dentro de los corchetes especificamos en la primera posici√≥n las filas que queremos extraer.\ntabla[1, ] # A tibble: 1 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 urbano s√≠ Esto, sumado a lo anterior, son los principios que usaremos para filtrar las filas de una tabla de datos:\ntabla[tabla$patas \u0026gt; 2, ] # A tibble: 3 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 urbano s√≠ 2 rana anfibio 4 rural no 3 mapache mam√≠fero 4 urbano s√≠ Usamos la comparaci√≥n que retorna verdaderos y falsos dentro de los corchetes para seleccionar las filas de la tabla. Entonces, como el vector de la comparaci√≥n entre el mismo largo que las filas de la tabla, en cada posici√≥n de la comparaci√≥n que se obtuvo TRUE, se muestra la fila correspondiente, y si se obtuvo FALSE, se omite.\nOtros ejemplos de filtrado:\ntabla$animal == \u0026#34;mapache\u0026#34; [1] FALSE FALSE FALSE FALSE TRUE FALSE tabla[tabla$animal == \u0026#34;mapache\u0026#34;, ] # A tibble: 1 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 mapache mam√≠fero 4 urbano s√≠ Una segunda opci√≥n es usar la funci√≥n subset() de R base para filtrar tablas:\nsubset(tabla, patas \u0026lt; 3) # A tibble: 3 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 paloma ave 2 urbano s√≠ 2 pollo ave 2 rural no 3 serpiente reptil 0 rural toda subset(tabla, animal == \u0026#34;pollo\u0026#34;) # A tibble: 1 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 pollo ave 2 rural no La alternativa de {dplyr}, filter(), es similar a subset(), pero tiene otras conveniencias que aprenderemos m√°s adelante:\nfilter(tabla, tipo != \u0026#34;ave\u0026#34;) # A tibble: 4 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 urbano s√≠ 2 rana anfibio 4 rural no 3 mapache mam√≠fero 4 urbano s√≠ 4 serpiente reptil 0 rural toda filter(tabla, animal %in% c(\u0026#34;mapache\u0026#34;, \u0026#34;gato\u0026#34;)) # A tibble: 2 √ó 5 animal tipo patas habitat cola \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 urbano s√≠ 2 mapache mam√≠fero 4 urbano s√≠ Renombrar columnas Para cambiar el nombre de una de las columnas, hay varias formas.\nUna forma, quiz√°s m√°s rudimentaria, ser√≠a crear una columna nueva con el nombre que deseamos, a partir de una columna existente, para luego eliminar la columna original:\n# columna original tabla$habitat [1] \u0026quot;urbano\u0026quot; \u0026quot;urbano\u0026quot; \u0026quot;rural\u0026quot; \u0026quot;rural\u0026quot; \u0026quot;urbano\u0026quot; \u0026quot;rural\u0026quot; # crear columna nueva a partir de la original tabla$zona \u0026lt;- tabla$habitat # eliminar la columna original tabla$habitat \u0026lt;- NULL # revisar cambios names(tabla) [1] \u0026quot;animal\u0026quot; \u0026quot;tipo\u0026quot; \u0026quot;patas\u0026quot; \u0026quot;cola\u0026quot; \u0026quot;zona\u0026quot; √âste procedimiento es similar al que vimos para crear nuevas columnas, ya que implica crear una columna que no existe a√∫n (zona), a partir de un valor, en este caso, una columna de la misma tabla (tabla$habitat). De esta forma, duplicamos la columna, para luego eliminar la columna original al asignarle el valor nulo, NULL.\nOtra forma de renombrar columnas, aunque un poco confusa, es usando la funci√≥n names(), que nos entrega los nombres de las columnas:\n# obtener columnas names(tabla) [1] \u0026quot;animal\u0026quot; \u0026quot;tipo\u0026quot; \u0026quot;patas\u0026quot; \u0026quot;cola\u0026quot; \u0026quot;zona\u0026quot; Al obtener los nombres de las columnas, realizamos una selecci√≥n de la columna que queremos, usando los corchetes. Luego habr√≠a que asignar el nombre nuevo a la columna que sleeccionamos:\n# seleccionar columna a renombrar names(tabla)[names(tabla) == \u0026#34;patas\u0026#34;] [1] \u0026quot;patas\u0026quot; # asignar nuevo nombre a la columna seleccionada names(tabla)[names(tabla) == \u0026#34;patas\u0026#34;] \u0026lt;- \u0026#34;piernas\u0026#34; # ver cambios names(tabla) [1] \u0026quot;animal\u0026quot; \u0026quot;tipo\u0026quot; \u0026quot;piernas\u0026quot; \u0026quot;cola\u0026quot; \u0026quot;zona\u0026quot; Finalmente, la alternativa que entrega {dplyr} para renombrar columnas es la funci√≥n rename(), a la cual se le entrega la tabla, y luego se le entrega el nombre nuevo de la columna, el signo = y el nombre original:\ntabla \u0026lt;- rename(tabla, nombre = animal) # ver cambios names(tabla) [1] \u0026quot;nombre\u0026quot; \u0026quot;tipo\u0026quot; \u0026quot;piernas\u0026quot; \u0026quot;cola\u0026quot; \u0026quot;zona\u0026quot; Ordenar observaciones Otra operaci√≥n com√∫n con tallas de datos es ordenar una tabla seg√∫n una variable num√©rica, para que las observaciones est√©n en orden decreciente o ascendente.\nPrimero, si queremos ordenar un vector, podemos usar la funci√≥n sort() para obtener los valores del vector de menor a mayor:\nsort(tabla$piernas) [1] 0 2 2 4 4 4 En cierto sentido, ordenar una tabla es la misma operaci√≥n que extraer filas de una tabla, solamente extraemos las filas de la tabla en el orden que deseamos. Por ejemplo:\ntabla # A tibble: 6 √ó 5 nombre tipo piernas cola zona \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 s√≠ urbano 2 paloma ave 2 s√≠ urbano 3 rana anfibio 4 no rural 4 pollo ave 2 no rural 5 mapache mam√≠fero 4 s√≠ urbano 6 serpiente reptil 0 toda rural # extraer filas de la tabla en un orden espec√≠fico tabla[c(6, 4, 4), ] # A tibble: 3 √ó 5 nombre tipo piernas cola zona \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 serpiente reptil 0 toda rural 2 pollo ave 2 no rural 3 pollo ave 2 no rural En este ejemplo, extrajimos tres filas de la tabla, pero la extracci√≥n que hacemos es espec√≠ficamente de la fila que tiene valor 0 en la variable piernas, y luego las dos filas que tienen valor 2.\nComo memos, en este caso no nos servir√≠a la funci√≥n sort(). Porque para ordenar una tabla no necesitamos los valores ordenados del vector, sino las posiciones de los valores del vector ordenadas de manera que podamos mover las filas de una tabla. Para eso nos sirve la funci√≥n order():\n# posiciones de los elementos ordenados order(tabla$piernas) [1] 6 2 4 1 3 5 Esta funci√≥n si no se entrega la posici√≥n de los elementos del vector o de la columna en el orden de menor a mayor, y con estas posiciones podemos reordenar las filas de la tabla:\n# ordenar de menor a mayor tabla[order(tabla$piernas), ] # A tibble: 6 √ó 5 nombre tipo piernas cola zona \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 serpiente reptil 0 toda rural 2 paloma ave 2 s√≠ urbano 3 pollo ave 2 no rural 4 gato mam√≠fero 4 s√≠ urbano 5 rana anfibio 4 no rural 6 mapache mam√≠fero 4 s√≠ urbano # ordenar de mayor a menor tabla[order(tabla$piernas, decreasing = TRUE), ] # A tibble: 6 √ó 5 nombre tipo piernas cola zona \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 s√≠ urbano 2 rana anfibio 4 no rural 3 mapache mam√≠fero 4 s√≠ urbano 4 paloma ave 2 s√≠ urbano 5 pollo ave 2 no rural 6 serpiente reptil 0 toda rural La funci√≥n arrange() de {dplyr} nos permite ordenar una tabla tan s√≥lo entreg√°ndole la columna por la cual queremos ordenar:\narrange(tabla, piernas) # A tibble: 6 √ó 5 nombre tipo piernas cola zona \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 serpiente reptil 0 toda rural 2 paloma ave 2 s√≠ urbano 3 pollo ave 2 no rural 4 gato mam√≠fero 4 s√≠ urbano 5 rana anfibio 4 no rural 6 mapache mam√≠fero 4 s√≠ urbano ¬°Mucho m√°s sencillo! Si deseamos ordenar en orden descendiente (mayor a menor), debemos meter la columna dentro de la funci√≥n desc() (por descending):\narrange(tabla, desc(piernas)) # A tibble: 6 √ó 5 nombre tipo piernas cola zona \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 gato mam√≠fero 4 s√≠ urbano 2 rana anfibio 4 no rural 3 mapache mam√≠fero 4 s√≠ urbano 4 paloma ave 2 s√≠ urbano 5 pollo ave 2 no rural 6 serpiente reptil 0 toda rural Bonus Crear tablas manualmente Si queremos crear una tabla de datos de prueba, para explorar estos aprendizajes, o bien porque nuestros datos son muy poquitos, podemos usar la funci√≥n tribble() para escribir la tabla como si la estuvi√©ramos haciendo en una aplicaci√≥n de planillas de c√°lculo:\ntribble(~d√≠as, ~n, ~caso, \u0026#34;jueves\u0026#34;, 0, 1, \u0026#34;viernes\u0026#34;, 4, 0, \u0026#34;s√°bado\u0026#34;, 2, 1, ) # A tibble: 3 √ó 3 d√≠as n caso \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 jueves 0 1 2 viernes 4 0 3 s√°bado 2 1 Simplemente escribe los nombres de las columnas con una colita de chancho antes (~) en la primera fila, y hacia abajo puedes ir rellenando los valores de cada columna.\nEn ese tutorial nuevamente aprendimos herramientas b√°sicas de R, esta vez orientadas a trabajar con datos en forma de tabla. Para esto, combinamos varios de los aprendizajes anteriores que hab√≠amos aplicado a vectores, para reutilizarlos en esta nueva forma de organizar la informaci√≥n. Con los conocimientos obtenidos hasta ahora, ya ser√≠a posible llevar a cabo la mayor parte de las operaciones necesarias para la exploraci√≥n de datos!\nEl siguiente paso es aprender a transformar datos con {dplyr} y {tidyr}, o bien puedes pasar a los tutoriales aplicados, donde practicaremos estos aprendizajes en conjunto de datos reales: con datos de proyecciones de poblaci√≥n provenientes del Censo, y con datos de un catastro de asentamientos de vivienda informales.\n","date":"2025-02-15T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/dplyr_intro/","tags":"dplyr ; consejos ; datos","title":"Introducci√≥n al manejo de datos con {dplyr}"},{"content":"Este post es una introducci√≥n al paquete {dplyr} para la exploraci√≥n y an√°lisis de datos con R. Est√° dirigido a principiantes de R. Si es primera vez que usas R, te recomiendo revisar primero este breve tutorial inicial de R..\nEn este tutorial veremos:\ncarga de datos de Excel seleccionar columnas ordenar tablas de datos seleccionar filas de una tabla de datos filtrar datos Los datos usados en este tutorial son las Proyecciones de poblaci√≥n para 2024 de Chile, calculadas por el Instituto Nacional de Estad√≠sticas (INE). La obtenci√≥n, procesamiento y visualizaci√≥n de estos datos puede encontrarse en este repositorio, junto a una aplicaci√≥n web desarrollada en R para visualizar los datos.\nInstalaci√≥n de paquetes Los paquetes son conjuntos de funciones, programas, datos y documentaci√≥n que sirven para potenciar R. Para poder usarlos, primero hay que instalarlos en nuestro computador usando la funci√≥n install.packages(). Luego de instalarlos, simplemente los cargamos usando library().\n# es necesario instalarlos una sola vez install.packages(\u0026#34;dplyr\u0026#34;) install.packages(\u0026#34;readxl\u0026#34;) Luego cargamos los paquetes:\nlibrary(dplyr) # manipulaci√≥n de datos library(readxl) # carga de archivos Excel {dplyr} es un paquete parte del Tidyverse, que se usa para manipular datos a partir de funciones que emulan instrucciones sencillas, como seleccionar, filtrar, etc.\nCargar datos Antes que nada, debemos descargar el archivo que usaremos para el tutorial:\nDescargar datos en Excel Descargamos el archivo, y lo guardamos en una carpeta. Esta carpeta debe ser nuestro proyecto de RStudio, o bien, creamos un nuevo proyecto de RStudio apuntando a esa carpeta, para decirle a R que trabajaremos ah√≠.\nImportamos los datos que usaremos con la funcion read_excel(). Si el archivo que queremos cargar est√° dentro de nuestro proyecto de RStudio, entonces solamente necesitamos poner el nombre del archivo entre comillas, y si no, indicar la subcarpeta del proyecto en donde est√© guardado, o si no estamos trabajando en un proyecto, indicar la ruta completa del archivo.\nAsignamos el resultado a un objeto, y as√≠ tenemos nuestros datos de Excel cargados en R:\ncenso \u0026lt;- read_excel(\u0026#34;censo_proyeccion_2024.xlsx\u0026#34;) # cargar censo # ver los datos de dataframe o tabla # A tibble: 346 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 11 Iquique 1101 Iquique 231962 2 1 Tarapac√° 11 Iquique 1107 Alto H‚Ä¶ 143294 3 1 Tarapac√° 14 Tamarugal 1401 Pozo A‚Ä¶ 18713 4 1 Tarapac√° 14 Tamarugal 1402 Cami√±a 1374 5 1 Tarapac√° 14 Tamarugal 1403 Colcha‚Ä¶ 1558 6 1 Tarapac√° 14 Tamarugal 1404 Huara 3095 7 1 Tarapac√° 14 Tamarugal 1405 Pica 6291 8 2 Antofagasta 21 Antofagasta 2101 Antofa‚Ä¶ 444276 9 2 Antofagasta 21 Antofagasta 2102 Mejill‚Ä¶ 15877 10 2 Antofagasta 21 Antofagasta 2103 Sierra‚Ä¶ 1800 # ‚Ñπ 336 more rows Para ver m√°s filas del dataframe, usamos la funci√≥n print() con el argumento n:\nprint(censo, n = 20) # A tibble: 346 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 11 Iquique 1101 Iquique 231962 2 1 Tarapac√° 11 Iquique 1107 Alto H‚Ä¶ 143294 3 1 Tarapac√° 14 Tamarugal 1401 Pozo A‚Ä¶ 18713 4 1 Tarapac√° 14 Tamarugal 1402 Cami√±a 1374 5 1 Tarapac√° 14 Tamarugal 1403 Colcha‚Ä¶ 1558 6 1 Tarapac√° 14 Tamarugal 1404 Huara 3095 7 1 Tarapac√° 14 Tamarugal 1405 Pica 6291 8 2 Antofagasta 21 Antofagasta 2101 Antofa‚Ä¶ 444276 9 2 Antofagasta 21 Antofagasta 2102 Mejill‚Ä¶ 15877 10 2 Antofagasta 21 Antofagasta 2103 Sierra‚Ä¶ 1800 11 2 Antofagasta 21 Antofagasta 2104 Taltal 13967 12 2 Antofagasta 22 El Loa 2201 Calama 196152 13 2 Antofagasta 22 El Loa 2202 Ollag√ºe 269 14 2 Antofagasta 22 El Loa 2203 San Pe‚Ä¶ 11030 15 2 Antofagasta 23 Tocopilla 2301 Tocopi‚Ä¶ 28354 16 2 Antofagasta 23 Tocopilla 2302 Mar√≠a ‚Ä¶ 6507 17 3 Atacama 31 Copiap√≥ 3101 Copiap√≥ 176100 18 3 Atacama 31 Copiap√≥ 3102 Caldera 19964 19 3 Atacama 31 Copiap√≥ 3103 Tierra‚Ä¶ 14431 20 3 Atacama 32 Cha√±aral 3201 Cha√±ar‚Ä¶ 13017 # ‚Ñπ 326 more rows Ahora que tenemos nuestros datos cargados como un objeto en nuestro entorno de R, podemos empezar a manipularlo y explorarlo usando {dplyr}.\nSeleccionar columnas La funci√≥n select() selecciona columnas del dataframe.\ncenso |\u0026gt; # comando + shift + M select(comuna, poblaci√≥n) # A tibble: 346 √ó 2 comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Iquique 231962 2 Alto Hospicio 143294 3 Pozo Almonte 18713 4 Cami√±a 1374 5 Colchane 1558 6 Huara 3095 7 Pica 6291 8 Antofagasta 444276 9 Mejillones 15877 10 Sierra Gorda 1800 # ‚Ñπ 336 more rows El operador |\u0026gt; es un conector, y significa que a este objeto le hago esto otro; es decir, se lee como si dijera \u0026ldquo;luego\u0026rdquo; o \u0026ldquo;entonces\u0026rdquo;. En este caso: a censo le selecciono comuna y poblaci√≥n.\nPodemos seleccionar negativamente; es decir, excluir ciertas columnas\ncenso |\u0026gt; select(-cut_provincia, -cut_comuna, -cut_region) # A tibble: 346 √ó 4 region provincia comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Tarapac√° Iquique Iquique 231962 2 Tarapac√° Iquique Alto Hospicio 143294 3 Tarapac√° Tamarugal Pozo Almonte 18713 4 Tarapac√° Tamarugal Cami√±a 1374 5 Tarapac√° Tamarugal Colchane 1558 6 Tarapac√° Tamarugal Huara 3095 7 Tarapac√° Tamarugal Pica 6291 8 Antofagasta Antofagasta Antofagasta 444276 9 Antofagasta Antofagasta Mejillones 15877 10 Antofagasta Antofagasta Sierra Gorda 1800 # ‚Ñπ 336 more rows Tambi√©n podemos seleccionar columnas en base a sus nombres parciales:\ncenso |\u0026gt; select(-contains(\u0026#34;cut\u0026#34;)) # A tibble: 346 √ó 4 region provincia comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Tarapac√° Iquique Iquique 231962 2 Tarapac√° Iquique Alto Hospicio 143294 3 Tarapac√° Tamarugal Pozo Almonte 18713 4 Tarapac√° Tamarugal Cami√±a 1374 5 Tarapac√° Tamarugal Colchane 1558 6 Tarapac√° Tamarugal Huara 3095 7 Tarapac√° Tamarugal Pica 6291 8 Antofagasta Antofagasta Antofagasta 444276 9 Antofagasta Antofagasta Mejillones 15877 10 Antofagasta Antofagasta Sierra Gorda 1800 # ‚Ñπ 336 more rows Selecci√≥n de columnas por el numero de una columna (su posici√≥n):\ncenso |\u0026gt; select(1:3, poblaci√≥n) # A tibble: 346 √ó 4 cut_region region cut_provincia poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 11 231962 2 1 Tarapac√° 11 143294 3 1 Tarapac√° 14 18713 4 1 Tarapac√° 14 1374 5 1 Tarapac√° 14 1558 6 1 Tarapac√° 14 3095 7 1 Tarapac√° 14 6291 8 2 Antofagasta 21 444276 9 2 Antofagasta 21 15877 10 2 Antofagasta 21 1800 # ‚Ñπ 336 more rows Ordenar filas Usamos la funci√≥n arrange() para ordenar las filas de nuestros datos de acuerdo a otra variable:\ncenso |\u0026gt; arrange(poblaci√≥n) |\u0026gt; select(comuna, poblaci√≥n) # A tibble: 346 √ó 2 comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Ant√°rtica 151 2 R√≠o Verde 205 3 Laguna Blanca 248 4 Ollag√ºe 269 5 Timaukel 276 6 Tortel 585 7 San Gregorio 651 8 Primavera 674 9 O'Higgins 675 10 General Lagos 801 # ‚Ñπ 336 more rows Ordenar de mayor a menor:\ncenso |\u0026gt; arrange(desc(poblaci√≥n)) |\u0026gt; select(region, comuna, poblaci√≥n) # A tibble: 346 √ó 3 region comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Metropolitana de Santiago Puente Alto 667904 2 Metropolitana de Santiago Maip√∫ 586812 3 Metropolitana de Santiago Santiago 544388 4 Antofagasta Antofagasta 444276 5 Metropolitana de Santiago La Florida 407297 6 Valpara√≠so Vi√±a del Mar 371490 7 Metropolitana de Santiago San Bernardo 348640 8 Metropolitana de Santiago Las Condes 343632 9 Valpara√≠so Valpara√≠so 320816 10 La Araucan√≠a Temuco 309696 # ‚Ñπ 336 more rows Ordenar por dos variables a la vez\ncenso |\u0026gt; arrange(region, desc(poblaci√≥n)) |\u0026gt; select(region, comuna, poblaci√≥n) |\u0026gt; print(n = 20) # A tibble: 346 √ó 3 region comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Antofagasta Antofagasta 444276 2 Antofagasta Calama 196152 3 Antofagasta Tocopilla 28354 4 Antofagasta Mejillones 15877 5 Antofagasta Taltal 13967 6 Antofagasta San Pedro de Atacama 11030 7 Antofagasta Mar√≠a Elena 6507 8 Antofagasta Sierra Gorda 1800 9 Antofagasta Ollag√ºe 269 10 Arica y Parinacota Arica 257163 11 Arica y Parinacota Putre 2569 12 Arica y Parinacota Camarones 1246 13 Arica y Parinacota General Lagos 801 14 Atacama Copiap√≥ 176100 15 Atacama Vallenar 57360 16 Atacama Caldera 19964 17 Atacama Tierra Amarilla 14431 18 Atacama Diego de Almagro 13909 19 Atacama Cha√±aral 13017 20 Atacama Huasco 11590 # ‚Ñπ 326 more rows Filtrar datos Con la funci√≥n filter() podemos filtrar nuestro dataframe a partir de una comparaci√≥n, dejando solamente las filas del dataframe que cumplan con la comparaci√≥n.\nPor ejemplo, dejar s√≥lo las filas donde la comuna sea \u0026ldquo;Providencia\u0026rdquo;:\ncenso |\u0026gt; filter(comuna == \u0026#34;Providencia\u0026#34;) # A tibble: 1 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 13 Metropolitana ‚Ä¶ 131 Santiago 13123 Provi‚Ä¶ 164009 Excluir las filas donde la columna sea \u0026ldquo;Alto Hospicio\u0026rdquo;:\ncenso |\u0026gt; filter(comuna != \u0026#34;Alto Hospicio\u0026#34;) # A tibble: 345 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 11 Iquique 1101 Iquique 231962 2 1 Tarapac√° 14 Tamarugal 1401 Pozo A‚Ä¶ 18713 3 1 Tarapac√° 14 Tamarugal 1402 Cami√±a 1374 4 1 Tarapac√° 14 Tamarugal 1403 Colcha‚Ä¶ 1558 5 1 Tarapac√° 14 Tamarugal 1404 Huara 3095 6 1 Tarapac√° 14 Tamarugal 1405 Pica 6291 7 2 Antofagasta 21 Antofagasta 2101 Antofa‚Ä¶ 444276 8 2 Antofagasta 21 Antofagasta 2102 Mejill‚Ä¶ 15877 9 2 Antofagasta 21 Antofagasta 2103 Sierra‚Ä¶ 1800 10 2 Antofagasta 21 Antofagasta 2104 Taltal 13967 # ‚Ñπ 335 more rows Dejar s√≥lo las observaciones donde la poblaci√≥n sea mayor a un valor:\ncenso |\u0026gt; filter(poblaci√≥n \u0026gt; 300000) # A tibble: 10 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 2 Antofagasta 21 Antofaga‚Ä¶ 2101 Antof‚Ä¶ 444276 2 5 Valpara√≠so 51 Valpara√≠‚Ä¶ 5101 Valpa‚Ä¶ 320816 3 5 Valpara√≠so 51 Valpara√≠‚Ä¶ 5109 Vi√±a ‚Ä¶ 371490 4 9 La Araucan√≠a 91 Caut√≠n 9101 Temuco 309696 5 13 Metropolitana‚Ä¶ 131 Santiago 13101 Santi‚Ä¶ 544388 6 13 Metropolitana‚Ä¶ 131 Santiago 13110 La Fl‚Ä¶ 407297 7 13 Metropolitana‚Ä¶ 131 Santiago 13114 Las C‚Ä¶ 343632 8 13 Metropolitana‚Ä¶ 131 Santiago 13119 Maip√∫ 586812 9 13 Metropolitana‚Ä¶ 132 Cordille‚Ä¶ 13201 Puent‚Ä¶ 667904 10 13 Metropolitana‚Ä¶ 134 Maipo 13401 San B‚Ä¶ 348640 Poblaci√≥n menor a 1000, s√≥lo dejar comuna y poblaci√≥n, y ordenar de menor a mayor:\ncenso |\u0026gt; filter(poblaci√≥n \u0026lt; 1000) |\u0026gt; select(comuna, poblaci√≥n) |\u0026gt; arrange(poblaci√≥n) # A tibble: 11 √ó 2 comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Ant√°rtica 151 2 R√≠o Verde 205 3 Laguna Blanca 248 4 Ollag√ºe 269 5 Timaukel 276 6 Tortel 585 7 San Gregorio 651 8 Primavera 674 9 O'Higgins 675 10 General Lagos 801 11 Lago Verde 914 Podemos hacer filtros usando funciones que operen sobre las columnas, por ejemplo, para filtrar las filas donde la poblaci√≥n sea igual al m√≠nimo de poblaci√≥n:\ncenso |\u0026gt; filter(poblaci√≥n == min(poblaci√≥n)) |\u0026gt; select(region, comuna, provincia, poblaci√≥n) # A tibble: 1 √ó 4 region comuna provincia poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Magallanes y de la Ant√°rtica Chilena Ant√°rtica Ant√°rtica Chilena 151 Un caso m√°s √∫til ser√≠a filtrar los casos donde la poblaci√≥n sea mayor o igual al promedio de poblaci√≥n:\ncenso |\u0026gt; filter(poblaci√≥n \u0026gt;= mean(poblaci√≥n)) |\u0026gt; select(region, comuna, provincia, poblaci√≥n) # A tibble: 84 √ó 4 region comuna provincia poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Tarapac√° Iquique Iquique 231962 2 Tarapac√° Alto Hospicio Iquique 143294 3 Antofagasta Antofagasta Antofagasta 444276 4 Antofagasta Calama El Loa 196152 5 Atacama Copiap√≥ Copiap√≥ 176100 6 Coquimbo La Serena Elqui 267400 7 Coquimbo Coquimbo Elqui 275644 8 Coquimbo Ovalle Limar√≠ 124401 9 Valpara√≠so Valpara√≠so Valpara√≠so 320816 10 Valpara√≠so Vi√±a del Mar Valpara√≠so 371490 # ‚Ñπ 74 more rows Tambi√©n es posible filtrar usando objetos que creamos con anterioridad:\nmin_pob \u0026lt;- 25000 max_pob \u0026lt;- 30000 censo |\u0026gt; filter(poblaci√≥n \u0026gt; min_pob, poblaci√≥n \u0026lt; max_pob) |\u0026gt; select(poblaci√≥n, comuna, provincia, region) # A tibble: 16 √ó 4 poblaci√≥n comuna provincia region \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 28354 Tocopilla Tocopilla Antofagasta 2 29916 Salamanca Choapa Coquimbo 3 27898 La Cruz Quillota Valpara√≠so 4 27065 Cartagena San Antonio Valpara√≠so 5 27286 Llaillay San Felipe Valpara√≠so 6 27749 Las Cabras Cachapoal Libertador General Bernardo O'Higgins 7 28552 Mostazal Cachapoal Libertador General Bernardo O'Higgins 8 26746 Hualqui Concepci√≥n Biob√≠o 9 27152 Lebu Arauco Biob√≠o 10 28028 Nacimiento B√≠ob√≠o Biob√≠o 11 25515 Carahue Caut√≠n La Araucan√≠a 12 25488 Freire Caut√≠n La Araucan√≠a 13 26617 Pitrufquen Caut√≠n La Araucan√≠a 14 26558 Collipulli Malleco La Araucan√≠a 15 25218 Ays√©n Ays√©n Ays√©n del General Carlos Ib√°√±ez del Campo 16 29067 Coihueco Punilla √ëuble Del mismo modo, podemos filtrar usando la cifra del promedio de poblaci√≥n:\npromedio \u0026lt;- mean(censo$poblaci√≥n) censo |\u0026gt; filter(poblaci√≥n \u0026gt; promedio) # A tibble: 84 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 11 Iquique 1101 Iquique 231962 2 1 Tarapac√° 11 Iquique 1107 Alto H‚Ä¶ 143294 3 2 Antofagasta 21 Antofagasta 2101 Antofa‚Ä¶ 444276 4 2 Antofagasta 22 El Loa 2201 Calama 196152 5 3 Atacama 31 Copiap√≥ 3101 Copiap√≥ 176100 6 4 Coquimbo 41 Elqui 4101 La Ser‚Ä¶ 267400 7 4 Coquimbo 41 Elqui 4102 Coquim‚Ä¶ 275644 8 4 Coquimbo 43 Limar√≠ 4301 Ovalle 124401 9 5 Valpara√≠so 51 Valpara√≠so 5101 Valpar‚Ä¶ 320816 10 5 Valpara√≠so 51 Valpara√≠so 5109 Vi√±a d‚Ä¶ 371490 # ‚Ñπ 74 more rows Seleccionar filas Usamos slice() para seleccionar filas espec√≠ficas del dataframe:\ncenso |\u0026gt; slice(200:220) # filas del 200 al 220 # A tibble: 21 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 9 La Araucan√≠a 92 Malleco 9205 Lonqui‚Ä¶ 11109 2 9 La Araucan√≠a 92 Malleco 9206 Los Sa‚Ä¶ 7468 3 9 La Araucan√≠a 92 Malleco 9207 Lumaco 9916 4 9 La Araucan√≠a 92 Malleco 9208 Pur√©n 12103 5 9 La Araucan√≠a 92 Malleco 9209 Renaico 11002 6 9 La Araucan√≠a 92 Malleco 9210 Traigu‚Ä¶ 19260 7 9 La Araucan√≠a 92 Malleco 9211 Victor‚Ä¶ 35554 8 10 Los Lagos 101 Llanquihue 10101 Puerto‚Ä¶ 280955 9 10 Los Lagos 101 Llanquihue 10102 Calbuco 37626 10 10 Los Lagos 101 Llanquihue 10103 Cocham√≥ 3947 # ‚Ñπ 11 more rows Tambi√©n puede servir para seleccionar la fila que tenga el mayor o menos valor en una columna:\ncenso |\u0026gt; slice_max(poblaci√≥n) # A tibble: 1 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 13 Metropolitana ‚Ä¶ 132 Cordille‚Ä¶ 13201 Puent‚Ä¶ 667904 censo |\u0026gt; slice_min(poblaci√≥n) # A tibble: 1 √ó 7 cut_region region cut_provincia provincia cut_comuna comuna poblaci√≥n \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 12 Magallanes y d‚Ä¶ 122 Ant√°rtic‚Ä¶ 12202 Ant√°r‚Ä¶ 151 Incluso nos puede servir para seleccionar una cantidad de filas elegidas al azar:\ncenso |\u0026gt; slice_sample(n = 5) |\u0026gt; select(comuna) # A tibble: 5 √ó 1 comuna \u0026lt;chr\u0026gt; 1 Panquehue 2 Independencia 3 Melipilla 4 Pe√±alol√©n 5 Chill√°n Viejo Selecci√≥n de filas por grupos Haciendo uso de la funci√≥n group_by() podemos realizar operaciones en base a grupos. Esto significa que si agrupamos por regi√≥n, y luego usamos slice_max() para obtener las observaciones con mayor poblaci√≥n, el filtro de slice_max() se realizar√° una vez por cada regi√≥n. Entonces, en vez de solamente obtener la comuna de mayor poblaci√≥n del pa√≠s, obtendremos la comuna con mayor poblaci√≥n para cada regi√≥n.\ncenso |\u0026gt; group_by(region) |\u0026gt; slice_max(poblaci√≥n) |\u0026gt; select(region, comuna, poblaci√≥n) # A tibble: 16 √ó 3 # Groups: region [16] region comuna poblaci√≥n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Antofagasta Antofagasta 444276 2 Arica y Parinacota Arica 257163 3 Atacama Copiap√≥ 176100 4 Ays√©n del General Carlos Ib√°√±ez del Campo Coyhaique 62046 5 Biob√≠o Concepci√≥n 239776 6 Coquimbo Coquimbo 275644 7 La Araucan√≠a Temuco 309696 8 Libertador General Bernardo O'Higgins Rancagua 274407 9 Los Lagos Puerto Montt 280955 10 Los R√≠os Valdivia 182086 11 Magallanes y de la Ant√°rtica Chilena Punta Arenas 145713 12 Maule Talca 242344 13 Metropolitana de Santiago Puente Alto 667904 14 Tarapac√° Iquique 231962 15 Valpara√≠so Vi√±a del Mar 371490 16 √ëuble Chill√°n 204091 Con esto concluye este tutorial inicial para manipular datos con el paquete {dplyr}. En siguientes tutoriales iremos usando funciones m√°s complejas y avanzadas! ü´£\nSi este tutorial te sirvi√≥, por favor considera hacerme una donaci√≥n! Cualquier monto me ayuda al menos a poder tomarme un cafecito ü•∫\n","date":"2024-11-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/tutorial_dplyr_censo/","tags":"dplyr","title":"Tutorial: introducci√≥n a {dplyr} con datos de poblaci√≥n"},{"content":"Este post es una introducci√≥n al paquete {dplyr} para la exploraci√≥n y an√°lisis de datos con R. Est√° dirigido a principiantes de R. Si es primera vez que usas R, te recomiendo revisar primero este breve tutorial inicial de R..\nEn este tutorial veremos:\ncarga de datos de Excel revisar los datos seleccionar columnas ordenar tablas de datos contar frecuencias filtrar datos crear variables dicot√≥micas crear variables complejas Los datos usados en este tutorial corresponden al catastro de campamentos de Chile 2024, del Centro de Estudios del Ministerio de Vivienda y Urbanismo.. El c√≥digo para obtener, procesar y visualizar los datos se encuentra en este repositorio de GitHub.\nPara empezar, instalamos los paquetes que usaremos en este tutorial (solo se necesita hacer una vez, y s√≥lo si es que no los tienes instalados).\ninstall.packages(\u0026#34;readxl\u0026#34;) # cargar datos desde Excel install.packages(\u0026#34;dplyr\u0026#34;) # manipulaci√≥n de datos Cargar datos Puedes descargar el archivo campamentos_chile_2024.xlsx que usaremos en este tutorial desde este enlace. Los datos se obtuvieron desde este repositorio.\nDescargar datos en Excel Cargamos los datos desde Excel usando el nombre del archivo como argumento a la funci√≥n read_excel():\nlibrary(readxl) datos \u0026lt;- read_excel(\u0026#34;campamentos_chile_2024.xlsx\u0026#34;) datos # A tibble: 1,432 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Bellavista Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 29 1.51 10617. 2 Buena Vis‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 32 1.67 11707. 3 Los Flete‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 56 2.49 17465. 4 Pueblo Hu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 65 4.60 32261. 5 Villa Ita‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 33 0.867 6081. 6 Nueva Esp‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 17 0.399 2802. 7 Francisco‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 24 2.85 19955. 8 Manuel Ro‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 21 0.443 3103. 9 Sofia 35 Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 69 2.68 18819. 10 Las Vi√±as‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 32 1.24 8704. # ‚Ñπ 1,422 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Este tipo de objetos tabulares se llaman dataframes, espec√≠ficamente tibble, que es un tipo de tabla. Los dataframes son tablas de datos hechas a partir de vectores, donde cada columna es un vector del mismo largo (misma cantidad de elementos). Los dataframes se caracterizan por tener distintas columnas que pueden de distinto tipo: num√©ricas, caracter (texto), l√≥gico (TRUE/FALSE), fechas, entre otras. Todas las columnas tienen el mismo largo, que es equivalente a la cantidad de filas de la tabla.\nPara explorar los datos, usaremos el paquete {dplyr}, que nos permite manejar datos con mayor facilidad. {dplyr} sirve para manipular datos a partir de funciones que emulan instrucciones sencillas, como seleccionar, filtrar, etc.\nlibrary(dplyr) Una particularidad del uso de {dplyr} es el uso del operador |\u0026gt;, que es operador que nos permite conectar un objeto con una o m√∫ltiples operaciones que deseamos realizarle al objeto.\nEjemplo de dos operaciones encadenadas:\ndatos |\u0026gt; select(nombre, hogares, hectareas) |\u0026gt; filter(hogares \u0026gt; 60) # A tibble: 352 √ó 3 nombre hogares hectareas \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Pueblo Hundido 65 4.60 2 Sofia 35 69 2.68 3 Ampliaci√≥n Prat-Lomas De Pe√±ablanca 146 15.1 4 Violeta Parra 123 10.7 5 Mesana Alto 128 14.5 6 Pampa Ilusi√≥n (Sector Las Torres) 195 7.04 7 Parcela 11 520 44.0 8 Parcela 15 257 15.4 9 Campanillas 98 6.19 10 La Isla 116 4.51 # ‚Ñπ 342 more rows El conector significa que a este objeto le hago esto otro; es decir, se lee como si dijera \u0026ldquo;luego\u0026rdquo; o \u0026ldquo;entonces\u0026rdquo;. En este caso: a datos le selecciono columnas y le aplico un filtro.\nRevisar Ejecutar el nombre del objeto nos permite que sus contenidos aparezcan en la consola de R.\ndatos # A tibble: 1,432 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Bellavista Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 29 1.51 10617. 2 Buena Vis‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 32 1.67 11707. 3 Los Flete‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 56 2.49 17465. 4 Pueblo Hu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 65 4.60 32261. 5 Villa Ita‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 33 0.867 6081. 6 Nueva Esp‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 17 0.399 2802. 7 Francisco‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 24 2.85 19955. 8 Manuel Ro‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 21 0.443 3103. 9 Sofia 35 Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 69 2.68 18819. 10 Las Vi√±as‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 32 1.24 8704. # ‚Ñπ 1,422 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Por defecto, la consola nos muestra 10 filas de la tabla. Si queremos ver m√°s filas podemos usar la funci√≥n print()\ndatos |\u0026gt; print(n = 20) # A tibble: 1,432 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Bellavista Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 29 1.51 1.06e4 2 Buena Vis‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 32 1.67 1.17e4 3 Los Flete‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 56 2.49 1.75e4 4 Pueblo Hu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 65 4.60 3.23e4 5 Villa Ita‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 33 0.867 6.08e3 6 Nueva Esp‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 17 0.399 2.80e3 7 Francisco‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 24 2.85 2.00e4 8 Manuel Ro‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 21 0.443 3.10e3 9 Sofia 35 Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 69 2.68 1.88e4 10 Las Vi√±as‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 32 1.24 8.70e3 11 Lomas De ‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 42 3.97 2.78e4 12 Manzana 33 Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 37 2.19 1.53e4 13 Ampliaci√≥‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 146 15.1 1.06e5 14 Los Artes‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 35 2.00 1.40e4 15 La Uni√≥n ‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 20 1.33 9.30e3 16 John Kenn‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 48 0.858 6.01e3 17 Pezoa Vel‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 22 0.194 1.36e3 18 Violeta P‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 123 10.7 7.50e4 19 Cristo Re‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 53 0.862 6.04e3 20 Loma Vist‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 47 1.19 8.34e3 # ‚Ñπ 1,412 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Las funciones head() y tails() te muestran las primeras o √∫ltimas filas de la tabla, respectivamente. Si la combinas con print(), puedes consultar la cantidad que quieras de filas al principio o final de tu tabla.\n# ver √∫ltimas 20 filas datos |\u0026gt; tail(20) |\u0026gt; print(n=Inf) # A tibble: 20 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Longitudi‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 14 0.681 4.78e3 2 Comunidad‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 36 1.28 8.97e3 3 Nueva Tol‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 10 0.305 2.14e3 4 Toma Nuev‚Ä¶ Metro‚Ä¶ Cordille‚Ä¶ Puent‚Ä¶ 13 132 13201 0 0 0 5 Villa Res‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ Carta‚Ä¶ 05 056 5601 48 6.15 4.26e4 6 Sector L√≠‚Ä¶ La Ar‚Ä¶ Malleco Traig‚Ä¶ 09 092 9210 15 2.56 1.58e4 7 Licantatay Antof‚Ä¶ El Loa Calama 02 022 2201 41 6.27 5.33e4 8 Nuevo Ama‚Ä¶ Antof‚Ä¶ El Loa Calama 02 022 2201 41 47.4 4.03e5 9 Barrio Tr‚Ä¶ Antof‚Ä¶ El Loa Calama 02 022 2201 0 55.3 4.69e5 10 Calame√±os‚Ä¶ Antof‚Ä¶ El Loa Calama 02 022 2201 91 4.41 3.74e4 11 Tres Band‚Ä¶ Antof‚Ä¶ Antofaga‚Ä¶ Taltal 02 021 2104 0 2.39 1.94e4 12 Sauce 3 Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 0 3.35 2.35e4 13 Campament‚Ä¶ Antof‚Ä¶ Antofaga‚Ä¶ Antof‚Ä¶ 02 021 2101 0 0.450 3.76e3 14 Campament‚Ä¶ Antof‚Ä¶ Tocopilla Tocop‚Ä¶ 02 023 2301 27 5.52 4.72e4 15 Luz Divin‚Ä¶ Antof‚Ä¶ Antofaga‚Ä¶ Antof‚Ä¶ 02 021 2101 0 0.934 7.81e3 16 Villa Esp‚Ä¶ Antof‚Ä¶ Antofaga‚Ä¶ Antof‚Ä¶ 02 021 2101 0 0.623 5.20e3 17 Valle Her‚Ä¶ Biob√≠o Arauco Los A‚Ä¶ 08 082 8206 71 8.18 5.14e4 18 Rucamanque Biob√≠o Concepci‚Ä¶ Talca‚Ä¶ 08 081 8110 119 5.24 3.37e4 19 Caleta Co‚Ä¶ Antof‚Ä¶ Tocopilla Tocop‚Ä¶ 02 023 2301 0 5.38 4.56e4 20 Caleta Co‚Ä¶ Antof‚Ä¶ Tocopilla Tocop‚Ä¶ 02 023 2301 0 1.00 8.52e3 # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Una funci√≥n √∫til para poder revisar los datos r√°pidamente de una forma distinta es glimpse(), que nos muestra la tabla pero con las columnas hacia abajo y los valores hacia el lado. Es como ver la tabla girada, permiti√©ndonos ver todas sus columnas, sus formatos, y un ejemplo de las primeras observaciones de cada variable.\ndatos |\u0026gt; glimpse() Rows: 1,432 Columns: 12 $ nombre \u0026lt;chr\u0026gt; \u0026quot;Bellavista\u0026quot;, \u0026quot;Buena Vista\u0026quot;, \u0026quot;Los Fleteros\u0026quot;, \u0026quot;Pueblo Hun‚Ä¶ $ region \u0026lt;chr\u0026gt; \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, ‚Ä¶ $ provincia \u0026lt;chr\u0026gt; \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, ‚Ä¶ $ comuna \u0026lt;chr\u0026gt; \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, ‚Ä¶ $ cut_r \u0026lt;chr\u0026gt; \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;0‚Ä¶ $ cut_p \u0026lt;chr\u0026gt; \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, ‚Ä¶ $ cut \u0026lt;dbl\u0026gt; 5101, 5101, 5101, 5101, 5101, 5101, 5101, 5101, 5101, 58‚Ä¶ $ hogares \u0026lt;dbl\u0026gt; 29, 32, 56, 65, 33, 17, 24, 21, 69, 32, 42, 37, 146, 35,‚Ä¶ $ hectareas \u0026lt;dbl\u0026gt; 1.5138015, 1.6700459, 2.4914854, 4.6023230, 0.8673470, 0‚Ä¶ $ area \u0026lt;dbl\u0026gt; 10617.233, 11707.446, 17465.450, 32261.178, 6080.654, 28‚Ä¶ $ observaciones \u0026lt;chr\u0026gt; \u0026quot;CAMPAMENTO EN CATASTRO NACIONAL 2022. EXTENSI√ìN DE L√çMI‚Ä¶ $ a√±o \u0026lt;chr\u0026gt; \u0026quot;CATASTRO_2011\u0026quot;, \u0026quot;CATASTRO_2011\u0026quot;, \u0026quot;CATASTRO_2011\u0026quot;, \u0026quot;CATA‚Ä¶ La funci√≥n slice() permite extraer filas espec√≠ficas de la tabla, seg√∫n su posici√≥n. Por ejemplo, aqu√≠ extraeremos las filas n√∫mero 1000 al 1010:\ndatos |\u0026gt; slice(1000:1010) # A tibble: 11 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Batuco Metro‚Ä¶ Chacabuco Lampa 13 133 13302 84 11.5 7.99e4 2 Jerusal√©n Metro‚Ä¶ Chacabuco Lampa 13 133 13302 565 32.1 2.24e5 3 Borde Rio‚Ä¶ Liber‚Ä¶ Cachapoal Do√±ih‚Ä¶ 06 061 6105 0 10.5 7.15e4 4 Toma Vist‚Ä¶ Metro‚Ä¶ Chacabuco Lampa 13 133 13302 539 14.5 1.01e5 5 Medialuna‚Ä¶ Metro‚Ä¶ Chacabuco Lampa 13 133 13302 104 2.23 1.56e4 6 Puente Li‚Ä¶ Liber‚Ä¶ Cachapoal Malloa 06 061 6109 0 1.75 1.18e4 7 Mirador Metro‚Ä¶ Chacabuco Lampa 13 133 13302 117 5.37 3.74e4 8 Esperando‚Ä¶ Liber‚Ä¶ Cachapoal Rengo 06 061 6115 0 1.15 7.84e3 9 Central L‚Ä¶ Metro‚Ä¶ Chacabuco Lampa 13 133 13302 14 1.79 1.25e4 10 Los Tronc‚Ä¶ Liber‚Ä¶ Cachapoal Rengo 06 061 6115 0 0.970 6.59e3 11 Los Tubos Metro‚Ä¶ Maipo Buin 13 134 13402 27 0.864 5.95e3 # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Ordenar Ordenar observaciones en base a una o varias columnas\ndatos |\u0026gt; arrange(nombre) # A tibble: 1,432 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 05 De Abr‚Ä¶ Ataca‚Ä¶ Copiap√≥ Copia‚Ä¶ 03 031 3101 27 1.11 8.71e3 2 10 De Ago‚Ä¶ Tarap‚Ä¶ Iquique Alto ‚Ä¶ 01 011 1107 104 1.63 1.43e4 3 12 De Feb‚Ä¶ Liber‚Ä¶ Cachapoal Macha‚Ä¶ 06 061 6108 47 12.7 8.64e4 4 12 De May‚Ä¶ Metro‚Ä¶ Chacabuco Colina 13 133 13301 148 2.16 1.51e4 5 12 De Oct‚Ä¶ Ataca‚Ä¶ Copiap√≥ Copia‚Ä¶ 03 031 3101 12 0.791 6.22e3 6 13 De Jun‚Ä¶ Tarap‚Ä¶ Tamarugal Pozo ‚Ä¶ 01 014 1401 0 0.224 1.96e3 7 14 de feb‚Ä¶ La Ar‚Ä¶ Caut√≠n Temuco 09 091 9101 0 0.635 3.86e3 8 15 De Feb‚Ä¶ Ataca‚Ä¶ Copiap√≥ Copia‚Ä¶ 03 031 3101 16 0.499 3.92e3 9 17 De Mayo Metro‚Ä¶ Santiago Cerro‚Ä¶ 13 131 13103 158 15.7 1.09e5 10 18 De Oct‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 18 1.15 8.04e3 # ‚Ñπ 1,422 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; datos |\u0026gt; arrange(desc(hogares)) # A tibble: 1,432 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Alto Molle Tarap‚Ä¶ Iquique Alto ‚Ä¶ 01 011 1107 3390 130. 1.14e6 2 Manuel Bu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 1647 90.2 6.33e5 3 Am√©rica I‚Ä¶ Metro‚Ä¶ Santiago Cerri‚Ä¶ 13 131 13102 1550 29.8 2.07e5 4 Dignidad Metro‚Ä¶ Chacabuco Colina 13 133 13301 1004 15.8 1.10e5 5 Milla Ant‚Ä¶ Metro‚Ä¶ Cordille‚Ä¶ Puent‚Ä¶ 13 132 13201 1001 23.0 1.59e5 6 Comit√© de‚Ä¶ Antof‚Ä¶ Antofaga‚Ä¶ Antof‚Ä¶ 02 021 2101 1000 14.8 1.24e5 7 Centinela‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 833 111. 7.69e5 8 Vista Her‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ Carta‚Ä¶ 05 056 5603 789 64.6 4.48e5 9 Aguas Sal‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 688 45.1 3.12e5 10 Felipe Ca‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 669 37.0 2.59e5 # ‚Ñπ 1,422 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; datos |\u0026gt; arrange(comuna, desc(hogares)) |\u0026gt; select(nombre, comuna, hogares) # A tibble: 1,432 √ó 3 nombre comuna hogares \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Las Quilas II Ais√©n 83 2 Las Avutardas Ais√©n 16 3 CAMINO CEMENTERIO Ais√©n 8 4 Almirante Simpson Ais√©n 0 5 Pueblo Hundido Alto Biob√≠o 30 6 Pueblo Hundido Alto Biob√≠o 13 7 Sector Pangue Alto Biob√≠o 10 8 Alto Molle Alto Hospicio 3390 9 Ex Vertedero Norte Alto Hospicio 394 10 La Pampa 2 Alto Hospicio 347 # ‚Ñπ 1,422 more rows datos |\u0026gt; glimpse() Rows: 1,432 Columns: 12 $ nombre \u0026lt;chr\u0026gt; \u0026quot;Bellavista\u0026quot;, \u0026quot;Buena Vista\u0026quot;, \u0026quot;Los Fleteros\u0026quot;, \u0026quot;Pueblo Hun‚Ä¶ $ region \u0026lt;chr\u0026gt; \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, ‚Ä¶ $ provincia \u0026lt;chr\u0026gt; \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, ‚Ä¶ $ comuna \u0026lt;chr\u0026gt; \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, \u0026quot;Valpara√≠so\u0026quot;, ‚Ä¶ $ cut_r \u0026lt;chr\u0026gt; \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;0‚Ä¶ $ cut_p \u0026lt;chr\u0026gt; \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, \u0026quot;051\u0026quot;, ‚Ä¶ $ cut \u0026lt;dbl\u0026gt; 5101, 5101, 5101, 5101, 5101, 5101, 5101, 5101, 5101, 58‚Ä¶ $ hogares \u0026lt;dbl\u0026gt; 29, 32, 56, 65, 33, 17, 24, 21, 69, 32, 42, 37, 146, 35,‚Ä¶ $ hectareas \u0026lt;dbl\u0026gt; 1.5138015, 1.6700459, 2.4914854, 4.6023230, 0.8673470, 0‚Ä¶ $ area \u0026lt;dbl\u0026gt; 10617.233, 11707.446, 17465.450, 32261.178, 6080.654, 28‚Ä¶ $ observaciones \u0026lt;chr\u0026gt; \u0026quot;CAMPAMENTO EN CATASTRO NACIONAL 2022. EXTENSI√ìN DE L√çMI‚Ä¶ $ a√±o \u0026lt;chr\u0026gt; \u0026quot;CATASTRO_2011\u0026quot;, \u0026quot;CATASTRO_2011\u0026quot;, \u0026quot;CATASTRO_2011\u0026quot;, \u0026quot;CATA‚Ä¶ datos2 \u0026lt;- datos |\u0026gt; select(1:4) |\u0026gt; slice_sample(n = 10) Seleccionar Podemos reducir la cantidad de columnas de nuestra tabla usando select(). Esto puede servirnos para acotar la exploraci√≥n de los datos, cuando no necesitamos ver todas las columnas al mismo tiempo.\ndatos |\u0026gt; select(nombre, hectareas) # A tibble: 1,432 √ó 2 nombre hectareas \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Bellavista 1.51 2 Buena Vista 1.67 3 Los Fleteros 2.49 4 Pueblo Hundido 4.60 5 Villa Italia Tur√≠n 0.867 6 Nueva Esperanza 0.399 7 Francisco Vergara 2.85 8 Manuel Rodr√≠guez 0.443 9 Sofia 35 2.68 10 Las Vi√±as De Irene Frei 1.24 # ‚Ñπ 1,422 more rows Ante poniendo un signo menos antes del nombre de una columna podemos excluirla de nuestra tabla.\ndatos |\u0026gt; select(-cut, -cut_r, -cut_p) # A tibble: 1,432 √ó 9 nombre region provincia comuna hogares hectareas area observaciones a√±o \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavi‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 29 1.51 10617. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 2 Buena V‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 32 1.67 11707. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 3 Los Fle‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 56 2.49 17465. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 4 Pueblo ‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 65 4.60 32261. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 5 Villa I‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 33 0.867 6081. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 6 Nueva E‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 17 0.399 2802. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 7 Francis‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 24 2.85 19955. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 8 Manuel ‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 21 0.443 3103. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 9 Sofia 35 Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 69 2.68 18819. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 10 Las Vi√±‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 32 1.24 8704. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ # ‚Ñπ 1,422 more rows Recordemos que, hasta que no asignemos estas operaciones a un nuevo objeto, no estamos modificando nuestros datos realmente, sino que solamente estamos aplicando operaciones sobre los datos de una forma no destructiva, como exploraci√≥n o a modo de prueba.\nLa funci√≥n selecta acepta diversas formas de poder seleccionar o de seleccionar variables en base a sus nombres.\nExcluir columnas que incluyan cierto texto dentro de sus nombres:\ndatos |\u0026gt; select(-contains(\u0026#34;cut\u0026#34;)) # A tibble: 1,432 √ó 9 nombre region provincia comuna hogares hectareas area observaciones a√±o \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavi‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 29 1.51 10617. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 2 Buena V‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 32 1.67 11707. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 3 Los Fle‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 56 2.49 17465. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 4 Pueblo ‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 65 4.60 32261. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 5 Villa I‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 33 0.867 6081. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 6 Nueva E‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 17 0.399 2802. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 7 Francis‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 24 2.85 19955. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 8 Manuel ‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 21 0.443 3103. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 9 Sofia 35 Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 69 2.68 18819. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ 10 Las Vi√±‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 32 1.24 8704. CAMPAMENTO E‚Ä¶ CATA‚Ä¶ # ‚Ñπ 1,422 more rows Seleccionar columnas que empiecen con cierto texto:\ndatos |\u0026gt; select(starts_with(\u0026#34;com\u0026#34;)) # A tibble: 1,432 √ó 1 comuna \u0026lt;chr\u0026gt; 1 Valpara√≠so 2 Valpara√≠so 3 Valpara√≠so 4 Valpara√≠so 5 Valpara√≠so 6 Valpara√≠so 7 Valpara√≠so 8 Valpara√≠so 9 Valpara√≠so 10 Villa Alemana # ‚Ñπ 1,422 more rows Seleccionar comunas que terminen con un texto determinado:\ndatos |\u0026gt; select(ends_with(\u0026#34;a\u0026#34;)) # A tibble: 1,432 √ó 3 provincia comuna area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Valpara√≠so Valpara√≠so 10617. 2 Valpara√≠so Valpara√≠so 11707. 3 Valpara√≠so Valpara√≠so 17465. 4 Valpara√≠so Valpara√≠so 32261. 5 Valpara√≠so Valpara√≠so 6081. 6 Valpara√≠so Valpara√≠so 2802. 7 Valpara√≠so Valpara√≠so 19955. 8 Valpara√≠so Valpara√≠so 3103. 9 Valpara√≠so Valpara√≠so 18819. 10 Marga Marga Villa Alemana 8704. # ‚Ñπ 1,422 more rows Tambi√©n podemos seleccionar columnas de un determinado tipo. En este caso, seleccionamos solamente las variables que sean num√©ricas:\ndatos |\u0026gt; select(where(is.numeric)) # A tibble: 1,432 √ó 4 cut hogares hectareas area \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 5101 29 1.51 10617. 2 5101 32 1.67 11707. 3 5101 56 2.49 17465. 4 5101 65 4.60 32261. 5 5101 33 0.867 6081. 6 5101 17 0.399 2802. 7 5101 24 2.85 19955. 8 5101 21 0.443 3103. 9 5101 69 2.68 18819. 10 5804 32 1.24 8704. # ‚Ñπ 1,422 more rows Conteos La funci√≥n Count se aplica a una de las variables de nuestros datos, y cuenta la cantidad de observaciones que se corresponden con cada uno de los valores o niveles posibles de la variable. En otras palabras, cuenta la frecuencia de cada categor√≠a de respuesta de la variable.\ndatos |\u0026gt; count(region) # A tibble: 16 √ó 2 region n \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Antofagasta 116 2 Arica y Parinacota 14 3 Atacama 121 4 Ays√©n del General Carlos Ib√°√±ez del Campo 10 5 Biob√≠o 225 6 Coquimbo 52 7 La Araucan√≠a 70 8 Libertador General Bernardo O'Higgins 59 9 Los Lagos 67 10 Los R√≠os 40 11 Magallanes y de la Ant√°rtica Chilena 3 12 Maule 25 13 Metropolitana 168 14 Tarapac√° 64 15 Valpara√≠so 374 16 √ëuble 24 Podemos combinar un conteo de una variable con el ordenamiento de las filas en base al conteo realizado, resultando una tabla ordenada de mayor a menor seg√∫n las observaciones contadas:\ndatos |\u0026gt; count(region) |\u0026gt; arrange(desc(n)) # A tibble: 16 √ó 2 region n \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Valpara√≠so 374 2 Biob√≠o 225 3 Metropolitana 168 4 Atacama 121 5 Antofagasta 116 6 La Araucan√≠a 70 7 Los Lagos 67 8 Tarapac√° 64 9 Libertador General Bernardo O'Higgins 59 10 Coquimbo 52 11 Los R√≠os 40 12 Maule 25 13 √ëuble 24 14 Arica y Parinacota 14 15 Ays√©n del General Carlos Ib√°√±ez del Campo 10 16 Magallanes y de la Ant√°rtica Chilena 3 Naturalmente, es posible realizar conteos por m√°s de una variable, mostrando las combinaciones entre ambas:\ndatos |\u0026gt; count(region, comuna) |\u0026gt; arrange(desc(n)) # A tibble: 195 √ó 3 region comuna n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Valpara√≠so Vi√±a del Mar 114 2 Valpara√≠so Valpara√≠so 99 3 Antofagasta Antofagasta 87 4 Atacama Copiap√≥ 82 5 Tarapac√° Alto Hospicio 45 6 La Araucan√≠a Temuco 41 7 Biob√≠o Talcahuano 32 8 Valpara√≠so Quilpu√© 32 9 Biob√≠o Lota 30 10 Valpara√≠so San Antonio 27 # ‚Ñπ 185 more rows Filtros Podemos realizar una comparaci√≥n sobre una columna del dataframe para filtrar las observaciones (filas), dejando solamente las filas que cumplen con la condici√≥n.\nPor ejemplo, filtrar solamente los casos donde la cantidad de hogares sea mayor a 80:\ndatos |\u0026gt; filter(hogares \u0026gt; 80) # A tibble: 239 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Ampliaci√≥‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Villa‚Ä¶ 05 058 5804 146 15.1 1.06e5 2 Violeta P‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 123 10.7 7.50e4 3 Mesana Al‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 128 14.5 1.02e5 4 Pampa Ilu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 195 7.04 4.93e4 5 Parcela 11 Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 520 44.0 3.08e5 6 Parcela 15 Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 257 15.4 1.08e5 7 Campanill‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 98 6.19 4.34e4 8 La Isla Valpa‚Ä¶ Valpara√≠‚Ä¶ Valpa‚Ä¶ 05 051 5101 116 4.51 3.16e4 9 Nueva Aur‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 91 7.47 5.24e4 10 Valle El ‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 107 4.04 2.84e4 # ‚Ñπ 229 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; datos |\u0026gt; filter(region == \u0026#34;√ëuble\u0026#34;) # A tibble: 24 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Los Corre‚Ä¶ √ëuble Diguill√≠n Chill‚Ä¶ 16 161 16101 13 0.250 1.61e3 2 L√≠nea F√©r‚Ä¶ √ëuble Diguill√≠n Chill‚Ä¶ 16 161 16101 35 3.21 2.07e4 3 Litral Co‚Ä¶ √ëuble Diguill√≠n Chill‚Ä¶ 16 161 16101 26 5.33 3.43e4 4 Los Monte‚Ä¶ √ëuble Diguill√≠n Chill‚Ä¶ 16 161 16101 47 5.57 3.59e4 5 Orilla It‚Ä¶ √ëuble Itata Porte‚Ä¶ 16 162 16205 11 1.41 9.07e3 6 Pablo Ner‚Ä¶ √ëuble Itata Quiri‚Ä¶ 16 162 16201 39 22.7 1.47e5 7 Esmeralda‚Ä¶ √ëuble Punilla San N‚Ä¶ 16 163 16305 13 0.232 1.50e3 8 Santa Lau‚Ä¶ √ëuble Punilla San N‚Ä¶ 16 163 16305 22 8.28 5.34e4 9 El Esfuer‚Ä¶ √ëuble Diguill√≠n Bulnes 16 161 16102 11 0.632 4.05e3 10 El Refugio √ëuble Diguill√≠n Bulnes 16 161 16102 16 1.11 7.10e3 # ‚Ñπ 14 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Es posible realizar dos o m√°s filtros de forma consecutiva:\ndatos |\u0026gt; filter(hogares \u0026gt; 90, hectareas \u0026gt; 30) # A tibble: 18 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Parcela 11 Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 520 44.0 3.08e5 2 Manuel Bu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 1647 90.2 6.33e5 3 Re√±aca Al‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 663 39.1 2.75e5 4 Felipe Ca‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 669 37.0 2.59e5 5 Aguas Sal‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 688 45.1 3.12e5 6 Alto Mira‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 560 47.7 3.30e5 7 Centinela‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 833 111. 7.69e5 8 Rol 9034-1 Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 227 32.1 2.22e5 9 Vista Her‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ Carta‚Ä¶ 05 056 5603 789 64.6 4.48e5 10 El Colora‚Ä¶ Valpa‚Ä¶ Marga Ma‚Ä¶ Limac‚Ä¶ 05 058 5802 235 59.1 4.15e5 11 Mirando l‚Ä¶ Tarap‚Ä¶ Iquique Alto ‚Ä¶ 01 011 1107 164 114. 9.96e5 12 Alto Molle Tarap‚Ä¶ Iquique Alto ‚Ä¶ 01 011 1107 3390 130. 1.14e6 13 El Casta√±o Biob√≠o Arauco Curan‚Ä¶ 08 082 8205 92 56.2 3.55e5 14 Ribera De‚Ä¶ Metro‚Ä¶ Talagante Talag‚Ä¶ 13 136 13601 115 37.8 2.61e5 15 Jerusal√©n Metro‚Ä¶ Chacabuco Lampa 13 133 13302 565 32.1 2.24e5 16 Las Minas‚Ä¶ Biob√≠o Arauco Curan‚Ä¶ 08 082 8205 100 88.3 5.58e5 17 Villa El ‚Ä¶ Biob√≠o Arauco Curan‚Ä¶ 08 082 8205 135 129. 8.16e5 18 Ex Inia Coqui‚Ä¶ Choapa Los V‚Ä¶ 04 042 4203 315 36.6 2.63e5 # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; Tambi√©n es posible usar otros operadores dentro de las comparaciones, Tales como el operador o |, que en este caso nos va a permitir filtrar las observaciones que cumplan con una o con otra condici√≥n:\ndatos |\u0026gt; filter(hogares \u0026gt; 300 | hectareas \u0026gt; 100) # A tibble: 33 √ó 12 nombre region provincia comuna cut_r cut_p cut hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Parcela 11 Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 520 44.0 3.08e5 2 Manuel Bu‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 1647 90.2 6.33e5 3 Re√±aca Al‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 663 39.1 2.75e5 4 Felipe Ca‚Ä¶ Valpa‚Ä¶ Valpara√≠‚Ä¶ Vi√±a ‚Ä¶ 05 051 5109 669 37.0 2.59e5 5 Yevide Valpa‚Ä¶ San Feli‚Ä¶ San F‚Ä¶ 05 057 5701 306 13.4 9.45e4 6 Aguas Sal‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 688 45.1 3.12e5 7 Alto Mira‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 560 47.7 3.30e5 8 Centinela‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ San A‚Ä¶ 05 056 5601 833 111. 7.69e5 9 Fuerza Gu‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ Carta‚Ä¶ 05 056 5603 342 16.5 1.14e5 10 Vista Her‚Ä¶ Valpa‚Ä¶ San Anto‚Ä¶ Carta‚Ä¶ 05 056 5603 789 64.6 4.48e5 # ‚Ñπ 23 more rows # ‚Ñπ 2 more variables: observaciones \u0026lt;chr\u0026gt;, a√±o \u0026lt;chr\u0026gt; El filtro anterior deja las filas donde los hogares sean mayores a 300, o bien, las hect√°reas sean mayores a 100, pudiendo darse el caso de que hayan filas con hogares mayores 300 pero hect√°reas menores de 100, o con menos de 300 hogares pero con m√°s de 100 hect√°reas.\nAplicando lo aprendido hasta el momento, podemos combinar un filtro con un conteo y un orden, as√≠ obtenemos un conteo de campamentos por comuna bajo un primer criterio de filtro, ordenados de mayor a menor:\ndatos |\u0026gt; filter(hogares \u0026gt; 10) |\u0026gt; count(comuna) |\u0026gt; arrange(desc(n)) # A tibble: 177 √ó 2 comuna n \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Vi√±a del Mar 101 2 Valpara√≠so 89 3 Antofagasta 80 4 Copiap√≥ 70 5 Alto Hospicio 42 6 Temuco 35 7 Lota 30 8 Talcahuano 26 9 San Antonio 22 10 Lampa 21 # ‚Ñπ 167 more rows Crear variables Hasta ahora, hemos explorado solamente con los datos que vienen directamente desde el archivo que cargamos. A continuaci√≥n, crearemos nuevas variables a partir de los datos existentes, para potenciar nuestro an√°lisis.\nLa funci√≥n mutate() crea nuevas variables. Lo primero que se indica dentro de mutate() es el nombre de la nueva variable que vamos a crear, despu√©s de un signo igual (=), y despu√©s la operaci√≥n que crear√° esta nueva variable.\nEn este primer ejemplo, crearemos la variable prueba, que contendr√° un texto en todas las filas.\ndatos |\u0026gt; select(1:4, hogares) |\u0026gt; mutate(prueba = \u0026#34;hola\u0026#34;) # A tibble: 1,432 √ó 6 nombre region provincia comuna hogares prueba \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista Valpara√≠so Valpara√≠so Valpara√≠so 29 hola 2 Buena Vista Valpara√≠so Valpara√≠so Valpara√≠so 32 hola 3 Los Fleteros Valpara√≠so Valpara√≠so Valpara√≠so 56 hola 4 Pueblo Hundido Valpara√≠so Valpara√≠so Valpara√≠so 65 hola 5 Villa Italia Tur√≠n Valpara√≠so Valpara√≠so Valpara√≠so 33 hola 6 Nueva Esperanza Valpara√≠so Valpara√≠so Valpara√≠so 17 hola 7 Francisco Vergara Valpara√≠so Valpara√≠so Valpara√≠so 24 hola 8 Manuel Rodr√≠guez Valpara√≠so Valpara√≠so Valpara√≠so 21 hola 9 Sofia 35 Valpara√≠so Valpara√≠so Valpara√≠so 69 hola 10 Las Vi√±as De Irene Frei Valpara√≠so Marga Marga Villa Alemana 32 hola # ‚Ñπ 1,422 more rows Usamos la funci√≥n paste() para crear una nueva variable que contenga un texto, al cual le agregamos la cifra de otra variable. La operaci√≥n se realizar√° para cada una de las filas de nuestra tabla, utilizando las cifras que corresponda a la fila en cuesti√≥n:\ndatos |\u0026gt; select(nombre, hogares) |\u0026gt; mutate(texto = paste(\u0026#34;Numero de hogares:\u0026#34;, hogares)) # A tibble: 1,432 √ó 3 nombre hogares texto \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista 29 Numero de hogares: 29 2 Buena Vista 32 Numero de hogares: 32 3 Los Fleteros 56 Numero de hogares: 56 4 Pueblo Hundido 65 Numero de hogares: 65 5 Villa Italia Tur√≠n 33 Numero de hogares: 33 6 Nueva Esperanza 17 Numero de hogares: 17 7 Francisco Vergara 24 Numero de hogares: 24 8 Manuel Rodr√≠guez 21 Numero de hogares: 21 9 Sofia 35 69 Numero de hogares: 69 10 Las Vi√±as De Irene Frei 32 Numero de hogares: 32 # ‚Ñπ 1,422 more rows Es posible usar cualquier funci√≥n que opere sobre una variable del tipo que corresponda. Por ejemplo, podemos redondear los valores de una variable num√©rica, y si a esta nueva variable creada le asignamos al mismo nombre de la variable original, la variable original ser√° reemplazada por la versi√≥n nueva, con sus datos redondeados.\ndatos |\u0026gt; select(nombre, where(is.numeric), -cut) |\u0026gt; mutate(hectareas = round(hectareas, digits = 1), area = round(area, digits = 0)) # A tibble: 1,432 √ó 4 nombre hogares hectareas area \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Bellavista 29 1.5 10617 2 Buena Vista 32 1.7 11707 3 Los Fleteros 56 2.5 17465 4 Pueblo Hundido 65 4.6 32261 5 Villa Italia Tur√≠n 33 0.9 6081 6 Nueva Esperanza 17 0.4 2802 7 Francisco Vergara 24 2.8 19955 8 Manuel Rodr√≠guez 21 0.4 3103 9 Sofia 35 69 2.7 18819 10 Las Vi√±as De Irene Frei 32 1.2 8704 # ‚Ñπ 1,422 more rows Tambi√©n podemos crear una nueva variable a partir de un c√°lculo matem√°tico:\ndatos |\u0026gt; select(nombre, where(is.numeric), -cut) |\u0026gt; mutate(densidad = hectareas/hogares) # A tibble: 1,432 √ó 5 nombre hogares hectareas area densidad \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Bellavista 29 1.51 10617. 0.0522 2 Buena Vista 32 1.67 11707. 0.0522 3 Los Fleteros 56 2.49 17465. 0.0445 4 Pueblo Hundido 65 4.60 32261. 0.0708 5 Villa Italia Tur√≠n 33 0.867 6081. 0.0263 6 Nueva Esperanza 17 0.399 2802. 0.0235 7 Francisco Vergara 24 2.85 19955. 0.119 8 Manuel Rodr√≠guez 21 0.443 3103. 0.0211 9 Sofia 35 69 2.68 18819. 0.0389 10 Las Vi√±as De Irene Frei 32 1.24 8704. 0.0388 # ‚Ñπ 1,422 more rows Si creamos una nueva variable en base a una comparaci√≥n (en este caso, que las hect√°reas sean mayores a 2), entonces la nueva variable ser√° de tipo l√≥gico, indicando las observaciones que cumplen con la comparaci√≥n con TRUE, y las que no con FALSE.\ndatos |\u0026gt; select(nombre, hectareas) |\u0026gt; mutate(prioridad = hectareas \u0026gt; 2) # A tibble: 1,432 √ó 3 nombre hectareas prioridad \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;lgl\u0026gt; 1 Bellavista 1.51 FALSE 2 Buena Vista 1.67 FALSE 3 Los Fleteros 2.49 TRUE 4 Pueblo Hundido 4.60 TRUE 5 Villa Italia Tur√≠n 0.867 FALSE 6 Nueva Esperanza 0.399 FALSE 7 Francisco Vergara 2.85 TRUE 8 Manuel Rodr√≠guez 0.443 FALSE 9 Sofia 35 2.68 TRUE 10 Las Vi√±as De Irene Frei 1.24 FALSE # ‚Ñπ 1,422 more rows Si lo pensamos, √©sta es la misma forma mediante la cual funciona la funci√≥n filter(): se establece una comparaci√≥n, se eval√∫a si cada una de las filas cumple con la comparaci√≥n, y finalmente se eliminan las que no cumplen (FALSE).\nVariables dicot√≥micas con if_else() Siguiendo la l√≥gica del ejemplo anterior, podemos usar una funci√≥n que nos ayude a crear variables en base a si las filas cumplen o no con una o varias condiciones que definamos. A esta operaci√≥n se llama if else, que en espa√±ol ser√≠a si se cumple, entonces esto, y si no, esto otro.\nEntonces, podemos usar if_else() para crear nuevas variables en base a una comparaci√≥n, pero en vez de retornar verdadero o falso, puede retornar los valores que nosotros le pidamos.\nEjemplo:\nplata \u0026lt;- 1000000 plata \u0026lt; 300000 [1] FALSE # una comparaci√≥n normal retorna TRUE o FALSE # pero en el ifelse, le especificamos primero la comparaci√≥n, # luego lo que queremos que retorne si la comparaci√≥n es TRUE, # y finalmente lo que queremos que retorne si es false if_else(plata \u0026lt; 300000, true = \u0026#34;poca\u0026#34;, false = \u0026#34;mucha\u0026#34;) [1] \u0026quot;mucha\u0026quot; # tambi√©n se puede escribir obviando el \u0026#34;yes\u0026#34; y \u0026#34;no\u0026#34; if_else(plata \u0026lt; 300000, \u0026#34;poca\u0026#34;, \u0026#34;mucha\u0026#34;) [1] \u0026quot;mucha\u0026quot; Siguiendo el ejemplo, podemos usar la funci√≥n dentro de mutate para crear nuestra nueva variable dicot√≥mica:\ndatos |\u0026gt; select(nombre, hogares) |\u0026gt; mutate(tipo = if_else(hogares \u0026gt; 40, true = \u0026#34;grande\u0026#34;, false = \u0026#34;chico\u0026#34;) ) # A tibble: 1,432 √ó 3 nombre hogares tipo \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista 29 chico 2 Buena Vista 32 chico 3 Los Fleteros 56 grande 4 Pueblo Hundido 65 grande 5 Villa Italia Tur√≠n 33 chico 6 Nueva Esperanza 17 chico 7 Francisco Vergara 24 chico 8 Manuel Rodr√≠guez 21 chico 9 Sofia 35 69 grande 10 Las Vi√±as De Irene Frei 32 chico # ‚Ñπ 1,422 more rows Otro ejemplo:\ndatos |\u0026gt; select(nombre, region, hectareas) |\u0026gt; mutate(prioridad = if_else(hectareas \u0026gt; 2, \u0026#34;alta\u0026#34;, \u0026#34;normal\u0026#34;)) |\u0026gt; count(region, prioridad) # A tibble: 31 √ó 3 region prioridad n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Antofagasta alta 45 2 Antofagasta normal 71 3 Arica y Parinacota alta 8 4 Arica y Parinacota normal 6 5 Atacama alta 45 6 Atacama normal 76 7 Ays√©n del General Carlos Ib√°√±ez del Campo alta 3 8 Ays√©n del General Carlos Ib√°√±ez del Campo normal 7 9 Biob√≠o alta 128 10 Biob√≠o normal 97 # ‚Ñπ 21 more rows Para los siguientes ejemplos, crearemos un nuevo dataframe en base al anterior, pero que contenga nuevas variables creadas mediante operaciones matem√°ticas:\ndatos_2 \u0026lt;- datos |\u0026gt; mutate(densidad_ha = hectareas / hogares, area_km = area/1000, densidad_km = area_km / hogares) Variables m√°s complejas con case_when() La funci√≥n case_when() es equivalente a usar varios if_else() seguidos, y por lo tanto nos permite crear variables m√°s complejas, que tengan m√°s de dos categor√≠as. Se utiliza poniendo todas las evaluaciones junto al valor que queremos que adopten si es que estas comparaciones son TRUE.\nComo prueba, vamos a incluir una sola comparaci√≥n, para ver que le otorga el valor solo a las observaciones correspondientes, y las dem√°s las deja vac√≠as:\ndatos_2 |\u0026gt; select(nombre, densidad_km) |\u0026gt; mutate(categoria = case_when(densidad_km \u0026lt; 0.3 ~ \u0026#34;baja\u0026#34;)) # A tibble: 1,432 √ó 3 nombre densidad_km categoria \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista 0.366 \u0026lt;NA\u0026gt; 2 Buena Vista 0.366 \u0026lt;NA\u0026gt; 3 Los Fleteros 0.312 \u0026lt;NA\u0026gt; 4 Pueblo Hundido 0.496 \u0026lt;NA\u0026gt; 5 Villa Italia Tur√≠n 0.184 baja 6 Nueva Esperanza 0.165 baja 7 Francisco Vergara 0.831 \u0026lt;NA\u0026gt; 8 Manuel Rodr√≠guez 0.148 baja 9 Sofia 35 0.273 baja 10 Las Vi√±as De Irene Frei 0.272 baja # ‚Ñπ 1,422 more rows El orden en que ponemos las comparaciones ser√° importante, porque se ejecutan en el orden que las escribas, as√≠ que una vez que una fila adquiere un valor, la fila deja de ser evaluada en las siguientes comparaciones.\nEl siguiente ejemplo usa tres comparaciones para abarcar todo el rango de n√∫meros de la variable hogares:\ndatos_2 |\u0026gt; select(nombre, hogares) |\u0026gt; mutate(tama√±o = case_when(hogares \u0026gt; 60 ~ \u0026#34;grande\u0026#34;, hogares \u0026gt; 30 ~ \u0026#34;mediano\u0026#34;, hogares \u0026lt;= 30 ~ \u0026#34;chico\u0026#34;)) # A tibble: 1,432 √ó 3 nombre hogares tama√±o \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista 29 chico 2 Buena Vista 32 mediano 3 Los Fleteros 56 mediano 4 Pueblo Hundido 65 grande 5 Villa Italia Tur√≠n 33 mediano 6 Nueva Esperanza 17 chico 7 Francisco Vergara 24 chico 8 Manuel Rodr√≠guez 21 chico 9 Sofia 35 69 grande 10 Las Vi√±as De Irene Frei 32 mediano # ‚Ñπ 1,422 more rows Otro ejemplo:\ndatos_2 |\u0026gt; select(nombre, densidad_km) |\u0026gt; mutate(categoria = case_when(densidad_km \u0026lt; 0.3 ~ \u0026#34;baja\u0026#34;, densidad_km \u0026lt; 0.6 ~ \u0026#34;media\u0026#34;, densidad_km \u0026lt; 0.9 ~ \u0026#34;alta\u0026#34;, densidad_km \u0026gt;= 0.9 ~ \u0026#34;muy alta\u0026#34; )) # A tibble: 1,432 √ó 3 nombre densidad_km categoria \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista 0.366 media 2 Buena Vista 0.366 media 3 Los Fleteros 0.312 media 4 Pueblo Hundido 0.496 media 5 Villa Italia Tur√≠n 0.184 baja 6 Nueva Esperanza 0.165 baja 7 Francisco Vergara 0.831 alta 8 Manuel Rodr√≠guez 0.148 baja 9 Sofia 35 0.273 baja 10 Las Vi√±as De Irene Frei 0.272 baja # ‚Ñπ 1,422 more rows En el ejemplo anterior, usamos comparaciones que proponen un valor num√©rico, y coinciden con los valores inferiores al valor que pusimos. Entonces, el orden de asignaci√≥n de los valores para la nueva variable va de menor a mayor: de 0.3 para abajo, de 0.6 para abajo, de 0.9 para abajo. Lo importante es entender que, una vez que una observaci√≥n adquiere su etiqueta, las dem√°s comparaciones no la van a sobreescribir. Por ejemplo, si tenemos el valor 0.2, va a ser etiquetado por la comparaci√≥n \u0026ldquo;valores menores a 0.3\u0026rdquo;, porque es menor a 0.3. Pero cuando se aplique la siguiente comparaci√≥n, que es \u0026ldquo;valores menores a 0.6\u0026rdquo;, a pesar de que 0.2 tambi√©n es menor a 0.6, no va a recibir una nueva etiqueta, porque ya obtuvo una en la comparaci√≥n anterior (menores a 0.3).\nLas comparaciones tambi√©n pueden combinarse para volverse m√°s espec√≠ficas. En el siguiente ejemplo definiremos no solamente si son menores a un valor, sino que definimos un rango de valores:\nmayores a 0 y menores a 3 mayores o iguales a 0.3 y menores a 0.6 etc Podemos especificar el argumento .default para que le otorgue a un valor a \u0026ldquo;todos los dem√°s\u0026rdquo;; es decir, a los valores que no coincidieron con ninguna de las condiciones dadas.\ndatos_2 |\u0026gt; mutate(categoria = case_when(densidad_km \u0026gt; 0 \u0026amp; densidad_km \u0026lt; 0.3 ~ \u0026#34;baja\u0026#34;, densidad_km \u0026gt;= 0.3 \u0026amp; densidad_km \u0026lt; 0.6 ~ \u0026#34;media\u0026#34;, densidad_km \u0026gt;= 0.6 \u0026amp; densidad_km \u0026lt; 0.9 ~ \u0026#34;alta\u0026#34;, .default = \u0026#34;desconocido\u0026#34;)) |\u0026gt; select(nombre, densidad_km, categoria) |\u0026gt; filter(categoria != \u0026#34;desconocido\u0026#34;) |\u0026gt; print(n = 15) # A tibble: 1,066 √ó 3 nombre densidad_km categoria \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista 0.366 media 2 Buena Vista 0.366 media 3 Los Fleteros 0.312 media 4 Pueblo Hundido 0.496 media 5 Villa Italia Tur√≠n 0.184 baja 6 Nueva Esperanza 0.165 baja 7 Francisco Vergara 0.831 alta 8 Manuel Rodr√≠guez 0.148 baja 9 Sofia 35 0.273 baja 10 Las Vi√±as De Irene Frei 0.272 baja 11 Lomas De Bellavista 0.662 alta 12 Manzana 33 0.414 media 13 Ampliaci√≥n Prat-Lomas De Pe√±ablanca 0.723 alta 14 Los Artesanos 0.401 media 15 La Uni√≥n - El√≠as Lafferte 0.465 media # ‚Ñπ 1,051 more rows Finalmente, case_when() nos permite crear cualquier tipo de comparaci√≥n arbitraria, usando cualquier columna de nuestro dataframe; por ejemplo, en este caso vamos a etiquetar una variable sobre densidad, pero podemos condicionar cierta densidad con una regi√≥n. En este ejemplo (solo con fines ilustrativos), las observaciones que son de Valpara√≠so no pueden ser categorizadas como altas:\ndatos_2 |\u0026gt; mutate(categoria = case_when(densidad_km \u0026gt; 0 \u0026amp; densidad_km \u0026lt; 0.3 ~ \u0026#34;baja\u0026#34;, densidad_km \u0026gt;= 0.3 \u0026amp; densidad_km \u0026lt; 0.6 ~ \u0026#34;media\u0026#34;, region != \u0026#34;Valpara√≠so\u0026#34; \u0026amp; densidad_km \u0026gt;= 0.6 \u0026amp; densidad_km \u0026lt; 0.9 ~ \u0026#34;alta\u0026#34;)) |\u0026gt; select(nombre, region, densidad_km, categoria) # A tibble: 1,432 √ó 4 nombre region densidad_km categoria \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 Bellavista Valpara√≠so 0.366 media 2 Buena Vista Valpara√≠so 0.366 media 3 Los Fleteros Valpara√≠so 0.312 media 4 Pueblo Hundido Valpara√≠so 0.496 media 5 Villa Italia Tur√≠n Valpara√≠so 0.184 baja 6 Nueva Esperanza Valpara√≠so 0.165 baja 7 Francisco Vergara Valpara√≠so 0.831 \u0026lt;NA\u0026gt; 8 Manuel Rodr√≠guez Valpara√≠so 0.148 baja 9 Sofia 35 Valpara√≠so 0.273 baja 10 Las Vi√±as De Irene Frei Valpara√≠so 0.272 baja # ‚Ñπ 1,422 more rows Pivotar Creamos una peque√±a tabla de conteo de casos a partir de dos variables de agrupaci√≥n: la regi√≥n y el tama√±o.\ntabla \u0026lt;- datos_2 |\u0026gt; mutate(tama√±o = case_when(hogares \u0026gt; 60 ~ \u0026#34;grande\u0026#34;, hogares \u0026gt; 30 ~ \u0026#34;mediano\u0026#34;, .default = \u0026#34;chico\u0026#34;)) |\u0026gt; count(region, tama√±o) tabla # A tibble: 47 √ó 3 region tama√±o n \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Antofagasta chico 42 2 Antofagasta grande 52 3 Antofagasta mediano 22 4 Arica y Parinacota chico 4 5 Arica y Parinacota grande 6 6 Arica y Parinacota mediano 4 7 Atacama chico 62 8 Atacama grande 29 9 Atacama mediano 30 10 Ays√©n del General Carlos Ib√°√±ez del Campo chico 7 # ‚Ñπ 37 more rows En esta tabla, cada fila corresponde a una observaci√≥n distinta; es decir, cada fila adquiere exactamente s√≥lo un valor posible de cada una de las variables. Al mismo tiempo, cada columna solamente corresponde a una variable espec√≠fica, y cada celda de la tabla solamente aloja un valor. Por ejemplo, en la primera fila, la regi√≥n es \u0026ldquo;Antofagasta\u0026rdquo;, el tama√±o es \u0026ldquo;chico\u0026rdquo;, y n es 42. A esto se le denomina formato largo o Tidy, y es un principio b√°sico de mantener para el an√°lisis de datos.\nSin embargo, al momento de compartir o publicar los datos, estas convenciones sobre ordenamiento de los datos dejan de ser prioridad. Usualmente, en las tablas destinadas para revisar o entregar resultados, las variables num√©ricas que est√°n agrupadas por otras variables (regi√≥n y tama√±o, en nuestro ejemplo) suelen presentarse con cada una de las categor√≠as de agrupaci√≥n en una columna distinta. Entonces, Antofagasta ya no usar√≠a tres filas, sino una sola fila, pero habr√≠an tres columnas que correspond√≠an al tama√±o, chico mediano y grande, cada una de esas celdas es conteniendo el valor num√©rico correspondiente. Entonces, terminar√≠amos con un DataFramed donde cada regi√≥n corresponda a una fila, y en cada fila habr√°n tres valores, cada uno correspondiendo a la categor√≠a de la variable tama√±o correspondiente.\nPara realizar esta transformaci√≥n de la estructura de los datos, cargaremos el paquete {tidyr}:\nlibrary(tidyr) La operaci√≥n que necesitamos realizar es pivotar la tabla a un formato ancho. Para esto, definimos que variable nos entregar√° los nombres de las nuevas columnas (en este ejemplo, el tama√±o), y desde qu√© variable se sacar√°n los valores que se ubicar√°n en cada una de las columnas nuevas:\ntabla_ancha \u0026lt;- tabla |\u0026gt; pivot_wider(names_from = tama√±o, values_from = n, values_fill = 0) |\u0026gt; relocate(mediano, .after = chico) tabla_ancha # A tibble: 16 √ó 4 region chico mediano grande \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; 1 Antofagasta 42 22 52 2 Arica y Parinacota 4 4 6 3 Atacama 62 30 29 4 Ays√©n del General Carlos Ib√°√±ez del Campo 7 2 1 5 Biob√≠o 116 61 48 6 Coquimbo 30 12 10 7 La Araucan√≠a 48 19 3 8 Libertador General Bernardo O'Higgins 49 6 4 9 Los Lagos 35 17 15 10 Los R√≠os 27 6 7 11 Magallanes y de la Ant√°rtica Chilena 0 2 1 12 Maule 22 2 1 13 Metropolitana 89 28 51 14 Tarapac√° 13 14 37 15 Valpara√≠so 209 79 86 16 √ëuble 20 3 1 De esta forma, obtenemos una tabla m√°s compacta, que nos permite visualizar los datos de una forma m√°s sencilla.\nlibrary(gt) gt(tabla_ancha) |\u0026gt; gt::tab_header(title = \u0026#34;Campamentos seg√∫n tama√±o\u0026#34;) |\u0026gt; cols_label(region = \u0026#34;Regi√≥n\u0026#34;) |\u0026gt; tab_style(locations = cells_body(region), style = cell_text(style = \u0026#34;italic\u0026#34;)) Campamentos seg√∫n tama√±o Regi√≥n chico mediano grande Antofagasta 42 22 52 Arica y Parinacota 4 4 6 Atacama 62 30 29 Ays√©n del General Carlos Ib√°√±ez del Campo 7 2 1 Biob√≠o 116 61 48 Coquimbo 30 12 10 La Araucan√≠a 48 19 3 Libertador General Bernardo O'Higgins 49 6 4 Los Lagos 35 17 15 Los R√≠os 27 6 7 Magallanes y de la Ant√°rtica Chilena 0 2 1 Maule 22 2 1 Metropolitana 89 28 51 Tarapac√° 13 14 37 Valpara√≠so 209 79 86 √ëuble 20 3 1 Guardar en Excel Guardar una tabla o dataframe de R en formato Excel es tan sencillo como utilizar la funci√≥n write_xlsx() y entregarle el objeto y el nombre del archivo que queremos crear.\nlibrary(writexl) write_xlsx(tabla_ancha, \u0026#34;tabla_campamentos.xlsx\u0026#34;) Con esto concluye este tutorial inicial para manipular datos con el paquete {dplyr}. En siguientes tutoriales iremos usando funciones m√°s complejas y avanzadas! ü´£\nSi este tutorial te sirvi√≥, por favor considera hacerme una donaci√≥n! Cualquier monto me ayuda al menos a poder tomarme un cafecito ü•∫\n","date":"2024-11-09T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/tutorial_dplyr_campamentos/","tags":"dplyr","title":"Tutorial: introducci√≥n a {dplyr} usando datos de campamentos"},{"content":" {ggplot2} es una librer√≠a de visualizaci√≥n de datos bastante popular en el mundo de la ciencia de datos. Sus principales caracter√≠sticas son su atractivo, su conveniencia para la exploraci√≥n de datos, un gran potencial de personalizaci√≥n, y un extenso ecosistema de extensiones que nos permiten generar visualizaciones pr√°cticamente de cualquier tipo.\nOtro beneficio de usarlo es propio de el uso de cualquier herramienta program√°tica para generar resultados en el √°mbito del an√°lisis de datos: la reusabilidad del c√≥digo, que nos permite especificar una sola vez el resultado que queremos y luego volver a aplicarlo infinitas veces con distintos datos, datos actualizados, o variaciones de un conjunto de datos, etc.\nEste tutorial est√° dise√±ado para empezar desde lo m√°s b√°sico, e ir avanzando de a poco por distintos tipos de visualizaciones para familiarizarse con el modo de uso de este paquete. A medida que tutorial avanza, se van introduciendo nuevos elementos es la medida que son relevantes y apropiados de introducir. Tambi√©n se van introduciendo distintos conjuntos de datos, y usando paquetes auxiliares que son introducidos secuencialmente. Por estas razones, se recomienda seguir el tutorial en orden.\n‚ö†Ô∏è Si a√∫n no te manejas bien programando en R, te recomiendo revisar primero este tutorial sobre trabajar con datos usando {dplyr}, o bien, este tutorial y su segunda parte para aprender R desde cero. Introducci√≥n La librer√≠a {ggplot2} crea gr√°ficos por medio de un sistema de capas. Mediante la suma de capas vamos a poder crear expresiones gr√°ficas de nuestros datos, agregando tantas capas como sean necesarias para comunicar los resultados, as√≠ como tambi√©n para afinar la visualizaci√≥n final.\nPara entender c√≥mo funciona {ggplot2}, veamos primero los principales tipos de capas que vamos a poder ir agregando a nuestro gr√°fico. Cada capa va a tener un rol espec√≠fico, y es importante saber c√≥mo se llaman para poder aplicarlas cuando queramos modificar uno u otro aspecto de nuestra visualizaci√≥n.\ndatos: usualmente la primera capa, que entrega los datos a {ggplot2} para poder usar variables como elementos de la visualizaci√≥n est√©ticas: (aes()) capa donde se realiza el mapeo1 de variables a objetos geom√©tricos, leyendas, ejes y escalas geometr√≠as: (geom_x()) escalas: (scale_x_y()) definici√≥n de las dimensiones que adquirir√°n las est√©ticas, tales como rangos de valores, paletas de colores, l√≠mites de los ejes, etc. coordenadas: (coord_x()): configuraci√≥n del plano de coordenadas donde se grafican los datos; por ejemplo, definir los l√≠mites del gr√°fico, la proyecci√≥n de los datos si es que se trata de un mapa, etc. facetas: (facet_x()) distribuci√≥n de los datos en matrices de gr√°ficos; son una forma de especificar que queremos dividir la visualizaci√≥n en tantos gr√°ficos como valores tenga una variable temas: (theme()) configura detalles visuales de todos los elementos del gr√°fico, tales como fondo, grilla, ejes, tipograf√≠a, tama√±os, espaciados, bordes y m√°s. Una vez que entendamos estas piezas b√°sicas de la creaci√≥n de gr√°ficos con {ggplot2}, pasemos a generar nuestras primeras visualizaciones.\n# install.packages(\u0026#34;ggplot2\u0026#34;) library(ggplot2) Vamos a crear un gr√°fico vac√≠o a partir de una primera capa de datos. Para iniciar la creaci√≥n de un gr√°fico, usamos la funci√≥n ggplot(), a la cual le pasamos el conjunto de datos que queremos usar.\niris |\u0026gt; ggplot() ggplot(data = iris) # equivalente a lo anterior Al llamar la funci√≥n ggplot() se genera un gr√°fico completamente vac√≠o, ya que a√∫n no hemos definido las est√©ticas ni las geometr√≠as de nuestro gr√°fico.\nA nuestra primera capa de datos le agregaremos una capa de est√©tica, en la cual mapearemos variables a aspectos de la visualizaci√≥n. Los aspectos m√°s b√°sicos de una visualizaci√≥n de datos, y usualmente los que son obligatorios de definir, son las variables mapeadas a los ejes horizontales (x) y verticales (y) del gr√°fico.\niris |\u0026gt; ggplot() + # iniciar el gr√°fico # definir el mapeo de variables a caracter√≠sticas est√©ticas del gr√°fico aes(x = Sepal.Length, # eje x (horizontal) y = Sepal.Width) # eje y (vertical) Con el c√≥digo anterior hicimos que el eje horizontal se corresponda con la variable Sepal.Length y el eje vertical con Sepal.Width. Podemos ver que ambos ejes adoptaron los nombres, rangos y valores de estas variables.\nSin embargo, a√∫n no hay ninguna expresi√≥n gr√°fica directa de los datos en nuestro gr√°fico, debido a que a√∫n no especificamos una capa de geometr√≠a.\nDispersi√≥n Como elegimos columnas num√©ricas de los datos iris para el gr√°fico, lo que representaremos son la ubicaci√≥n de las observaciones con respecto a ambas variables. Cuando tenemos dos variables num√©ricas en los ejes, podemos crear un gr√°fico de dispersi√≥n.\nAgreguemos una capa geom_point() a nuestro gr√°fico para que los datos se expresen visualmente como puntos:\niris |\u0026gt; ggplot() + # iniciar el gr√°fico # definir el mapeo de variables a caracter√≠sticas est√©ticas del gr√°fico aes(x = Sepal.Length, # eje x (horizontal) y = Sepal.Width) + # eje y (vertical) # agregar una capa de geometr√≠a geom_point() # geometr√≠a de puntos Con geom_point(), cada observaci√≥n adquiere una coordenada en el gr√°fico en base a los valores que tengan en las variables de los ejes vertical y horizontal.\nEste tipo de gr√°ficos se llaman gr√°ficos de dispersi√≥n, y son √∫tiles para explorar datos que poseen varias variables num√©ricas que pueden estar relacionadas entre s√≠.\nComplementemos el ejemplo anterior, esta vez mapeando una variable m√°s a la est√©tica del color:\niris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width, color = Species) + # variable mapeada al color geom_point() Los puntos del gr√°fico adquieren colores en base a una tercera variable, Species, permiti√©ndonos diferenciar grupos de puntos, y en consiguiente extraer m√°s informaci√≥n desde la visualizaci√≥n.\nAhora, en lugar del color, mapeemos una variable al tama√±o de los puntos:\niris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width, size = Petal.Length) + # variable mapeada al tama√±o geom_point(color = \u0026#34;purple2\u0026#34;, alpha = 0.5) Ahora los valores de la variable Petal.Length que mapeamos a la est√©tica size har√°n que los puntos del gr√°fico cambien de tama√±o en relaci√≥n a los valores de Petal.Length.\nDentro de la geometr√≠a podemos definir manualmente el color, la transparencia, Y varios otros atributos visuales de todas las geometr√≠as que usemos. En este caso, definimos un color para todos los puntos, y una transparencia que nos permitir√° notar cuando existen puntos sobrepuestos (observaciones id√©nticas).\nNaturalmente, podemos usar variables para controlar tanto el color como el tama√±o, y ajustar los argumentos de las geometr√≠as para que se vean como queramos. Como toque final, cambiamos la paleta de colores por una de ColorBrewer:\niris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width, color = Species, size = Petal.Length) + geom_point(alpha = 0.6, shape = \u0026#34;diamond\u0026#34;) + # paleta de colores scale_color_brewer(palette = \u0026#34;Set2\u0026#34;) + # tema del gr√°fico theme_minimal() Histograma Los gr√°ficos de histograma se usan com√∫nmente para explorar la distribuci√≥n de los datos de forma r√°pida.\niris |\u0026gt; # datos ggplot() + # iniciar aes(x = Sepal.Length) + # variable horizontal geom_histogram() # histograma Ese tipo de gr√°ficos solamente requiere de una variable. La variable se expresar√° en el eje horizontal, con la frecuencia de observaciones ascendiendo desde el plano horizontal en correspondencia con la cantidad de casos en cada valor de la variable.\nEn otras palabras, un histograma nos permite ver cu√°ntas veces se repite cada valor de una variable, y de este modo podemos identificar c√≥mo se distribuyen los datos.\nDensidad Al igual que los histogramas, los gr√°ficos de densidad solo requieren de una variable. Los gr√°ficos de densidad expresan la distribuci√≥n de los datos como una curva, simplificando la visualizaci√≥n.\niris |\u0026gt; ggplot() + aes(x = Sepal.Length) + geom_density() Podemos cambiar los argumentos de geom_density(), o de cualquier otra funci√≥n geom_x(), para personalizar su apariencia:\niris |\u0026gt; ggplot() + aes(x = Sepal.Length) + geom_density(fill = \u0026#34;black\u0026#34;, alpha = 0.6) Si mapeamos una variable al color del gr√°fico de densidad, obtendremos m√∫ltiples distribuciones de datos para cada grupo en la variable asignada al color.\niris |\u0026gt; ggplot() + aes(x = Sepal.Length, fill = Species, # relleno de la figura color = Species) + # bordes de la figura geom_density(alpha = 0.6) + # tema theme_classic() + scale_color_brewer(palette = \u0026#34;Dark2\u0026#34;) + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + coord_cartesian(expand = FALSE) Cu√°ndo se visualizan figuras cerradas, como una curva, una barra, o un pol√≠gono, existen dos argumentos que corresponden con el color: el relleno (fill) de las figuras, y su borde (color). Por eso en este ejemplo asignamos la variable Species tanto al relleno como al borde. Como toque final, definimos un tema con theme_classic(), aplicamos una paleta de colores tanto al relleno como al color, y eliminamos el espaciado extra en los ejes ajustando el argumento expand en la capa de coordenadas, coord_cartesian().\nPara seguir aprendiendo veremos algunos ejemplos con conjuntos de datos reales.\nEl primer conjunto de datos que utilizaremos es una serie de temperaturas medidas en estaciones meteorol√≥gicas a lo largo de todo Chile.\nlibrary(dplyr) # para manipular datos library(readr) # para cargar datos Puedes descargar los datos desde este repositorio, o bien ejecutar el siguiente c√≥digo que descargar√° los datos directamente y los cargar√° en tu sesi√≥n de R:\ntemp \u0026lt;- read_csv2(\u0026#34;https://github.com/bastianolea/temperaturas_chile/raw/main/datos/procesados/temperaturas_chile_unificadas.csv\u0026#34;) glimpse(temp) Rows: 159,073 Columns: 13 $ codigo_nacional \u0026lt;dbl\u0026gt; 180005, 180005, 180005, 180005, 180005, 180005, 180005‚Ä¶ $ altura \u0026lt;dbl\u0026gt; 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50‚Ä¶ $ a√±o \u0026lt;dbl\u0026gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, ‚Ä¶ $ mes \u0026lt;dbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶ $ dia \u0026lt;dbl\u0026gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,‚Ä¶ $ t_min \u0026lt;dbl\u0026gt; 16.7, 16.2, 20.1, 17.5, 19.8, 18.8, 17.5, 17.3, 19.2, ‚Ä¶ $ t_max \u0026lt;dbl\u0026gt; 23.9, 23.5, 24.3, 24.4, 23.9, 24.0, 23.6, 23.1, 24.9, ‚Ä¶ $ nombre \u0026lt;chr\u0026gt; \u0026quot;Chacalluta, Arica Ap.\u0026quot;, \u0026quot;Chacalluta, Arica Ap.\u0026quot;, \u0026quot;Cha‚Ä¶ $ latitud \u0026lt;dbl\u0026gt; -18.35555, -18.35555, -18.35555, -18.35555, -18.35555,‚Ä¶ $ longitud \u0026lt;dbl\u0026gt; -70.34028, -70.34028, -70.34028, -70.34028, -70.34028,‚Ä¶ $ zona_geografica \u0026lt;chr\u0026gt; \u0026quot;Litoral\u0026quot;, \u0026quot;Litoral\u0026quot;, \u0026quot;Litoral\u0026quot;, \u0026quot;Litoral\u0026quot;, \u0026quot;Litoral\u0026quot;,‚Ä¶ $ fecha \u0026lt;date\u0026gt; 2013-01-01, 2013-01-02, 2013-01-03, 2013-01-04, 2013-‚Ä¶ $ t_med \u0026lt;dbl\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA‚Ä¶ El conjunto de datos posee variables de identificaci√≥n de las estaciones meteorol√≥gicas como su nombre y ubicaci√≥n, tres columnas que identifican la fecha de la observaci√≥n, y dos columnas con las temperaturas m√≠nimas y m√°ximas.\nExploremos las observaciones de una estaci√≥n a trav√©s del tiempo con un gr√°fico de histograma, usando la geometr√≠a geom_histogram():\ntemp |\u0026gt; filter(nombre == \u0026#34;Chacalluta, Arica Ap.\u0026#34;) |\u0026gt; ggplot() + aes(fecha) + geom_histogram(color = \u0026#34;white\u0026#34;) + # tema theme_classic() Dentro de la funci√≥n geom_histogram() especificamos que el borde de las barras sea blanco, y al final del gr√°fico agregamos una funci√≥n theme_x() para darle una apariencia distinta a la visualizaci√≥n.\nDispersi√≥n Teniendo dos columnas num√©ricas, podemos crear un gr√°fico de dispersi√≥n que dibuje un puntos que relacionen las mediciones meteorol√≥gicas de cada d√≠a.\ntemp |\u0026gt; filter(nombre == \u0026#34;Carriel Sur, Concepci√≥n Ap.\u0026#34;, a√±o \u0026gt; 1990) |\u0026gt; ggplot() + aes(t_min, t_max, color = mes) + geom_point(alpha = 0.6) + # tema theme_classic() Cada punto representa un d√≠a, y su ubicaci√≥n corresponde a la temperatura m√°xima y m√≠nima de cada d√≠a.\nCajas o boxplot Puedes crear un gr√°fico de caja o boxplot del total de las observaciones:\ntemp |\u0026gt; ggplot() + aes(y = t_max) + geom_boxplot(fill = \u0026#34;grey90\u0026#34;) + theme_classic() Solamente definiendo una variable para el eje vertical obtenemos un gr√°fico que nos presenta un resumen estad√≠stico de las observaciones del conjunto de datos, con l√≠neas que marcan la mediana (al medio de la caja) y los cuartiles del 25% y del 75% (los l√≠mites de la caja).\nFiltremos los datos para tener informaci√≥n de s√≥lo tres estaciones meteorol√≥gicas:\ntemp_filt \u0026lt;- temp |\u0026gt; filter(nombre %in% c(\u0026#34;Chacalluta, Arica Ap.\u0026#34;, \u0026#34;General Freire, Curic√≥ Ad.\u0026#34;, \u0026#34;Carlos Iba√±ez, Punta Arenas Ap.\u0026#34;)) Ahora podemos asignar la variable nombre al eje horizontal del gr√°fico para obtener tres cajas:\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_boxplot(fill = \u0026#34;grey90\u0026#34;) + # tema theme_classic() Tambi√©n podemos volver a mapear la variable del eje horizontal a la est√©tica del color para distinguir a√∫n m√°s las cajas; sin embargo, mapear una variable al color hace que aparezca una leyenda, que en este caso es redundante, por lo que agregamos una capa de leyenda (guides()) para omitirla.\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max, color = nombre, fill = nombre) + geom_boxplot(alpha = 0.5) + guides(fill = guide_none(), color = guide_none()) + # tema theme_classic() + # paletas de colores scale_fill_brewer(palette = \u0026#34;Set2\u0026#34;) + scale_color_brewer(palette = \u0026#34;Set2\u0026#34;) Dispersi√≥n por grupos Si queremos producir un punto por cada observaci√≥n a trav√©s de las tres estaciones metodolog√≠as que filtramos, obtenemos un gr√°fico como el siguiente:\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_point(size = 10, alpha = 0.05) + theme_minimal() Podemos ver que resulta un gr√°fico muy poco legible, dado que estamos dibujando 15 mil puntos unos encima de otros. Para solucionarlo, podemos reemplazar geom_point() por geom_jitter(), que es una geometr√≠a que agrega dispersi√≥n a los puntos para hacerlos mas visibles:\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_jitter(size = 2, alpha = 0.05, height = 0) + theme_minimal() Dentro de los argumentos de geom_jitter() podemos especificar la direcci√≥n en la que queremos agregar la dispersi√≥n aleatoria. Si especificamos height = 0, entonces la dispersi√≥n no ser√° vertical, y los puntos solamente se mover√°n horizontalmente, para que la posici√≥n vertical de los puntos sea certera y solamente se desplacen hacia los lados para poder verlos individualmente sin que se tapen unos a otros.\nViol√≠n Los gr√°ficos de violin son b√°sicamente gr√°ficos de densidad, pero espejados o duplicados para producir una silueta similar a la de un viol√≠n.\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_violin(alpha = 0.5, fill = \u0026#34;grey90\u0026#34;) + theme_minimal() Recordemos que siempre podemos agregar la cantidad de capas que deseemos a nuestros gr√°ficos. Por ejemplo, agregar un boxplot sobre los violines:\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_violin(alpha = 0.4, fill = \u0026#34;purple3\u0026#34;, color = \u0026#34;purple3\u0026#34;) + geom_boxplot(width = 0.2, outliers = FALSE, alpha = 0.4, fill = \u0026#34;purple4\u0026#34;, color = \u0026#34;purple4\u0026#34;,) + theme_minimal() combinar viol√≠n con puntos\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_jitter(size = 1, alpha = 0.05, height = 0) + geom_violin(alpha = 0.4) + theme_minimal() Los gr√°ficos que creemos no tienen por qu√© reducirse a un solo conjunto de datos. Podemos calcular un nuevo conjunto de datos para complementar las visualizaciones que queremos realizar.\nCalculemos una tabla que contenga los promedios y las medianas para cada uno de los tres grupos de nuestro conjunto de datos:\n# calcular medianas temp_median \u0026lt;- temp_filt |\u0026gt; group_by(nombre) |\u0026gt; summarise(t_max = median(t_max, na.rm = T)) Luego podemos hacer el gr√°fico, y en las capas que queremos utilizar conjuntos de datos distintos, usamos el argumento data para decirle a {ggplot2} que esas capas se basar√°n en datos distintos a los de la primera capa de datos (temp_filt):\ntemp_filt |\u0026gt; ggplot() + aes(nombre, t_max) + geom_violin(alpha = 0.4, color = \u0026#34;grey80\u0026#34;, fill = \u0026#34;grey80\u0026#34;) + # cuadrados de mediana geom_point(data = temp_median, size = 5, shape = \u0026#34;diamond\u0026#34;, color = \u0026#34;purple\u0026#34;, alpha = 0.6) + # tema theme_minimal() Como las columnas de el segundo conjunto de datos (temp_median) se llaman igual a las del primero, {ggplot2} detecta las variables mapeadas en la capa de est√©tica y las reutiliza en la segunda capa de geometr√≠a, por lo que no es necesario especificar en la capa de geom_point() las variables a utilizar. Pero si las variables de un segundo conjunto de datos se llamaran distinto, podr√≠amos especificar dentro de la geometr√≠a una nueva est√©tica con la funci√≥n aes() para que se aplique a esa capa en particular.\nL√≠neas Para visualizar los datos como l√≠neas primero procesaremos los datos para obtener promedios mensuales de temperatura:\nlibrary(lubridate) # para trabajar con fechas temp_mensual \u0026lt;- temp |\u0026gt; filter(nombre == \u0026#34;Quinta Normal, Santiago\u0026#34;, a√±o \u0026gt; 1980) |\u0026gt; # redondear fechas al mes mutate(fecha = lubridate::floor_date(fecha, \u0026#34;month\u0026#34;)) |\u0026gt; group_by(fecha) |\u0026gt; summarise(t_min = mean(t_min, na.rm = T), t_max = mean(t_max, na.rm = T)) Ahora podemos usar una variable en formato fecha como eje horizontal. {ggplot2} detectar√° que la variable es una fecha y mostrar√° un eje adaptado de acuerdo a la escala de los datos; en este caso, mostrando s√≥lo los a√±os.\ntemp_mensual |\u0026gt; ggplot() + aes(x = fecha, # usar fecha como eje horizontal y = t_max, color = t_max) + geom_line(linewidth = 1) + # gr√°fico de l√≠neas # especificar colores de la escala scale_color_gradient(low = \u0026#34;blue4\u0026#34;, high = \u0026#34;red2\u0026#34;) + # leyenda abajo guides(color = guide_colorbar(position = \u0026#34;bottom\u0026#34;)) + # temas theme_classic() + theme(legend.key.width = unit(30, \u0026#34;pt\u0026#34;), legend.key.height = unit(4, \u0026#34;pt\u0026#34;)) Mosaico Del mismo modo que realizamos un gr√°fico de dispersi√≥n, podemos realizar un gr√°fico de puntos ordenados si es que las variables num√©ricas que usaremos en los ejes de coordenadas son consistentes, por ejemplo, en el caso de observaciones medidas diaria o mensualente.\nEn el siguiente gr√°fico mapearemos los valores de las temperaturas por a√±o horizontalmente, y con los meses verticalmente:\ntemp |\u0026gt; filter(nombre == \u0026#34;General Freire, Curic√≥ Ad.\u0026#34;) |\u0026gt; group_by(a√±o, mes) |\u0026gt; summarize(t_max = mean(t_max, na.rm = T)) |\u0026gt; filter(a√±o \u0026gt;= 1980) |\u0026gt; ggplot() + aes(a√±o, mes, color = t_max) + geom_point(size = 3, alpha = .7) + scale_y_continuous(breaks = 1:12) + theme_minimal() Obtenemos una visualizaci√≥n que nos permite ver, al mismo tiempo, la evoluci√≥n a trav√©s de los a√±os de las temperaturas, teniendo la vista la variaci√≥n mensual dentro de cada a√±o. Podemos mejorar esta visualizaci√≥n utilizando la geometr√≠a geom_tile(), para generar mosaicos:\ntemp |\u0026gt; filter(nombre == \u0026#34;General Freire, Curic√≥ Ad.\u0026#34;) |\u0026gt; group_by(a√±o, mes) |\u0026gt; summarize(t_max = mean(t_max, na.rm = T)) |\u0026gt; filter(a√±o \u0026gt;= 1980) |\u0026gt; ggplot() + aes(a√±o, mes, fill = t_max) + geom_tile()+ scale_y_continuous(breaks = 1:12) + theme_minimal() En el clase anterior, cada observaci√≥n es representada por uno de los mosaicos. Esta visualizaci√≥n podr√≠a mejorarse si es que cambiamos el sistema de coordenadas del gr√°fico para que la relaci√≥n entre la variable vertical y la variable horizontal sea siempre cuadrada. Usamos la funci√≥n coord_fixed() para fijar el sistema de coordenadas para cada intersecci√≥n entre el eje x e y tengan un aspecto cuadrado:\ntemp |\u0026gt; filter(nombre == \u0026#34;General Freire, Curic√≥ Ad.\u0026#34;) |\u0026gt; group_by(a√±o, mes) |\u0026gt; summarize(t_max = mean(t_max, na.rm = T)) |\u0026gt; filter(a√±o \u0026gt;= 1980) |\u0026gt; ggplot() + aes(a√±o, mes, fill = t_max) + geom_tile() + coord_fixed(expand = FALSE) + viridis::scale_fill_viridis(option = \u0026#34;magma\u0026#34;, name = NULL) + theme_minimal() + scale_y_continuous(breaks = 1:12) + scale_x_continuous(breaks = c(seq(1980, 2020, 10), 2024)) + labs(title = \u0026#34;Temperatura m√°xima mensual\u0026#34;, subtitle = \u0026#34;Estaci√≥n meteorol√≥gica General Freire, Curic√≥\u0026#34;) + theme(legend.key.height = unit(8, \u0026#34;mm\u0026#34;), legend.key.width = unit(2, \u0026#34;mm\u0026#34;)) + theme(panel.grid.major = element_blank()) Al especificar el argumento expand = FALSE en cualquier funci√≥n coord_x(), hacemos que el gr√°fico elimine el espaciado interior entre los ejes y las geometr√≠as, logrando as√≠ que se acerquen los mosaicos a los n√∫meros de las escalas.\nA esta visualizaci√≥n tambi√©n le agregamos una paleta de colores continua m√°s apropiada para mostrar las diferencias entre los valores; en este caso, la paleta magma del conjunto de paletas de colores {viridis}. Adem√°s usamos scale_x_continuous() para especificar los quiebres (breaks) de los valores de la escala horizontal, incluyendo as√≠ el a√±o 2024, ya agregamos t√≠tulos, subt√≠tulos, y especificaciones del tema del gr√°fico (theme()) para que la leyenda se vea mejor.\nSeguiremos con los ejemplos de visualizaciones usando un conjunto de datos distintos. Se trata de conteo de poblaci√≥n ind√≠gena u originaria, desagradados por g√©nero, pueblo ind√≠gena, y ubicaci√≥n geogr√°fica. Puedes obtener los datos desde este repositorio, o cargar los datos desde la siguiente funci√≥n, que los descarga y lo agrega tu entorno de R directamente.\npueblos \u0026lt;- readr::read_csv2(\u0026#34;https://github.com/bastianolea/pueblos_indigenas_chile/raw/master/datos/pueblos_indigenas_chile.csv\u0026#34;) glimpse(pueblos) Rows: 7,612 Columns: 10 $ sexo \u0026lt;chr\u0026gt; \u0026quot;Hombres\u0026quot;, \u0026quot;Hombres\u0026quot;, \u0026quot;Hombres\u0026quot;, \u0026quot;Hombres\u0026quot;, \u0026quot;Hombres\u0026quot;,‚Ä¶ $ pueblo \u0026lt;chr\u0026gt; \u0026quot;Mapuche\u0026quot;, \u0026quot;Aymara\u0026quot;, \u0026quot;Rapa Nui\u0026quot;, \u0026quot;Lican Antai\u0026quot;, \u0026quot;Quech‚Ä¶ $ n \u0026lt;dbl\u0026gt; 4094, 27075, 19, 353, 1156, 152, 915, 14, 5, 2202, 540‚Ä¶ $ codigo_comuna \u0026lt;dbl\u0026gt; 15101, 15101, 15101, 15101, 15101, 15101, 15101, 15101‚Ä¶ $ nombre_comuna \u0026lt;chr\u0026gt; \u0026quot;Arica\u0026quot;, \u0026quot;Arica\u0026quot;, \u0026quot;Arica\u0026quot;, \u0026quot;Arica\u0026quot;, \u0026quot;Arica\u0026quot;, \u0026quot;Arica\u0026quot;, ‚Ä¶ $ codigo_region \u0026lt;dbl\u0026gt; 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15‚Ä¶ $ nombre_region \u0026lt;chr\u0026gt; \u0026quot;Arica y Parinacota\u0026quot;, \u0026quot;Arica y Parinacota\u0026quot;, \u0026quot;Arica y P‚Ä¶ $ a√±o \u0026lt;dbl\u0026gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, 2017, ‚Ä¶ $ poblacion_total \u0026lt;dbl\u0026gt; 232628, 232628, 232628, 232628, 232628, 232628, 232628‚Ä¶ $ orden_region \u0026lt;dbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶ Barras ordenado Realicemos una suma de los conteos agrupada por pueblo originario:\npueblos_n \u0026lt;- pueblos |\u0026gt; mutate(pueblo = ifelse(pueblo %in% c(\u0026#34;Mapuche\u0026#34;, \u0026#34;Aymara\u0026#34;, \u0026#34;Diaguita\u0026#34;), pueblo, \u0026#34;Otros\u0026#34;)) |\u0026gt; group_by(pueblo) |\u0026gt; summarize(total = sum(n)) pueblos_n # A tibble: 4 √ó 2 pueblo total \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Aymara 156754 2 Diaguita 88474 3 Mapuche 1745147 4 Otros 195417 Con esta informaci√≥n podemos generar un gr√°fico de barras:\npueblos_n |\u0026gt; ggplot() + aes(pueblo, total, fill = pueblo) + geom_col() + theme_minimal() + # paleta de colores scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) Si deseamos ordenar las barras de acuerdo a su valor, lo que tenemos que hacer es ordenar la variable del eje desde el que se originan las barras. En este caso, las barras salen desde el eje x de acuerdo al pueblo ind√≠gena. Entonces, la variable pueblo tendr√≠a que ser ordenada de acuerdo a la variable total. Para esto, necesitamos que la variable sea un factor, que son el tipo de variables categ√≥ricas en R que guardan informaci√≥n acerca de el orden de los niveles o categor√≠as de la variable.\nLa funci√≥n fct_reorder() del paquete {forcats} nos permite ordenar variables tipo caracter a partir de una segunda variable num√©rica:\ngrafico_pueblos_1 \u0026lt;- pueblos_n |\u0026gt; mutate(pueblo = forcats::fct_reorder(pueblo, total)) |\u0026gt; ggplot() + aes(pueblo, total, fill = pueblo) + geom_col() + theme_minimal() + # paleta de colores scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;)+ # escala vertical scale_y_continuous(labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;)) grafico_pueblos_1 Tambi√©n agregamos una capa scale_y_continuous() para modificar la escala vertical del gr√°fico y as√≠ mostrar correctamente los n√∫meros grandes con un separador de miles, para mejorar la legibilidad de las cifras. Para lograrlo, usamos la funci√≥n label_comma() del conveniente paquete {scales}.\nTextos Para agregar texto a nuestros gr√°ficos debemos introducir la capa de geometr√≠a geom_text(). Esta geometr√≠a requiere de un mapeo espec√≠fico, label, que corresponde a la etiqueta de texto que se mostrar√°. En label debes poner la variable cuyo valor quieres que aparezca como texto:\ngrafico_pueblos_1 + geom_text(aes(label = total)) En primera instancia, se ve terrible. Esto es porque los textos est√°n apareciendo en la coordenada del eje vertical donde terminan las barras; es decir, justo encima del l√≠mite de las barras. Para mejorar esto, en la capa de geom_text() para especificar la justificaci√≥n vertical del texto en vjust, para que el texto no aparezca centrado en la coordenada y, sino que la coordenada y sea la altura de base del texto, y el argumento nudge_y para sumarle un valor espec√≠fico a la coordenada y del texto, cosa que aparezca levemente distanciado del borde de las barras:\ngrafico_pueblos_1 + geom_text(aes(label = format(total, big.mark = \u0026#34;.\u0026#34;)), vjust = 0, nudge_y = 15000) Cuando ponemos texto en un gr√°fico, usualmente tenemos que hacer algunos ajustes en consideraci√≥n de que algunos elementos del gr√°fico van a ser muy grandes o muy peque√±os, y por lo tanto el texto no siempre se va a ver bien. Para solucionar estos problemas podemos usar m√∫ltiples capas de texto en lugar de una sola, donde cada capa de texto dibuje los textos para algunos datos, con los ajustes necesarios para dichos casos.\nEn el ejemplo que estamos haciendo, vamos a graficar el texto en dos capas de geom_text(): una capa para las cifras que son mayores al promedio (barras grandes), y otra capa para las que son menores al promedio (barras peque√±as). De esta forma, podemos hacer que los n√∫meros sobre las Barras grandes aparezcan dentro de la barra y en color blanco, y los n√∫meros de las barras peque√±as aparezcan encima de las barras y en color negro:\ngrafico_pueblos_1 + # texto para barras chicas geom_text(data = ~filter(.x, total \u0026lt; mean(total)), aes(label = format(total, big.mark = \u0026#34;.\u0026#34;)), vjust = 0, nudge_y = 20000) + # texto para barras grandes geom_text(data = ~filter(.x, total \u0026gt;= mean(total)), aes(label = format(total, big.mark = \u0026#34;.\u0026#34;)), vjust = 1, nudge_y = -20000, color = \u0026#34;white\u0026#34;) Hicimos que cada capa dibuje textos distintos filtrando los datos que llegan a cada una de las capas en el argumento data de cada geometr√≠a. En los argumentos data usamos notaci√≥n lambda para filtrar los datos del gr√°fico (~filter(.x)) sin tener que especificar el conjunto de datos espec√≠fico. Pero si esto te parece complicado, tambi√©n se puede lograr el mismo efecto sin data usando ifelse(total \u0026gt; mean(total), total, \u0026quot;\u0026quot;) en label para que cada capa escriba el texto que cumple con la condici√≥n, e imprima nada si es que no la cumple.\nAnotaciones Muchas veces queremos agregar un texto o anotaci√≥n espec√≠fico en alguna ubicaci√≥n de nuestro gr√°fico. Para estos fines existe una capa ed geometr√≠a personalizada llamada annotate(), que a diferencia del resto de la geometr√≠a de {ggplot2}, no depende de la especificaci√≥n est√©tica (aes()), sino que sus par√°metros son completamente manuales. Entonces, podemos usar annotate() para crear un evento puntual en nuestra visualizaci√≥n, y sea escribiendo el texto y sus coordenadas a mano, o sac√°ndolas de un objeto. En este caso, filtraremos la tabla de datos que produce el gr√°fico para enfocarnos en una sola observaci√≥n, y usaremos las coordenadas de esta tabla resultante para crear una anotaci√≥n que a√±ada un texto en un lugar espec√≠fico del gr√°fico:\n# filtrar datos del gr√°fico cifra_pueblos \u0026lt;- pueblos_n |\u0026gt; filter(pueblo == \u0026#34;Aymara\u0026#34;) grafico_pueblos_1 + # agregar una geometr√≠a manual annotate(\u0026#34;text\u0026#34;, x = cifra_pueblos$pueblo, y = cifra_pueblos$total + 10000, # agregar separaci√≥n entre la barra y el texto label = \u0026#34;***\u0026#34;, size = 6, fontface = \u0026#34;bold\u0026#34;) Un segundo ejemplo:\npueblos_n |\u0026gt; mutate(pueblo = forcats::fct_reorder(pueblo, total)) |\u0026gt; ggplot() + aes(pueblo, total, fill = pueblo) + geom_col() + theme_minimal() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + scale_y_continuous(labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;)) + # geometr√≠a manual annotate(\u0026#34;text\u0026#34;, x = \u0026#34;Mapuche\u0026#34;, y = 1000000, label = \u0026#34;Mayor√≠a mapuche\u0026#34;, size = 5, angle = 90, color = \u0026#34;white\u0026#34;) Barras apiladas En un gr√°fico de barras apiladas, lo que hacemos es separar los datos por colores, y generar una sola barra que est√© compuesta por segmentos de colores del tama√±o que represente cada grupo. Este tipo de visualizaci√≥n puede ser himnos para mostrar la proporci√≥n que ocupa cada sus grupos dentro del total, dado que la informaci√≥n se presenta como un solo todo.\nPara lograr que la informaci√≥n est√© en una misma barra, simplemente tenemos que definir alguno de los dos ejes, horizontal o vertical, como un valor fijo, en este caso \u0026quot;grupo\u0026quot;:\ngrafico_pueblos_2 \u0026lt;- pueblos_n |\u0026gt; mutate(pueblo = forcats::fct_reorder(pueblo, total)) |\u0026gt; ggplot() + aes(total, \u0026#34;grupo\u0026#34;, fill = pueblo) + geom_col() + theme_minimal() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + scale_x_continuous(labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;)) + coord_cartesian(expand = FALSE) + guides(fill = guide_legend(position = \u0026#34;top\u0026#34;)) grafico_pueblos_2 Podemos realizar algunos ajustes al tema del gr√°fico para ocultar el truco que hicimos para que el gr√°fico tuviera una sola barra, y aprovechamos de ponerle texto a los valores de cada segmento. El texto lo agregamos con la funci√≥n geom_text(), pero explicitando que la posici√≥n de las etiquetas tiene que ser apilada, igual que nuestro gr√°fico, con position = position_stack(). El n√∫mero 0.5 dentro de position_stack() indica que queremos que las cifras aparezcan en medio de su correspondiente segmento, y no al final del mismo.\ngrafico_pueblos_2 + geom_text(aes(label = format(total, big.mark = \u0026#34;.\u0026#34;)), color = \u0026#34;white\u0026#34;, position = position_stack(0.5), angle = -90) + theme(axis.title.y = element_blank(), axis.text.y = element_blank()) Torta Muchas personas dedicadas a las estad√≠sticas o a la ciencia de datos han planteado (buenas) cr√≠ticas en contra de los gr√°ficos de torta. Para fines de este tutorial, ignoraremos un poco estas cr√≠ticas, debido a que, a pesar de ser inapropiados para muchas situaciones, siguen siendo gr√°ficos atractivos y muy solicitados en la pr√°ctica. Por lo tanto, aprenderemos de todas formas a realizarlos en {ggplot2}.\nEn {ggplot2}, un gr√°fico de torta no es un tipo de visualizaci√≥n completamente distinto a las que ya hemos visto, ya que, t√©cnicamente, un gr√°fico de torta no es m√°s que una visualizaci√≥n radial o circular de lo mismo que expresa un gr√°fico de barras. En otras palabras, un gr√°fico de torta es un gr√°fico de barras apilado, y luego enrollado desde una de sus esquinas.\nEn este sentido, todo gr√°fico de tortas empieza siendo un gr√°fico de barras apilado:\npueblos_n |\u0026gt; ggplot() + aes(1, total, fill = pueblo) + geom_col() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + theme_minimal() A especificar que el eje horizontal del gr√°fico sea tan s√≥lo el valor 1, mientras que las observaciones est√°n agrupadas por una variable asignada a la est√©tica color, estamos haciendo que todos los datos del gr√°fico aparezcan uno encima del otro, sin separarse horizontalmente como los ejemplos anteriores.\nUna vez que tenemos este gr√°fico de barras apilado, podemos agregar una capa coord_polar() para cambiar el sistema de coordenadas del gr√°fico, con el objetivo de que la escala vertical del gr√°fico deje de ser una l√≠nea vertical y se transforme en un c√≠rculo:\npueblos_n |\u0026gt; ggplot() + aes(1, total, fill = pueblo) + geom_col() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + theme_void() + # coordenadas circulares coord_polar(theta = \u0026#34;y\u0026#34;) # enrollar el gr√°fico para volverlo circular Si comparas este gr√°fico de torta con el gr√°fico anterior, notar√°s que el gr√°fico de torta es exactamente el gr√°fico de barras, pero en enrollado a partir de su esquina inferior derecha.\nPara agregar etiquetas de texto a nuestro gr√°fico de torta, el proceso es el mismo que para agregar a un gr√°fico de barras apiladas; es decir, necesitamos agregar una capa geom_text() que especifique que los textos tambi√©n deben apilarse con position = position_stack():\npueblos_n |\u0026gt; ggplot() + aes(1, total, fill = pueblo) + geom_col() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + theme_void() + coord_polar(theta = \u0026#34;y\u0026#34;) + # texto geom_text(aes(label = format(total, big.mark = \u0026#34;.\u0026#34;), x = 1.3), color = \u0026#34;white\u0026#34;, position = position_stack(0.5)) Una variaci√≥n del gr√°fico de torta es el gr√°fico de dona, que no es m√°s que un gr√°fico de torta con un espacio al medio. Para crear el espacio dentro de la torta, y recordando que los gr√°ficos de tortas son gr√°ficos de barras apiladas, necesitamos agregar espacio en el eje horizontal del gr√°fico de barras:\npueblos_n |\u0026gt; ggplot() + aes(1, total, fill = pueblo) + geom_col() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + # agregar espacio en el eje scale_x_continuous(expand = expansion(c(2, 0))) Logramos agregar un espacio en el eje horizontal del gr√°fico modificando la escala correspondiente (scale_x_continuous()), ajustando en ella al argumento expand que controla cu√°nto espaciado va a haber en cada borde de el eje correspondiente. Por defecto, {ggplot2} agrega un peque√±o espaciado en cada eje.\npueblos_n |\u0026gt; ggplot() + aes(1, total, fill = pueblo) + geom_col() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + # agregar espacio en el eje scale_x_continuous(expand = expansion(c(2, 0))) + # hacer en torta coord_polar(theta = \u0026#34;y\u0026#34;) + theme_void() + # texto geom_text(aes(label = format(total, big.mark = \u0026#34;.\u0026#34;), x = 1), color = \u0026#34;white\u0026#34;, size = 3, position = position_stack(0.5)) Si cambiamos coord_polar() por coord_radial() y ajustamos un poco la escala vertical y otros detalles, podemos hacer que los textos sigan en el √°ngulo de la torta:\npueblos_n |\u0026gt; ggplot() + aes(1, total, fill = pueblo) + geom_col() + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + # agregar espacio en el eje scale_x_continuous(expand = expansion(c(2, 0))) + scale_y_continuous(expand = expansion(c(0, 0))) + # hacer en torta coord_radial(theta = \u0026#34;y\u0026#34;, rotate.angle = TRUE) + theme_void() + # texto geom_text(aes(label = scales::comma(total, big.mark = \u0026#34;.\u0026#34;), x = 1.7), color = \u0026#34;black\u0026#34;, size = 3, position = position_stack(0.5)) Facetas Se le llama a facetas a la divisi√≥n de un mismo gr√°fico en m√∫ltiples gr√°ficos a partir de una variable determinada. Especificando una variable de agrupaci√≥n, entonces, podemos generar una visualizaci√≥n que contenga m√∫ltiples gr√°ficos del mismo tipo, pero visualizando datos filtrados por la variable seleccionada.\nPrimero calculemos un conjunto de datos agrupados por dos variables:\npueblos_n_sexo \u0026lt;- pueblos |\u0026gt; mutate(pueblo = ifelse(pueblo %in% c(\u0026#34;Mapuche\u0026#34;, \u0026#34;Aymara\u0026#34;, \u0026#34;Diaguita\u0026#34;), pueblo, \u0026#34;Otros\u0026#34;)) |\u0026gt; group_by(pueblo, sexo) |\u0026gt; summarize(total = sum(n)) |\u0026gt; group_by(pueblo) |\u0026gt; mutate(p = total/sum(total)) glimpse(pueblos_n_sexo) Rows: 8 Columns: 4 Groups: pueblo [4] $ pueblo \u0026lt;chr\u0026gt; \u0026quot;Aymara\u0026quot;, \u0026quot;Aymara\u0026quot;, \u0026quot;Diaguita\u0026quot;, \u0026quot;Diaguita\u0026quot;, \u0026quot;Mapuche\u0026quot;, \u0026quot;Mapuche‚Ä¶ $ sexo \u0026lt;chr\u0026gt; \u0026quot;Hombres\u0026quot;, \u0026quot;Mujeres\u0026quot;, \u0026quot;Hombres\u0026quot;, \u0026quot;Mujeres\u0026quot;, \u0026quot;Hombres\u0026quot;, \u0026quot;Mujeres‚Ä¶ $ total \u0026lt;dbl\u0026gt; 75785, 80969, 43360, 45114, 861241, 883906, 97725, 97692 $ p \u0026lt;dbl\u0026gt; 0.4834645, 0.5165355, 0.4900875, 0.5099125, 0.4935063, 0.506493‚Ä¶ Teniendo una variable extra en el conjunto de datos, podemos dividir el gr√°fico en m√°s de uno especificando una capa facet_wrap() con la variable de divisi√≥n:\npueblos_n_sexo |\u0026gt; ggplot() + aes(1, p, fill = sexo) + geom_col() + # agregar texto geom_text(aes(label = scales::percent(p, accuracy = 1)), color = \u0026#34;white\u0026#34;, position = position_stack(0.5), fontface = \u0026#34;bold\u0026#34;) + coord_polar(theta = \u0026#34;y\u0026#34;) + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + facet_wrap(~pueblo) + theme_void() Al crear una faceta por la variable pueblo, que tiene cuatro niveles, obtenemos cuatro gr√°ficos con el mismo c√≥digo que necesitamos para generar uno solo. ¬°Qu√© ofert√≥n!\nLa tercera parte de tutorial continuaremos con un √∫ltimo conjunto de datos. Se trata de una base con m√°s de 1 mill√≥n de filas que contiene la frecuencia de m√∫ltiples tipos de delitos, desagregados por el tipo de delito, ubicaci√≥n geogr√°fica, y a√±o. Puedes descargar los datos desde este repositorio que recopila las estad√≠sticas oficiales sobre delitos en Chile, o bien puedes ejecutar el siguiente c√≥digo para descargar los datos y cargarlo en tu entorno de R. Debido a la cantidad de observaciones, el archivo viene en formato parquet, un formato moderno de datos columnares optimizado para eficiencia y velocidad, para el cual necesitas instalar el paquete {arrow}.\n# install.packages(\u0026#34;arrow\u0026#34;) library(arrow) delinc \u0026lt;- arrow::read_parquet(\u0026#34;https://github.com/bastianolea/delincuencia_chile/raw/main/datos_procesados/cead_delincuencia_chile.parquet\u0026#34;) L√≠neas La gr√°ficos en l√≠nea se usan principalmente para mostrar el cambio o evoluci√≥n de una variable a trav√©s de otra, usualmente a trav√©s del tiempo. Usaremos geom_line() para visualizar la cantidad total de delitos mensuales desde el a√±o 2018.\ndelinc |\u0026gt; filter(delito == \u0026#34;Robos con violencia o intimidaci√≥n\u0026#34;) |\u0026gt; group_by(fecha) |\u0026gt; summarize(n = sum(delito_n)) |\u0026gt; ggplot() + aes(fecha, n) + geom_line(alpha = .4) + geom_point(size = 1) + theme_classic() Podemos agregar al mismo tiempo una capa de puntos sobre las l√≠neas para destacar la ubicaciones espec√≠fica de las observaciones.\nRecordemos que tambi√©n podemos usar cualquier variable para darle color a cualquier geometr√≠a; por ejemplo, crear una variable que indique si la observaci√≥n aumenta o disminuye con respecto al caso anterior, y pintar los puntos siguiendo estos cambios:\ndelinc |\u0026gt; filter(delito == \u0026#34;Robos con violencia o intimidaci√≥n\u0026#34;) |\u0026gt; group_by(fecha) |\u0026gt; summarize(n = sum(delito_n)) |\u0026gt; mutate(cambio = ifelse(n \u0026gt; lag(n), \u0026#34;aumento\u0026#34;, \u0026#34;disminuci√≥n\u0026#34;)) |\u0026gt; filter(!is.na(cambio)) |\u0026gt; ggplot() + aes(fecha, n) + geom_line(alpha = .4) + geom_point(aes(color = cambio), size = 2) + scale_color_manual(values = c(\u0026#34;aumento\u0026#34; = \u0026#34;indianred3\u0026#34;, \u0026#34;disminuci√≥n\u0026#34; = \u0026#34;darkolivegreen3\u0026#34;)) + guides(color = guide_legend(override.aes = list(size = 5))) + theme_classic() Calculemos una tabla de datos que sume las cantidades de tres delitos en espec√≠fico a trav√©s del tiempo:\ndelinc_filt \u0026lt;- delinc |\u0026gt; filter(delito %in% c(\u0026#34;Robos con violencia o intimidaci√≥n\u0026#34;, \u0026#34;Robo en lugar habitado\u0026#34;, \u0026#34;Robo por sorpresa\u0026#34;)) |\u0026gt; group_by(delito, fecha) |\u0026gt; summarize(n = sum(delito_n)) Ahora que los datos est√°n agrupados por la variable delito, podemos usarla para dar color a nuestras l√≠neas. Esto tiene como resultado que las l√≠neas se separen para seguir la trayectoria de cada uno de los valores de los niveles de la variable que usamos para el color:\ndelinc_filt |\u0026gt; ggplot() + aes(fecha, n, color = delito) + geom_line(linewidth = 0.8) + theme_classic() + scale_color_brewer(palette = \u0026#34;Accent\u0026#34;) + scale_x_date(expand = expansion(0)) Algunas geometr√≠as en {ggplot2} son capaces de realizar c√°lculos estad√≠sticos por nosotros a la hora de visualizar. Uno de los m√°s comunes para explorar tendencias en los datos es agregar l√≠neas de regresi√≥n lineal sobre los datos. Agregando una capa de la geometr√≠a geom_smooth(), se calcular√°n tres l√≠neas de regresi√≥n para cada uno de los grupos que estamos visualizando, debido a que en este caso estamos agrupando nuestra visualizaci√≥n por color.\ndelinc_filt |\u0026gt; ggplot() + aes(fecha, n, color = delito) + geom_line(linewidth = 0.8) + geom_smooth(method = \u0026#34;lm\u0026#34;, se = F, linetype = \u0026#34;dashed\u0026#34;) + theme_classic() + scale_color_brewer(palette = \u0026#34;Accent\u0026#34;) + scale_x_date(expand = expansion(0)) Estas l√≠neas de regresi√≥n representan trayectorias ajustadas a la posici√≥n de todas las observaciones de cada grupo, entreg√°ndonos informaci√≥n visual acerca de si los datos representan en general una tendencia a la alza o a la baja.\nOtra forma de complementar la informaci√≥n en nuestros gr√°ficos es agregar l√≠neas que marquen puntos importantes en una de las escalas. Esto suele ser √∫til cuando estamos presentando informaci√≥n graficada en torno al tiempo, para marcar por ejemplo alguna fecha clave. En este caso, marcaremos una barra vertical con respecto a la escala del tiempo que indique el inicio del √∫ltimo gobierno, usando geom_vline() (v por vertical). Adem√°s, usaremos annotate() para crear una etiqueta que indique a qu√© corresponde la barra que agregamos:\ndelinc_filt |\u0026gt; ggplot() + aes(fecha, n, color = delito) + geom_line(linewidth = 0.8) + geom_vline(xintercept = as_date(\u0026#34;2022-03-11\u0026#34;), linewidth = 1.3, color = \u0026#34;deeppink3\u0026#34;, alpha = 0.5) + annotate(geom = \u0026#34;label\u0026#34;, label = \u0026#34;Gabriel Boric\u0026#34;, x = as_date(\u0026#34;2022-03-11\u0026#34;) + 40, y = 7000, hjust = 0, fill = \u0026#34;deeppink3\u0026#34;, color = \u0026#34;white\u0026#34;, alpha = 0.6, size = 3.5) + theme_classic() + scale_color_brewer(palette = \u0026#34;Accent\u0026#34;) + scale_x_date(expand = expansion(0)) Barras comparativas Los gr√°ficos de barras nos permiten comparar valores de forma muy clara. Pero a veces tambi√©n queremos comparar valores dentro de los valores que est√°bamos comparando. Calcularemos la cantidad de tres delitos distintos a trav√©s de 10 comunas, para generar un gr√°fico que nos permita comparar tanto los delitos entre las comunas como las cantidades de los delitos distintos dentro de cada una de estas comunas.\n# obtener top 10 comunas segun cantidad de delitos comunas_delinc \u0026lt;- delinc |\u0026gt; filter(region == \u0026#34;Metropolitana de Santiago\u0026#34;) |\u0026gt; group_by(comuna) |\u0026gt; summarize(total = sum(delito_n)) |\u0026gt; # sumar delitos por comuna slice_max(total, n = 10) |\u0026gt; # filtrar 10 con mayor cantidad pull(comuna) # extraer comunas # calcular delitos por comunas delinc_comuna \u0026lt;- delinc |\u0026gt; # seleccionar delitos a incluir filter(delito %in% c(\u0026#34;Robos con violencia o intimidaci√≥n\u0026#34;, \u0026#34;Robo en lugar habitado\u0026#34;, \u0026#34;Robo por sorpresa\u0026#34;)) |\u0026gt; filter(lubridate::year(fecha) == 2023) |\u0026gt; filter(region == \u0026#34;Metropolitana de Santiago\u0026#34;, comuna %in% comunas_delinc) |\u0026gt; group_by(comuna, delito) |\u0026gt; summarize(n = sum(delito_n)) |\u0026gt; ungroup() |\u0026gt; arrange(desc(n)) Creamos un gr√°fico de barras, que en el eje horizontal tenga los valores y en el vertical tenga las comunas, y usamos las categor√≠as de delitos como el relleno de color:\ndelinc_comuna |\u0026gt; # reordenar las barras por frecuencia mutate(comuna = forcats::fct_reorder(comuna, n)) |\u0026gt; ggplot() + aes(n, comuna, fill = delito) + # especificar color # barras geom_col(width = 0.5) + # texto geom_text(aes(label = ifelse(n \u0026gt; 350, n, \u0026#34;\u0026#34;)), position = position_stack(vjust = 0.5), size = 2.5) + # escalas scale_x_continuous(name = \u0026#34;Delitos\u0026#34;, labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;), expand = expansion(c(0, 0.1))) + scale_y_discrete(name = \u0026#34;Regiones\u0026#34;, labels = scales::label_wrap(30)) + theme_classic() + # paleta de colores scale_fill_brewer(palette = \u0026#34;Accent\u0026#34;) + # modificar leyenda guides(fill = guide_legend(position = \u0026#34;bottom\u0026#34;, # leyenda abajo nrow = 1)) + # en dos columnas labs(subtitle = \u0026#34;Total de delitos denunciados en el a√±o 2023, por comunas\u0026#34;, caption = \u0026#34;Fuente: Centro de Estudios y An√°lisis del Delito\u0026#34;) Sin embargo, en este gr√°fico toma preponderancia la cantidad total de delitos en ciertas comunas, dado que resultan muy mayores que en otras. Tenemos una alternativa para realizar esta visualizaci√≥n, que es poner los segmentos de las barras de cada variable del eje vertical lado al lado en vez de apilarlas. Para ello, podemos definir que los segmentos de color de cada barra se ubiquen en la posici√≥n position_dodge() en lugar de position_stack() (la anterior):\ngrafico_delincuencia_1 \u0026lt;- delinc_comuna |\u0026gt; ggplot() + aes(n, comuna, fill = delito) + # relleno geom_col(width = 0.8, position = position_dodge(), # especificar que las categor√≠as aparezcan lado a lado color = \u0026#34;white\u0026#34;, linewidth = 0.5) + geom_text(aes(label = paste(\u0026#34; \u0026#34;, n)), # espaciar texto position = position_dodge(width = 0.8), size = 2.3, hjust = 0) + theme_classic() + scale_x_continuous(name = \u0026#34;Delitos\u0026#34;, labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;), expand = expansion(c(0, 0.1))) + scale_fill_brewer(palette = \u0026#34;Accent\u0026#34;, name = \u0026#34;Delitos\u0026#34;, labels = scales::label_wrap(20)) + guides(fill = guide_legend(position = \u0026#34;right\u0026#34;, ncol = 1)) + theme(panel.grid.major.x = element_line()) + labs(subtitle = \u0026#34;Total de delitos denunciados en el a√±o 2023, por comunas\u0026#34;, caption = \u0026#34;Fuente: Centro de Estudios y An√°lisis del Delito\u0026#34;) grafico_delincuencia_1 Con este posicionamiento de las barras obtenemos un gr√°fico que nos permite comparar cada uno de los subgrupos de cada variable del eje vertical entre s√≠, dado que ahora los segmentos de colores, en este caso los tipos de delitos, se ubican lateralmente uno con el otro, facilitando la comparaci√≥n visual.\nTemas Para cambiar el tema de un gr√°fico, contamos con temas predefinidos en funciones que empiezan con theme_, como theme_minimal() para un tema de fondo blanco con l√≠neas grises, o theme_classic() para uno con bordes negros.\ngrafico \u0026lt;- iris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width, size = Petal.Length) + geom_point(alpha = 0.5) grafico + theme_minimal() grafico + theme_classic() Si queremos modificar elementos espec√≠ficos de la visualizaci√≥n, usamos la capa theme(). Dentro de esta funci√≥n, podemos individualizar cualquier elemento de la visualizaci√≥n. Para saber c√≥mo se llama cada elemento, puedes empezar escribiendo su ubicaci√≥n general (plot, panel, axis, legend, etc.) y RStudio/Positron deber√≠a sugerirte las distintas posibilidades, o bien puedes entrar a esta gu√≠a para encontrar los nombres de cada uno de los elementos.\nEn este caso, definiremos la tipograf√≠a general del gr√°fico al incluirla en el llamado a theme_classic(), y dentro de la especificaci√≥n del tema (theme()) modificaremos la apariencia del subt√≠tulo, de las l√≠neas en el panel del gr√°fico correspondientes al eje horizontal, eliminaremos el t√≠tulo del eje vertical y las rayitas de los ejes, y especificaremos el tipo de letra del texto del eje vertical.\ngrafico_delincuencia_2 \u0026lt;- grafico_delincuencia_1 + theme_classic(base_family = \u0026#34;Verdana\u0026#34;) + theme(plot.subtitle = element_text(face = \u0026#34;italic\u0026#34;, size = 12), panel.grid.major.x = element_line(), axis.title.y = element_blank(), axis.ticks = element_blank(), axis.text.y = element_text(colour = \u0026#34;black\u0026#34;, face = \u0026#34;bold\u0026#34;, size = 11, lineheight = 0.8)) grafico_delincuencia_2 Tambi√©n podemos cambiar el tema de todos los gr√°ficos que hagamos en la sesi√≥n (hasta que reiniciemos R o cambiemos el tema) ejecutando la funci√≥n theme_set() con el tema (como theme_minimal() o theme() que queramos aplicar dentro.\nTipograf√≠as Existen muchos m√©todos distintos para usar tipograf√≠as personalizadas en nuestros gr√°ficos de {ggplot2}. Debido a que obtener, instalar y activar tipograf√≠as suele ser algo complejo, una soluci√≥n sencilla y compatible es utilizar tipograf√≠a web, como las ofrecidas por Google Fonts. puedes navegar a ese sitio y encontrar una tipograf√≠a que te interese, y descargarla por medio del paquete {showtext}:\n# install.packages(\u0026#34;showtext\u0026#34;) library(showtext) font_add_google(name = \u0026#34;Montserrat\u0026#34;) Luego, tienes que usar la funci√≥n showtext_auto() para activar el uso de las tipograf√≠as descargadas en tu sesi√≥n de R, y posiblemente tengas que ajustar la resoluci√≥n de las tipograf√≠as para que se vean bien en la pantalla.\nshowtext_auto() showtext_opts(dpi = 200) # resoluci√≥n para que se vean bien las tipograf√≠as Habiendo hecho lo anterior, basta con referirse al nombre de la tipograf√≠a, ya sea al especificar el tema de nuestro gr√°fico, o en cualquier geometr√≠a que utilice texto como geom_text().\ngrafico_delincuencia_2 + theme_classic(base_family = \u0026#34;Montserrat\u0026#34;) Vale mencionar que el tipo graf√≠as descargadas por este m√©todo solamente estar√°n disponibles durante la sesi√≥n de R, por lo que la pr√≥xima vez que quieras usarlas deber√°n ser descargadas de la misma manera. Si tienes alg√∫n problema con esas tipograf√≠as, basta con reiniciar la sesi√≥n de R para dejar de utilizarlas.\nGuardar gr√°ficos El √∫ltimo paso para nuestra visualizaci√≥n es, probablemente, guardarla a nuestro equipo para poder insertarla en alg√∫n documento u ocuparla. Para ello, la funci√≥n ggsave() guardar√° a tu computadora el √∫ltimo gr√°fico que hayas generado. Solamente debes especificar el nombre del archivo resultante, con su extensi√≥n (jpg, png, pdf, etc.).\nggsave(\u0026#34;grafico.jpg\u0026#34;, width = 7, height = 5) La extensi√≥n del archivo definir√° el formato del archivo resultante. Si no especifica una ruta para archivo, lo m√°s probable es que tu archivo aparezca en tu proyecto de R (si no est√°s usando proyectos de R (deber√≠as) Lo m√°s probable es que no encuentres la imagen porque aparecer√° en la ra√≠z de tu disco).\nSi no espec√≠ficas un ancho y alto, el gr√°fico tendr√° el ancho y alto de la ventana de previsualizaci√≥n de RStudio. Si deseas ajustar el tama√±o de los elementos de tu gr√°fico, puedes usar el argumento scale, que es un n√∫mero que mientras m√°s grande har√° que los elementos sean m√°s peque√±os.\nCon esto concluye este tutorial inicial para aprender a visualizar datos en R con {ggplot2}. C√≥mo puedes ver, las nociones principales de {ggplot2} son simples, pero es la combinaci√≥n entre ellas y su uso creativo lo que nos permite crear visualizaciones interesantes! Revisa otras publicaciones sobre visualizaci√≥n de datos para seguir avanzando üöÄ\nSi aprendiste con este tutorial, considera hacerme una peque√±a donaci√≥n en el siguiente enlace:\nPara cerrar, dejo algunos enlaces √∫tiles para ayudarte a usar {ggplot2}:\nOtros tutoriales\nA ggplot2 Tutorial for Beautiful Plotting in R Paletas de colores\nTutorial sobre el uso de paletas de colores: https://datavizf24.classes.andrewheiss.com/resource/colors.html Gu√≠a sobre herramientas para usar color en R: https://bastianolea.rbind.io/blog/colores/ Gu√≠a para el uso de paletas de colores Viridis: https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html#the-color-scales Sitio web con paletas de colores ColorBrewer: https://colorbrewer2.org/#type=sequential\u0026scheme=YlGnBu\u0026n=3 Paletas de colores Scico: https://www.data-imaginist.com/posts/2018-05-30-scico-and-the-colour-conundrum/ Temas\nSobre los temas de {ggplot2}: https://ggplot2.tidyverse.org/reference/ggtheme.html Paquete {ggthemes} con temas extra: https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/ Elementos de los gr√°ficos (para modificar temas):\nhttps://isabella-b.com/blog/ggplot2-theme-elements-reference/ https://henrywang.nl/ggplot2-theme-elements-demonstration/ https://ggplot2.tidyverse.org/reference/theme con mapeo nos referimos al acto de definir una correspondencia entre el comportamiento de una variable y el resultado de alg√∫n elemento de nuestro gr√°fico, el cual pasar√° a asumir caracter√≠sticas de la variable que se le mapea.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-03-21T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/tutorial_visualizacion_ggplot/","tags":"visualizaci√≥n de datos ; gr√°ficos ; ggplot2","title":"Tutorial: visualizaci√≥n de datos con {ggplot2}"},{"content":"Shiny es un paquete de R que permite crear aplicaciones web interactivas usando s√≥lo c√≥digo de R. Es muy f√°cil de aprender, puedes crear cosas interesantes en muy poco tiempo, y tiene la capacidad de crear complejas y atractivas aplicaciones.\nEn este tutorial introductorio aprender√°s c√≥mo crear una app Shiny b√°sica, que incluya texto, interacci√≥n para el usuario, y un resultado a partir de la interacci√≥n.\n¬øPor qu√© usar Shiny? Control del stack completo de la aplicaci√≥n desde un mismo lenguaje: S√≥lo necesitas aprender un lenguaje para poder hacer una aplicaci√≥n completa: desde el procesamiento de los datos a la apariencia visual de tu aplicaci√≥n, pasando por la interactividad, los gr√°ficos y m√°s. Reutilizaci√≥n del c√≥digo de R: Como todo est√° programado con R, puedes usar el c√≥dido que usas en otros proyectos o scripts para hacer tus gr√°ficos, c√°lculos, estad√≠sticos y tablas en tu aplicaci√≥n Shiny. Reducido tiempo de desarrollo para usuarios que no tienen un trasfondo de inform√°tica Flexibilidad a la hora de publicar la aplicaci√≥n en un servicio o servidor Ecosistema de paquetes de R que se integra perfectamente en el desarrollo de Shiny Elementos de una app Shiny Para entender c√≥mo funciona una aplicaci√≥n Shiny, debemos saber que una app se crea en un script usualmente llamado app.R, el cual se subdivide en dos partes principales: ui y server.\nUI: interfaz gr√°fica e interacci√≥n Interfaz de la aplicaci√≥n Disposici√≥n de los elementos en la app: botones, texto, t√≠tulos Creaci√≥n de los inputs de la app (botones, sliders, etc.) Establecimiento temas y de estilos CSS Disposici√≥n de los outputs de una app: gr√°ficos, tablas, y otros elementos que se renderizan desde R Server: c√°lculos y salidas Aspectos computacionales de la aplicaci√≥n Definici√≥n de objetos reactivos, que se re-eval√∫an al cambiar un input u otro reactivo Observadores que realizan c√≥mputos en base a inputs u otros reactivos Renderizaci√≥n de gr√°ficos y tablas, y salida de los mismos como outputs Entendiendo √©sto, podemos crear nuestra propia aplicaci√≥n.\nCreando una aplicaci√≥n Shiny m√≠nima Crea un nuevo proyecto Primero, como en cualquier otra instancia de desarrollo con R, debes crear un nuevo proyecto, dentro del cual tengas todos los scripts y datos que se vayan a utilizar en tu aplicaci√≥n.\nEn el men√∫ File, elige New Project y crea un proyecto en una nueva carpeta, con el t√≠tulo de tu aplicaci√≥n.\nCrear el script En RStudio, crea un nuevo script titulado app.R. Lo primero que vamos a poner en este script vac√≠o, va a ser la carga del paquete {shiny} y del paquete {bslib} (que nos ayuda a construir aplicaciones m√°s atractivas).\nlibrary(shiny) library(bslib) Interfaz b√°sica El segundo paso ser√° crear una interfaz visual para nuestra aplicaci√≥n que est√© vac√≠a.\nEn esta interfaz es donde pondremos los t√≠tulos, textos, y botones de nuestra aplicaci√≥n, y tambi√©n donde posicionaremos las salidas o outputs de nuestra aplicaci√≥n, tales como gr√°ficos, tablas, y m√°s.\nPara empezar, la ui de nuestra app se crea con una funci√≥n que empiece con page_, como page_fluid():\nui \u0026lt;- page_fluid() Esa ser√≠a una aplicaci√≥n vac√≠a, sin nada en ella. Podemos agregar los primeros contenidos usado nuestras primeras funciones para crear textos:\nh1(): un t√≠tulo h2(): un subt√≠tulo p(): un p√°rrafo de texto normal ui \u0026lt;- page_fluid( h1(\u0026#34;T√≠tulo\u0026#34;), h2(\u0026#34;Introducci√≥n\u0026#34;), p(\u0026#34;Bienvenidx a mi primera app\u0026#34;) ) Server provisorio Para poder previsualizar nuestra aplicaci√≥n, tenemos que tener una ui y un server, as√≠ que crearemos un server b√°sico, que no haga nada por ahora.\nserver es una funci√≥n de R que contiene los argumentos input, output y session. Ser√°n importantes m√°s adelante, pero por ahora, solamente definimos esta funci√≥n en nuestro script y la dejamos ah√≠.\nserver \u0026lt;- function(input, output, session) { } Ejecutar aplicaci√≥n El √∫ltimo paso ser√° unir ambos aspectos de nuestra aplicaci√≥n, para poder ejecutarla. Esto se hace al final del script:\nshinyApp(ui, server) Al incluir esta l√≠nea en nuestro script, RStudio detectar√° que se trata de una aplicaci√≥n, y ofrecer√° un nuevo bot√≥n en la parte superior derecha del panel de scripts: el bot√≥n para ejecutar la app (Run App).\nPero antes, revisemos la totalidad de nuestro (breve) script hasta el momento:\nlibrary(shiny) library(bslib) ui \u0026lt;- page_fluid( h1(\u0026#34;T√≠tulo\u0026#34;), h2(\u0026#34;Introducci√≥n\u0026#34;), p(\u0026#34;Bienvenidx a mi primera app\u0026#34;) ) server \u0026lt;- function(input, output, session) { } shinyApp(ui, server) Tenemos un script que carga los paquetes que usamos, crea una interfaz (ui), define un servidor (server), y une ambos al final para poder ejecutarla. Presiona el bot√≥n Run App y tu aplicaci√≥n Shiny deber√≠a abrirse en una nueva ventana y mostrarse. ¬°Lo logramos!\nCrear una aplicaci√≥n Shiny b√°sica A continuaci√≥n aprenderemos a agregar los primeros inputs y outputs a nuestra aplicaci√≥n.\nInputs Los inputs son todos los elementos visuales e interactivos que podemos poner en una aplicaci√≥n, y que permiten que un usuario o usuario interact√∫e con nuestra aplicaci√≥n, y a su vez, con el c√≥digo que la compone.\nPueden ser elementos tales como selectores, botones, sliders, y otros. Shiny ofrece una amplia variedad de inputs a nuestra disposici√≥n, pero tambi√©n hay otros paquetes de R que nos entregan m√°s inputs.\nPara agregar un input a tu aplicaci√≥n, debes definirlo en la secci√≥n ui de la app:\nui \u0026lt;- page_fluid( h1(\u0026#34;T√≠tulo\u0026#34;), h2(\u0026#34;Introducci√≥n\u0026#34;), p(\u0026#34;Bienvenidx a mi primera app\u0026#34;), # agregar un input textInput(\u0026#34;nombre\u0026#34;, label = \u0026#34;Escribe tu nombre\u0026#34;) ) Aqu√≠ agregamos un textInput(), un input que permite al usuario o usuaria escribir el texto que desee.\nLos inputs tienen siempre como primer argumento su nombre interno. Este nombre interno debe ser √∫nico, y es el que se usar√° m√°s adelante en server para referirnos al contenido de la selecci√≥n del usuario/a.\nComo segundo argumento, usualmente hay que poner la etiqueta del input, que es el texto que el usuario ver√° inmediatamente antes del input, que le entrega instrucciones sobre qu√© debe o puede hacer con √©l.\nLuego de agregar el input al ui de tu app, puedes volver a ejecutarla para ver c√≥mo va quedando.\nServer Por ahora, el input que creamos no hace nada. Para hacer que haga algo, hay que usarlo en server.\nCrearemos un objeto dentro del server que recibir√° el contenido del input. que acabamos de crear. Pero este objeto ser√° un objeto especial, porque es creado con la funci√≥n reactive(), que crea un objeto reactivo.\nReactividad Los objetos reactivos son la pieza fundamental de Shiny: son objetos de R que tienen una caracter√≠stica especial: cuando cambia uno de los elementos que se usan dentro del objeto, o que se usan para construir el objeto, el objeto reactivo se actualiza.\nEn otras palabras, es como si crearas un objeto de R que se va a actualizar autom√°ticamente si es que uno de los elementos que se usan para calcular el objeto cambian en su valor.\nPor ejemplo:\nnumero_a = 4 numero_b = 8 resultado = numero_a + numero_b En este ejemplo, se usan dos objetos para calcular un tercer objeto, resultado. En una sesi√≥n normal de R, si cambiamos el valor de numero_a, tenemos que volver a ejecutar, manualmente, numero_a y resultado = numero_a + numero_b para poder obtener el nuevo valor de resultado.\nPero en Shiny, este tipo de actualizaciones de los valores ocurren autom√°ticamente, siempre y cuando se realicen rentro de la funci√≥n reactive(). As√≠, cuando el usuario cambie numero_a o numero_b, el valor de resultado se actualizar√° autom√°ticamente.\nDe esta forma, los c√°lculos que hagamos en Shiny se van a actualizar siempre que el usuario o usuario haga cambios en los inputs que afectan al objeto.\nDefinamos nuestro primero objeto reactivo dentro de server:\nserver \u0026lt;- function(input, output, session) { # crear un objeto reactivo texto \u0026lt;- reactive({ # aqu√≠ ir√° el c√°lculo }) } Ahora, dentro del reactive(), pondremos una operaci√≥n b√°sica de R que haga uso del input que hab√≠amos creado:\nDentro de un reactive(), podemos hacer cualquier operaci√≥n o secuencia de operaciones con R que queramos, usando los paquetes de R que necesitemos. Para mantener este tutorial sencillo, usaremos la funci√≥n paste(), que une dos o mas piezas de texto, separadas por un espacio.\n# crear un objeto reactivo texto \u0026lt;- reactive({ paste(\u0026#34;Hola\u0026#34;, input$nombre) # pegar el contenido del input con otro texto }) De este modo, cuando el input cambie, se recalcular√° el objeto reactivo texto, y se actualizar√° su resultado para reflejar el cambio en el input.\nPero a√∫n falta un paso para poder ver el resultado! üò±\nOutputs Para poder ver el resultado, tenemos que crear una salida o output. Los outputs toman el resultado de los c√°lculos realizados en server, y se los hacen llegar a la parte visual de nuestra aplicaci√≥n, la ui.\nCreamos un output que grafique o renderice el c√°lculo en un resultado visible:\noutput$texto \u0026lt;- renderText({ texto() }) Lo que har√° este bloque es tomar el objeto reactivo texto() (que al ser reactivo debe llamarse como si fuera una funci√≥n, con () al final), renderizarlo como texto (con rendertext()), y asignarlo a una salida llamada \u0026quot;texto\u0026quot; (output$texto).\nConfirmemos c√≥mo va quedando nuestra secci√≥n server en su totalidad:\nserver \u0026lt;- function(input, output, session) { # crear un objeto reactivo texto \u0026lt;- reactive({ paste(\u0026#34;Hola\u0026#34;, input$nombre) # pegar el contenido del input con otro texto }) # output del objeto reactivo output$texto \u0026lt;- renderText({ texto() }) } Conectar server con ui El √∫ltimo paso es poner en alg√∫n lugar de nuestra ui el output que acabamos de crear. Simplemente agregamos textOutput(\u0026quot;texto\u0026quot;) en el lugar de nuestra ui que elijamos:\nui \u0026lt;- page_fluid( h1(\u0026#34;T√≠tulo\u0026#34;), h2(\u0026#34;Introducci√≥n\u0026#34;), p(\u0026#34;Bienvenidx a mi primera app\u0026#34;), textInput(\u0026#34;nombre\u0026#34;, label = \u0026#34;Escribe tu nombre\u0026#34;), hr(), # salida desde server textOutput(\u0026#34;texto\u0026#34;) ) Adem√°s, entre el input y el output pusimos una l√≠nea separadora con hr(). Si ahora ejecutas la aplicaci√≥n, podr√°s ver que el texto de abajo refleja lo que escribas en el input de arriba.\nAhora que vimos lo b√°sico de una app Shiny, podemos complejizar el ejemplo agregando otro input:\nselectInput(\u0026#34;saludo\u0026#34;, label = \u0026#34;Elije un saludo\u0026#34;, choices = c(\u0026#34;Hola\u0026#34;, \u0026#34;Chao\u0026#34;, \u0026#34;Te odio\u0026#34; = \u0026#34;Hasta nunca,\u0026#34;)), Agregamos un selector que permite elegir entre varias opciones. Una de ellas tiene un nombre y un valor (\u0026quot;Te odio\u0026quot; = \u0026quot;Hasta nunca,\u0026quot;), porque el usuario ver√° el nombre en el selector (Te odio), pero internamente el input entregar√° el valor (\u0026quot;Hasta nunca,\u0026quot;).\nModificamos el objeto reactivo para que ahora use los dos inputs:\ntexto \u0026lt;- reactive({ # paste(\u0026#34;Hola\u0026#34;, input$nombre) # pegar el contenido del input con otro texto paste(input$saludo, input$nombre) # pegar los dos inputs }) Ejecutamos la app, y vemos que ahora tenemos dos inputs, los cuales se usan en un mismo objeto reactivo, el cual se actualiza cuando cualquiera de los dos inputs cambia.\n¬°Listo! ü•≥ Tienes una app Shiny b√°sica con inputs, reactividad y outputs. Puedes encontrar todo el c√≥digo de la aplicaci√≥n de este tutorial en este enlace.\nEl siguiente paso es compartirla con los dem√°s! Para eso, puedes seguir el tutorial publicar una app Shiny en shinyapps.io, y en unos minutos podr√°s subir tu aplicaci√≥n Shiny a internet, gratis.\nSi tienes cualquier consulta, necesitas apoyo con tu aplicaci√≥n Shiny, o deseas que te ayude a desarrollar un proyecto, no dudes en contactarme.\nRevisa mis clases para ver los cursos anteriores de Shiny que he impartido, los cuales contienen c√≥digo y ejemplos de aplicaciones.\n","date":"2024-11-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/tutorial_shiny_1/","tags":"shiny","title":"Tutorial: introducci√≥n al desarrollo de apps con Shiny"},{"content":"¬øDesarrollaste una aplicaci√≥n con Shiny, y quieres compartirla con el mundo? shinyapps.io es, en mi experiencia, el servicio m√°s sencillo de usar para poder hacer p√∫blicas tus aplicaciones Shiny.\nEl primer paso es, l√≥gicamente, tener una app Shiny funcionando. Para asegurarte que tu app funcione sin problemas, ac√° van soluciones a los errores m√°s frecuentes de las apps Shiny:\nAseg√∫rate de que tus scripts (app.R, o bien, ui.R y server.R) est√©n todos dentro de una misma carpeta Confirma que los datos que cargue tu app est√©n en la misma carpeta que tu script, o bien, entro de carpetas que est√©n al mismo nivel que tus scripts. En otras palabras, si tu app carga datos, las rutas deber√≠an/ser/as√≠.csv o as√≠.rds, y no ~/users/tu/documents/cosas/app/datos.xlsx ni tampoco C:\\Users\\Desktop\\app\\datos\\data.csv. Reinicia tu sesi√≥n de R (Session \u0026gt; Restart R) y confirma que tu aplicaci√≥n funciona correctamente. As√≠ confirmas que tu app carga todos los paquetes necesarios, y que no depende de algo que estaba en tu entorno de R pero que no era reproducible desde su c√≥digo. Luego, debes crearte una cuenta en shinyapps.io. Las cuentas gratuitas permiten tener hasta 5 aplicaciones, con 25 horas de uso mensual (en total, entre todos tus usuarios). √âsto es m√°s que suficiente para apps de pruebas y con pocos usuarios, considerando que al superar el l√≠mite de horas no te interrumpen imnediatamente el acceso a tu aplicaci√≥n. El plan inicial (13USD) permite 25 aplicaciones y 1000 horas de uso mensual.\nDespu√©s, en tu sesi√≥n de R, debes instalar el paquete {rsconnect}, que permite la conexi√≥n entre R y el servicio:\ninstall.packages(\u0026#39;rsconnect\u0026#39;) Conectar tu cuenta a RStudio Una vez que tengas tu cuenta y R preparado, debes autorizar tu cuenta de shinyapps.io en RStudio, para que tu cuenta quede guardada en RStudio y as√≠ puedas subir cosas. Para ello, ShinyApps te entrega un c√≥digo secreto asociado a tu cuenta, el cual debes registrar en tu sesi√≥n de R.\nAl crear tu cuenta, el sitio te explica √©sto, y te entrega un bloque de c√≥digo similar al que pongo a continuaci√≥n. Al ejecutar ese c√≥digo en tu sesi√≥n de R, registra tu cuenta de shinyapps.io con tu computadora.\nrsconnect::setAccountInfo(name=‚Äòcuenta‚Äô, token=‚Äò\u0026lt;TOKEN\u0026gt;, secret=\u0026#39;\u0026lt;SECRET\u0026gt;\u0026#39;) Si ya tienes tu cuenta, pero necesitas conectarla con RStudio, en el men√∫ superior del sitio puedes entrar a Tokens y crear una nueva llave.\nAh√≠ creas una nueva llave, y puedes realizar el proceso de enlazamiento de tu cuenta con RStudio desde RStudio: en el bot√≥n azul publicar en la esquina superior derecha de tu panel de scripts de RStudio, y presiona Manage Accounts, o bien, abre las opciones globales de RStudio (men√∫ Tools \u0026gt; Global Options) y entra al panel Publishing.\nDentro del men√∫ que se abre, elige el bot√≥n Connect para agregar una cuenta nueva, y pegas el bloque de c√≥digo con tu token y secret.\nPublicar una aplicaci√≥n Una vez realizados los pasos anteriores podr√°s subir tus aplicaciones. Cuando abras un script de una app Shiny, ver√°s el bot√≥n azul de publicar al lado del bot√≥n Run App. En este bot√≥n eliges Publish Application para empezar el proceso de subir tu aplicaci√≥n local a shinyapps.io.\nEn la ventana que se abre, debes seleccionar los scripts y archivos que se requieren para que tu aplicaci√≥n funcione. Puedes des-seleccionar los que no sean cruciales para el funcionamiento de la app. Luego le das un nombre a tu splicaci√≥n (que ser√° parte del enlace que la gente usar√° para acceder a tu app, as√≠ que elige bien), y presionas Publish.\nSe abrir√° un panel nuevo en tu panel de consola, titulado Deploy, donde se indicar√° el avance de la construcci√≥n de tu aplicaci√≥n. Dependiendo de la cantidad de paquetes que uses, se demorar√° m√°s o menos en generar el entorno de tu aplicaci√≥n. Finalmente, el mismo panel te entregar√° el enlace a tu aplicaci√≥n, y si seleccionaste la opci√≥n en el paso anterior, tu app se abrir√° en tu navegador web. ¬°Listo! Tu app fue publicada en los servidores de shinyapps.io, y ya est√° lista para ser compartida.\nSoluci√≥n de problemas Si tu aplicaci√≥n remota (la versi√≥n que acabas de publicar) no se ejecuta, o arroja errores, puedes entrar a tu perfil en shinyapps.io, elegir la aplicaci√≥n, y revisar los registros (logs) de tu aplicaci√≥n para ver lo que dicen los errores. Usualmente puede ocurrir porque falt√≥ cargar un paquete, o una ruta estaba mal especificada.\nEn el panel de logs tambi√©n puedes ver los mensajes que tu aplicaci√≥n emite, lo que puede ayudarte a detectar problemas.\n","date":"2024-11-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/tutorial_shinyapps/","tags":"shiny","title":"Tutorial: publicar una app Shiny en shinyapps.io"},{"content":" Se denomina web scraping al conjunto de t√©cnicas que permiten extraer datos e informaci√≥n alojada en p√°ginas web, usualmente en formatos que no son f√°cilmente convertibles a tablas de datos.\nAl ser R un lenguaje enfocado completamente el an√°lisis de datos, es la plataforma ideal para este tipo de tareas, dado que puedes usar un s√≥lo lenguaje para controlar las herramientas de extracci√≥n de datos, programar la l√≥gica para automatizar la extracci√≥n, procesar y limpiar los datos, y finalmente analizar y presentar tus resultados.\nA continuaci√≥n, te presento tres formas distintas de extraer datos desde p√°ginas web con R. Cada una tiene sus ventajas y desventajas, y est√°n acompa√±adas de un tutorial en el que le explico desde cero a utilizarlas.\n{rvest} {rvest} es uno de los paquetes principales y m√°s usados para extraer datos desde internet. Como forma parte del Tidyverse, su sintaxis es muy intuitiva y coincide con el flujo de trabajo de la mayor√≠a de usuarios/as de R. Adem√°s de ser una forma sencilla de acercarse al web scraping, contiene funciones para interpretar el c√≥digo HTML obtenido, lo cual lo vuelve una herramienta vers√°til que tambi√©n sirve a la par de otras herramientas de web scraping.\nSirve para la mayor√≠a de los sitios web, pero presenta dificultades con sitios web din√°micos.\nTutorial de {rvest}\nSitio web oficial\n{RSelenium} Selenium es un software de automatizaci√≥n y testeo de sitios web bastante popular y muy usado. Por esta misma raz√≥n, puede ser una de las herramientas de web scraping para la que sea m√°s f√°cil encontrar recursos, consejos y asistencia online.\nSu fuerte est√° en la capacidad de controlar distintos navegadores, como Firefox y Chrome, incluso ayud√°ndote con la instalaci√≥n, u operando desde contendores Docker.\nTutorial de {RSelenium}\nSitio web oficial\n{chromote} Con este paquete se puede controlar una instancia sin interfaz gr√°fica de Google Chrome. Hoy en d√≠a, cuando este navegador ha monopolizado gran parte del internet, puede ser conveniente utilizarlo para la extracci√≥n de datos web. Tambi√©n te permite controlar el navegador de forma gr√°fica, y una de sus fortalezas es que es m√°s dif√≠cil de detectar como un web scraper por los sitios web.\nTutorial de {chromote}\nSitio web oficial\nEjemplos de web scraping con R Web scraping de datos electorales desde Servel (Chile), automatizando el control de varios botones y selectores, con {RSelenium} Web scraping de varios sitios del Banco Central usando {rvest}, automatizado de forma recurrente con GitHub Actions Web scraping de perfiles de GitHub con {rvest} para generar tablas de los repositorios Ejemplo de web scraping de noticias con {rvest} Ejemplo de web scraping de un sitio web de Transparencia Activa (Chile) con {RSelenium} Obtenci√≥n automatizada y masiva de datos de prensa con {rvest} y {chromote} para sitios que bloquean el acceso Extracci√≥n de una tabla de Wikipedia con {rvest} Ejemplo de extracci√≥n de una tabla del Banco Central con {rvest} ","date":"2025-07-17T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/web_scraping/","tags":"web scraping","title":"Web scraping con R"},{"content":" En este tutorial aprender√°s a empezar a usar Git con tus proyectos de R, mediante la creaci√≥n de repositorios. Git te permite llevar un registro de las versiones y un control de cambios en tu c√≥digo, mientras que GitHub te permite subir tus repositorios a un servicio online, en el cual puedes compartir tu c√≥digo con otras personas, descargar el c√≥digo de otros, y colaborar en un mismo proyecto.\nGit y GitHub Lo primero es entender bien el software y servicios que vamos a usar. Git es un software de c√≥digo abierto ampliamente usado, que instalas en tu computador para llevar un control de las versiones de tu c√≥digo local. Por otro lado, GitHub es una plataforma online donde las personas pueden subir sus repositorios de Git, permitiendo a otros acceder a su c√≥digo, y contribuir a los repositorios, entre muchas otras funcionalidades.\nEn este tutorial aprenderemos a realizar las tres tareas m√°s comunes del uso de Git/GitHub en R:\nClonar un repositorio remoto Crear un repositorio local Configurar R para conectarte a GitHub Subir un repositorio a GitHub Clonar un repositorio c√≥digo de R en GitHub Clonar significa descargar a tu computadora una copia id√©ntica de un repositorio de c√≥digo alojado en la web.\nSi alguna vez te encuentras con un proyecto de c√≥digo abierto interesante, participas de una clase de programaci√≥n que publica sus contenidos en un repositorio, o encuentras un proyecto de an√°lisis de datos que quieras probar o modificar, lo m√°s probable es que estos proyectos est√©n alojados como repositorios en GitHub.\nPor ejemplo, en mi perfil de GitHub tengo m√°s de 50 repositorios p√∫blicos de an√°lisis de datos con R que puedes clonar a tu computador.\nPara clonar un repositorio de GitHub a tu computador, y as√≠ tener todo el c√≥digo necesario para poder ejecutarlo y explorarlo, s√≥lo necesitas tener RStudio instalado.\nNavega al repositorio El primer paso es navegar al repositorio que te interesa, y encontrar el bot√≥n verde que dice Code, en el tendr√°s que copiar un enlace justo arriba del texto que dice clone using the web URL.\nCrea un proyecto de R a partir del repositorio Con el enlace al repositorio copiado, ve a RStudio y crea un nuevo proyecto. Dentro de las tres opciones que te presenta para crear un nuevo proyecto, elige la tercera, que es para crear un proyecto desde un repositorio de control de versiones:\nLuego elige la opci√≥n Git:\nFinalmente, pega el enlace del repositorio en el primer campo de texto, y ajusta el nombre que le dar√°s y la ubicaci√≥n donde quieres que se guarde.\nAl presionar Crear proyecto, RStudio descargar√° todo el c√≥digo y datos del repositorio y los incluir√° en el proyecto que creaste. Luego podr√°s ejecutar el c√≥digo y navegar en repositorio localmente en tu computador. Recuerda que la mayor√≠a de los repositorios contienen un archivo README.md, en el cual sus autores explican de qu√© se trata y usualmente incluyen instrucciones, y tambi√©n un archivo de licencias que especifica qu√© puedes hacer con el c√≥digo y que no puedes hacer con √©l, si es que planeas modificar el c√≥digo o usarlo para otros fines.\nCrear un repositorio local para tu proyecto de R Si est√°s trabajando en un proyecto de R, y quieres mantener una suerte de respaldo a medida que vas avanzando en el proyecto, debes usar Git para crear un repositorio local. De esta forma, mantendr√°s un control de versiones de tu proyecto, y as√≠ podr√°s navegar entre distintas versiones de tu proyecto, por ejemplo, si realizaste un cambio que provoc√≥ demasiados problemas y quieres volver a una versi√≥n anterior, si borraste algo y quieres recuperarlo, o simplemente si quieres llevar una documentaci√≥n de tu avance en tu proyecto a trav√©s del tiempo.\nInstalar Git El primer paso ser√≠a instalar Git en tu computador, aunque varios sistemas operativos ya lo tienen instalado.\nInstalar {usethis} Para muchas de las tareas que involucran usar Git en R, existe un paquete que nos facilita much√≠simo el trabajo. {usethis} es un paquete de R que automatiza muchas tareas repetitivas que se hacen al configurar tus proyectos.\nInstala {usethis} en R:\ninstall.packages(\u0026#34;usethis\u0026#34;) Crear repositorio Para crear un repositorio, y para cualquier otra oportunidad en la que trabajes con R, debes estar trabajando en un Proyecto de RStudio. Si no est√°s trabajando dentro de un Proyecto de RStudio, cr√©alo primero.\nEn tu consola de R, ejecuta usethis::use_git() para crear un repositorio local. La consola te preguntar√° si deseas commit los archivos actuales. Commit significa hacer una confirmaci√≥n de que quieres guardar el estado actual de tu c√≥digo como una versi√≥n de tu proyecto. En otras palabras, significa algo as√≠ como guardar todo el estado de tu proyecto en el momento actual. Cuando creamos por primera vez un repositorio, hacemos un primer commit de la situaci√≥n inicial del proyecto.\nHacer commits A medida que hagamos cambios en el repositorio, vamos a ir haciendo nuevos commits que vayan guardando nuestro progreso. Por ejemplo, si cargas un nuevo conjunto de datos, realizas la limpieza de estos datos en un nuevo script, y quedaste conforme con esta limpieza, ser√≠a conveniente crear un nuevo commit que guarde el estado de tu proyecto en este nuevo momento en el que avanzaste en tus tareas.\nPara hacer un nuevo commit, puedes volver a ejecutar usethis::use_git(), pero no es la forma m√°s ideal de hacerlo. Lo ideal ser√≠a, o bien usar le panel de Git de RStudio, que te permite usar Git de forma interactiva en tu sesi√≥n, o bien, usar Git desde la l√≠nea de comandos o Terminal de tu computador.\nHacer commit desde el panel de Git de RStudio En la parte superior de RStudio, presiona el icono de Git y elige la opci√≥n commit: Se abrir√° una nueva ventana donde aparecer√°n los archivos y datos nuevos en tu proyecto desde la √∫ltima vez que hiciste commit.\nPara todos los archivos nuevos que desees incluir en este guardado, debes seleccionar la casilla de cada uno para hacer el stage (considerarlos para el commit), y luego tienes que escribir un mensaje que describa cu√°l es tu nuevo cambio. Este mensaje servir√° para que t√∫ puedas identificar en el futuro qu√© cambios contiene este commit. Luego presiona el bot√≥n commit.\nHacer commit desde la terminal En la pesta√±a de Terminal de RStudio tambi√©n puedes interactuar con Git, de manera m√°s directa.\nEl comando git add . agrega a todos los nuevos archivos y archivos modificados a la fase de staging, que significa que son archivos considerados para el commit, y luego el comando git commit -m \u0026quot;mensaje\u0026quot; te permite crear el commit. Debes poner entre comillas el mensaje asociado al commit. Si en alguna momento tienes alguna duda, puedes ejecutar git status para conocer el estado de tu repositorio.\nConfigurar GitHub en R Lo primero que tienes que hacer es darle permiso a tu computador para conectarse a tu cuenta de GitHub.\nL√≥gicamente, el primer paso es crearse una cuenta en el servicio de GitHub.\nEn R, ejecuta el comando usethis::create_github_token(), que abrir√° una ventana de Github. En esta ventana se podr√°n crear tokens para tu cuenta.\nUn token es una especie de contrase√±a √∫nica y secreta de un solo uso, que te permite conectar tu cuenta a un computador sin tener que entregar tu clave de tu cuenta de GitHub, volvi√©ndolo mucho m√°s seguro.\nCrea el token que necesitas, y copia del c√≥digo secreto. Recuerda que este c√≥digo solamente podr√°s verlo una vez, as√≠ que procura realizar el siguiente paso en seguida.\nEjecuta el comando gitcreds::gitcreds_set() y entr√©gale el token que copiaste. De esta forma queda enlazada tu cuenta con tu computador.\nConfigurar tu cuenta Solamente queda un √∫ltimo paso de configuraci√≥n, que es guardar la informaci√≥n b√°sica de tu cuenta en R. Ejecuta el comando usethis::use_git_config(user.name = \u0026quot;usuario\u0026quot;, user.email = \u0026quot;correo\u0026quot;), indicando en sus argumentos tu nombre de usuario y tu correo de tu cuenta GitHub.\nCrear un repositorio remoto en GitHub para tu proyecto de R Si ya tienes un proyecto de RStudio con un repositorio local asociado, y quieres compartir este c√≥digo en Internet, ya sea para respaldarlo o para que otras personas puedan verlo y utilizarlo, puedes crear un repositorio remoto en GitHub que almacene una copia enlazada de tu c√≥digo. A medida que vayas actualizando tu c√≥digo, vas a ir actualizando tambi√©n el repositorio remoto, por lo que ser√° una especie de espejo de tu c√≥digo local.\nEn tu proyecto de RStudio, ejecuta el comando usethis::use_github() para que autom√°ticamente se cree un repositorio remoto conectado a tu repositorio local, y se suban los datos y c√≥digo de tu repositorio local a GitHub. El proceso es autom√°tico, y deber√≠a abrirse una ventana de tu navegador con tu nuevo repositorio de GitHub.\nPuedes compartir el enlace a este repositorio para que otras personas puedan ver tu c√≥digo, clonarlo en sus computadoras, y colaborar contigo. Es recomendable crear un archivo readme.md en tu proyecto para que aparezca como una descripci√≥n de tu repositorio GitHub, as√≠ como ponerle una descripci√≥n a tu repositorio de GitHub para que otras personas puedan entender de qu√© se.\nRecuerda que los repositorios en GitHub son por defecto p√∫blicos y visibles para las dem√°s personas. Si necesitas respaldar, almacenar o compartir c√≥digo y o datos privados, crea un repositorio privado con el comando usethis::use_github(private = TRUE). En un repositorio privado, solamente tus computadoras autorizadas y personas que t√∫ autorices podr√°n acceder a tu c√≥digo.\nSi te sirvi√≥ este tutorial, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\nRecursos El libro Happy Git with R detalla todos los pasos necesarios para poder usar Git con R, incluyendo soluciones a problemas comunes.\n","date":"2025-02-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/tutorial_github/","tags":"Git ; Consejos","title":"Tutorial: crear un repositorio Git para tu proyecto de R y comparte tu c√≥digo en GitHub"},{"content":"En esta p√°gina voy guardando enlaces a sitios web √∫tiles para otros usuarios de R. Si quieres que incluya tu sitio o iniciativa, puedes escribirme.\nAprender Sitios con contenido educacional para que aprendas R.\nR aplicado a las ciencias sociales Ciencia de Datos para Gente Sociable üìö libro introductorio de R enfocado en personas de las ciencias sociales Taller de M√©todos y T√©cnicas de Investigaci√≥n I, materiales de un curso de sociolog√≠a sobre aplicaci√≥n pr√°ctica de t√©cnicas estad√≠sticas usando R Recursos para aprender R Tutorial de R desde cero, con niveles b√°sico, intermedio, y foco en aprender {dplyr} R para ciencia de datos üìö traducci√≥n al espa√±ol del libro \u0026ldquo;R for Data Science\u0026rdquo;, recomendado para entrar a R Big Book of R üìö colecci√≥n de cientos de libros sobre R, organizada por temas R Resource Database, sitio que compila cientos de recursos para usuarios de R, como tutoriales, informaci√≥n sobre paquetes, y m√°s. R Universe, plataforma para ayudarte a encontrar y publicar contenido sobre R R Packages, lista de paquetes de R populares que facilita el acceso a su documentaci√≥n RStudio Education, recursos oficiales para aprender R (en ingl√©s) Torpedos o cheat sheets, hojas de referencia r√°pida para recordar aspectos de R y sus paquetes m√°s populares Large Language Model tools for R, Inteligencia artificial y modelos de lenguaje en R Learning statistics with R: A tutorial for psychology students and other beginners (en ingl√©s) Visualizaci√≥n de datos en R R Graph Gallery, galer√≠a de gr√°ficos y visualizaciones de datos hechas con R R Charts, galer√≠a de gr√°ficos y visualizaciones de datos hechas con R Tutorial de visualizaci√≥n de datos con {ggplot2} A ggplot2 Tutorial for Beautiful Plotting in R, tutorial recomendado de {ggplot2} (en ingl√©s) Desarrollo de aplicaciones con Shiny en R Shiny Assistant, asistente de inteligencia artificial para desarrollar, corregir y revisar aplicaciones Shiny Galer√≠a de Shiny Widgets, paquete que ofrece muchas inputs nuevos para Shiny Extensiones de Shiny, colecci√≥n de paquetes que extienden Shiny Documentaci√≥n de {bslib}, paquete para construir interfaces en Shiny Reportes Quarto Tutorial para crear documentos Quarto Tutorial para usar Quarto para generar blogs y sitios web Crear, publicar y analizar sitios web personales usando R üìö libro que detalla todas las instrucciones de crear un sitio web con R y Hugo. An√°lisis de texto con R Cuentapalabras. Estilometr√≠a y an√°lisis de texto con R para fil√≥logos Cursos para aprender R SpatialLab, cursos de R y m√°s (algunos impartidos por mi! üòå) Estaci√≥n R DataCamp, cursos as√≠ncronos interactivos para aprender R (as√≠ aprend√≠ yo) Hazla con Datos ü©∫ Escuela de Datos Obtener ayuda sobre R StackOverflow, sitio web dedicado a preguntas y respuestas Comunidad de R en Reddit, donde tambi√©n se pueden hacer consultas Conectar Conoce a otras personas que usan R o √∫nete a una comundad de usuarios/as!\nComunidades de R en Chile üá®üá± RLadies Santiago, grupo por la diversidad de g√©nero en la comunidad R RLadies Chile Comunidades de R en Latinoam√©rica o hipanohablantes Latin R, Conferencia Latinoamericana de R para investigaci√≥n y desarrollo Escuela de Datos Grupo de usuarios de R de Madrid üá™üá∏ R en Buenos Aires üá¶üá∑ Otras comunidades de R rainbowR üè≥Ô∏è‚Äçüåà comunidad de usuarixs de R enfocada en diversidad y disidencias sexo-gen√©ricas y activismo de datos Usuarios de R destacados Julia Silge (an√°lisis de texto, machine learning) Yanina Bellini Saibene Josiah Parry (geoespacial, Rust) Danielle Navarro (data scientist, arte generativo) Nicola Rennie (visualizaci√≥n, salud) Yihui Xie (RMarkdown, {knitr}) Albert Rapp (tips y tutoriales) Mauricio \u0026ldquo;Pacha\u0026rdquo; Vargas üá®üá± (estad√≠stica, econometr√≠a) Riva Quiroga üá®üá± (humanidades computacionales, ling√º√≠stica) Bruno Rodrigues (reproducibilidad) Luis D. Verde Arregoitia (bi√≥logo) Rosana Ferrero (comparte mucho contenido sobre estad√≠sticas y R) Joachim Schork Kennedy Mwavu Rony Rodr√≠guez-Ram√≠rez üá≥üáÆ Deepali Kank (visualizaciones de datos) Kyle Walker (desarrollador del paquete mapGL para mapas interactivos) Dominic Roy√© (mapas y datos geoespaciales) Blogs sobre R Blog R-Bloggers, blog que re√∫ne cientos de posts desde blogs de usuarios y desarrolladores de R R Weekly, curator√≠a de noticias y posts sobre R Blog del Tidyverse RWorks, blog de curator√≠a de funcionalidades y paquetes de R Blog de Posit, blog oficial de Posit (antes RStudio) Blog de Posit sobre IA Datos Sitios donde puedes encontrar datos que puedes usar para explorar o aprender.\nIniciativas sobre datos en Latinoam√©rica Argendata üá¶üá∑ datos sobre Argentina infoactivismo.org, sitio sobre activismo de datos, tecnolog√≠a e informaci√≥n en Latinoam√©rica Vivir sin violencia üè≥Ô∏è‚Äçüåà datos abiertos sobre violencia de g√©nero y contra el colectivo LGBTIQ+ Abriendo Datos üá®üá± fundaci√≥n chilena que promueve una cultura de datos abiertos Fuentes de datos Fuentes de datos sobre Chile üá®üá± Repositorio de datos sociales abiertos (mantenido y desarrollado por mi) Datos abiertos del Estado de Chile Banco Integrado de Datos (BIDAT) del Ministerio de Desarrollo Social y Familia Banco Central de Chile, repositorio de datos estad√≠sticos sobre econom√≠a y trabajo Estad√≠sticas sociales del Instituto Nacional de Estad√≠sticas (INE) Estad√≠sticas y datos abiertos de salud p√∫blica en Chile: Departamento de Estad√≠sticas e Informaci√≥n de Salud (DEIS) {guaguas}, paquete de R con base de datos de nombres inscritos en Chile Observa, observatorio del Sistema Nacional de Ciencia, Tecnolog√≠a, Conocimiento e Innovaci√≥n Data Observatory, plataforma de datos integrado por el Ministerio de Ciencia, Agencia Nacional de Investigaci√≥n y Desarrollo, Ministerio de Econom√≠a y Universidad Adolfo Ib√°√±ez Otras fuentes de datos Paquete {datos}, traducci√≥n al espa√±ol de conjuntos de datos que vienen por defecto en paquetes de R populares DataSetsVerse, paquete de R que contiene conjuntos de datos de diversos temas dataverse.harvard.edu ourworldindata.org statista.com Otros Tipograf√≠as Tipograf√≠as de Google Pares de tipograf√≠as Paletas de colores Sitios para encontrar combinaciones de colores para tus gr√°ficos o aplicaciones\nHTML Color Picker Pigment, paletas de colores 2 Color Combinations, pares de colores Realtime Colors, simulador de interfaz web con paletas de colores Color Buddy ","date":"2024-11-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/r_introduccion/recursos_r/","tags":"blog","title":"Recursos, blogs y otros sitios sobre R"},{"content":"** No content below YAML for the blog _index. This file provides front matter for the listing page layout and sidebar content. It is also a branch bundle, and all settings under cascade provide front matter for all pages inside blog/. You may still override any of these by changing them in a page\u0026rsquo;s front matter.**\n","date":null,"href":"https://bastianoleah.netlify.app/blog/","tags":"","title":"Blog: an√°lisis de datos en R"},{"content":" √çndice Generando el √≠ndice de b√∫squeda Obteniendo los datos del sitio Implementando la b√∫squeda Desarrollando la aplicaci√≥n Obtener datos desde la app B√∫squeda desde la app Salida de los resultados de b√∫squeda Apariencia de la app Conclusi√≥n Este blog ya lleva m√°s de 100 publicaciones! üéâ y si bien uso las etiquetas para mantener todo organizado y ayudar a descubrir nuevos posts, a veces hasta a mi me cuesta encontrar publicaciones entre tanta cosa üòÖ\nPor esa raz√≥n hace tiempo que quer√≠a implementar un buscador en este sitio, cosa que result√≥ ser m√°s complicada de lo que esperaba. Pero lo logr√©, y estoy irracionalmente feliz por eso üíú\nAlgo hermoso de programar es la sensaci√≥n de logro y orgullo que provoca poder crear cosas bonitas y que funcionan! ‚ú®\nPero les cuento la historia. Pasa que lamentablemente1 decid√≠ hacer este blog con Hugo en vez de con Quarto, que recientemente se ha vuelto una excelente herramienta para crear blogs y sitios web. Quarto viene con buscador implementado, pero en Hugo hab√≠a que implementarlo a mano. Y si bien encontr√© un tutorial muy completo para implementar b√∫squedas con LunrJS en Hugo, era realmente largu√≠simo y complicado üò£ As√≠ que me rend√≠.\nPero resulta que, cuando estaba intentando seguir ese tutorial, not√© que en los primeros pasos se configuraba Hugo para generar un indice del blog en formato JSON. Un √≠ndice del sitio es un documento de texto que contiene todo el contenido de tu sitio web. El resto del tutorial era sobre usar ese √≠ndice para implementar la b√∫squeda. Entonces qued√© pensando‚Ä¶ ü§î\nDespu√©s de semanas de darle vuelta a la frustraci√≥n de no haberlo logrado, decid√≠ hacerlo a mi manera, y me puse a hacer una app Shiny con R que usara el √≠ndice para buscar contenido y entregar resultados. ¬øQu√© tan dif√≠cil pod√≠a ser? ü´¢\nResulta que nada de dif√≠cil. En menos de una hora ya ten√≠a un producto funcional!\nGenerando el √≠ndice de b√∫squeda El primer paso para el buscador fue hacer que mi blog generara un √≠ndice de su contenido para poder buscarlo. Esto que usualmente es complejo, porque implica instalar programas que se corren regularmente para re-generar el √≠ndice, con Hugo se hace facilito porque viene integrado en su forma de funcionar.\nVer c√≥digo e instrucciones para crear el √≠ndice Simplemente hab√≠a que agregar al config.toml (archivo de configuraci√≥n del sitio) que, adem√°s de HTML y XML, genere un output JSON del sitio. Luego, en una plantilla, decirle qu√© queremos que contenga el sitio.\nEn config.toml, agregar al final estas l√≠neas:\n[outputs] home = [\u0026#34;HTML\u0026#34;, \u0026#34;RSS\u0026#34;, \u0026#34;JSON\u0026#34;] page = [\u0026#34;HTML\u0026#34;] Luego, crear un archivo index.json en la carpeta layouts para decirle que queremos que el JSON contenga t√≠tulo, enlace, fecha, etiquetas, y el texto completo de cada post:\n{{- $.Scratch.Add \u0026#34;pagesIndex\u0026#34; slice -}} {{- range $index, $page := .Site.Pages -}} {{- if in (slice \u0026#34;post\u0026#34; \u0026#34;blog\u0026#34; \u0026#34;tutoriales\u0026#34;) $page.Type -}} {{- if gt (len $page.Content) 0 -}} {{- $pageData := (dict \u0026#34;title\u0026#34; $page.Title \u0026#34;href\u0026#34; $page.Permalink \u0026#34;date\u0026#34; $page.Params.Date \u0026#34;tags\u0026#34; (delimit (default (slice) $page.Params.tags) \u0026#34; ; \u0026#34;) \u0026#34;content\u0026#34; $page.Plain) -}} {{- $.Scratch.Add \u0026#34;pagesIndex\u0026#34; $pageData -}} {{- end -}} {{- end -}} {{- end -}} {{- $.Scratch.Get \u0026#34;pagesIndex\u0026#34; | jsonify -}} Finalmente, reconstruimos el sitio ejecutando blogdown::build_site(). En la carpeta public va a aparecer el archivo index.json.\nLa gracia es que el √≠ndice se construye y actualiza solito, sin depender de otros programas ni instalar nada. Adem√°s, este √≠ndice queda expuesto a la internet, por lo que se puede acceder a √©l por la url https://bastianolea.rbind.io/index.json\nEntonces, sin necesidad de web scraping ni APIs, pod√≠a hacer una app que leyera directamente los datos del sitio üò±\nObteniendo los datos del sitio Empec√© con las primeras pruebas.\nAntes de hacer lo del √≠ndice JSON, primero empec√© leyendo el √≠ndice XML, con el paquete {xml2} le√≠a la direcci√≥n con read_xml(), y usando xml_find_all() iba apuntando a los elementos del √≠ndice para crear un dataframe. Pero pronto me di cuenta de que ese √≠ndice no ten√≠a el texto completo de los posts, y tampoco le√≠a el c√≥digo de los posts.\nAs√≠ que implement√© el √≠ndice en JSON, y con el paquete {jsonlite} y la funci√≥n fromJSON() pude obtener directamente un dataframe desde el √≠ndice, sin pasos intermedios como con la versi√≥n XML.\nAs√≠ que hice una funci√≥n procesar_json() que fue m√°s o menos as√≠:\nobtener \u0026lt;- sitio |\u0026gt; jsonlite::fromJSON() datos \u0026lt;- obtener |\u0026gt; tibble() |\u0026gt; mutate(texto = limpiar_html(texto)) |\u0026gt; mutate(fecha = extraer_fechas(fecha)) |\u0026gt; mutate(link = corregir_enlace(link)) Con esto ya ten√≠a un dataframe con las m√°s de 100 publicaciones.\nImplementando la b√∫squeda Existen muchos servicios y paquetes especializados en b√∫squeda‚Ä¶ pero yo no soy inform√°ticx ni quer√≠a complicarme. ¬øQu√© tan malo pod√≠a ser usar {stringr} para detectar texto y hacerlo pasar por motor de b√∫squeda? ü§î\nResulta que nada de malo üòå Los resultados de str_detect() no son para nada lentos, sobre todo cuando estamos hablando de apenas cientos de observaciones, cada una con apenas unas miles de palabras.\nAs√≠ que implementar la b√∫squeda fue tan sencillo como:\nbusqueda \u0026lt;- \u0026#34;waldo\u0026#34; resultado \u0026lt;- datos |\u0026gt; filter(str_detect(texto, busqueda)) Y listo. Se obtiene el dataframe filtrado, limpio, bonito. Literalmente desde la obtenci√≥n de los datos a los resultados de b√∫squeda en menos de 50 l√≠neas de c√≥digo. No hay mucho m√°s que agregar, aguante R üòÇ\nDesarrollando la aplicaci√≥n En resumen, la app es b√°sicamente:\nUn input de texto libre para las b√∫squedas con textInput() Un reactive() que cargue los datos del √≠ndice index.json alojado en mi sitio Otro rective() que filtre estos datos en base al texto de b√∫squeda Un output de texto que diga la cantidad de resultados Un output de HTML para los resultados construidos en base a los datos Amononar el UI de la app para que combine con mi sitio, usando bs_theme() para encargarse del tema del sitio y una hoja de estilos CSS Obtener datos desde la app En la obtenci√≥n de datos del sitio solamente puse la funci√≥n procesar_json(). Esto implica, naturalmente, la carga (o descarga) del √≠ndice, que como tiene tanto texto puede pesar un par de megas.\nEste ser√≠a el √∫nico *cuello de botella de la app, as√≠ que le puse un bindCache() para que se guarden los resultados en la app, acelerando la carga del √≠ndice y disminuyendo el impacto en el servidor del sitio, y le puse que el cache durara una hora (usando como llave del cache la fecha/hora del d√≠a redondeada a la hora con floor_date())\n# obtener datos del sitio sitio \u0026lt;- reactive({ message(\u0026#34;obteniendo sitio...\u0026#34;) procesar_json(\u0026#34;https://bastianolea.rbind.io/index.json\u0026#34;) }) |\u0026gt; # guardar cache por hora bindCache(floor_date(now(), unit = \u0026#34;hours\u0026#34;)) B√∫squeda desde la app La b√∫squeda es literal un filter(str_detect(texto, input$busqueda)), que retorna un objeto reactivo con el dataframe filtrado por las coincidencias.\nSe pone un debounce() para que lo que el usuario escriba no se busque a cada rato, sino que se esperen que el input se quede quieto 300 milisegundos antes de empezar la b√∫squeda.\nPara el texto de los resultados us√© cli::pluralize() para escribir texto singular o plural autom√°ticamente:\npluralize(\u0026#34;Se encontr{?√≥/aron} {n} publicaci{?√≥n/ones}:\u0026#34;) Salida de los resultados de b√∫squeda Finalmente, teniendo un dataframe con los resultados de b√∫squeda, no puedo solamente mostrar una tabla con t√≠tulos y enlaces. As√≠ que viene la parte m√°s compleja: generar el c√≥digo HTML en base a los datos para mostrar los resultados de b√∫squeda con una interfaz personalizada.\nSe trata de un output de HTML, que naturalmente requiere (req()) que el usuario haya buscado algo y existan resultados:\noutput$resultados \u0026lt;- renderUI({ req(termino() != \u0026#34;\u0026#34;) req(n_resultados() \u0026gt; 0) ... }) Luego, mi truco (o mala pr√°ctica?) favorito: separar un dataframe por filas para meterlas a un loop de purrr::map():\n# separar resultados elementos \u0026lt;- busqueda() |\u0026gt; mutate(id = row_number()) |\u0026gt; split(~id) Con este c√≥digo conviertes un dataframe en una lista donde cada elemento de la lista es un dataframe de una fila.\nEntonces, por cada resultado de b√∫squeda (un elemento de la lista que contiene una fila del dataframe), lo metemos a una funci√≥n donde definimos qu√© hacemos con las variables asociadas a cada resultado.\nEn el siguiente loop, cada elemento de los resultados se llama elemento, y como es un dataframe de una fila, con $ extraemos sus variables como titulo, link, etc., y las vamos ubicando libremente en un div():\nmap(elementos, \\(elemento) { div(class = \u0026#34;resultado\u0026#34;, # t√≠tulo con link a(href = elemento$link, target = \u0026#34;_blank\u0026#34;, h3(elemento$titulo)), # fecha div(class = \u0026#34;fecha\u0026#34;, elemento$fecha), # etiquetas con links div(class = \u0026#34;contenedor_etiquetas\u0026#34;, etiquetas(elemento$tags)), # separador hr() ) }) Me gusta esta forma de hacerlo, porque es como llegar al c√≥digo HTML con un dataframe de una fila y varias columnas, b√°sicamente una lista con varios elementos, y voy decidiendo qu√© hago con cada elemento en la interfaz que va a crearse. Es como mezclar el UI y el server de Shiny en un mismo proceso.\nLa √∫nica parte complicada de esto es el c√≥digo para las etiquetas o tags, que como pueden ser m√°s de una, cre√© la funci√≥n etiquetas() para ponerlas como rectangulitos una al lado de la otra:\nVer c√≥digo # texto de etiquetas separado por punto y comas etiquetas \u0026lt;- function(tag) { elementos \u0026lt;- tag |\u0026gt; # separar porque es un puro texto delimitado por \u0026#34;;\u0026#34; str_split(\u0026#34;;\u0026#34;) |\u0026gt; unlist() |\u0026gt; # eliminar espacios entre t√©rminos str_trim() # por cada elemento, crear un \u0026lt;div\u0026gt; con el texto y un enlace map(elementos, ~div(class = \u0026#34;etiquetas\u0026#34;, # enlace a( div(.x, class = \u0026#34;texto_etiquetas\u0026#34;), href = paste0(\u0026#34;https://bastianolea.rbind.io/tags/\u0026#34;, str_replace_all(.x, \u0026#34; \u0026#34;, \u0026#34;-\u0026#34;)), target = \u0026#34;_blank\u0026#34;) )) } Apariencia de la app Ninguna aplicaci√≥n ser√≠a nada si no cuidamos su apartado est√©tico. En la interfaz de la aplicaci√≥n primero definimos un tema de colores y tipograf√≠as con {bslib}:\n# tema theme = bs_theme( fg = \u0026#34;#553A74\u0026#34;, bg = \u0026#34;#EAD1FA\u0026#34;, primary = \u0026#34;#6E3A98\u0026#34;, font_scale = 1.1, base_font = font_google(\u0026#34;Atkinson Hyperlegible\u0026#34;), heading_font = font_google(\u0026#34;EB Garamond\u0026#34;), ) Luego podemos afinar los detalles con una hoja de estilos CSS. CSS es el lenguaje usado para definir la apariencia de toda p√°gina web. Esto es un archivo styles.css que cargamos a la interfaz de la app con includeCSS(\u0026quot;styles.css\u0026quot;).\nMientras hacemos la interfaz de la app, ya sea en UI o dentro de una funci√≥n como el map() que vimos antes, cuando definimos un div(), en el argumento class creamos clases CSS que luego usaremos para hacer que cada elemento tenga la apariencia deseada en styles.css.\nEntonces, en la hoja de estilo le damos apariencia a las clases que fuimos creando en la app, por ejemplo:\n/* estilo de t√≠tulo de resultados */ h3 { color: #9069C0; font-size: 24px; font-weight: 700; } /* estilo de textos de fechas */ .fecha { font-size: 12px; margin-bottom: 4px; margin-top: -4px; } Finalmente afinamos un detallito de la app: con el paquete {shinydisconnect} de Dean Attali podemos personalizar el mensaje de desconexi√≥n de la app para que les usaries entiendan mejor que la app requiere recargarse.\n# mensaje en caso de desconexi√≥n disconnectMessage( background = \u0026#34;#EAD1FA\u0026#34;, colour = \u0026#34;#553A74\u0026#34;, refreshColour = \u0026#34;#9069C0\u0026#34;, overlayColour = \u0026#34;#553A74\u0026#34;, size = 14, text = \u0026#34;La aplicaci√≥n se desconect√≥. Vuelve a cargar la p√°gina.\u0026#34;, refresh = \u0026#34;Volver a cargar\u0026#34; ), Esto pasa porque, como las apps Shiny tienen un servidor detr√°s, no pueden estar conectadas por siempre, y luego de un tiempo de inactividad se desconectan. Por ejemplo, si el usuario de la app se va a un resultado de b√∫squeda y despu√©s aprieta atr√°s en el navegador, la app podr√≠a haberse desconectado al detectar que el usuario se fue.\nConclusi√≥n Acabo de contar, y en total (app.R + funciones.R) la app tiene exactamente 300 l√≠neas de c√≥digo, que puedes trajinear en su repositorio. Me alegra mucho haber resuelto tan r√°pido este problema que ten√≠a con el sitio, y el resultado se ve lindo y es funcional ü•∞\nSi llegaste hasta aqu√≠ leyendo, muchas gracias üíú An√≠mate a aprender a programar para que tambi√©n hagas cosas √∫tiles y bonitas!\nMuchxs usuarixs de R est√°n migrando sus blogs Hugo Ap√©ro a Quarto, principalmente porque Quarto tiene muchas m√°s funcionalidades integradas y permite hacer blogs con c√≥dgio de R con much√≠simas cosas que Hugo no tiene, como pesta√±as, notas al margen, estilos y m√°s.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-11-11T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/buscador/","tags":"blog ; Shiny","title":"Desarrollando un buscador para mi blog con Shiny"},{"content":" {waldo} es un paquete de R para encontrar diferencias entre objetos y conjuntos de datos.\nCreemos dos vectores de datos de ejemplo:\nvector_a \u0026lt;- c(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;) vector_b \u0026lt;- c(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;f\u0026#34;) Si los comparamos con la funci√≥n all.equal(), de R base, obtenemos un resultado poco informativo:\n# comparar con base all.equal(vector_a, vector_b) [1] \u0026quot;Lengths (5, 4) differ (string compare on first 4)\u0026quot; [2] \u0026quot;1 string mismatch\u0026quot; B√°sicamente nos dice \u0026ldquo;son distintos\u0026rdquo; ü§®\nPero si usamos waldo::compare(), obtenemos una comparaci√≥n ordenada y clara de las diferencias:\n# comparar con waldo waldo::compare(vector_a, vector_b) Se nos informa con color de las diferencias en los datos.\nProbemos con otro ejemplo simple de vectores similares:\nvector_c \u0026lt;- c(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;) vector_d \u0026lt;- c(\u0026#34;d\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;a\u0026#34;) waldo::compare(vector_c, vector_d) La comparaci√≥n destaca las diferencias de posici√≥n entre ambos vectores.\nDesordenemos y ensuciemos un dataframe con ayuda del paquete {messy}, de Nicola Rennie, para compararlo con su versi√≥n original:\niris_b \u0026lt;- iris |\u0026gt; messy::messy() compare(iris, iris_b) Las diferencias son tantas que indica que las variables son de tipo distinto, y muestra sus primeras observaciones.\nHagamos otra veri√≥n sucia de iris para comparar ambos dataframe sucios:\niris_c \u0026lt;- iris |\u0026gt; messy::messy() compare(head(iris_b), head(iris_c)) En este caso te muestra las filas de ambas tablas intercaladas, para que se vean las diferencias, y luego muestra las columnas con los primeros valores distintos.\nHagamos otro par de versiones sucias, pero ahora que s√≥lo difieran en su cantidad de datos perdidos o missing:\niris_c \u0026lt;- iris |\u0026gt; messy::make_missing() iris_d \u0026lt;- iris |\u0026gt; messy::make_missing() compare(iris_c, iris_d) En este caso, va destacando las diferencias entre ambos dataframes, indicando con color sus cambios y la cantidad extra de cambios que hay.\nPara terminar, veamos un ejemplo m√°s pr√°ctico: ac√° hay dos tablas de datos con muchas columnas, todas con nombres levemente distintos. Es una situaci√≥n que pasa mucho cuando nos encontramos con datos cuyas columnas son solamente ids de variables que luego hay que ir a buscar a un diccionario de datos, y que por lo tanto tienen nombres muy parecidos üò£\nvar_ead32 var_efe23 var_eea31 var_edr52 var_ead30 var_eae31 0.6445493 0.7915215 0.4051289 0.6173781 0.5126542 0.2135513 var_ead32 var_efe23 var_eae31 var_ede52 var_ead30 var_eae30 0.5498182 0.0864707 0.8429734 0.0750443 0.3870897 0.0301285 As√≠ a la r√°pida es casi imposible saber si las columnas son las mismas, o si no lo son, cu√°les sobran y cu√°les faltan! üò≠\ncompare(tabla_a, tabla_b) As√≠ podemos ver claramente que hay tres columnas distintas entre ambas tablas, y cu√°les son, en vez de partirnos la cabeza y los ojos comparando nombres de columnas ü§ì\n","date":"2025-11-10T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/waldo/","tags":"limpieza de datos ; consejos ; datos perdidos","title":"Encuentra diferencias entre objetos de R con {waldo}"},{"content":" {ggiraph} es un paquete de R que permite agregar interactividad a gr√°ficos {ggplot2}. Esto significa que tus gr√°ficos podr√°n mostrar informaci√≥n extra al pasar el cursor encima (tooltips), hacer que se destaquen u oculten elementos al pasar el cursor, hacer clic en elementos del gr√°fico para generar cambios en aplicaciones, y m√°s.\nUn beneficio de {ggiraph} es que, a diferencia de alternativas como {plotly} o {highcharter}, no necesitas aprender a usar un paquete de visualizaci√≥n nuevo, porque {ggiraph} usa los gr√°ficos generados por {ggplot2} y mantiene al 100% su apariencia. Esto significa que tu gr√°fico interactivo se ver√° id√©ntico a tu gr√°fico de {ggplot2} (a diferencia de con ggplotly() üòí). Esto es gracias a que {ggiraph} toma el gr√°fico que hiciste y lo convierte a SVG, un formato de imagen vectorial que es compatible con HTML y CSS, lo que permite la interactividad.\nIntroducci√≥n Lo primero es instalar el paquete:\ninstall.packages(\u0026#34;ggiraph\u0026#34;) En t√©rminos generales, el procedimiento para crear gr√°ficos interactivos con {ggiraph} es:\nHacer un gr√°fico con {ggplot2} Cambiar las funciones geom_x() por geom_x_interactive() Usar la funci√≥n girafe() en vez de plot() para generar el gr√°fico interactivo. Ve√°moslo con un ejemplo:\nAdaptar gr√°ficos Para entender el proceso, crearemos un gr√°fico b√°sico y luego lo adaptaremos para incluir interactividad.\nVamos a crear un gr√°fico de dispersi√≥n con {ggplot2}, agreg√°ndole un tema de colores personalizado con {thematic}.\nlibrary(ggplot2) library(thematic) thematic_on(bg = \u0026#34;#EAD1FA\u0026#34;, fg = \u0026#34;#6E3998\u0026#34;, accent = \u0026#34;#9069C0\u0026#34;) iris |\u0026gt; ggplot(aes(Sepal.Length, Sepal.Width, color = Species)) + geom_point(size = 2) + scale_color_brewer(palette = \u0026#34;Dark2\u0026#34;) Ahora convertimos el gr√°fico en interactivo usando {ggiraph}. Para ello, identificaremos las funciones de geometr√≠as del gr√°fico (en este caso geom_point() y la cambiaremos a geom_point_interactive(). Esta capa del gr√°fico seguir√° funcionando igual que antes, pero ahora podremos agregarle nuevos argumentos:\nEn el argumento data_id, dentro de aes() indicaremos una variable que identifique los elementos del gr√°fico. Esto puede ser un identificador √∫nico si queremos que la interactividad se aplique a cada elemento de manera independiente, o una variable que agrupe las observaciones para aplicar interactividad que opere a varios elementos a la vez. El argumento tooltip dentro de aes() ser√° donde definamos el texto que aparecer√° al pasar el cursor sobre un elemento del gr√°fico. En este texto podemos usar paste() o glue() para agregar informaci√≥n de otras variables que correspondan al elemento destacado, y tambi√©n podemos usar HTML para dar estilo al texto. library(ggiraph) library(dplyr) library(glue) grafico \u0026lt;- iris |\u0026gt; mutate(id = row_number()) |\u0026gt; # identificador de observaciones ggplot(aes(Sepal.Length, Sepal.Width, color = Species)) + # geom point(size = 3) + geom_point_interactive( size = 3, aes(data_id = id, tooltip = glue(\u0026#34;\u0026lt;b\u0026gt;Largo:\u0026lt;/b\u0026gt; {Sepal.Length} \u0026lt;b\u0026gt;Ancho:\u0026lt;/b\u0026gt; {Sepal.Width} \u0026lt;b\u0026gt;Especie:\u0026lt;/b\u0026gt; {Species}\u0026#34;)) ) + scale_color_brewer(palette = \u0026#34;Dark2\u0026#34;) Una vez hechas las modificaciones, en vez de usar plot(grafico), usaremos la funci√≥n girafe() para generar el gr√°fico interactivo:\ngirafe(ggobj = grafico) Pasa el cursor sobre el gr√°fico para ver la interactividad!\nTooltips Una de las funcionalidades principales en la interactividad de gr√°ficos es el tooltip, que es el cuadro de texto que aparece al pasar el cursor sobre un elemento del gr√°fico. Sirven para poder mostrar datos extra sobre los elementos del gr√°fico sin saturar la visualizaci√≥n, tales como cifras exactas, textos que describen la observaci√≥n, etc.\nPara modificar el estilo del tooltip, usamos la funci√≥n opts_tooltip() dentro del argumento options de girafe(). Ah√≠ podemos escribir c√≥digo CSS para configurar el estilo, como color de fondo y texto, tipograf√≠a, tama√±os y espaciados, y m√°s.\nestilo_tooltip \u0026lt;- \u0026#34;background-color: #EAD1FA; color: black; font-family: sans-serif; font-size: 9pt; padding: 6px; padding-left: 8px; padding-right: 8px; border-radius: 4px;\u0026#34; girafe(ggobj = grafico, options = list( # estilo de tooltip opts_tooltip(css = estilo_tooltip), # ocultar botones opts_toolbar(saveaspng = FALSE)) ) Dentro de opts_tooltip(), el argumento use_fill hace que el color del tooltip coincida con el color del elemento del gr√°fico, definido por la paleta de colores y la variable asignada al color.\ngirafe(ggobj = grafico, options = list( opts_toolbar(saveaspng = FALSE), # estilo de tooltip opts_tooltip(use_fill = TRUE, css = estilo_tooltip)) ) Hover El hover es el efecto visual que ocurre cuando pasamos el cursor sobre un elemento del gr√°fico. Podemos usarlo para destacar un punto, agrandarlo, cambiar su color, o hacer que el resto de los puntos pasen a segundo plano.\nCon opts_hover() definimos el estilo CSS para los puntos en estado de hover, mientras que con opts_hover_inv() definimos el estilo CSS para los puntos que no est√°n en estado de hover; es decir, el resto de los puntos.\nPodemos cambiar el color del punto bajo el cursor:\ngirafe(ggobj = grafico, options = list( opts_toolbar(saveaspng = FALSE), opts_tooltip(use_fill = TRUE, css = estilo_tooltip), # opciones de hover opts_hover(css = \u0026#34;stroke: #6E3998; fill: #6E3998;\u0026#34;) )) Agrandar el punto y hacer que el resto de los puntos se transparenten:\ngirafe(ggobj = grafico, options = list( # estilo de tooltip opts_tooltip(use_fill = TRUE, css = estilo_tooltip), # ocultar botones opts_toolbar(saveaspng = FALSE), # opciones de hover opts_hover(css = \u0026#34;stroke-width: 4px;\u0026#34;), opts_hover_inv(css = \u0026#34;opacity: 0.3;\u0026#34;) )) Hacer que el resto de los elementos cambien de color al posar el cursor sobre un punto:\ngirafe(ggobj = grafico, options = list( # estilo de tooltip opts_tooltip(use_fill = TRUE, css = estilo_tooltip), # ocultar botones opts_toolbar(saveaspng = FALSE), # opciones de hover opts_hover(css = \u0026#34;stroke: none;\u0026#34;), opts_hover_inv(css = \u0026#34;stroke: grey; fill: grey; opacity: 0.3;\u0026#34;) )) Combinar gr√°ficos interactivos Otra funcionalidad clave de la interactividad es la posibilidad de que las interacciones en un gr√°fico afecten a otros gr√°ficos. Por ejemplo, posar el cursor sobre un elemento del gr√°fico revela informaci√≥n extra sobre el mismo elemento en un segundo gr√°fico, o posar el cursor sobre una observaci√≥n indica su ubicaci√≥n en una segunda visualizaci√≥n.\nPara combinar gr√°ficos usaremos {patchwork}, paquete que nos permite unir dos o m√°s gr√°ficos en R. Si necesitas una gu√≠a m√°s completa sobre combinaci√≥n de gr√°ficos, revisa este tutorial.\nEn el siguiente ejemplo, crearemos un gr√°fico de dispersi√≥n como el que hemos visto, pero con un data_id que agrupe los puntos por una variable categ√≥rica, y un segundo gr√°fico de barras donde dicha variable categ√≥rica se use para calcular promedios de los elementos del primer gr√°fico. Entonces, al pasar el cursor sobre puntos de un valor de la variable categ√≥rica, se destacar√° su valor promedio en el gr√°fico de barras, y viceversa.\nlibrary(patchwork) # gr√°fico de dispersi√≥n puntos \u0026lt;- iris |\u0026gt; ggplot() + aes(Sepal.Length, Sepal.Width, color = Species) + geom_point_interactive( size = 3, aes(data_id = Species, tooltip = glue(\u0026#34;\u0026lt;b\u0026gt;Largo:\u0026lt;/b\u0026gt; {Sepal.Length} \u0026lt;b\u0026gt;Ancho:\u0026lt;/b\u0026gt; {Sepal.Width} \u0026lt;b\u0026gt;Especie:\u0026lt;/b\u0026gt; {Species}\u0026#34;))) + scale_color_brewer(palette = \u0026#34;Dark2\u0026#34;) + guides(color = guide_legend(position = \u0026#34;top\u0026#34;)) # gr√°fico de barras barras \u0026lt;- iris |\u0026gt; group_by(Species) |\u0026gt; summarize(Sepal.Length = mean(Sepal.Length)) |\u0026gt; ggplot() + aes(Species, Sepal.Length, fill = Species) + geom_col_interactive( width = 0.4, aes(data_id = Species, tooltip = glue(\u0026#34;\u0026lt;b\u0026gt;Largo:\u0026lt;/b\u0026gt; {Sepal.Length} \u0026lt;b\u0026gt;Especie:\u0026lt;/b\u0026gt; {Species}\u0026#34;))) + scale_fill_brewer(palette = \u0026#34;Dark2\u0026#34;) + guides(fill = \u0026#34;none\u0026#34;) # combinar ambos gr√°ficos combinado \u0026lt;- barras + puntos + plot_layout(widths = c(1, 3)) # interactividad girafe(ggobj = combinado, options = list( opts_tooltip(use_fill = TRUE, css = estilo_tooltip), opts_toolbar(saveaspng = FALSE), opts_hover(css = \u0026#34;stroke: none;\u0026#34;), opts_hover_inv(css = \u0026#34;opacity: 0.3;\u0026#34;) )) Listo! Con pocas l√≠neas de c√≥digo convertimos un par de visualizaciones sencillas en algo bastante m√°s interesante e informativo.\nPara conocer ejemplos m√°s interesantes sobre las posibilidades de {ggplot2} con {ggiraph}, recomiendo revisar este conjunto de diapositivas presentadas por Tanya Shapiro y C√©dric Scherer en la conferencia UseR 2025.\nRecursos Libro de {ggiraph}, por David Gohel Diapositivas: Plot Twist. Adding Interactivity to the Elegance of {ggplot2} with {ggiraph}, por Tanya Shapiro y C√©dric Scherer ","date":"2025-11-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggiraph/","tags":"visualizaci√≥n de datos ; ggplot2","title":"Convierte gr√°ficos {ggplot2} en visualizaciones interactivas con {ggiraph}"},{"content":" √çndice Qu√© es una base de datos Cu√°ndo usar una base de datos Crear una base de datos en Supabase Conectarse a la base de datos Credenciales de acceso Variables de entorno Conexi√≥n a la base de datos Crear una tabla en la base de datos Leer una tabla desde la base de datos Procesar desde la base de datos con {dplyr} Avanzado Conexi√≥n por IPv4 Recursos Qu√© es una base de datos Cuando se habla de datos, mucha gente (me incluyo) usa coloquialmente el t√©rmino base de datos para referirse a datos que est√°n en Excel o csv üò£ Pero la realidad es que una base de datos es algo distinto: un sistema de almacenamiento y procesamiento de datos que puede contener m√∫ltiples tablas, que est√° hosteado en un computador, servidor o en la nube, y que entrega datos de acuerdo a las solicitudes que se le hagan. En este sentido una base de datos es distinto a leer un archivo, porque la base de datos siempre tiene cargados los datos, y est√° esperando que se los pidan para entregarlos de manera optimizada.\nUna de las diferencias principales al usar bases de datos es que no necesitas cargar los datos en tu computador, porque se encuentran en la base de datos remota. En vez de cargarlos, los puedes solicitar para que la base los procese y te los entregue. Solamente cuando los necesitas en memoria, los cargas localmente.\nPero adem√°s, una base de datos puede hacer m√°s que simplemente almacenar los datos. Las solicitudes que hacemos a la base, usualmente hechas por medio del lenguaje SQL, son procesadas de forma r√°pida y eficiente, entreg√°ndote solamente lo necesario. De este modo puedes acceder a conjuntos de muchos millones de observaciones sin que tu computador explote üí•\nCu√°ndo usar una base de datos Cuando la cantidad de observaciones es muy grande, y te encuentras con l√≠mites de memoria Cuando necesitas acceder a los datos desde varios equipos o aplicaciones Cuando tus datos ocupan mucho almacenamiento local y preferir√≠as que estuvieran en la nube Cuando tienes muchos datos, y solo los cargas para obtener subconjuntos o res√∫menes de los mismos Cuando quieres optimizar la velocidad de acceso a los datos, sobre todo la velocidad de cargar archivos Cuando tienes un conjunto de datos complejos que requieren de m√∫ltiples tablas relacionadas entre s√≠ Cuando no puedes mantener todos los datos en memoria A continuaci√≥n veremos c√≥mo crear una base de datos gratuita, c√≥mo conectarnos a ella desde R, y c√≥mo subir y trabajar con los datos en la base de datos remota.\nCrear una base de datos en Supabase Como una base de datos requiere estar instalada en un computador o servidor, necesitamos un proveedor que nos permita alojar la base de datos1. Una opci√≥n es Supabase, una plataforma para bases de datos que se basa en c√≥digo abierto, y que ofrece bases de datos Postgres gratuitas para proyectos peque√±os.\nPara empezar, crea una cuenta en Supabase.\nUna vez en tu cuenta, en la secci√≥n Projects, crea un nuevo proyecto:\nUn proyecto es una instancia en el servidor de Supabase con su propia base de datos Postgres2, donde podr√°s escribir tus tablas de datos. Ponle un nombre y define una contrase√±a segura. Con esta contrase√±a podr√°s acceder a tus datos.\nLuego de crear el proyecto se abrir√° el panel principal, donde te indica que (por ahora) tienes cero tablas üëéüèª\nConectarse a la base de datos Con el proyecto creado, ahora podemos conectarnos a la base de datos. Pero necesitamos crear una conexi√≥n con la misma, y para ello requerimos ciertas credenciales y datos para que tu computador conecte con el servidor donde est√° tu base de datos.\nPresiona Connect en la parte superior. para ver los par√°metros de conexi√≥n.\nSe abrir√° un panel donde se nos entregar√°n los par√°metros de acceso a la base de datos. Presiona View parameters para desplegar la informaci√≥n:\nNecesitamos los par√°metros host, port, database y user. Ahora iremos a R para introducirlos y conectarnos.\nCredenciales de acceso Para interactuar con bases de datos, necesitamos el paquete {DBI}, que gestiona las conexiones con bases de datos, y en nuestro caso el paquete {RPostgres}, que es el motor para trabajar con bases de datos Postgres.\ninstall.packages(\u0026#34;DBI\u0026#34;) install.packages(\u0026#34;RPostgres\u0026#34;) Para conectarnos a una base de datos desde R usamos la funci√≥n dbConnect(). Dentro de esta funci√≥n explicitamos el driver de la base de datos (en este caso Postgres()), y los par√°metros de conexi√≥n que obtuvimos en Supabase: dbname, host, port, user y password.\ndb_con \u0026lt;- DBI::dbConnect( RPostgres::Postgres(), dbname = \u0026#34;postgres\u0026#34;, host = \u0026#34;host\u0026#34;, port = 5432, user = \u0026#34;postgres\u0026#34;, password = \u0026#34;contrase√±a\u0026#34; ) ‚ö†Ô∏è ¬°Pero espera! No es seguro escribir credenciales privadas en un script. As√≠ que vamos a seguir las buenas pr√°cticas y vamos a guardar las credenciales de forma segura.\nUna opci√≥n es no escribir la contrase√±a y en su lugar usar rstudioapi::askForPassword() para ingresar la contrase√±a manualmente pero de forma segura. Sin embargo, no queremos estar escribiendo la contrase√±a cada vez que necesitemos los datos!\nVariables de entorno Vamos a crear un script donde podamos guardar variables de entorno, que son variables que R puede leer pero que no quedan en el c√≥digo, y que adem√°s siempre se cargan cuando abrimos el proyecto. Es decir, quedan disponibles para poder usarlas, pero estar√°n ocultas. As√≠ podemos compartir y respaldar nuestro c√≥digo sin exponer informaci√≥n sensible, y podemos conectarnos a la base de datos sin tener que volver a introducir las credenciales.\nCreamos un script de entorno llamado .Renviron en la ra√≠z de nuestro proyecto ejecutando una funci√≥n que lo hace por nosotres:\nusethis::edit_r_environ(scope = \u0026#34;project\u0026#34;) En el script que se abre guardamos las credenciales de la siguiente manera:\ndb_host=db.blablablabla.supabase.co db_port=5432 db_user=postgres db_pass=clavebasededatosprueba Una vez guardadas las credenciales, reiniciamos la sesi√≥n de R para que se lean las variables de entorno (siempre se leer√°n al iniciar R), o podemos ejecutar readRenviron(\u0026quot;.Renviron\u0026quot;) para cargarlas.\n‚ö†Ô∏è Importante: Si usas git, no olvides agregar el archivo .Renviron a tu .gitignore para evitar subir a internet credenciales privadas! Conexi√≥n a la base de datos Procedemos a hacer la conexi√≥n a la base de datos de forma segura, usando Sys.getenv() para obtener las variables de entorno que guardamos en .Renviron:\nlibrary(DBI) library(RPostgres) db_con \u0026lt;- DBI::dbConnect( RPostgres::Postgres(), dbname = \u0026#34;postgres\u0026#34;, host = Sys.getenv(\u0026#34;db_host\u0026#34;), port = Sys.getenv(\u0026#34;db_port\u0026#34;), user = Sys.getenv(\u0026#34;db_user\u0026#34;), password = Sys.getenv(\u0026#34;db_pass\u0026#34;) ) Al conectarnos creamos un objeto que representa nuestra conexi√≥n a la base de datos.\ndb_con \u0026lt;PqConnection\u0026gt; postgres@db.ybqnpazmjvictxbevqqk.supabase.co:5432 Usaremos este objeto para interactuar con la base de datos.\nCrear una tabla en la base de datos Con la funci√≥n dbWriteTable() creamos en la base de datos una tabla nueva a partir de un dataframe; por ejemplo, usando el conjunto de datos iris que viene por defecto en R.\nlibrary(DBI) # crear tabla dbWriteTable(conn = db_con, # conexi√≥n a la base name = \u0026#34;prueba\u0026#34;, # nombre de la tabla a crear iris # datos a escribir ) Confirmamos que la tabla se subi√≥ a la base de datos consult√°ndole a la base los nombres de las tablas existentes:\ndbListTables(db_con) [1] \u0026quot;prueba\u0026quot; \u0026quot;pg_stat_statements\u0026quot; [3] \u0026quot;pg_stat_statements_info\u0026quot; Tambi√©n podemos confirmar en Supabase que la tabla existe:\nAhora nuestros datos est√°n almacenados remotamente en la base de datos! Acaso √©sta ser√° la m√≠stica nube de la que tanto hablan? ‚òÅÔ∏è\nLeer una tabla desde la base de datos Podemos leer las tablas existentes en la base de datos con dbReadTable() tan solo indicando el nombre de la tabla:\ndatos_db \u0026lt;- dbReadTable(db_con, # conexi√≥n a la base \u0026#34;prueba\u0026#34; # nombre de la tabla a leer ) head(datos_db) Sepal.Length Sepal.Width Petal.Length Petal.Width Species 1 5.1 3.5 1.4 0.2 setosa 2 4.9 3.0 1.4 0.2 setosa 3 4.7 3.2 1.3 0.2 setosa 4 4.6 3.1 1.5 0.2 setosa 5 5.0 3.6 1.4 0.2 setosa 6 5.4 3.9 1.7 0.4 setosa De esta manera solicitamos a la base que nos entregue los datos de la tabla, y los cargamos en la sesi√≥n de R como un dataframe. Desde este punto podemos usar los datos normalmente, pero a continuaci√≥n veremos una forma mejor de hacerlo ü´¢\nProcesar desde la base de datos con {dplyr} Una de las ventajas de una base de datos es solicitar y obtener datos procesados desde la base de datos üè≠ Normalmente esto se hace con el lenguaje SQL, pero en R hay formas m√°s sencillas: usando directamente {dplyr} para interactuar con la base de datos.\nPara ello instalamos {dbplyr}, paquete que traducir√° el c√≥digo de {dplyr} en SQL.\ninstall.packages(\u0026#34;dbplyr\u0026#34;) Esta funcionalidad se carga autom√°ticamente al cargar {dplyr}.\nPara obtener datos desde la base de datos, usamos tbl() con el objeto de conexi√≥n y el nombre de la tabla, y recibiremos los datos en el formato tibble de {dplyr}:\nlibrary(dplyr) datos_db \u0026lt;- tbl(db_con, \u0026#34;prueba\u0026#34;) datos_db # Source: table\u0026lt;\u0026quot;prueba\u0026quot;\u0026gt; [?? x 5] # Database: postgres [postgres@db.ybqnpazmjvictxbevqqk.supabase.co:5432/postgres] Sepal.Length Sepal.Width Petal.Length Petal.Width Species \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 5.1 3.5 1.4 0.2 setosa 2 4.9 3 1.4 0.2 setosa 3 4.7 3.2 1.3 0.2 setosa 4 4.6 3.1 1.5 0.2 setosa 5 5 3.6 1.4 0.2 setosa 6 5.4 3.9 1.7 0.4 setosa 7 4.6 3.4 1.4 0.3 setosa 8 5 3.4 1.5 0.2 setosa 9 4.4 2.9 1.4 0.2 setosa 10 4.9 3.1 1.5 0.1 setosa # ‚Ñπ more rows Esta tabla generada desde la base de datos no es un dataframe normal üò± sino que es una conexi√≥n abierta con la base de datos:\nclass(datos_db) [1] \u0026quot;tbl_PqConnection\u0026quot; \u0026quot;tbl_dbi\u0026quot; \u0026quot;tbl_sql\u0026quot; \u0026quot;tbl_lazy\u0026quot; [5] \u0026quot;tbl\u0026quot; Esto nos permite seguir pidi√©ndole instrucciones que se procesar√°n en la base, no en nuestra sesi√≥n local de R. Esto es lo que nos permite realizar c√°lculos con datos de grandes vol√∫menes o manejar bases de datos gigantes que no caben en la memoria de tu computador üò≤\nUsemos la tabla obtenida desde la base de datos para hacer un filtro y calcular un promedio:\ncalculo_db \u0026lt;- datos_db |\u0026gt; filter(Species == \u0026#34;setosa\u0026#34;) |\u0026gt; summarise(mean_sepal_length = mean(Sepal.Length)) Estas operaciones se realizan remotamente en la base, y con una evaluaci√≥n perezosa ü¶• (lazy evaluation); es decir, solamente se calcula el resultado cuando es estrictamente necesario. Entonces, reci√©n al solicitar el resultado la base de datos va a realizar el c√°lculo requerido:\ncalculo_db Warning: Missing values are always removed in SQL aggregation functions. Use `na.rm = TRUE` to silence this warning This warning is displayed once every 8 hours. # Source: SQL [?? x 1] # Database: postgres [postgres@db.ybqnpazmjvictxbevqqk.supabase.co:5432/postgres] mean_sepal_length \u0026lt;dbl\u0026gt; 1 5.01 Podemos confirmar que el c√°lculo se hizo en la base de datos usando show_query() para ver el c√≥digo SQL que se us√≥ para hacer el c√°lculo:\ncalculo_db |\u0026gt; show_query() \u0026lt;SQL\u0026gt; SELECT AVG(\u0026quot;Sepal.Length\u0026quot;) AS \u0026quot;mean_sepal_length\u0026quot; FROM ( SELECT \u0026quot;prueba\u0026quot;.* FROM \u0026quot;prueba\u0026quot; WHERE (\u0026quot;Species\u0026quot; = 'setosa') ) AS \u0026quot;q01\u0026quot; ü™Ñ‚ú® Magia! Es como si hubi√©ramos aprendido SQL: combinamos el poder de SQL con la conveniencia de R.\nSi necesitamos traer los datos desde la base a tu computador, los cargamos en la memoria con la funci√≥n collect():\ndatos_df \u0026lt;- datos_db |\u0026gt; filter(Species == \u0026#34;setosa\u0026#34;) |\u0026gt; collect() Ahora s√≠ que s√≠ el objeto datos_df se encuentra cargado en tu sesi√≥n local de R como un dataframe normal.\nComo los c√°lculos que hagamos sobre los datos se traducen desde R a SQL y luego se nos entregan, un uso importante de collect() es para anteponerlo a operaciones que no tienen traducci√≥n a SQL.\nPor ejemplo, me consta que las funciones de {forcats} no se traducen a SQL:\ndatos_db |\u0026gt; group_by(Species) |\u0026gt; summarise(Sepal.Width = mean(Sepal.Width)) |\u0026gt; mutate(Species = forcats::fct_reorder(Species, Sepal.Width)) Error in `forcats::fct_reorder()`: ! No known SQL translation En este caso, anteponemos collect() para pasar de SQL a R en medio del proceso y listo.\ndatos_db |\u0026gt; group_by(Species) |\u0026gt; summarise(Sepal.Width = mean(Sepal.Width)) |\u0026gt; collect() |\u0026gt; # cargar a la memoria mutate(Species = forcats::fct_reorder(Species, Sepal.Width)) |\u0026gt; arrange(Species) # A tibble: 3 √ó 2 Species Sepal.Width \u0026lt;fct\u0026gt; \u0026lt;dbl\u0026gt; 1 versicolor 2.77 2 virginica 2.97 3 setosa 3.43 De esta forma, aprovechamos la base de datos SQL lo m√°s posible, y cuando necesitemos operaciones m√°s complejas nos pasamos a R! üòâ\nYa sea porque necesitas la capacidad de almacenamiento, porque requieres procesamiento optimizado de grandes vol√∫menes de datos, o porque vas a usar tus datos en una aplicaci√≥n o plataforma, aprender a manejar bases de datos es una habilidad crucial para escalar tus capacidades y pasar al siguiente nivel ‚ú®\nAvanzado Conexi√≥n por IPv4 Las bases de Supabase usan IPv6 por defecto, pero algunos servicios requieren de conexiones IPv4 por limitaciones t√©cnicas o de infraestructura. Uno de estos servicios es ShinyApps.io, el servicio que uso yo para alojar mis aplicaciones Shiny.\nPara usar IPv4 en conexiones a bases de datos Supabase, en el panel de Conexi√≥n (el mismo que usaste para obtener las credenciales), en la opci√≥n Method puedes elegir Session pooler para obtener credenciales IPv4.\nRecursos A Crash Course on PostgreSQL for R Users, por Mauricio Vargas S. Tambi√©n se puede correr la base de datos en tu mismo computador, pero eso lo dejamos para otro post ü§ì\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPostgres es un sistema de gesti√≥n de bases de datos relacionales , uno de los m√°s usados, pero existen muchos otros m√°s, como SQLite, MariaDB, y m√°s.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-11-06T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/db_supabase/","tags":"datos ; optimizaci√≥n ; dplyr","title":"Crear y conectarse a una base de datos en R"},{"content":" En una aplicaci√≥n Shiny, cada interacci√≥n que la/el usuario hace suele conllevar un c√°lculo de R que se ejecuta para producir un output, como una tabla o un gr√°fico. Dependiendo de la cantidad de datos, de la complejidad del c√°lculo o del output, estas interacciones pueden tomar m√°s tiempo del esperado.\nUna forma de optimizar la velocidad de una aplicaci√≥n Shiny es implementando un cache. Un cache significa que los resultados de los c√°lculos realizados por la app se guardan, de modo que si el c√°lculo se repite, el resultado se obtiene desde el cache, sin necesidad de volver a ejecutar el c√°lculo. En la mayor√≠a de los casos esto significa una gran mejora de velocidad! üöÄ\nConsideraciones previas Antes que nada, hay que ver si es posible (o si vale la pena) implementar un cache para cada situaci√≥n.\n¬øCu√°ndo agregar un cache?\nSi los c√°lculos son repetitivos; es decir, que uno o varios usuarios pueden volver a solicitar el mismo c√°lculo varias veces. Si los c√°lculos son determin√≠sticos; es decir, que para los mismos inputs siempre se produzca el mismo output. No tiene sentido si el c√°lculo implica azar o variables fuera del control de la app, como la fecha u hora. Si la cantidad de inputs que definen el c√°lculo es baja, porque si son demasiados inputs, no tiene sentido agregar un cache para interacciones que escasamente se van a repetir. Si los inputs son limitados, ya que si son muy espec√≠ficos (como un campo de texto o el subir un archivo) tampoco tiene sentido cachear un input que no se va a repetir. Implementando el cache Con la funci√≥n bindCache() podemos hacer que un output (gr√°ficos, tablas, textos din√°micos) o un objeto reactivo (creado con reactive() y que se actualiza seg√∫n su dependencia de inputs u otros objetos reactivos) guarden sus resultados en un cache.\ncalculo_lento \u0026lt;- reactive({ # c√°lculo que demora mucho }) |\u0026gt; bindCache() Al especificar que queremos cachear un objeto/output, tambi√©n debemos que explicitar sus dependencias: los inputs u objetos cuyo valor hace que el c√°lculo cambie.\ncalculo_lento \u0026lt;- reactive({ # c√°lculo que demora mucho }) |\u0026gt; bindCache(input$selector_1, input$selector_2) En este ejemplo, el objeto reactivo calculo_lento depende de los valores de input$selector_1 e input$selector_2, definidos por el/la usuario/a de la app.\nCuando un usuario/a elija estos inputs y por consiguiente obtenga un resultado de calculo_lento(), el cache se guardar√° para la combinaci√≥n de valores de estos dos inputs.\nEntonces: si el usuario/a selecciona una combinaci√≥n que ya ha sido calculada antes, se omite el c√°lculo y el resultado se carga desde el cache, y si es una combinaci√≥n nueva, el resultado se calcula y se guarda en el cache para futuras solicitudes.\nComparaci√≥n de desempe√±o En este ejemplo, vemos una aplicaci√≥n Shiny con varios outputs, los cuales tienen agregado bindCache().\nEn la primera ejecuci√≥n, la app demora aproximadamente 3 segundos en cargar los outputs por primera vez:\nPero en una segunda ejecuci√≥n, la carga es casi instant√°nea, dado que los resultados de los c√°lculos estaban preguardados:\nUna vez que las combinaciones se cargaron, las siguientes veces que se soliciten la carga es mucho m√°s r√°pida! üî•\nEn este ejemplo, el bindCache() se puso en cada output, en la misma funci√≥n render_x() que general el objeto output$grafico_x, con una dependencia al input$region que hace cambiar los gr√°ficos. Entonces, cuando la/el usuaria/o cambia el input, Shiny se salta todos los c√°lculos y carga el output correspondiente. Pero puedes experimentar con poner el bindCache() en distintos lugares que puedan ser cuello de botella de tu app.\nConfigurar el almacenamiento del cache Por defecto, el cache se guarda en memoria, lo que significa que al cerrar la aplicaci√≥n, el cache se pierde. Si queremos que el cache persista entre sesiones, podemos configurar el almacenamiento del cache en disco, agregando la siguiente l√≠nea en el archivo app.R:\nshinyOptions(cache = cachem::cache_disk(\u0026#34;./cache\u0026#34;)) De este modo, el cache quedar√° guardado en la carpeta cache de la app, y podremos ver en tiempo real que los archivos del cache se van generando a medida que los usuarios interact√∫an con la app.\nEsto entrega el beneficio de poder ampliar el cache a m√∫ltiples usuarios, porque si varios usuarios solicitan el mismo c√°lculo, el segundo usuario en adelante obtendr√° el resultado desde el cache en disco. Tambi√©n te permite evitar que el primer usuario tenga que esperar la carga de los elementos, al poder subir una app que ya venga con su cache generado.\nOtro beneficio es que te entrega el control sobre el cache, en el sentido que simplemente puedes borrar los archivos para obligar que Shiny re-calcule los outputs. Esto sirve para ayudarte cuando cambies el c√≥digo pero no veas cambios y despu√©s te des cuenta que era porque los gr√°ficos se estaban cargando desde el cache üòÖ\nBonus: generando el cache de antemano Si quieres evitar que el primer usuario de tu app tenga que esperar a que se generen los c√°lculos y el cache, puedes generar el cache de antemano. Para esto simplemente configuras que el cache se guarde en el disco, y manualmente exploras las combinaciones de inputs de tu app\u0026hellip; lo cual ser√≠a bastante aburrido de hacer.\nPuedes combinar la generaci√≥n de cache con el testeo de aplicaciones Shiny con {shinytest2} para automatizar el uso de tu aplicaci√≥n, con el doble objetivo de probar que cada interacci√≥n de tu app funcione correctamente, y en tanto la app es puesta a prueba, generar un cache de todos los c√°lculos sin tener que esperar que el usuario realice las interacciones manualmente.\nRecursos Gu√≠a oficial de Posit para optimizar aplicaciones Shiny ","date":"2025-11-04T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/shiny_optimizar/","tags":"shiny ; optimizaci√≥n","title":"Optimiza la velocidad de tus aplicaciones Shiny con bindCache()"},{"content":" ‚ö†Ô∏è post en construcci√≥n ‚ö†Ô∏è √çndice Empezar a usar {shinytest2} Estructura de carpetas Creando una prueba para tu app Automatizar tests repetitivos Al igual que la validaci√≥n de datos, validar aplicaciones te permite crear un conjunto de pruebas para confirmar que tus aplicaciones funcionan bien sin tener que probarlas manualmente. En la pr√°ctica, puedes programar un bot que apriete todos los botones de tu aplicaci√≥n y obtener capturas de pantalla que te confirmen que todo se ve bien, o realizar otros tipos de pruebas m√°s complejas.\nEn esta gu√≠a aprender√°s a utilizar {shinytest2} para automatizar el testeo de tus aplicaciones Shiny, asegurando su correcto funcionamiento a trav√©s de capturas de pantalla y otras validaciones autom√°ticas.\nPrimero que nada, instalamos el paquete:\ninstall.packages(\u0026#34;shinytest2\u0026#34;) Empezar a usar {shinytest2} Hay dos formas de empezar con los tests en tu app Shiny.\nLa primera opci√≥n es crear la infraestructura necesaria, ejecutando use_shinytest2() e indicando la carpeta donde est√° tu app:\nshinytest2::use_shinytest2(app_dir = \u0026#34;app/inversion_gores/\u0026#34;) Este comando solamente crea las carpetas de tests que son b√°sicas para validaci√≥n con {testthat}, pero no crea ning√∫n test en particular.\nLa segunda opci√≥n, y recomendada, es empezar\nshinytest2::record_test(\u0026#34;app/inversion_gores/\u0026#34;) Adem√°s de crear la infraestructura necesaria, este comando abre tu aplicaci√≥n Shiny en un navegador para que grabes tus interacciones con la app para generar autom√°ticamente tu primer test.\nPresiona los inputs de tu aplicaci√≥n para navegar por ella, y elige uno de los botones de la parte superior para esperar (expect) que tu app retorne un valor (Expect Shiny value) o genere una captura de pantalla (Expect screenshot). Contra estas expectativas se evaluar√° el funcionamiento de tu app.\nCuando termines de simular una visita a tu app presiona Save test and exit. Esto generar√° autom√°ticamente un archivo de pruebas en la carpeta tests/testthat/ de tu aplicaci√≥n Shiny, que se abrir√° y de inmediato ejecutar√° la prueba en el fondo; es decir, tu app se ejecutar√° de manera invisible reproduciendo los pasos que tomaste.\nDe esto se trata la validaci√≥n de aplicaciones: programar interacciones con tu aplicaci√≥n para evaluar que siemrpe retorne los valores esperados.\nEstructura de carpetas En la carpeta de tu app tendr√°s la carpeta tests. Dentro est√° testthat.R, que contiene la funci√≥n shinytest2::test_app(), con la que puedes ejecutar todas tus pruebas.\nDentro de la carpeta testthat/ estar√°n todos los archivos de tests que hayas grabado o creado manualmente, que siguen la estructura test-x.R. Puedes agregar los tests que necesites.\nAdem√°s, dentro de tests/testthat/ est√° _snaps, que contiene las capturas de pantalla tomadas en cada prueba.\nAqu√≠ hay un ejemplo de las carpetas de una app m√≠a:\ninversion_gores/ |-- app.R |-- funciones.R |-- styles.css +-- tests/ |-- testthat.R +-- testthat/ |-- setup-shinytest2.R # archivo necesario |-- test-mapas.R # test para probar mapas |-- test-tablas.R # test para probar tablas +-- _snaps/ # carpeta con pantallazos +-- mac-4.4/ +-- test-mapas/ |-- test-mapas-001.png |-- test-mapas-002.png |-- ... +-- test-tablas/ |-- test-tablas-001.png |-- test-tablas-002.png |-- ... Creando una prueba para tu app Para empezar, puedes basarte en el test que se genera al simular y grabar tu interacci√≥n con shinytest2::record_test(), o crear un test manualmente.\nlibrary(shinytest2) test_that(\u0026#34;{shinytest2} recording: inversion_gores_2\u0026#34;, { app \u0026lt;- AppDriver$new(variant = platform_variant(), name = \u0026#34;test-tablas\u0026#34;, height = 985, width = 1254) # cambiar de pesta√±a app$set_inputs(tabs = \u0026#34;Tabla\u0026#34;, allow_no_input_binding_ = TRUE) # cambiar un input app$set_inputs(region = \u0026#34;2\u0026#34;) # esperar a que la app haya cargado app$wait_for_idle(200) # tomar pantallazo app$expect_screenshot() }) Dentro de la carpeta tests/testthat/_snaps se pueden encontrar los resultados de los pantallazos producidos durante el test con app$expect_screenshot()\nPodemos inspeccionar visualmente las capturas para corroborar que la aplicaci√≥n funciona correctamente (asegurarnos que todos los outputs se vean, que la disposici√≥n de la app es visualmente correcta), pero tambi√©n la prueba nos avisar√° si las capturas de pantalla nuevas difieren de las anteriores, lo que significar√≠a un cambio en los resultados.\nAutomatizar tests repetitivos Si tienes una lista con los valores de uno o varios inputs que quieres testear, puedes correr las pruebas en un loop que repita la prueba para cada elemento.\nDe ser necesario, dentro del test puedes cargar datos que te entreguen la lista de inputs (por ejemplo, los valores √∫nicos de una variable)\n# por cada variable, navegar y captura de pantalla for(i in variables) { app$set_inputs(indicador_lista = i) app$wait_for_idle(200) app$expect_screenshot() } Para ejecutar todos los tests\nshinytest2::test_app(\u0026#34;app/icbg/\u0026#34;) ","date":"2025-11-02T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/shiny_validacion/","tags":"shiny ; automatizaci√≥n","title":"Testeo automatizado de aplicaciones Shiny con {shinytest2}"},{"content":"Si eres usuario/a de macOS y de R, aqu√≠ va un truquito para facilitar tu trabajo.\nEn el Finder puedes crear carpetas inteligentes, que muestran autom√°ticamente archivos que cumplen ciertos criterios, intependiente de donde est√©n en tu computador. B√°sicamente son carpetas que guardan resultados de b√∫squeda que se mantienen actualizados.\nCon esto podemos crear una carpeta que muestre todos tus proyectos de R, para poder acceder a ellos m√°s r√°pido.\nEn el Finder, vamos a Archivo y creamos una nueva carpeta inteligente.\nEn la barra de b√∫squeda, escribimos Rproj, que es la extensi√≥n de los proyectos de R, y especificamos El nombre contiene\u0026hellip; para s√≥lo buscar nombres de archivo que coincidan (y no, por ejemplo, archivos de texto que contengan esa palabra).\nLuego, en la barra de arriba, seleccionamos \u0026ldquo;Este Mac\u0026rdquo; si queremos buscar en todo el computador, o elegimos otra carpeta si queremos restringir la b√∫squeda.\nEn este punto ya deber√≠a aparecer el resultado dentro de la carpeta. Para guardar esta carpeta inteligente, hacemos clic en el bot√≥n Guardar en la esquina superior derecha, y elegimos d√≥nde guardarla.\nFinalmente podemos agregar la carpeta al Dock para tener un acceso r√°pido a todos los proyectos de R, y si hacemos clic derecho podemos especificar que se ordenen por fecha de modificaci√≥n, que aparezcan como abanico, y que el √≠cono se vea como carpeta.\n","date":"2025-10-29T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-10-29/","tags":"consejos","title":"Crea una carpeta inteligente con todos tus proyectos de R en Mac"},{"content":"git es una herramienta para el control de versiones de c√≥digo, respaldo de c√≥digo, y colaboraci√≥n. En otro post hice un tutorial para aprender a usar git y GitHub con R y RStudio. En este post voy a mantener una lista1 de los comandos que m√°s uso en git, as√≠ como los comandos que necesito para resolver los problemas m√°s frecuentes.\nOtro recurso mucho m√°s completo es ohshitgit.com, que como su nombre indica, est√° enfocado en resolver problemas comunes con git.\nCrear repositorio git en proyecto de RStudio git init usethis::use_git() Para m√°s informaci√≥n sobre la integraci√≥n de R con git, revisa este post. Tambi√©n existe el libro Happy Git with R, que detalla todos los pasos necesarios para poder usar git con R, incluyendo soluciones a problemas comunes.\nAgregar archivos al √°rea de preparaci√≥n (staging area) Cuando creaste o modificaste archivoc, y quieres registrarlos para ser agregados a la nueva versi√≥n del proyecto:\ngit add archivo.R Para agregar todos los archivos cambiados desde el √∫ltimo commit:\ngit add . Ver estado del repositorio Para ver qu√© archivos han sido modificados, cu√°les est√°n en el √°rea de preparaci√≥n, y cu√°les no:\ngit status Guardar los cambios preparados en una versi√≥n (commit) Un commit es la operaci√≥n en la que tomas los archivos del √°rea de preparaci√≥n y los guardas como una nueva versi√≥n del proyecto. Siempre hay que agregar un mensaje que describa los cambios de esta versi√≥n:\ngit commit -m \u0026#34;script de procesamiento de datos actualizado\u0026#34; Ver todos los commits que has hecho Te entrega una lista con las versiones de tu repositorio, con sus mensajes respectivos y el √≠ndice de cada uno de ellos (un c√≥digo √∫nico que identifica cada cambio)\ngit log Tambi√©n est√° el comando git reflog, que muestra un historial de todos los movimientos en el repositorio, incluyendo commits, cambios de ramas, y otras operaciones.\ngit reflog Subir los cambios guardados al repositorio remoto (GitHub) Asumiendo que tu proyecto de RStudio tiene un repositorio git, que has hecho commit de tus cambios, y que ya conectaste el repositorio local con un repositorio remoto en GitHub o GitLab:\ngit push Si no has creado una versi√≥n remota de tu repositorio a√∫n, puedes usar el comando use_github() para crear una r√°pidamente.\nusethis::use_github() Deshacer git add archivo.R Por si la embarraste y agregaste un archivo incorrecto a la zona de preparaci√≥n:\ngit rm archivo.R Deshacer git add . git reset Deshacer commit Si guardaste una versi√≥n del c√≥digo pero √©sta ten√≠a archivos equivocados, puedes deshacer el commit pero sin perder los cambios que hiciste. Con esto, tu repositorio volver√° a la versi√≥n antes del commit, pero el c√≥digo y archivos nuevos no se perder√°n, y estar√°n disponibles para volver a agregarlos con git add y rehacer la versi√≥n con git commit.\ngit reset --soft HEAD~1 Eliminar archivos agregados con git add Para cuando agregaste archivos al commit pero luego te das cuenta que no deb√≠as haberlo hecho. Por ejemplo, si agregaste un archivo muy grande por error:\ngit rm --cached \u0026#34;archivo\u0026#34; git commit -m \u0026#34;mensaje\u0026#34; git push -u origin branch Volver al √∫ltimo commit Borra el √∫ltimo commit, perdiendo tus cambios locales.\ngit reset --hard HEAD Forzar push Por si no te deja subir los cambios, pero est√°s segurx de que quieres sobreescribir el repositorio remoto con tu versi√≥n local:\ngit push origin main --force Volver a una versi√≥n anterior de tu c√≥digo Busca el √≠ndice de la versi√≥n a la cual quieres volver, y usa git reset para regresar a esa versi√≥n:\ngit reflog git reset HEAD@{index} Ramas Aprende a hacer ramas online aqu√≠\nHago esto porque tengo una nota en el computador con todos los comandos y siempre vuelvo a buscarla para copiarlos, as√≠ que mejor dejo todo eso ac√° üòã\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-10-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/git_comandos/","tags":"git","title":"Comandos comunes de Git"},{"content":"El viernes 22 de agosto de 2025 tuve el honor de participar en las clases magistrales del Diplomado de Ciencia de Datos para Ciencias Sociales y Humanidades de la Facultad de Estudios Superiores Acatl√°n, Universidad Nacional Aut√≥noma de M√©xico (UNAM).\nMe pidieron hacer un taller acerca de c√≥mo crear una marca personal como cient√≠fico de datos, pero d√°ndole unas vueltas a esa idea, termin√© hablando sobre tres principios: crear, diferenciarse y compartir.\nEn la clase hablo de mi trayectoria, mi salto desde la sociolog√≠a al an√°lisis de datos, y voy dando consejos (mezclados con ejemplos de c√≥digo) para tomar una postura participativa y solidaria con respecto a la programaci√≥n, el trabajo con datos, y la creaci√≥n de comunidades en torno al c√≥digo abierto.\nGrabaci√≥n Diapositivas Para la ocasi√≥n hice unas diapositivas con Quarto que tambi√©n puedes revisar aqu√≠.. El c√≥digo de las diapositivas est√° en este repositorio.\nRes√∫men Las ideas principales del taller fueron:\nMantenerse creando desde la experticia, la experiencia, y la relevancia social ‚úäüèº Destacar respecto del resto diferenci√°ndose con contenido inclusivo, atractivo, novedoso y con personalidad üíé Intentar compartir y participar lo m√°s posible para mantener viva la comunidad datera, ayudar a otrxs a aprender, y dar a cambio lo que hemos recibido gracias al c√≥digo abierto y los datos abiertos üéÅ Recib√≠ muy lindos comentarios de las y los participantes, que agradezco de coraz√≥n üíú\nLas y los invito a crear su propio lugar en la internet, destinado a visibilizar su trabajo y compartir sus aprendizajes!\nEnlaces Portafolio de aplicaciones Shiny de an√°lisis de datos Tutorial Git y GitHub desde R Tutorial para crear blog con Quarto Bonus Fotos m√≠as vendi√©ndola durante la clase:\n","date":"2025-10-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/taller_datos_unam/","tags":"videos ; consejos ; quarto ; github ; blog","title":"Taller: Compartir y colaborar desde el cruce entre las ciencias de datos y las ciencias sociales"},{"content":" Como Chile es un pa√≠s tan largo, a veces cuesta publicar mapas que se vean bien por el espacio que requiere. En otro post intentamos resolver esto girando Chile para que quede horizontal o acostado. Ahora veremos otra opci√≥n: partir Chile en tres secciones, norte centro y sur, que podemos disponer lado a lado para ocupar mejor el espacio.\n√çndice Descargar mapas Cargar mapa Visualizar mapa Cortar mapa de Chile continental Calcular recortes Cortar mapas Unir mapas Descargar mapas En el siguiente bot√≥n descargaremos un shapefile de Chile por regiones, que proviene de la Mapoteca de la Biblioteca del Congreso Nacional. Tambi√©n puedes descargarlo en el script con download.file().\nDivision regional: pol√≠gonos de las regiones de Chile Una vez descargado, descomprimimos el archivo (podemos usar unzip()) y obtendremos una carpeta. Como siempre, es importante que estemos trabajando en un proyecto de RStudio, y que guardemos los datos y shapes dentro de la carpeta del proyecto.\nPuedes hacer esto mediante c√≥digo:\n# descargar download.file(\u0026#34;https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip\u0026#34;, \u0026#34;Regiones.zip\u0026#34;) # descomprimir unzip(\u0026#34;Regiones.zip\u0026#34;, exdir = \u0026#34;Regiones\u0026#34;) Cargar mapa Cargamos el shape con la funci√≥n read_sf() del paquete {sf}. Si es tu primera vez haciendo mapas, revisa esta gu√≠a.\nlibrary(sf) mapa \u0026lt;- read_sf(\u0026#34;Regiones\u0026#34;) Visualizar mapa Primero veamos el mapa tal como viene desde el shapefile:\nlibrary(ggplot2) mapa |\u0026gt; ggplot() + geom_sf() + theme_minimal() Aqu√≠ se nota al tiro el problema: el pa√≠s es tan delgado y alto ü´¶ que si contamos con poco espacio vertical, no se notan los detalles y dejamos m√°rgenes sin uso.\nSi la visualizaci√≥n se demora mucho en generar en tu computador, prueba simplificando los detalles del mapa.\nCortar mapa de Chile continental Un primer ajuste para la visualizaci√≥n es cortar los m√°rgenes del mapa para enfocarnos en Chile continental. Perd√≥n, Rapa Nui üòî\nmapa |\u0026gt; # reproyectar st_transform(crs = 5360) |\u0026gt; # visualizar ggplot() + geom_sf() + # recortar Chile continental coord_sf(expand = FALSE, xlim = c(-79, -62), ylim = c(-56.2, -17.3)) + theme_minimal(base_size = 8) Uno de los pasos para el recorte fue reproyectar el mapa, dado que vienen con un sistema de coordenadas distinto al que t√≠picamente se usa. Al reproyectar, las coordenadas pasan a estar en grados decimales.\nCalcular recortes Ahora toca sacar la calculadora (tambi√©n se puede hace a mano, pero ac√° nos gusta el c√≥digo reproducible y sobrecomplejizar todo) ü§ì\nLa idea es: medir cu√°nto mide cada secci√≥n del pa√≠s, y calcular los cortes que hay que hacerle al mapa para dividirlo en tres.\nPrimero tomamos el l√≠mite superior o norte del pa√≠s, y el l√≠mite sur, y calculamos el largo en t√©rmino de grados de latitud. Dividimos ese largo en tres partes para saber cu√°nto va a medir cada una de las tres secciones.\nlimite_sur = -56.2 limite_norte = -17.3 largo = abs(limite_sur) - abs(limite_norte) parte = largo / 3 Obtenemos que cada secci√≥n medir√° 12.9666667 grados de latitud.\nSi empezamos desde el norte del pa√≠s (n, que equivale a -17.3), la primera secci√≥n llegar√° hasta n - parte (-30.3). Luego la segunda secci√≥n empieza donde termina la anterior, y llega hasta n - parte*2 (-43), y la tercera secci√≥n llegar√° hasta n - parte*2 (-56.2), que coincide con el l√≠mite sur del pa√≠s.\nsecciones norte sur 1 n n-p 2 n-p n-p*2 3 n-p*2 n-p*3 Podemos calcular esto a mano, o hacerlo al ojo, pero vamos a creamor una tablita mejor.\nlibrary(dplyr) cortes \u0026lt;- tibble(secciones = c(1, 2, 3)) cortes \u0026lt;- cortes |\u0026gt; mutate(norte = limite_norte, sur = limite_norte) cortes # A tibble: 3 √ó 3 secciones norte sur \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 1 -17.3 -17.3 2 2 -17.3 -17.3 3 3 -17.3 -17.3 cortes \u0026lt;- cortes |\u0026gt; mutate(norte = norte - (parte * (secciones - 1)), sur = sur - (parte * secciones)) cortes # A tibble: 3 √ó 3 secciones norte sur \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 1 -17.3 -30.3 2 2 -30.3 -43.2 3 3 -43.2 -56.2 secciones norte sur 1 -17.30000 -30.26667 2 -30.26667 -43.23333 3 -43.23333 -56.20000 Cortar mapas Creamos un mapa base, y definimos un objeto que contiene los cortes horizontales, que en este caso ser√°n iguales para los tres mapas.\nmapa_base \u0026lt;- mapa |\u0026gt; # reproyectar st_transform(crs = 5360) |\u0026gt; # visualizar ggplot() + geom_sf() + theme_minimal(base_size = 8) limites_continental \u0026lt;- c(-78, -64) Ahora, usando el mapa_base, aplicamos el corte de coordenadas con coors_sf() a partir de la tabla cortes, seleccionando la columna de la tabla que corresponde (norte o sur), y la posici√≥n del elemento para cada secci√≥n (1, 2 o 3).\nmapa_norte \u0026lt;- mapa_base + coord_sf(expand = FALSE, xlim = limites_continental, ylim = c(cortes$norte[1], cortes$sur[1])) mapa_centro \u0026lt;- mapa_base + coord_sf(expand = FALSE, xlim = limites_continental, ylim = c(cortes$norte[2], cortes$sur[2])) mapa_sur \u0026lt;- mapa_base + coord_sf(expand = FALSE, xlim = limites_continental, ylim = c(cortes$norte[3], cortes$sur[3])) Unir mapas El paso final es unir los tres gr√°ficos: como detallamos en un post anterior, con el paquete {patchwork} podemos unir y combinar gr√°ficos de {ggplot2}, y la sintaxis es muy simple: si conectas los gr√°ficos con el signo + se unir√°n lado a lado, si los divides con / aparecer√°n uno sobre otro. Con el signo \u0026amp; puedes agregar capas a todos los gr√°ficos de una.\nlibrary(patchwork) mapa_norte + mapa_centro + mapa_sur + plot_annotation(title = \u0026#34;Mapa de Chile\u0026#34;, subtitle = \u0026#34;dividido en tres secciones\u0026#34;) \u0026amp; theme(axis.text.x = element_blank()) Listo! Ahora el mapa cabe mucho mejor en una hoja, p√°gina o imagen.\nTambi√©n podemos ajustar los cortes horizontales del mapa, para que cada secci√≥n tenga un espaciado similar. Ac√° dejo el c√≥digo con los n√∫meros exactos para copiar y pegar, o bien, revisa el script completo en este Gist.\nmapa_norte \u0026lt;- mapa_base + coord_sf(expand = FALSE, xlim = c(-74, -65), ylim = c(-17.3, -30.2)) mapa_centro \u0026lt;- mapa_base + coord_sf(expand = FALSE, xlim = c(-76, -68), ylim = c(-30.2, -43.2)) mapa_sur \u0026lt;- mapa_base + coord_sf(expand = FALSE, xlim = c(-78, -65), ylim = c(-43.2, -56.2)) mapa_norte + mapa_centro + mapa_sur + plot_annotation(title = \u0026#34;Mapa de Chile\u0026#34;, subtitle = \u0026#34;dividido en tres secciones\u0026#34;) \u0026amp; theme(axis.text.x = element_blank()) ","date":"2025-10-23T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/mapa_chile_triple/","tags":"mapas ; Chile","title":"Visualizar un mapa de Chile separado en tres secciones"},{"content":" ‚ö†Ô∏è Este tutorial se encuentra en construcci√≥n! ‚ö†Ô∏è R cuenta con un muy amplio ecosistema de paquetes para datos geoespaciales. Uno de los paquetes m√°s importantes es {sf}, que permite manipular datos espaciales a partir del est√°ndar simple features (caracter√≠sticas simples), ampliamente utilizado en sistemas de informaci√≥n geogr√°fica (SIG/GIS).\nEn esta gu√≠a ir√© guardando los comandos que uso frecuentemente para manipular, transformar y visualizar datos geoespaciales en R. En la medida que voy aprendiendo m√°s sobre hacer mapitas, ir√© actualizando y complementando.\nLo inicial es instalar {sf}:\ninstall.packages(\u0026#34;sf\u0026#34;) Y cargarlo junto a {dplyr} para empezar a trabajar con datos geoespaciales.\nlibrary(sf) library(dplyr) Nota: para simplificar, en este tutorial voy a ocultar el c√≥digo de los gr√°ficos, pero siempre estar√° disponible bajo flechitas que despliegan el c√≥digo, como la siguiente:\nVer c√≥digo para los gr√°ficos library(ggplot2) # tema de colores thematic::thematic_on(fg = \u0026#34;#553A74\u0026#34;, bg = \u0026#34;#EAD2FA\u0026#34;, accent = \u0026#34;#9069C0\u0026#34;) theme_set( # fondo transparente para mapas theme(plot.background = element_rect(fill = \u0026#34;transparent\u0026#34;, color = \u0026#34;transparent\u0026#34;)) + # borrar l√≠neas feas theme(axis.ticks = element_blank()) ) √çndice Carga de mapas Cargar mapas de cualquier pa√≠s Cargar shapes Visualizaci√≥n b√°sica de mapas Operaciones sobre geometr√≠as Calcular centroide Extraer longitud y latitud Calcular buffer Calcular caja de un pol√≠gono Convertir caja a pol√≠gono Poner un punto en un mapa Poner varios puntos en un mapa Crear un cuadrado Crear un rect√°ngulo a partir de puntos Crear un pol√≠gono a partir de coordenadas Crear varios pol√≠gonos a partir de coordenadas Recursos para aprender m√°s Apuntes Libros Carga de mapas Una de las fuentes principales de datos geoespaciales son los shapefiles. Pero tambi√©n existen paquetes de R que contienen informaci√≥n geoespacial, para mayor conveniencia. Exploraremos ambas opciones a continuaci√≥n.\nCargar mapas de cualquier pa√≠s Si no tenemos o no queremos descargar shapes, podemos cargar mapas de cualquier pa√≠s directo en R gracias a {rnaturalearth}. Con este paquete obtenemos directamente mapas de cualquier pa√≠s del mundo, incluyendo sus estados o regiones internos, sin necesidad de descargas.\nInstala {rnaturalearth} si no lo tienes:\ninstall.packages(\u0026#34;rnaturalearth\u0026#34;) Puedes insertar el nombre de tu pa√≠s para seguir con este tutorial usando ejemplos de tu territorio.\n# install.packages(\u0026#34;rnaturalearth\u0026#34;) library(rnaturalearth) pais \u0026lt;- ne_states(\u0026#34;Argentina\u0026#34;) # pais \u0026lt;- ne_states(\u0026#34;Mexico\u0026#34;) # pais \u0026lt;- ne_states(\u0026#34;Colombia\u0026#34;) mapa \u0026lt;- pais |\u0026gt; # seleccionar columnas select(pais = admin, region = name_es, geometry) mapa Simple feature collection with 24 features and 2 fields Geometry type: MULTIPOLYGON Dimension: XY Bounding box: xmin: -73.57274 ymin: -55.05202 xmax: -53.66155 ymax: -21.78694 Geodetic CRS: WGS 84 First 10 features: pais region geometry 1 Argentina Entre R√≠os MULTIPOLYGON (((-58.20011 -... 12 Argentina Salta MULTIPOLYGON (((-68.49647 -... 13 Argentina Jujuy MULTIPOLYGON (((-67.25133 -... 741 Argentina Formosa MULTIPOLYGON (((-62.34136 -... 746 Argentina Misiones MULTIPOLYGON (((-54.66497 -... 749 Argentina Chaco MULTIPOLYGON (((-58.35127 -... 750 Argentina Corrientes MULTIPOLYGON (((-58.6042 -2... 1318 Argentina Catamarca MULTIPOLYGON (((-68.33776 -... 1320 Argentina La Rioja MULTIPOLYGON (((-69.65405 -... 1321 Argentina San Juan MULTIPOLYGON (((-69.95766 -... Cargar shapes Un shapefile es un formato de archivo com√∫n para datos geoespaciales, que en realidad consiste en una carpeta con archivos relacionados (.shp, .shx, .dbf, entre otros) que juntos representan la geometr√≠a y atributos de los objetos geogr√°ficos.\nTeniendo la carpeta, basta con cargarla con la funci√≥n read_sf().\nEjemplo de descarga y carga de un shapefile de Chile Para aprender, podemos descargar un shape y usarlo para practicar. Si no tienes uno a mano, en el siguiente bot√≥n podemos bajar un shapefile de Chile por regiones, que proviene de la Mapoteca de la Biblioteca del Congreso Nacional.\nDivision regional: pol√≠gonos de las regiones de Chile\nTambi√©n puedes descargarlo directamente desde R con download.file() y luego unzip(), como se indica en este post.\nUna vez descargado, descomprimimos el archivo y obtenemos una carpeta. Esta carpeta es nuestro shapefile, as√≠ que la guardamos dentro de nuestro proyecto de RStudio, idealmente dentro de una carpeta donde guardemos nuestros mapas.\n# descargar download.file(\u0026#34;https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip\u0026#34;, \u0026#34;Regiones.zip\u0026#34;) # descomprimir unzip(\u0026#34;Regiones.zip\u0026#34;, exdir = \u0026#34;shapes/Regiones\u0026#34;) En el siguiente ejemplo, guardamos el shapefile en una carpeta shapes, y lo cargamos con read_sf().\nmapa \u0026lt;- read_sf(\u0026#34;shapes/Regiones\u0026#34;) |\u0026gt; janitor::clean_names() mapa Simple feature collection with 17 features and 7 fields Geometry type: GEOMETRY Dimension: XY Bounding box: xmin: -12183900 ymin: -7554306 xmax: -7393644 ymax: -1978920 Projected CRS: WGS 84 / Pseudo-Mercator # A tibble: 17 √ó 8 objectid cir_sena codregion area_km st_area_sh st_length region * \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1084 1 15 16867. 18868687744. 750530. Regi√≥n de Arica ‚Ä¶ 2 1085 2 1 42285. 48306372203. 1213713. Regi√≥n de Tarapa‚Ä¶ 3 1086 3 2 126071. 150845155633 2516112. Regi√≥n de Antofa‚Ä¶ 4 1087 15 12 133053. 358131609833 90498304. Regi√≥n de Magall‚Ä¶ 5 1088 14 11 106703. 224274263072 41444811. Regi√≥n de Ays√©n ‚Ä¶ 6 1089 4 3 75661. 96439063562. 2401741. Regi√≥n de Atacama 7 1090 5 4 40576. 54980818749. 2065933. Regi√≥n de Coquim‚Ä¶ 8 1091 6 5 16323. 23014748571. 1679609. Regi√≥n de Valpar‚Ä¶ 9 1092 7 13 15392. 22252038246. 1064253. Regi√≥n Metropoli‚Ä¶ 10 1093 13 10 48408. 87718341940. 7874158. Regi√≥n de Los La‚Ä¶ 11 1094 12 14 18245. 31086613540. 1844423. Regi√≥n de Los R√≠‚Ä¶ 12 1095 11 9 31838. 52215073344. 1501025. Regi√≥n de La Ara‚Ä¶ 13 1096 10 8 24022. 38176117509. 2097147. Regi√≥n del B√≠o-B‚Ä¶ 14 1097 10 16 13104. 20376298459. 1074094. Regi√≥n de √ëuble 15 1098 9 7 30322. 45969426092. 1388328. Regi√≥n del Maule 16 1099 8 6 16349. 24090278437. 984853. Regi√≥n del Liber‚Ä¶ 17 1100 0 0 3937. 9306245194. 388722. Zona sin demarcar # ‚Ñπ 1 more variable: geometry \u0026lt;GEOMETRY [m]\u0026gt; Puedes seguir este tutorial independientemente del mapa que hayas cargado (el shape de Chile, con rnaturalearth, u otro shape que t√∫ elijas); lo importante es que cargues un objeto mapa que tenga columna geometry y region. Como vemos, una vez que cargamos los datos geoespaciales obtenemos una tabla con caracter√≠sticas especiales. Arriba de la tabla vemos una descripci√≥n de las caracter√≠sticas del mapa, el tipo de geometr√≠as, la caja o bounding box que enmarca los pol√≠gonos, y el sistema de referencia de coordenadas del mapa.\nEn {sf} los datos geoespaciales adem√°s contienen una columna geometry, que contiene las geometr√≠as (puntos, l√≠neas o pol√≠gonos) que definen la forma y ubicaci√≥n de los elementos geogr√°ficos. Vamos a trabajar con esta columna si queremos modificar la geometr√≠a de los elementos geoespaciales o calcular algo a partir de ellos. Cada fila de la tabla representa un objeto geogr√°fico (una regi√≥n, comuna, pa√≠s, etc.) y las dem√°s columnas son variables relacionadas al objeto geogr√°fico (poblaci√≥n, superficie, nombre, etc.)\nVisualizaci√≥n b√°sica de mapas Para visualizar un mapa con {sf} usamos la geometr√≠a geom_sf() dentro de un gr√°fico de {ggplot2}. Esta funci√≥n reconoce autom√°ticamente la columna geometry del objeto espacial, y dibuja las formas geogr√°ficas correspondientes.\nmapa |\u0026gt; ggplot() + geom_sf(fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FA\u0026#34;, linewidth = 0.1) Si necesitas aprender lo b√°sico de {ggplot2} para visualizaci√≥n de datos, revisa este completo tutorial. Operaciones sobre geometr√≠as Las operaciones sobre geometr√≠as permiten manipular y analizar las formas y ubicaciones de los objetos geogr√°ficos. A continuaci√≥n veremos algunas operaciones comunes que se pueden realizar con el paquete {sf} en R.\nCalcular centroide El centroide es el punto central de un pol√≠gono. Calcularlo sirve, por ejemplo, para ubicar una etiqueta de texto sobre un pol√≠gono, poner un punto sobre un territorio que crece con respecto a una variable, etc.\nmapa_centroide \u0026lt;- mapa |\u0026gt; select(region, geometry) |\u0026gt; mutate(centroide = st_centroid(geometry)) region centroide 1 Entre R√≠os POINT (-59.20493 -32.03189) 12 Salta POINT (-64.80661 -24.28824) 13 Jujuy POINT (-65.77985 -23.31783) 741 Formosa POINT (-59.94839 -24.89604) 746 Misiones POINT (-54.65212 -26.86956) 749 Chaco POINT (-60.77109 -26.39039) 750 Corrientes POINT (-57.79471 -28.76018) 1318 Catamarca POINT (-66.99006 -27.3092) 1320 La Rioja POINT (-67.21371 -29.66235) 1321 San Juan POINT (-68.88199 -30.82274) 1323 Mendoza POINT (-68.60826 -34.58944) 1328 Neuqu√©n POINT (-70.11374 -38.62865) 1333 Chubut POINT (-68.51499 -43.78523) 1335 R√≠o Negro POINT (-67.21765 -40.40738) 1337 Santa Cruz POINT (-69.8981 -48.76187) 1339 Tierra del Fuego POINT (-67.4401 -54.32625) 1726 Buenos Aires POINT (-60.54573 -36.66279) 1746 Buenos Aires POINT (-58.45093 -34.64272) 3852 Santa Fe POINT (-60.93513 -30.66904) 3853 Tucum√°n POINT (-65.36557 -26.9491) 3854 Santiago del Estero POINT (-63.2909 -27.71835) 3855 San Luis POINT (-66.03363 -33.74238) 3856 La Pampa POINT (-65.44562 -37.12691) 3857 C√≥rdoba POINT (-63.76859 -32.07319) Ver c√≥digo del gr√°fico mapa_centroide |\u0026gt; filter(region == mapa$region[3]) |\u0026gt; ggplot() + geom_sf(fill = \u0026#34;#9069C0\u0026#34;, linewidth = NA) + geom_sf( aes(geometry = centroide), size = 3, alpha = .6) + geom_sf_text( aes(geometry = centroide), label = \u0026#34;centroide\u0026#34;, size = 3, vjust = 2) Extraer longitud y latitud Para obtener las coordenadas (longitud y latitud) de un elemento espacial, necesitamos primero que sea un punto, porque un pol√≠gono es una figura compleja que no tiene solamente una latitud y una longitud. Si tenemos un pol√≠gono, primero calculamos el centroide, y luego extraemos las coordenadas con st_coordinates(). Como esta funci√≥n retorna la longitud y latitud de cada punto al mismo tiempo, tenemos que pedirle que entregue la una o la otra usando corchetes.\nmapa_centroide_coordenadas \u0026lt;- mapa_centroide |\u0026gt; mutate(lon = st_coordinates(centroide)[,1], lat = st_coordinates(centroide)[,2]) region lon lat 1 Entre R√≠os -59.20493 -32.03189 12 Salta -64.80661 -24.28824 13 Jujuy -65.77985 -23.31783 741 Formosa -59.94839 -24.89604 746 Misiones -54.65212 -26.86956 749 Chaco -60.77109 -26.39039 750 Corrientes -57.79471 -28.76018 1318 Catamarca -66.99006 -27.30920 1320 La Rioja -67.21371 -29.66235 1321 San Juan -68.88199 -30.82274 1323 Mendoza -68.60826 -34.58944 1328 Neuqu√©n -70.11374 -38.62865 1333 Chubut -68.51499 -43.78523 1335 R√≠o Negro -67.21765 -40.40738 1337 Santa Cruz -69.89810 -48.76187 1339 Tierra del Fuego -67.44010 -54.32625 1726 Buenos Aires -60.54573 -36.66279 1746 Buenos Aires -58.45093 -34.64272 3852 Santa Fe -60.93513 -30.66904 3853 Tucum√°n -65.36557 -26.94910 3854 Santiago del Estero -63.29090 -27.71835 3855 San Luis -66.03363 -33.74238 3856 La Pampa -65.44562 -37.12691 3857 C√≥rdoba -63.76859 -32.07319 Ver c√≥digo del gr√°fico mapa_centroide_coordenadas |\u0026gt; distinct(region, .keep_all = TRUE) |\u0026gt; mutate(region = forcats::fct_reorder(region, lat)) |\u0026gt; # ordenar regiones ggplot() + aes(lat, region) + geom_col(width = 0.7, fill = \u0026#34;#9069C0\u0026#34;) + geom_text(aes(label = region), size = 3, hjust = -0.05, color = \u0026#34;#EAD2FA\u0026#34;) + scale_y_discrete(labels = NULL) + labs(y = NULL, x = \u0026#34;Latitud\u0026#34;) Calcular buffer Un buffer es una zona alrededor de un objeto geogr√°fico, definida por una distancia espec√≠fica. Calcular un buffer es √∫til para analizar √°reas de influencia, proximidad a ciertos puntos o regiones, o para hacer modificiones sobre mapas con fines de visualizaci√≥n.\nCon la funci√≥n st_buffer() definimos el espacio en torno a un pol√≠gono, especificando en el argumento dist la distancia del buffer en las unidades del sistema de coordenadas del mapa (por ejemplo, metros si el mapa est√° en UTM), y con max_cells podemos controlar la calidad del pol√≠gono resultante.\nmapa_buffer \u0026lt;- mapa |\u0026gt; # filtrar una regi√≥n/pol√≠gono filter(region == mapa$region[3]) |\u0026gt; # crear buffer mutate(buffer = st_buffer(geometry, dist = 20000, max_cells = 10000)) Ver c√≥digo del gr√°fico mapa_buffer |\u0026gt; ggplot() + # capa de la regi√≥n geom_sf(aes(geometry = geometry), fill = \u0026#34;#9069C0\u0026#34;, linewidth = NA) + # capa del buffer geom_sf(aes(geometry = buffer), fill = \u0026#34;#9069C0\u0026#34;, alpha = 0.5, linewidth = NA) Calcular caja de un pol√≠gono Con la funci√≥n st_bbox() obtenemos las coordenadas de la caja que envuelve a un pol√≠gono o conjunto de pol√≠gonos. Esta caja est√° definida por las coordenadas m√≠nimas y m√°ximas en los ejes x (longitud) e y (latitud).\ncaja \u0026lt;- st_bbox(mapa) caja xmin ymin xmax ymax -73.57274 -55.05202 -53.66155 -21.78694 Convertir caja a pol√≠gono Teniendo una caja con sus coordenadas, podemos convertirla a un pol√≠gono para aplicarlo sobre (o debajo de) un mapa.\nrectangulo \u0026lt;- caja |\u0026gt; st_as_sfc(crs = st_crs(mapa)) Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FB\u0026#34;, linewidth = 0.1) + # capa con la caja encima geom_sf(data = rectangulo, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#9069C0\u0026#34;, linewidth = 0.8, alpha = 0.4) + # tema theme(axis.text = element_blank(), panel.background = element_blank()) Poner un punto en un mapa Si queremos poner puntos en posiciones espec√≠ficas de un mapa, s√≥lo necesitamos crear una tabla con las coordenadas de los puntos y convertir la tabla a sf con st_as_sf(). Al hacer esto, es necesario especificar el sistema de referencia de coordenadas (CRS) del mapa, para que los puntos se ubiquen correctamente. Hacemos esto extrayendo el CRS del mapa con st_crs() y aplic√°ndolo a nuestra nueva tabla sf.\n# definir coordenadas coordenadas \u0026lt;- tibble(longitud = -70, latitud = -38) # convertir tabla a sf punto \u0026lt;- coordenadas |\u0026gt; st_as_sf(coords = c(\u0026#34;longitud\u0026#34;, \u0026#34;latitud\u0026#34;), crs = st_crs(mapa)) Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FB\u0026#34;, linewidth = 0.1) + # capa con el punto geom_sf(data = punto, size = 3, alpha = .5) Poner varios puntos en un mapa Si necesitamos agregar m√°s de un punto, simplemente hacemos una tabla con todos los que necesitemos. Obviamente tambi√©n podemos especificar otras columnas que podemos usar para etiquetar los puntos, especificar sus colores, y m√°s.\ncoordenadas \u0026lt;- tribble(~nombre, ~lon, ~lat, ~n, \u0026#34;A\u0026#34;, -69, -38, 4, \u0026#34;B\u0026#34;, -65, -37, 6, \u0026#34;C\u0026#34;, -61, -36, 9) puntos \u0026lt;- coordenadas |\u0026gt; # convertir tabla a sf st_as_sf(coords = c(\u0026#34;lon\u0026#34;, \u0026#34;lat\u0026#34;), crs = st_crs(mapa)) Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FB\u0026#34;, linewidth = 0.1) + # capa con puntos geom_sf(data = puntos, aes(size = n), alpha = .5) + # capa con textos geom_sf_label(data = puntos, aes(label = nombre), size = 3, vjust = -0.8, fontface = \u0026#34;bold\u0026#34;) + # escala de tama√±o scale_size(range = c(3, 6), breaks = scales::breaks_pretty(n = 3)) + guides(size = guide_legend(override.aes = list(color = \u0026#34;#9069C0\u0026#34;, alpha = 1))) Crear un cuadrado Para poner un cuadrado encima de una ubicaci√≥n del mapa, primero creamos un punto, luego lo expandimos con un buffer, calculamos la caja que envuelve a dicho punto, y finalmente convertimos la caja en un pol√≠gono sf.\ncoordenadas \u0026lt;- tibble(longitud = -58, latitud = -38) punto \u0026lt;- coordenadas |\u0026gt; # convertir tabla a sf st_as_sf(coords = c(\u0026#34;longitud\u0026#34;, \u0026#34;latitud\u0026#34;), crs = st_crs(mapa)) cuadrado \u0026lt;- punto |\u0026gt; st_buffer(dist = 100000) |\u0026gt; # agrandar punto st_bbox() |\u0026gt; # crear caja al rededor st_as_sfc(crs = st_crs(mapa)) # convertir a sf Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FB\u0026#34;, linewidth = 0.1, alpha = .7) + # capa con puntos geom_sf(data = cuadrado, fill = NA, linewidth = 0.8, linejoin = \u0026#34;mitre\u0026#34;, #linejoin = \u0026#34;round\u0026#34;, color = \u0026#34;#402E5A\u0026#34;) + coord_sf(xlim = c(-72, -56), ylim = c(-40, -30)) Paso a paso, el proceso de crear el punto, agrandarlo, y formarlo en un cuadrado se ver√≠a as√≠:\nVer c√≥digo del proceso y del gr√°fico punto_grande \u0026lt;- punto |\u0026gt; st_buffer(dist = 100000, max_cells = 10000) cuadrado \u0026lt;- punto_grande |\u0026gt; st_bbox(crs = st_crs(mapa)) |\u0026gt; st_as_sfc() |\u0026gt; st_as_sf(crs = st_crs(mapa)) ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FB\u0026#34;, linewidth = 0.1) + # capas geom_sf(data = punto, color = \u0026#34;#402E5A\u0026#34;, size = 3) + geom_sf(data = punto_grande, fill = NA, color = \u0026#34;#402E5A\u0026#34;, lwd = 0.7) + geom_sf(data = cuadrado, fill = NA, color = \u0026#34;#402E5A\u0026#34;, lwd = 0.7) + # acercar mapa coord_sf(xlim = c(-61, -55), ylim = c(-40, -35.7)) Crear un rect√°ngulo a partir de puntos Si tenemos varios puntos y necesitamos crear un rect√°ngulo que los contenga a todos, podemos repetir lo anterior pero partiendo de varios puntos a la vez.\n# tabla con coordenadas coordenadas \u0026lt;- tribble(~nombre, ~lon, ~lat, ~n, \u0026#34;A\u0026#34;, -69, -38, 4, \u0026#34;B\u0026#34;, -65, -37, 6, \u0026#34;C\u0026#34;, -61, -36, 9) # convertir coordenadas a puntos puntos \u0026lt;- coordenadas |\u0026gt; # convertir tabla a sf st_as_sf(coords = c(\u0026#34;lon\u0026#34;, \u0026#34;lat\u0026#34;), crs = st_crs(mapa)) # convertir puntos a rect√°ndulo rectangulo \u0026lt;- puntos |\u0026gt; st_buffer(dist = 80000) |\u0026gt; # ampliar st_bbox() |\u0026gt; st_as_sfc(crs = st_crs(mapa)) Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#EBD2FB\u0026#34;, linewidth = 0.2, alpha = .7) + # capa con puntos geom_sf(data = puntos, alpha = .5) + geom_sf(data = rectangulo, fill = NA, color = \u0026#34;#402E5A\u0026#34;, lwd = 0.7) Crear un pol√≠gono a partir de coordenadas Teniendo una tabla con un conjunto de coordenadas, podemos unirlas para formar un pol√≠gono. Es decir, unir los puntos para conformar una figura geom√©trica cerrada. Para ello, usamos st_combine() para combinar las coordenadas en un solo elemento, y luego st_cast() para convertir esos puntos combinados en un pol√≠gono.\ncoordenadas \u0026lt;- tribble(~nombre, ~lon, ~lat, \u0026#34;A\u0026#34;, -68, -36, \u0026#34;B\u0026#34;, -64, -31, \u0026#34;C\u0026#34;, -60, -36) # convertir tabla a sf puntos \u0026lt;- coordenadas |\u0026gt; st_as_sf(coords = c(\u0026#34;lon\u0026#34;, \u0026#34;lat\u0026#34;), crs = st_crs(mapa)) poligono \u0026lt;- puntos |\u0026gt; # combinar coordenadas en un solo elemento summarise(geometry = st_combine(geometry)) |\u0026gt; # convertir puntos a pol√≠gono st_cast(\u0026#34;POLYGON\u0026#34;) Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#E0C7F0\u0026#34;, linewidth = 0.2, alpha = 0.7) + # capa con puntos geom_sf(data = puntos, alpha = .6) + # capa con pol√≠gono geom_sf(data = poligono, fill = \u0026#34;#402E5A\u0026#34;, color = \u0026#34;#402E5A\u0026#34;, lwd = 0.7, alpha = 0.7) Crear varios pol√≠gonos a partir de coordenadas Podemos realizar el mismo proceso anterior, pero agrupando los datos con group_by() para crear varios pol√≠gonos a la vez, de acuerdo a la variable de agrupaci√≥n (en este caso, tipo). Entonces, cuando usemos st_combine(), se combinar√°n las coordenadas de cada grupo por separado, y luego st_cast() convertir√° cada grupo de puntos combinados en un pol√≠gono distinto.\ncoordenadas \u0026lt;- tribble(~tipo, ~lon, ~lat, \u0026#34;Tri√°ngulo\u0026#34;, -68, -30, \u0026#34;Tri√°ngulo\u0026#34;, -64, -25, \u0026#34;Tri√°ngulo\u0026#34;, -60, -30, \u0026#34;Cuadrado\u0026#34;, -68, -38, \u0026#34;Cuadrado\u0026#34;, -60, -38, \u0026#34;Cuadrado\u0026#34;, -60, -32, \u0026#34;Cuadrado\u0026#34;, -68, -32) # convertir tabla a sf puntos \u0026lt;- coordenadas |\u0026gt; st_as_sf(coords = c(\u0026#34;lon\u0026#34;, \u0026#34;lat\u0026#34;), crs = st_crs(mapa)) poligono \u0026lt;- puntos |\u0026gt; # combinar coordenadas en elementos √∫nicos agrupados por una variable group_by(tipo) |\u0026gt; summarise(geometry = st_combine(geometry)) |\u0026gt; # convertir puntos a pol√≠gono st_cast(\u0026#34;POLYGON\u0026#34;) Ver c√≥digo del gr√°fico ggplot() + # mapa de fondo geom_sf(data = mapa, fill = \u0026#34;#9069C0\u0026#34;, color = \u0026#34;#E0C7F0\u0026#34;, linewidth = 0.2, alpha = 0.7) + # capa con pol√≠gonos de color geom_sf(data = poligono, aes(fill = tipo, color = tipo), lwd = 0.6, alpha = .7) + # capa con puntos geom_sf(data = puntos, alpha = .4) + # escala de colores labs(fill = \u0026#34;Tipo\u0026#34;, color = \u0026#34;Tipo\u0026#34;) + theme(legend.key.spacing.y = unit(1, \u0026#34;mm\u0026#34;)) ‚ö†Ô∏è Este tutorial se encuentra en construcci√≥n ‚ö†Ô∏è Recursos para aprender m√°s Apuntes Libros Drawing beautiful maps programmatically with R, sf and ggplot2 Geocomputation with R Spatial Data Science With Applications in R Using Spatial Data with R ","date":"2025-10-22T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/mapas_sf/","tags":"mapas ; visualizaci√≥n de datos","title":"Mapas y visualizaci√≥n de datos geoespaciales en R con {sf}"},{"content":"Cuando estamos limpiando datos frecuentemente nos preguntamos cu√°ntos datos perdidos tiene una columna. La respuesta se obtiene pidiendo un resumen (summarize()) que cuente la suma de datos perdidos (sum(is.na())) en una columna espec√≠fica.\nlibrary(dplyr) # contar datos perdidos en una columna iris |\u0026gt; summarize( missings = sum(is.na(Sepal.Length)) ) missings 1 0 ¬øPero qu√© pasa si tienes muchas columnas y quieres revisarlo en todas? No vas a andar escribiendo las columnas una por una\u0026hellip; üòµ‚Äçüí´\nUsando las funci√≥n across() de {dplyr}, podemos aplicar la misma operaci√≥n a todas las columnas de un dataframe, y as√≠ obtener el conteo de datos perdidos de todas las columnas.\nPrimero creemos datos perdidos al azar con el paquete {messy} para ensuciar datos:\nlibrary(messy) iris_m \u0026lt;- messy::make_missing(iris) Ahora con summarize() calculamos un resumen de datos (es decir, reducir las filas de la tabla a un s√≥lo resultado), especificando con across() que el resumen ser√° a trav√©s de todas las columnas (everything()), y finalmente pedimos que el resumen sea la suma (sum()) de los datos de cada columna (.x) que son missing is.na().\nlibrary(dplyr) iris_m |\u0026gt; # resumir los datos summarize( # a trav√©s de todas las columnas across( everything(), # contar la cantidad de missings ~sum(is.na(.x)) ) ) Sepal.Length Sepal.Width Petal.Length Petal.Width Species 1 15 17 10 12 21 El mismo c√≥digo sirve si quieres contar todos los ceros, o todos los valores infinitos, etc.\n# contar los ceros iris_m |\u0026gt; summarize( across(everything(), ~sum(.x == 0, na.omit = TRUE) )) Sepal.Length Sepal.Width Petal.Length Petal.Width Species 1 NA NA NA NA NA # contar infinitos iris_m |\u0026gt; summarize( across(everything(), ~sum(is.infinite(.x)) )) Sepal.Length Sepal.Width Petal.Length Petal.Width Species 1 0 0 0 0 0 # etc Si quieres saber los datos perdidos s√≥lo en las columnas num√©ricas, en vez de everything() puedes usar where(is.numeric), o si necesitas saberlo en un conjunto de columnas espec√≠ficas, usa starts_with() o pon sus nombres dentro de c().\nTambi√©n hay otras formas de revisar datos perdidos, como por ejemplo con el paquete {visdat} que resume tus datos visualmente.\n","date":"2025-10-21T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-10-21/","tags":"datos perdidos ; limpieza de datos","title":"Contar datos perdidos en una o varias columnas"},{"content":"Cuando desarrollamos reportes, gr√°ficos o aplicaciones en R, necesitamos hacer que nuestros textos se adapten a los datos que estamos analizando.\nSi tenemos que poner texto sobre una cantidad de elementos, tenemos que escribir en singular o plural dependiendo de la cantidad (1 gato, 2 gatos).\nPor ejemplo, si tenemos un objeto cantidad que contiene el n√∫mero de gatos, y queremos escribir un texto que diga \u0026ldquo;gato\u0026rdquo; o \u0026ldquo;gatos\u0026rdquo; dependiendo de la cantidad, podemos usar la funci√≥n ifelse():\ncantidad \u0026lt;- 12 singular \u0026lt;- \u0026#34;gato\u0026#34; plural \u0026lt;- \u0026#34;gatos\u0026#34; texto \u0026lt;- ifelse(cantidad == 1, yes = singular, no = plural) texto [1] \u0026quot;gatos\u0026quot; Para evitar repetir el c√≥digo cada vez que necesitemos escribir en singular o plural, creamos una funci√≥n llamada plural(), que recibe como argumentos la cantidad n, y luego el texto en singular y en plural, y dependiendo de la cantidad se retornar√° el texto apropiado:\nplural \u0026lt;- function(n, singular, plural) { ifelse(n == 1, singular, plural) } plural(1, \u0026#34;gato\u0026#34;, \u0026#34;gatos\u0026#34;) [1] \u0026quot;gato\u0026quot; plural(3, \u0026#34;gato\u0026#34;, \u0026#34;gatos\u0026#34;) [1] \u0026quot;gatos\u0026quot; Podemos mejorar esta funci√≥n agregando una validaci√≥n para chequear que la cantidad sea realmente un n√∫mero, y podemos mejorar el ifelse() haciendo que el argumento plural sea opcional, y si no se entrega, la funci√≥n agregue una \u0026ldquo;s\u0026rdquo; al final del texto en singular para formar el plural.\nplural \u0026lt;- function(n, singular, plural = NULL) { # validaci√≥n if (!is.numeric(n)) stop(\u0026#34;se requiere un valor num√©rico\u0026#34;) # si la cantidad es 1, singular ifelse(n == 1, singular, # si la cantidad es mayor a 1 ifelse( # pero no se defini√≥ el plural, agregar \u0026#34;s\u0026#34; is.null(plural), paste0(singular, \u0026#34;s\u0026#34;), # de lo contrario, usar el plural plural) ) } plural(3, \u0026#34;gato\u0026#34;) [1] \u0026quot;gatos\u0026quot; plural(1, \u0026#34;gato\u0026#34;) [1] \u0026quot;gato\u0026quot; El uso de esta funci√≥n ser√≠a m√°s o menos algo as√≠:\nn \u0026lt;- 23 paste(\u0026#34;Existe un total de\u0026#34;, n, plural(n, \u0026#34;gato\u0026#34;), \u0026#34;en la vivienda.\u0026#34;) [1] \u0026quot;Existe un total de 23 gatos en la vivienda.\u0026quot; Para adecuarnos a la posibilidad de que la cantidad sea cero, creamos una nueva funci√≥n que use la funci√≥n anterior plural() si la cifra es igual o mayor a 1, o si no, retorna un texto distinto.\nn \u0026lt;- 4 cantidad \u0026lt;- function(n, singular) { # si la cantidad es missing o cero ifelse(is.na(n) | n == 0, # anteponer \u0026#34;ning√∫n\u0026#34; a la cifra paste(\u0026#34;ning√∫n\u0026#34;, singular), # si la cantidad es 1 o m√°s, usar la funci√≥n plural # anteponiento la cifra paste(n, plural(n, singular)) ) } Probemos distintos casos:\nn \u0026lt;- 6 cantidad(n, \u0026#34;gato\u0026#34;) [1] \u0026quot;6 gatos\u0026quot; n \u0026lt;- 1 cantidad(n, \u0026#34;gato\u0026#34;) [1] \u0026quot;1 gato\u0026quot; n \u0026lt;- NA cantidad(n, \u0026#34;gato\u0026#34;) [1] \u0026quot;ning√∫n gato\u0026quot; Todo lo anterior fue una excusa para ‚ú®aprender‚ú®, porque existe una mejor opci√≥n: usar la funci√≥n pluralize() del paquete {cli}, que soluciona el problema (a cambio de tener que cargar un paquete m√°s).\nlibrary(cli) cantidad \u0026lt;- 3 pluralize(\u0026#34;Total de {cantidad} gato{?s}.\u0026#34;) Total de 3 gatos. cantidad \u0026lt;- 1 pluralize(\u0026#34;Total de {cantidad} gato{?s}.\u0026#34;) Total de 1 gato. ","date":"2025-10-21T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-10-21b/","tags":"texto","title":"Redactar palabras en plural en R"},{"content":" √çndice Instalaci√≥n Configurar un proveedor de IA/modelo de lenguaje Opci√≥n A: instalar un modelo de lenguaje local desde R Opci√≥n B: configurar un proveedor de IA en la nube Variables de entorno Guardar configuraci√≥n del modelo Configurar atajo de teclado Usar {gander} Ejemplo de uso {gander} es un paquete de R para integrar asistentes de inteligencia artificial (IA) directamente en RStudio. Solo con presionar una combinaci√≥n de teclas, podr√°s pedirle a un asistente con tus propias palabras que escriba c√≥digo, corrija tu c√≥digo, o incluso que genere gr√°ficos.\nSe trata de una herramienta capaz de acelerar tu trabajo escribi√©ndote c√≥digo, ayud√°ndote a salir de bloqueos mentales, y solucionando problemas en los que usualmente perdemos tiempo tipeando.\nPasos a seguir: tienes que configurar su acceso a un modelo de lenguaje (como OpenAI, Anthropic, Copilot, o un modelo local como Llama), luego configurar el atajo de teclado para invocarlo, y listo!\nC√≥mo funciona: en vez de tener que copiar tu c√≥digo e ir pidi√©ndole a una IA que te ayude, {gander} se conecta directamente a la IA para entregarle lo que le pides, y te lo entrega directo en tu c√≥digo. Pero adem√°s le entrega al modelo informaci√≥n contextual sobre tu proyecto que har√° que el c√≥digo recibido se adec√∫e a tu entorno de R. Esto significa que el modelo sabr√° los objetos que tienes cargados, sus columnas, y m√°s, por lo que las respuestas ser√°n mucho m√°s √∫tiles.\nLa idea principal es que puedes seleccionar tu c√≥digo en R, o invocarlo en una l√≠nea nueva, y presionar una combinaci√≥n de teclas para abrir una ventana en la que puedes escribir tu solicitud. Presionas enter y el modelo te entrega el c√≥digo directamente en RStudio, ya sea reemplazando el c√≥digo que ten√≠as seleccionado, o agregando c√≥digo en el punto que le pediste.\nInstalaci√≥n Instala el paquete con:\ninstall.packages(\u0026#34;gander\u0026#34;) Una vez instalado, aparecer√° en el bot√≥n Addins, porque se trata de un paquete que entrega funcionalidades extras a RStudio.\nPero antes de usarlo hay que configurar dos cosas: la IA que usar√°, y las teclas para invocarlo ‚ú®\nConfigurar un proveedor de IA/modelo de lenguaje Para conectar la IA a {gander}, tenemos dos opciones: usar un modelo de IA local, o usar un proveedor de IA en la nube.\nOpci√≥n A: instalar un modelo de lenguaje local desde R Si tu computador tiene una tarjeta de video lo suficientemente grande (m√°s de 16GB de memoria de video), si quieres usar IA gratis, o si prefieres no usar modelos en la nube por privacidad, puedes instalar un modelo de lenguaje localmente en tu equipo.\nEl modelo Llama 3.2 tiene 3 billones de par√°metros, por lo que puede correr localmente en varios equipos. Para instalar un modelo localmente en tu equipo desde R, primero tienes que instalar Ollama en tu equipo, abrir la aplicaci√≥n, y luego instalar el paquete de R {ollamar} para descargar un modelo de lenguaje local desde R.1\nSi no tienes un modelo instalado, usa este comando para descargar e instalar un modelo desde R:\nlibrary(ollamar) pull(\u0026#34;llama3.2:3b\u0026#34;) Es necesario tener la aplicaci√≥n Ollama abierta en tu computadora, dado que √©sta aplicaci√≥n es la que le entrega el modelo de lenguaje a R.\nOpci√≥n B: configurar un proveedor de IA en la nube Para conectarte a un proveedor en la nube de IA, como ChatGPT y otros, necesitas darle a R la API key o clave de acceso. Como esta clave es privada (nadie m√°s la deber√≠a ver!), la mejor forma de guardarla es en las variables de entorno de R.\nVariables de entorno Las variables de entorno son variables definidas en un archivo .Renviron que est√° fuera de tus proyectos de R, y que permanece oculto y no se sube a GitHub ni similares. Puedes editar este archivo ejecutando usethis::edit_r_environ(). Se abrir√° un script en el que puedes agregar variables disponibles para todos tus proyectos de R.\nLas variables de entorno se definen sin comillas, siguiendo este formato VARIABLE=valor. Por ejemplo, para guardar una clave de API de ChatGPT (OpenAI) en tus variables de entorno, agrega la siguiente l√≠nea en tu archivo .Renviron:\nOPENAI_API_KEY=345345398475937434534539847593743453453984759374 Si tu proveedor es Claude (Anthropic), el nombre de la variable es ANTHROPIC_API_KEY, etc.\nGuardar configuraci√≥n del modelo Ahora que tienes tu modelo de lenguaje listo, tienes que indicarle a {gander} qu√© modelo usar. Esto lo haces configurando la opci√≥n .gander_chat en R. Pero la gracia es configurar √©sto una sola vez y que quede siempre configurado, como veremos a continuaci√≥n.\nSimilar a las variables de entorno, el perfil de R es un script global de R llamado .Rprofile, que no se ubica en un proyecto de R espec√≠fico, sino que se guarda en tu carpeta de usuario y por ende aplica a todos tus proyectos de R. El c√≥digo del perfil de R se ejecuta autom√°ticamente cada vez que abras un proyecto o crees una sesi√≥n de R nueva. Es el lugar perfecto para guardar algo que necesites que siempre se ejecute en todos tus proyectos, como definir configuraciones y similares.\nPara editar tu perfil de R, ejecuta usethis::edit_r_profile(). Se abrir√° un script en el que puedes agregar c√≥digo que se ejecutar√° cada vez que inicies una sesi√≥n de R.\nAgrega una l√≠nea para decirle a {gander} que use el modelo que elijas:\noptions(.gander_chat = ellmer::chat_ollama(model = \u0026#34;llama3.2:3b\u0026#34;)) O si usas ChatGPT:\noptions(.gander_chat = ellmer::chat_openai()) Personalmente uso Copilot, as√≠ que pongo ellmer::chat_copilot().\nPara conocer otras formas de usar la integraci√≥n de IA con R, revisa este post sobre {ellmer} Configurar atajo de teclado Un paso clave para poder integrar r√°pidamente IA en tu flujo de trabajo es configurar un atajo de teclado para invocar a {gander}.\nPara esto, entra al men√∫ Tools de RStudio, presiona Modify Keyboard Shortcuts, y en la ventana que se abre busca gander. Se sugiere configurar algo como shift+comando+G en Mac1 o control+alt+G en Windows.\nUsar {gander} Ahora que tienes todo configurado, ya puedes usar {gander}!\nSelecciona c√≥digo, o pon el cursor de texto en cualquier parte de tu script, y presiona el atajo que configuraste üò±\nSe abrir√° una ventana para escribir lo que necesites pedirle al asistente. Usa tus propias paralabras para especificar la tarea que quieres lograr.\nEscribe algo como:\ntransforma estos datos a formato wide crea un gr√°fico de barras con estos datos recodifica la variable g√©nero limpia los datos de la columna nombre exporta los datos a formato Excel Presiona enter, y el modelo te entregar√° los resultados de inmediato! üéâ Adem√°s, si usas proveedores de IA, lograste que se consumieran 200ml de agua! ü§ë\nEjemplo de uso En este ejemplo, con tan s√≥lo seleccionar el c√≥digo e invocar {gander} con shift+comando+G, se abre una ventana a la que le pido que transforme y recodifique los datos, y luego que haga un gr√°fico.\nMagia? No! Estad√≠sticas! Yey! ü•≥\nPara m√°s paquetes y herramientas de modelos de lenguaje e IA en R, revisa Large Language Model tools for R, de Luis D. Verde Arregoitia. Si tu computador no es muy poderoso, te recomiendo instalar llama3.2:1b (m√°s liviano) o llama3.2:3b (un poco mejor), pero si tienes suficiente memoria y tarjeta de video, puedes instalar llama3.1:8b.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-10-20T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/gander/","tags":"inteligencia artificial ; consejos","title":"Acelera tus an√°lisis con {gander}, un asistente de IA integrado en RStudio"},{"content":"Por fin tuve un respiro en el trabajo, as√≠ que aprovech√© de darle una manito de gato a este sitio. Cambi√© algunas cosas est√©ticas menores y algunas funcionalidades que ten√≠a pendientes de hace tiempo.\nAgregu√© al inicio del sitio un panel que contiene las etiquetas o tags m√°s usados en el blog, para indicar los temas que trato en los posts y para que la gente interesada pueda llegar a los posts.\nPude hacerlo gracias a estas instrucciones.\nTambi√©n agregu√© otro panel con las etiquetas de los posts en la parte lateral de la p√°gina del blog, para usar ese espacio vac√≠o y destacar los temas principales.\nComo se ve en la foto anterior, tambi√©n he ido agregando m√°s botones con enlaces relacionados a cada post, incluyendo snippets de c√≥digo para quienes solo quieren copiar y pegar en R (v√°lido).\nPor fin le agregu√© un contador de visitas de c√≥digo abierto y enfocado en privacidad, GoatCounter üêê para monitorear el tr√°fico del sitio. Pude hacerlo gracias a estas instrucciones para agregar contador de visita a sitios Hugo. Por opci√≥n personal no uso Google Analytics ni ning√∫n otro servicio que afecte la privacidad de las personas que visitan el sitio ni que usen esos datos con fines comerciales. Quiz√°s despu√©s haga un dashboard para ver las visitas o algo as√≠.\nFinalmente, tengo algunos bocetos de posts grandes para el futuro pr√≥ximo, principalmente uno sobre procesamiento de datos geoespaciales en R, que voy complementando a medida que aprendo yo misme üòå\nEste sitio naci√≥ porque yo aprend√≠ R de forma autodidacta, gracias a lo que compart√≠an otras personas. As√≠ que quise ayudar tambi√©n a que m√°s gente aprendiera a usar R para an√°lisis de datos.\nCon el tiempo, me di cuenta que el sitio tambi√©n me sirve a mi como referencia: muy seguido entro a mi blog buscando mi propio c√≥digo para copiarlo! Espero que les sirva üíú\nComo siempre, el c√≥digo entero de este sitio est√° en su repositorio.\n","date":"2025-10-16T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-10-16/","tags":"blog","title":"Actualizaci√≥n del blog: etiquetas"},{"content":" En un post anterior habl√© sobre c√≥mo hacer validaci√≥n b√°sica de datos en R. A grandes razgos, vimos la utilidad de crear funciones que contengan pruebas simples para validar la calidad de tus datos, tales como revisar cantidad de filas, cantidad de datos perdidos, y otros.\nDado que R es un lenguaje enfocado en el an√°lisis de datos, existen varios paquetes que nos pueden ayudar con la validaci√≥n de datos!\nEn este post veremos {testthat}, un paquete que facilita implementar pruebas unitarias a tu c√≥digo para validar su funcionamiento, y {pointblank}, un paquete dise√±ado para la validaci√≥n de datos con poderosas capacidades de reportabilidad. En unos minutos aprender√°s a usar este paquete para garantizar que tus datos cumplen con tus expectativas de calidad.\n¬øPara qu√© sirve la validaci√≥n de datos? Para que, en cualquier punto de tus procesos de an√°lisis de datos, puedas verificar si los datos cumplen con los criterios de calidad que t√∫ definas, y as√≠ enterarte de si vienen como esperas o si es que traen sorpresas. En la validaci√≥n de datos se crean pruebas para, por ejemplo, confirmar que una columna no tenga datos perdidos, que los valores de una columna est√©n dentro de un rango esperado, etc√©tera.\nAl crear una serie de pruebas, podemos automatizar el proceso de validaci√≥n de datos. De esta forma, si modificamos nuestro c√≥digo, o si cambian los datos, no necesitamos revisar manualmente que todo est√© en orden, sino que tenemos una especie de protocolo para certificar que los datos son los esperados. Cada vez que hagamos cambios en el c√≥digo, podemos ejecutar las pruebas para confirmar que todo sigue funcionando como se espera.\n√çndice Datos de ejemplo Validaci√≥n con {testthat} Estructura del c√≥digo Crear pruebas unitarias Ejemplos de pruebas unitarias para validaci√≥n de datos Uso completo Uso simple Conclusi√≥n de {testthat} para validaci√≥n de datos Validaci√≥n de datos con {pointblank} Reportes de validaci√≥n de datos Ejemplo de validaci√≥n de datos sucios Crear un plan b√°sico de validaci√≥n de datos Conclusiones Recursos para aprender {pointblank} Datos de ejemplo Creemos una peque√±a tabla para aprender a validar datos:\nlibrary(dplyr) datos \u0026lt;- tribble(~animal, ~patas, ~lindura, ~color, \u0026#34;mapache\u0026#34;, \u0026#34;4\u0026#34;, 100, \u0026#34;gris\u0026#34;, \u0026#34;gato\u0026#34;, \u0026#34;80\u0026#34;, 90, \u0026#34;negro\u0026#34;, \u0026#34;pollo\u0026#34;, \u0026#34;2\u0026#34;, NA, \u0026#34;plumas\u0026#34;, \u0026#34;rata\u0026#34;, \u0026#34;cuatro\u0026#34;, 90, \u0026#34;#CCCCCC\u0026#34;) De inmediato podemos ver en esta tabla creada con tribble() que hay varios problemas: la columna patas viene como caracteres, hay datos perdidos en lindura, y hay un color hexadecimal en color. Pero nos damos cuenta de √©sto porque la tabla contiene pocos datos. Cuando trabajemos con miles o millones de observaciones, se vuelve m√°s dif√≠cil detectar este tipo de problemas. Ah√≠ es cuando la validaci√≥n de datos nos puede ayudar!\nValidaci√≥n con {testthat} A pesar de que {testthat} se usa en general para el desarrollo de paquetes, y se enfoca a validar que c√°lculos y m√©todos estad√≠sticos funcionen como es esperado, igual se puede usar para validar en proyectos de an√°lisis de datos.\nEstructura del c√≥digo Asumiendo que nuestro proyecto posee varios scripts donde se procesan los datos, la idea general ser√° crear scripts con pruebas, y periodicamente ejecutar estos scripts de pruebas para confirmar que todo est√© en orden.\nPrimero necesitamos crear una carpeta para los tests, y scripts con pruebas para cada script o paso en nuestro flujo de trabajo que queramos validar. Podemos hacerlo a mano, o bien crear una carpeta para las pruebas con fs::dir_create(), y dentro creamos los scripts que necesitemos con fs::file_create(), siguiendo la convenci√≥n de anteponer test- al nombre de cada script de pruebas.\nSe recomienda crear un script de pruebas por cada script de nuestro proyecto: si tenemos un script llamado datos.R, creamos un script de pruebas llamado test-datos.R dentro de la carpeta tests/. Dentro de este script empezamos a dise√±ar las pruebas unitarias. Las pruebas unitarias son pruebas que validan que una unidad espec√≠fica de c√≥digo (una funci√≥n, un c√°lculo, una transformaci√≥n de datos) funcione como se espera.\nCrear pruebas unitarias Usamos la funci√≥n test_that() para definir cada prueba, indicando primero el nombre de la prueba. Dentro, usamos funciones como expect_true(), expect_equal(), expect_type(), para declarar que esperamos que luego de cierta operaci√≥n ocurra algo. Por ejemplo: espero (expect) que mi tabla tenga una columna determinada, o que una columna sea de cierto tipo. Estas son las condiciones que deben cumplirse para que la prueba pase.\nVeamos un ejemplo de una prueba:\nlibrary(testthat) Attaching package: 'testthat' The following object is masked from 'package:dplyr': matches test_that(\u0026#34;n√∫meros iguales\u0026#34;, expect_equal(4, 4) ) Test passed üåà Esta prueba eval√∫a si dos n√∫meros son iguales (expect_equal()), y en este ejemplo se cumple: {testthat} nos entrega un emoji de celebraci√≥n üéâ Veamos la siguiente prueba:\ntest_that(\u0026#34;n√∫meros desiguales\u0026#34;, expect_equal(4, 5) ) ‚îÄ‚îÄ Failure: n√∫meros desiguales ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 4 not equal to 5. 1/1 mismatches [1] 4 - 5 == -1 Error: ! Test failed Como la prueba no se cumple, porque 4 es distinto a 5, y la prueba nos dar√° un error explicando en d√≥nde est√° el problema.\nEjemplos de pruebas unitarias para validaci√≥n de datos Apliquemos pruebas similares a los datos de ejemplo, dentro de un script que se llame tests/test-datos.R, donde cargamos los datos (es importante que el script sea reproducible, ya que no lee los datos desde tu entorno sino que los carga en su propio entorno) y luego hacemos las pruebas:\n# c√≥digo para que el script de pruebas cargue los datos # datos \u0026lt;- readr::read_rds(\u0026#34;datos.rds\u0026#34;) # esperamos que exista un objeto llamado \u0026#34;datos\u0026#34; test_that(\u0026#34;se cargaron los datos\u0026#34;, expect_true(exists(\u0026#34;datos\u0026#34;)) ) Test passed üòÄ # esperamos que el n√∫mero de columnas sea 4 test_that(\u0026#34;suficientes columnas\u0026#34;, expect_equal(ncol(datos), 4) ) Test passed ü•á # esperamos que la columna `animal` sea tipo caracter test_that(\u0026#34;columnas tipo texto\u0026#34;, expect_type(datos$animal, \u0026#34;character\u0026#34;) ) Test passed ü•á # esperamos que la columna `patas` sea tipo num√©rico test_that(\u0026#34;columnas tipo texto\u0026#34;, expect_type(datos$patas, \u0026#34;numeric\u0026#34;) ) ‚îÄ‚îÄ Failure: columnas tipo texto ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ datos$patas has type 'character', not 'numeric'. Error: ! Test failed # esperamos que los colores est√©n dentro de un conjunto determinado test_that(\u0026#34;colores factibles\u0026#34;, expect_in(datos$color, c(\u0026#34;negro\u0026#34;, \u0026#34;gris\u0026#34;, \u0026#34;blanco\u0026#34;, \u0026#34;amarillo\u0026#34;, \u0026#34;caf√©\u0026#34;)) ) ‚îÄ‚îÄ Failure: colores factibles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ datos$color (`actual`) isn't fully contained within c(\u0026quot;negro\u0026quot;, \u0026quot;gris\u0026quot;, \u0026quot;blanco\u0026quot;, \u0026quot;amarillo\u0026quot;, \u0026quot;caf√©\u0026quot;) (`expected`). * Missing from `expected`: \u0026quot;plumas\u0026quot;, \u0026quot;#CCCCCC\u0026quot; * Present in `expected`: \u0026quot;negro\u0026quot;, \u0026quot;gris\u0026quot;, \u0026quot;blanco\u0026quot;, \u0026quot;amarillo\u0026quot;, \u0026quot;caf√©\u0026quot; Error: ! Test failed Una vez que guardamos este script, podemos ejecutar sus pruebas manualmente, o bien podemos usar test_file(\u0026quot;tests/test-script.R\u0026quot;) para ejecutar todas las pruebas de un script, o test_dir(\u0026quot;tests.R\u0026quot;) para ejecutar todas las pruebas de la carpeta de pruebas, validando tu proyecto entero de una sola vez.\nA partir de las pruebas que definimos podemos confirmar que hay problemas en las columnas patas y color, ya que no cumplen con las expectativas que definimos en las pruebas.\nPodemos ejecutar las funciones que realizan la validaci√≥n desde donde m√°s nos resulte conveniente: desde alg√∫n script principal de nuestro proyecto, desde un script tests.R espec√≠fico para ejecutar las pruebas, al final de cada script del proyecto, al final de un script donde ejecutemos todo el procesamiento de nuestro proyecto, o manualmente.\nUso completo üí° Lo que yo har√≠a ser√≠a algo as√≠ como agregar un test_file() al final del script de limpieza de datos, que confirme que la limpieza sali√≥ bien, en otro script donde procese datos tendr√≠a otro test_file() con pruebas relacionadas a este paso, etc√©tera.\nOtra opci√≥n es guardar los scripts de pruebas en tests y ejecutar todos los scripts de pruebas con test_dir(\u0026quot;tests/\u0026quot;), en cuyo caso {testthat} arroja un resumen de los resultados.\nTambi√©n, al guardar un script con pruebas, RStudio se da cuenta y aparece el bot√≥n Run Tests en la parte superior derecha del script.\nUso simple Si queremos hacerlo todo m√°s simple, simplemente usemos las funciones testthat::expect_x() entremedio del c√≥digo, de modo que si la prueba falla, arroja error, pero si no falla, no pasa nada. En este sentido, funciona igual que stopifnot(), pero para mi resulta mucho m√°s claro (esa funci√≥n me confunde mucho üò£). Con expect_x() declaramos: esperamos que lo siguiente retorne TRUE, y si las cosas se dan as√≠, no pasa nada y la vida sigue.\ntestthat::expect_equal(n_distinct(iris$Species), 3) testthat::expect_equal(n_distinct(iris$Species), 4) Error: n_distinct(iris$Species) not equal to 4. 1/1 mismatches [1] 3 - 4 == -1 Conclusi√≥n de {testthat} para validaci√≥n de datos Con {testthat} podemos crear un flujo de trabajo que incluya la validaci√≥n de datos a nuestros proyectos, con funciones e interfaz amigable que te dan un golpe de dopamina cuando aparece el mensajito verde con el emoji de felicitaci√≥n. Si bien es ampliamente usado en la comunidad de R, su uso principal no es la validaci√≥n de datos, por lo que ahora veremos un segundo paquete especialmente dise√±ado para ello.\nValidaci√≥n de datos con {pointblank} A diferencia de {testthat}, el paquete {pointblank} est√° dise√±ado para evaluar la calidad de conjuntos de datos. Sirve para definir pruebas que validen que los datos cumplen con ciertos est√°ndares, integrando las pruebas en cadenas de comandos unidos por conectores o pipes (|\u0026gt; o %\u0026gt;%), y se destaca por su capacidad de crear agentes que generan reportes autom√°ticos de validaci√≥n de datos.\nLas funciones de validaci√≥n de {pointblank} sirven para integrarlas en pipelines. Si se pasa la prueba, el proceso contin√∫a, pero si la prueba falla, el proceso se detiene y te avisa. Probemos la validaci√≥n de algunos aspectos de la tabla de ejemplo:\nlibrary(pointblank) datos |\u0026gt; col_is_numeric(lindura) |\u0026gt; col_is_character(c(animal, color)) |\u0026gt; col_vals_in_set(animal, set = c(\u0026#34;perro\u0026#34;, \u0026#34;gato\u0026#34;, \u0026#34;sapo\u0026#34;, \u0026#34;pollo\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;pez\u0026#34;, \u0026#34;rata\u0026#34;)) # A tibble: 4 √ó 4 animal patas lindura color \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 mapache 4 100 gris 2 gato 80 90 negro 3 pollo 2 NA plumas 4 rata cuatro 90 #CCCCCC Obtenemos de vuelta la tabla de datos, porque impl√≠citamente las tres pruebas se pasaron correctamente. Es decir, si todo est√° correcto, seguimos con nuestros procesos.\nProbemos qu√© pasa si incluimos pruebas m√°s estrictas que nuestra humilde tabla no podr√° pasar:\ndatos |\u0026gt; col_is_numeric(lindura) |\u0026gt; col_is_character(c(animal, color)) |\u0026gt; col_vals_in_set(animal, set = c(\u0026#34;perro\u0026#34;, \u0026#34;gato\u0026#34;, \u0026#34;sapo\u0026#34;, \u0026#34;pollo\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;pez\u0026#34;, \u0026#34;rata\u0026#34;)) |\u0026gt; col_vals_in_set(patas, set = 2:100) |\u0026gt; col_vals_not_null(lindura) Error: Exceedance of failed test units where values in `patas` should have been in the set of `2`, `3`, `4` (and 96 more). The `col_vals_in_set()` validation failed beyond the absolute threshold level (1). * failure level (1) \u0026gt;= failure threshold (1) Recibimos un aviso que indica un exceso de test fallidos, y una explicaci√≥n de lo que fall√≥. El paquete ofrece la posibilidad de ajustar o soltar el nivel de dificultad de las pruebas, por ejemplo, para permitir un cierto porcentaje de problemas, pero avisar si este nivel se supera.\nVeamos otro ejemplo de pruebas aplicadas a un pipeline: aqu√≠ intentamos corregir uno de los problemas con los datos, detectado con una de las pruebas anteriores, y aplicamos nuevamente la prueba para confirmar que qued√≥ bien:\ndatos |\u0026gt; # corregir mutate(lindura = tidyr::replace_na(lindura, mean(lindura, na.rm = TRUE))) |\u0026gt; # probar col_vals_not_null(lindura) # A tibble: 4 √ó 4 animal patas lindura color \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 mapache 4 100 gris 2 gato 80 90 negro 3 pollo 2 93.3 plumas 4 rata cuatro 90 #CCCCCC En otras palabras, corregimos los datos e inmediatamente probamos que la correcci√≥n funciona, sin necesidad de revisar manualmente.\nAlternativamente existen variedades de las funciones de validaci√≥n que empiezan con test_, y que retornan TRUE o FALSE dependiendo de si se cumple o no la prueba. Sirven para usarlas dentro de condicionales if, o dentro de funciones if() o ifelse(). Por ejemplo, puede usarse en un if para aplicar una correcci√≥n si la prueba no se cumple.\nReportes de validaci√≥n de datos Aparte de las funciones de validaci√≥n, el verdadero potencial de {pointblank} est√° en la creaci√≥n de agentes que generan reportes autom√°ticos de validaci√≥n de datos. Por agentes se refieren a un objeto que contiene las pruebas que queremos aplicar a los datos, y que al interrogarlo genera un reporte con los resultados de las pruebas.\nCreamos un agente entreg√°ndole nuestros datos y opcionalmente el nivel de acci√≥n, que le indica cu√°ndo actuar sobre los problemas en nuestros datos. Luego, le indicamos al agente las pruebas que queremos realizar. Finalmente, interrogamos al agente para que nos entregue su reporte.\nlibrary(pointblank) # crear agente agente \u0026lt;- create_agent(datos, actions = action_levels(warn_at = 1, stop_at = 2)) # definir pruebas agente \u0026lt;- agente |\u0026gt; col_is_numeric(c(lindura, patas)) |\u0026gt; col_is_character(c(animal, color)) |\u0026gt; col_vals_in_set(animal, set = c(\u0026#34;perro\u0026#34;, \u0026#34;gato\u0026#34;, \u0026#34;sapo\u0026#34;, \u0026#34;pollo\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;pez\u0026#34;, \u0026#34;rata\u0026#34;)) |\u0026gt; col_vals_between(patas, left = 2, right = 4) |\u0026gt; col_vals_not_null(lindura) # interrogar interrogate(agente) Recibimos un reporte interactivo que indica la calidad de nuestros datos en base a las pruebas definidas:\nEn el reporte vemos los pasos de validaci√≥n (las pruebas) hacia abajo en la columna steps, y los colores indican si la prueba se pas√≥ (verde), si hubo advertencias (amarillo), o si la prueba fall√≥ (rojo). En la columna units se indica las unidades o pruebas individuales aplicadas en cada paso: probar el formato de una columna es una prueba, pero buscar datos perdidos corresponde a una prueba por cada observaci√≥n de la tabla.\nEjemplo de validaci√≥n de datos sucios Probemos otro ejemplo con datos ensuciados gracias al paquete {messy}, que te permite agregar datos perdidos, errores gramaticales, s√≠mbolos raros y otras asquerosidades a cualquier conjunto de datos. Ensuciaremos el famoso dataset iris:\niris_sucio \u0026lt;- datasets::iris |\u0026gt; tibble() |\u0026gt; janitor::clean_names() |\u0026gt; messy::messy(messiness = 0.2) iris_sucio # A tibble: 150 √ó 5 sepal_length sepal_width petal_length petal_width species \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 \u0026quot;5.1 \u0026quot; \u0026quot;3.5\u0026quot; \u0026quot;1.4\u0026quot; \u0026lt;NA\u0026gt; \u0026quot;S!ETOSA\u0026quot; 2 \u0026lt;NA\u0026gt; \u0026quot;3\u0026quot; \u0026quot;1.4 \u0026quot; \u0026quot;0.2\u0026quot; \u0026quot;se^tosa\u0026quot; 3 \u0026quot;4.7\u0026quot; \u0026quot;3.2\u0026quot; \u0026quot;1.3\u0026quot; \u0026quot;0.2\u0026quot; \u0026quot;se+tos.a \u0026quot; 4 \u0026quot;4.6 \u0026quot; \u0026lt;NA\u0026gt; \u0026quot;1.5\u0026quot; \u0026quot;0.2\u0026quot; \u0026quot;seto%sa\u0026quot; 5 \u0026lt;NA\u0026gt; \u0026quot;3.6\u0026quot; \u0026lt;NA\u0026gt; \u0026quot;0.2\u0026quot; \u0026quot;se#tosa \u0026quot; 6 \u0026quot;5.4\u0026quot; \u0026quot;3.9 \u0026quot; \u0026lt;NA\u0026gt; \u0026quot;0.4 \u0026quot; \u0026lt;NA\u0026gt; 7 \u0026quot;4.6 \u0026quot; \u0026quot;3.4\u0026quot; \u0026quot;1.4\u0026quot; \u0026quot;0.3\u0026quot; \u0026quot;SETOSA\u0026quot; 8 \u0026quot;5\u0026quot; \u0026lt;NA\u0026gt; \u0026quot;1.5\u0026quot; \u0026quot;0.2\u0026quot; \u0026quot;SETO$SA\u0026quot; 9 \u0026quot;4.4 \u0026quot; \u0026quot;2.9 \u0026quot; \u0026quot;1.4\u0026quot; \u0026lt;NA\u0026gt; \u0026quot;.SETOSA\u0026quot; 10 \u0026quot;4.9\u0026quot; \u0026quot;3.1\u0026quot; \u0026quot;1.5\u0026quot; \u0026quot;0.1\u0026quot; \u0026quot;set(o$s@a\u0026quot; # ‚Ñπ 140 more rows Luego creamos un agente para validar estos datos:\nagente_iris \u0026lt;- create_agent(iris_sucio, actions = action_levels(warn_at = 0.02, stop_at = 0.5)) agente_iris \u0026lt;- agente_iris |\u0026gt; col_is_numeric(columns = everything()) |\u0026gt; col_is_character(species) |\u0026gt; col_vals_in_set(species, c(\u0026#34;virginica\u0026#34;, \u0026#34;setosa\u0026#34;, \u0026#34;versicolor\u0026#34;)) |\u0026gt; col_vals_between(sepal_length, 1, 6) |\u0026gt; col_vals_not_null(columns = everything()) interrogate(agente_iris) Confirmamos que {messy} destruy√≥ a nuestro querido iris üòîüïäÔ∏è\nCrear un plan b√°sico de validaci√≥n de datos Si no sabes c√≥mo empezar a validar tus datos, {pointblank} te ayuda a crear un plan b√°sico de validaci√≥n de datos con la funci√≥n draft_validation(), la cual genera un script con pruebas b√°sicas para que lo edites y adaptes a tus necesidades:\ndraft_validation( tbl = ~datasets::iris, filename = \u0026#34;test-iris\u0026#34; ) Este c√≥digo nos crea un script que contiene 10 pruebas para el dataset en base a sus propios datos y caracter√≠sticas, y as√≠ tenemos material para definir los est√°ndares para el conjunto de datos, y volver a validarlo en el futuro luego de que se apliquen cambios, actualizaciones o correcciones.\nConclusiones Aplicar principios de validaci√≥n de datos a tus proyectos de an√°lisis de datos te va a ayudar a tener mayor confianza en tus datos, d√°ndote certeza de que no hay sorpresas inesperadas entre las miles o millones de observaciones con las que trabajas. Tambi√©n puede ahorrarte dolores de cabeza, ya que si los datos cambian y estos cambios se desajustan de tus est√°ndares, te enterar√°s de inmediato en vez de darte cuenta cuando se eche a perder alg√∫n gr√°fico o tabla m√°s adelante üòÖ\nRecursos para aprender {pointblank} Introducci√≥n a {pointblank} Gu√≠a oficial de {pointblank} Workshop de {pointblank} por Richard Iannone (requiere clonar el proyecto y generar los reportes Markdown) ","date":"2025-10-15T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/validacion_avanzada/","tags":"procesamiento de datos ; consejos ; automatizaci√≥n ; limpieza de datos","title":"Validaci√≥n de datos con {testthat} y {pointblank}"},{"content":"En post anteriores mostr√© c√≥mo hacer mapas comunales y regionales de Chile con R, y a hacer mapas de los territorios urbanos del pa√≠s.\nEn este tutorial aprenderemos a crear mapas de Chile en R usando datos geogr√°ficos o shapes oficiales de Chile, obtenidos desde la Subsecretar√≠a de Desarrollo Regional y Administrativo (Subdere) y la Biblioteca del Congreso Nacional de Chile (BCN).\nEl objetivo ser√° aprender a visualizar mapas desde shapefiles obtenidos de internet, y a procesar datos geogr√°ficos m√°s complejos con R, para generar mapas de Chile con pol√≠gonos y l√≠mites geogr√°ficamente correctos.\nObtener datos geogr√°ficos El primer paso para visualizar mapas es obtener los datos geogr√°ficos. Con esto nos referimos a los pol√≠gonos (figuras geom√©tricas que usualmente representan territorios), l√≠neas (que pueden representar l√≠mites o redes viales) y puntos (que pueden representar ubicaciones como municipios o capitales).\nLos datos geogr√°ficos suelen venir como shapes, que usualmente son carpetas que contienen archivos, principalmente shapefiles (.shp).\nLos siguientes botones ofrecen descargas directas de los datos que usaremos desde sus fuentes originales, la mayor√≠a de ellos obtenidos desde la IDE Subdere.\nLa divisi√≥n pol√≠tico-administrativa contiene los pol√≠gonos a nivel comunal, provincial y regional que consituyen el territorio de Chile, y provienen de la Subdere (2023):\nPol√≠gonos de divisi√≥n pol√≠tico-administrativa Los l√≠mites comunales de la divisi√≥n pol√≠tico-administrativa contiene las l√≠neas que limitan las unidades administrativas (comunas) del pa√≠s, y provienen de la Subdere (2022):\nL√≠neas de l√≠mites comunales Las ubicaciones de los municipios marcan con puntos la localizaci√≥n de estas instituciones, y provienen de la Subdere (2022):\nPuntos de ubicaci√≥n de municipios del pa√≠s La red vial es el conjunto de l√≠neas que representan las carreteras y caminos de todo el pa√≠s, y provienen de la Bibioteca del Congreso Nacional de Chile (BCN):\nL√≠neas de red vial del pa√≠s Alternativamente, puedes descargar los archivos desde R ejecutando este c√≥digo:\ndir.create(\u0026#34;shapes\u0026#34;) # crear carpeta # descargar download.file(\u0026#34;https://ide.subdere.gov.cl/wp-content/uploads/74_limites_dpa_2022.zip\u0026#34;, \u0026#34;shapes/74_limites_dpa_2022.zip\u0026#34;) download.file(\u0026#34;https://ide.subdere.gov.cl/descargas/SHP/Limite_DPA_03082023.rar\u0026#34;, \u0026#34;shapes/Limite_DPA_03082023.rar\u0026#34;) download.file(\u0026#34;https://ide.subdere.gov.cl/descargas/SHP/Municipios_15112022.zip\u0026#34;, \u0026#34;shapes/Municipios_15112022.zip\u0026#34;) download.file(\u0026#34;https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10403/2/Red_Vial.zip\u0026#34;, \u0026#34;shapes/Red_Vial.zip\u0026#34;) Una vez que descargamos los archivos, debemos descomprimirlos para obtener las carpetas que contienen los shapes.\nCargar datos geogr√°ficos Para trabajar con datos geogr√°ficos usamos el paquete {sf}, abreviaci√≥n de simple features, que es un est√°ndar para manejar datos geoespaciales. Si no tienes instalado el paquete, inst√°lalo con install.packages(\u0026quot;sf\u0026quot;).\nPara leer un archivo geoespacial usamos la funci√≥n read_sf() apuntada a la carpeta que contiene los shapefiles:\nlibrary(sf) library(janitor) # pol√≠gonos de comunas comunas \u0026lt;- read_sf(\u0026#34;shapes/DPA_2023/COMUNAS\u0026#34;) |\u0026gt; clean_names() # l√≠mites comunales limites \u0026lt;- read_sf(\u0026#34;shapes/74_limites_dpa_2022\u0026#34;) |\u0026gt; clean_names() # ubicaci√≥n de municipalidades municipios \u0026lt;- read_sf(\u0026#34;shapes/Municipios_15112022\u0026#34;) |\u0026gt; clean_names() # red vial calles \u0026lt;- read_sf(\u0026#34;shapes/Red_Vial\u0026#34;) |\u0026gt; clean_names() Algunos de estos mapas pueden ser muy detallados y/o complejos, por lo que pueden tardarse en cargar1.\nSi verificamos la clase de uno de los objetos geogr√°ficos cargados, vemos que una de sus clases es sf, pero al mismo tiempo tbl y data.frame:\nclass(comunas) [1] \u0026quot;sf\u0026quot; \u0026quot;tbl_df\u0026quot; \u0026quot;tbl\u0026quot; \u0026quot;data.frame\u0026quot; Si lo imprimimos en la consola, confirmamos que los objetos cargados desde los shapefiles son tablas de datos que arriba dicen Simple feature collection; es decir, son tablas de datos que adem√°s tienen informaci√≥n geogr√°fica.\ncomunas Simple feature collection with 345 features and 7 fields Geometry type: MULTIPOLYGON Dimension: XY Bounding box: xmin: -109.4549 ymin: -56.53777 xmax: -66.41559 ymax: -17.4984 Geodetic CRS: GCS_SIRGAS-Chile # A tibble: 345 √ó 8 cut_reg cut_prov cut_com region provincia comuna superficie \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 11 113 11302 Ays√©n del General Carlo‚Ä¶ Capit√°n ‚Ä¶ O'Hig‚Ä¶ 7785. 2 05 055 05503 Valpara√≠so Quillota Hijue‚Ä¶ 268. 3 08 083 08308 Biob√≠o Biob√≠o Quila‚Ä¶ 1124. 4 09 092 09209 La Araucan√≠a Malleco Renai‚Ä¶ 265. 5 09 092 09202 La Araucan√≠a Malleco Colli‚Ä¶ 1306. 6 15 152 15201 Arica y Parinacota Parinaco‚Ä¶ Putre 5890. 7 07 071 07110 Maule Talca San R‚Ä¶ 263. 8 08 083 08311 Biob√≠o Biob√≠o Santa‚Ä¶ 1251. 9 12 121 12102 Magallanes y de la Ant√°‚Ä¶ Magallan‚Ä¶ Lagun‚Ä¶ 3568. 10 11 113 11303 Ays√©n del General Carlo‚Ä¶ Capit√°n ‚Ä¶ Tortel 19991. # ‚Ñπ 335 more rows # ‚Ñπ 1 more variable: geometry \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; Estas tablas de datos cuentan con una columna geometry, que contiene la informaci√≥n geogr√°fica de los pol√≠gonos, puntos y/o l√≠neas de cada observaci√≥n. A su vez, encima de la tabla de datos vemos informaci√≥n especial, como el tipo de geometr√≠a, las dimensiones de la caja (bounding box), y el sistema de coordenadas de referencia (CRS), que indica el tipo de proyecci√≥n usada.\nVisualizar mapas Una vez cargados los shapes, simplemente es cosa de aplicarlos por capas a un gr√°fico de {ggplot2}. Las capas de datos geogr√°ficos se agregan con geom_sf(), y en este caso, que tenemos varios shapes, en cada capa habr√≠a que definir el objeto correspondiente en el argumento data; es decir, cada capa se basa en datos distintos, pero que coinciden en t√©rminos de coordenadas.\nEntonces, empezamos un gr√°fico con ggplot(), y luego vamos agregando capas de geom_sf(), recordando que el orden en que agreguemos las capas importa: las primeras (m√°s arriba) ser√°n los objetos en el fondo, y las siguientes capas (en sucesivas l√≠neas) se visualizar√°n encima de las anteriores.\nlibrary(dplyr) library(ggplot2) ggplot() + # capa de fondo: pol√≠gonos de comunas geom_sf(data = comunas, aes(fill = region), linewidth = 0) + # l√≠mites regionales encima de las comunas geom_sf(data = limites, color = \u0026#34;peachpuff4\u0026#34;, linewidth = 0.2, alpha = 0.8) + # calles geom_sf(data = calles |\u0026gt; filter(clase_ruta \u0026lt;= 3), color = \u0026#34;peachpuff4\u0026#34;, linewidth = 0.1, alpha = 0.3) + # puntos de municipios geom_sf(data = municipios, color = \u0026#34;peachpuff4\u0026#34;, size = 0.7, alpha = 0.6) + # borde oscuro geom_sf(data = municipios, color = \u0026#34;cornsilk1\u0026#34;, size = 0.1, alpha = 0.9) + # centro claro # recortar Chile continental coord_sf(expand = FALSE, xlim = c(-76, -66), ylim = c(-56.2, -17)) + # paleta de colores colorspace::scale_fill_discrete_qualitative( palette = \u0026#34;Warm\u0026#34;, c1 = 40, # intensidad del color l1 = 85) + # brillo del color theme_minimal() + theme(legend.position = \u0026#34;none\u0026#34;) A las capas de objetos geogr√°ficos le especificamos el sistema de coordenadas con coord_sf() para recortar el mapa al territorio continental del pa√≠s, y adem√°s le pusimos una escala de colores c√°lidos desde el paquete {colorspace}, que adem√°s tiene la cualidad de poder adaptar la intensidad y brillo de sus colores.\nListo! La gracia de {sf} es poder entregar herramientas para cargar cualquier tipo de datos geogr√°ficos y habilitar que {ggplot2} los pueda graficar sin problemas. A menos que ocurran problemas. Lo cual veremos en otro post üò¨\nAl tratarse de mapas oficiales, estos datos geogr√°ficos contienen mucho nivel de detalle; usualmente mucho m√°s del necesario para hacer mapas a nivel nacional, donde el nivel de detalle es visualmente imperceptible. Dado que una mayor calidad significa mapas m√°s pesados y por ende procesos m√°s lentos, podemos simplificar las geometr√≠as con la funci√≥n ms_simplify() del paquete {rmapshaper}, como detallamos en este post.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-10-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_mapa_chile_subdere/","tags":"mapas ; ggplot2 ; gr√°ficos ; ciencias sociales ; Chile","title":"Crea un mapa de Chile desde datos geoespaciales oficiales en R"},{"content":"** No content below YAML for the series _index. This file is a leaf bundle, and provides settings for the listing page layout and sidebar content.**\n","date":null,"href":"https://bastianoleah.netlify.app/blog/r_introduccion/","tags":"","title":"Introducci√≥n a R"},{"content":"Gracias al paquete {shinyjs} podemos hacer que una app Shiny muestre u oculte elementos seg√∫n los datos que correspondan o los inputs que haya seleccionado el usuario.\nPor ejemplo:\nSi el/la usuario/a selecciona una opci√≥n en particular, mostrar un contenedor con informaci√≥n adicional. Si no hay datos para graficar, ocultar el gr√°fico y mostrar un aviso. Se trata de una habilidad clave para crear aplicaciones que se adapten a datos complejos, cambiantes, o modificables por los usuarios.\nLo primero que tenemos que hacer en nuestra app es activar el uso de {shinyjs} agregando la funci√≥n useShinyjs() en nuestra UI:\nlibrary(shiny) library(bslib) library(shinyjs) ui \u0026lt;- page_fluid( # activar javascript useShinyjs() ) Tutorial 1: mostrar/ocultar elementos seg√∫n selecci√≥n del usuario Para el primer ejemplo, haremos una app simple que muestre y oculte un elemento de acuerdo a lo que elija el/la usuario/a.\nEn esta app ponemos un t√≠tulo y un selector de opciones (selectInput()), una salida de texto (textOutput()) para mostrar la selecci√≥n hecha, y un contenedor div() que contiene un aviso que queremos mostrar u ocultar seg√∫n la selecci√≥n del usuario. En este contenedor, el argumento id es lo que nos permitir√° identificar el elemento para poder mostrarlo u ocultarlo.\nlibrary(shiny) library(bslib) library(shinyjs) ui \u0026lt;- page_fluid( # activar javascript useShinyjs(), h1(\u0026#34;Mostrar/ocultar\u0026#34;), # selector de opciones selectInput(\u0026#34;filtro\u0026#34;, label = \u0026#34;Filtrar\u0026#34;, choices = c(\u0026#34;gato\u0026#34;, \u0026#34;perro\u0026#34;, \u0026#34;gallina\u0026#34;) ), textOutput(\u0026#34;animales\u0026#34;), # contenedor con un aviso para mostrar div(id = \u0026#34;aviso\u0026#34;, style = css(margin_top = \u0026#34;8px\u0026#34;), span( style = css(border = \u0026#34;solid 1px #A085B7\u0026#34;, border_radius = \u0026#34;6px\u0026#34;, padding = \u0026#34;6px\u0026#34;, font_weight = \u0026#34;bold\u0026#34;), \u0026#34;‚ö†Ô∏è Muy muy feo!\u0026#34; ) ) ) En la secci√≥n server de nuestra app vamos a programar la l√≥gica que har√° que se muestre u oculte el aviso:\nserver \u0026lt;- function(input, output, session) { # texto con la selecci√≥n del usuario/a output$animales \u0026lt;- renderText({ paste(\u0026#34;Animal seleccionado:\u0026#34;, input$filtro) }) # mostrar contenedor s√≥lo si se selecciona \u0026#34;perro\u0026#34; observe({ if(input$filtro == \u0026#34;perro\u0026#34;) { show(\u0026#34;aviso\u0026#34;) } else { hide(\u0026#34;aviso\u0026#34;) } }) } Usamos observe() para que ocurra una acci√≥n en nuestra app si es que cambia alg√∫n objeto reactivo. En este caso, haremos que si se cambia input$filtro, se detecte si la selecci√≥n es \u0026quot;perro\u0026quot;, y si es as√≠, mostrar (show()) el elemento llamado \u0026quot;aviso\u0026quot;. Si la selecci√≥n es cualquier otra, se oculta (hide()) el elemento.\nVeamos la app en acci√≥n!\nPara este ejemplo, agregamos un toque de color para que se vea m√°s bonita la aplicaci√≥n, definido al principio de la UI:\ntheme = bs_theme(bg = \u0026#34;#EAD1FA\u0026#34;, fg = \u0026#34;#553A74\u0026#34;, primary = \u0026#34;#8557AB\u0026#34;) Para m√°s informaci√≥n sobre aplicar temas a apps Shiny, revisa este post.\nPuedes ver el c√≥digo completo de esta aplicaci√≥n en este Gist de Github.\nTutorial 2: mostrat/ocultar elementos seg√∫n los datos Crearemos una aplicaci√≥n b√°sica que muestre un gr√°fico, con un input encima que filtrar√° los datos del gr√°fico. Primero definimos la interfaz:\nlibrary(shiny) library(bslib) library(shinyjs) library(dplyr) library(ggplot2) ui \u0026lt;- page_fluid( # activar javascript useShinyjs(), h1(\u0026#34;Mostrar/ocultar\u0026#34;), sliderInput(\u0026#34;filtro\u0026#34;, \u0026#34;Filtrar\u0026#34;, min = 5, max = 10, value = 1), # contenedor con el elemento a mostrar u ocultar div(id = \u0026#34;grafico\u0026#34;, plotOutput(\u0026#34;grafico_barras\u0026#34;, width = 320, height = 200) ), # otro contenedor con un aviso para mostrar div(id = \u0026#34;aviso\u0026#34;, p(em(\u0026#34;No hay datos para mostrar!\u0026#34;)) ) ) En la secci√≥n server de nuestra app vamos a crear un objeto reactivo con reactive() que filtre los datos a partir del selector input$filtro:\nserver \u0026lt;- function(input, output, session) { datos \u0026lt;- reactive({ iris |\u0026gt; filter(Sepal.Length \u0026gt;= input$filtro) }) } Con este c√≥digo, creamos el objeto reactivo datos() que se actualizar√° cada vez que la/el usuario cambie el input input$filtro, y por consiguiente actualizar√° los elementos que usen este objeto.\nLuego, definimos un gr√°fico sencillo en base a datos(), y que por consiguiente se actualizar√° autom√°ticamente cuando cambien los datos reactivos:\n# generar un gr√°fico de barras output$grafico_barras \u0026lt;- renderPlot({ datos() |\u0026gt; ggplot() + aes(Sepal.Length, Sepal.Width) + geom_point() }) Finalmente, programamos la l√≥gica que har√° que se muestren u oculten los elementos. La idea principal es que los elementos aparezcan y se oculten a partir de los datos, por lo que creamos un observador con observe() que ejecute c√≥digo cada vez que los datos cambien. En este caso, el observador evaluar√° con un if si el n√∫mero de filas de los datos (nrow(datos())) es cero, y si llega a ser cero, ocultar el gr√°fico (hide(\u0026quot;grafico\u0026quot;)) y mostrar un texto de aviso (show(\u0026quot;aviso\u0026quot;)).\n# mostrar y ocultar elementos en base a los datos observe({ if (nrow(datos()) == 0) { hide(\u0026#34;grafico\u0026#34;) show(\u0026#34;aviso\u0026#34;) } else { show(\u0026#34;grafico\u0026#34;) hide(\u0026#34;aviso\u0026#34;) } }) Vale mencionar que debemos especificar tambi√©n la condici√≥n donde el gr√°fico debe volver a mostrarse, y el aviso debe volver a ocultarse, para que cuando el o la usuaria cambie el filtro y vuelvan a haber datos, el gr√°fico vuelva a aparecer.\nVeamos la aplicaci√≥n!\nPuedes ver el c√≥digo completo de esta aplicaci√≥n en este Gist de Github.\nNuevamente, le agregamos el tema a la aplicaci√≥n Shiny para que se vea bonita, y adem√°s agregamos la funci√≥n thematic_shiny() del paquete {thematic} para que los gr√°ficos usen los colores del tema autom√°ticamente.\n","date":"2025-10-10T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/shiny_ocultar/","tags":"shiny","title":"Mostrar y ocultar elementos de una app Shiny a partir de datos o inputs"},{"content":"Elevar tus aplicaciones Shiny al siguiente nivel es muy f√°cil! Una app con un dise√±o atractivo y profesional puede marcar la diferencia entre que alguien la use o no, o bien, que alguien la recuerde o no!\nEn este tutorial veremos c√≥mo personalizar los temas de colores en tus aplicaciones Shiny utilizando el paquete {bslib}, y adem√°s combinaremos esto con la capacidad para que nuestros gr√°ficos {ggplot2} se ajusten autom√°ticamente al tema gracias al paquete {thematic}.\nCrear una aplicaci√≥n Shiny b√°sica Comencemos con una aplicaci√≥n Shiny muy b√°sica, que no tiene ning√∫n tema de colores personalizado. El c√≥digo es el siguiente:\nlibrary(shiny) library(bslib) ui \u0026lt;- page_fluid( h1(\u0026#34;App Shiny ‚ú®\u0026#34;), # selector de opciones selectInput(\u0026#34;animal\u0026#34;, label = \u0026#34;Animalito\u0026#34;, choices = c(\u0026#34;Gatito\u0026#34;, \u0026#34;Gallineta\u0026#34;, \u0026#34;Ratita\u0026#34;)), # deslizador de tama√±o sliderInput(\u0026#34;tama√±o\u0026#34;, label = \u0026#34;Tama√±o\u0026#34;, min = 16, max = 128, value = 48, ticks = FALSE), htmlOutput(\u0026#34;animales\u0026#34;) ) server \u0026lt;- function(input, output, session) { } shinyApp(ui, server) En esta aplicaci√≥n extra b√°sica tenemos un texto, un selector de alternativas, y un deslizador num√©rico para seleccionar valores.\nCambiar los colores de una app Shiny Para cambiar el tema de colores, usaremos la funci√≥n bs_theme() del paquete {bslib}. Esta funci√≥n nos permite definir los colores principales de la aplicaci√≥n, y luego aplicarlos a la interfaz de usuario con el argumento theme de la funci√≥n que usemos para construir la UI o interfaz de nuestra app (en este caso, page_fluid()).\nPara definir los colores del tema, agregamos el argumento theme a page_fluid(), y definimos el tema de la siguiente manera:\ntheme = bs_theme(bg = \u0026#34;#EAD1FA\u0026#34;, fg = \u0026#34;#553A74\u0026#34;, primary = \u0026#34;#8557AB\u0026#34;) Aqu√≠ se configuran los tres colores principales: el fondo (bg), el color de los textos (fg), y el color principal (primary) que se usa en los botones, barras de navegaci√≥n, y otros elementos interactivos.\nEn este caso, pondremos los colores de este mismo sitio üíú\nAgregar funcionalidad a la app Shiny Antes de seguir, agreguemos alguna funcionalidad a nuestra app! En la funci√≥n server agregaremos el siguiente c√≥digo para hacer que la app muestre el emoji del animal seleccionado junto a un texto, y el deslizador nos permitir√° cambiar el tama√±o del animal elegido:\nserver \u0026lt;- function(input, output, session) { # generar animalito con texto y emoji output$animales \u0026lt;- renderUI({ # animal y texto seg√∫n selecci√≥n if (input$animal == \u0026#34;Gatito\u0026#34;) { animal \u0026lt;- list(\u0026#34;texto\u0026#34; = \u0026#34;Miu\u0026#34;, \u0026#34;emoji\u0026#34; = \u0026#34;üêà\u0026#34;) } else if (input$animal == \u0026#34;Gallineta\u0026#34;) { animal \u0026lt;- list(\u0026#34;texto\u0026#34; = \u0026#34;Cocoroc√≥\u0026#34;, \u0026#34;emoji\u0026#34; = \u0026#34;üêì\u0026#34;) } else if (input$animal == \u0026#34;Ratita\u0026#34;) { animal \u0026lt;- list(\u0026#34;texto\u0026#34; = \u0026#34;Mimimi\u0026#34;, \u0026#34;emoji\u0026#34; = \u0026#34;üêÅ\u0026#34;) } # generar interfaz para mostrar el animalito div( # t√≠tulo del animal h3(em(animal$texto)), # emoji del animal div(animal$emoji, # tama√±o del animalito style = css(font_size = paste0(input$tama√±o, \u0026#34;px\u0026#34;)) ) ) }) } Ahora s√≠, veamos c√≥mo cambia la app al aplicar este tema:\nQueda s√∫per bonito! ‚ò∫Ô∏è Encuentra el c√≥digo completo de esta app en este Gist de Github.\nAplicar el tema de tu app Shiny a tus gr√°ficos Ahora que definimos colores base para el tema de la aplicaci√≥n, podemos usar {thematic} para aplicar los mismos colores a los gr√°ficos, tal como vimos en el tutorial de temas para {ggplot2}..\nPrimero hagamos una app b√°sica que muestre un gr√°fico:\nlibrary(shiny) library(bslib) library(dplyr) library(ggplot2) ui \u0026lt;- page_fluid( br(), h1(\u0026#34;App Shiny ‚ú®\u0026#34;), # selector de n√∫meros sliderInput(\u0026#34;filtro\u0026#34;, label = \u0026#34;Filtrar\u0026#34;, min = 5, max = 10, value = 1), # gr√°fico plotOutput(\u0026#34;grafico_barras\u0026#34;, width = 320, height = 200) ) server \u0026lt;- function(input, output, session) { datos \u0026lt;- reactive({ iris |\u0026gt; filter(Sepal.Length \u0026gt;= input$filtro) }) # generar un gr√°fico de barras output$grafico_barras \u0026lt;- renderPlot({ datos() |\u0026gt; ggplot() + aes(Sepal.Length, Sepal.Width) + geom_point() }) } shinyApp(ui, server) Esta aplicaci√≥n tiene un selector de n√∫meros que filtran los datos, que a su vez alimentan el gr√°fico. Al cambiar la selecci√≥n de n√∫meros, el gr√°fico se actualiza gracias a la reactividad del objeto datos().\nAplicar el tema es tan sencillo como agregar el tema en el argumento theme de page_fluid():\ntheme = bs_theme(bg = \u0026#34;#EAD1FA\u0026#34;, fg = \u0026#34;#553A74\u0026#34;, primary = \u0026#34;#8557AB\u0026#34;) Luego, para que el gr√°fico adopte la paleta de colores del tema, solamente tenemos que cargar el paquete {thematic} con library(thematic), y luego activar el uso de temas con thematic_shiny() antes de la interfaz/UI, y listo! No es necesario cambiar nada en el c√≥digo del gr√°fico ni del resto de la aplicaci√≥n.1\nLa parte superior de la aplicaci√≥n quedar√≠a as√≠:\nlibrary(shiny) library(bslib) library(dplyr) library(ggplot2) library(thematic) thematic_shiny() # activar el tema ui \u0026lt;- page_fluid( # definir los colores del tema theme = bs_theme(bg = \u0026#34;#EAD1FA\u0026#34;, fg = \u0026#34;#553A74\u0026#34;, primary = \u0026#34;#8557AB\u0026#34;) # el resto de la app... Listo! As√≠ de f√°cil. Ahora no hay excusas para hacer que tus aplicaciones se vean bonitas y dejen una buena impresi√≥n en sus usuarios.\na menos que el gr√°fico ya tenga aplicado un tema de {ggplot2} como theme_minimal(), en cuyo caso habr√≠a que eliminarlo para que el tema de {thematic} funcione correctamente.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-10-09T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/shiny_temas/","tags":"shiny","title":"Temas de colores personalizados en apps Shiny"},{"content":"Esta plataforma visualiza datos de ingresos a nivel regional, comunal, y por g√©nero.\nSu objetivo es visibilizar diferencias de los ingresos recibidos por las personas, permitiendo compararlos por regiones y comunas, as√≠ como tambi√©n producir comparaciones de brechas de g√©nero entre hombres y mujeres.\nLa fuente de los datos est√° en el Banco Integrado de Datos de Mideso.\nDatos Obt√©n los datos procesados en formato csv en este enlace.\nVisualizador Accede al visualizador web en este enlace.\nAnimaciones Las siguientes son grabaciones del proceso de visualizaci√≥n de datos, grabadas con el paquete {camcorder}.\n","date":"2025-09-24T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_mideso_ingresos_genero/","tags":"apps ; datos ; Chile ; g√©nero ; ciencias sociales ; animaciones","title":"App: comparaci√≥n de ingresos regionales y comunales"},{"content":" Infograf√≠a que recopila visualizaciones de datos acerca de los cr√≠menes de lesa humanidad cometidos por el r√©gimen dictatorial en Chile, entre entre 1973 y 1989.\nEntrar a la infograf√≠a El objetivo es poder compartir informaci√≥n de forma pedag√≥gica y clara, para que las nuevas generaciones puedan comprender la magnitud de las violaciones a los derechos humanos cometidas en ese per√≠odo, y as√≠ contribuir a la memoria hist√≥rica del pa√≠s.\nAqu√≠ dejo un video cortito que hice mostrando la p√°gina web y explicando un poco las motivaciones:\n@bastimapache Septiembre es el mes de la memoria! Revisa la infograf√≠a en el link de mi perfil, y ay√∫dame a mejorarla üôèüèº #chile #septiembre ‚ô¨ Ventolera - Quilapay√∫n Se buscan contribuciones, como por ejemplo relatos, estad√≠sticas y datos, contribuci√≥n de textos y similares. Cont√°ctame!\nActualizaciones 10/09/2025: fichas de principales violadores de derechos humanos: Krasnoff, Contreras, Corval√°n, Romo y Moren. 10/09/2025: apartados con caso de los 119, caso de Michel Nash, y caso degollados 09/09/2025: apartado sobre censura 08/09/2025: apartado sobre segregaci√≥n, posibilidad de hacer zoom a fotos 07/09/2025: apartado sobre infancias, l√≠nea de tiempo 03/09/2025: apartados con relatos sobre casos insignes de v√≠ctimas: caso Sebasti√°n Acevedo y caso quemados 01/09/2025: secciones dispersas de testimonios de sobrevivientes 31/08/2025: nueva secci√≥n de mujeres detenidas desaparecidas embarazadas Notas t√©cnicas La p√°gina fue construida completamente usando Quarto desde RStudio, publicando el sitio gratuitamente a GitHub Pages.\n","date":"2025-09-11T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/infografia_violaciones_ddhh_chile/","tags":"apps ; Chile","title":"Infograf√≠a: Violaciones a los Derechos Humanos cometidas por la dictadura c√≠vico-militar chilena"},{"content":"El otro d√≠a tuve que usar R para generar comandos muy largos (para automatizar el convertir cientos de reportes html a pdf usando un navegador web), y el c√≥digo resultante fue eterno. Al pegarlo en la consola se produjo un aluvi√≥n de texto:\nEntre el oc√©ano de texto y c√≥digo aparecen algunas figuras diagonales con cierta regularidad. Es un fen√≥meno que me hab√≠a pasado antes, y que siempre llam√≥ mi atenci√≥n.\nCuando programo loops me gusta hacer que R imprima mensajes de estado en cada paso (con message() o cat()) para saber c√≥mo avanza el proceso, y en algunos casos esto genera un caos de texto, particularmente cuando los procesos son demasiado r√°pidos.\nMe interesaba replicar estas situaciones. Lo m√°s b√°sico ser√≠a hacer un loop que imprima todos los n√∫meros del 1 al n. Una operaci√≥n de este tipo es instant√°nea, ya que no tiene mayor complejidad, as√≠ que para que se note mejor, le ponemos una breve espera1 de una mil√©sima de segundo entre cada paso:\n# funci√≥n para pausar entre cada paso wait \u0026lt;- Sys.sleep # loop desde el 1 al 10000 for (i in 1:10000) { cat(i) # imprimir valor a la consola wait(0.001) # tomarse una pausa # repetir } El loop simplemente imprime a la consola el valor que le toca en cada paso, empezando por el 1 y terminando en el 10.000. Pero el movimiento de cientos de caracteres ASCII en la pantalla hace que emerjan patrones visuales interesantes.\nMe puse a explorar formas de crear distintos patrones de c√≥digo que producen estas secuencias de ruido visual.\nPrimero definimos algunas constantes para la cantidad de pasos de los loops y la espera entre cada paso:\nn \u0026lt;- 60000 t \u0026lt;- 0.0002 Si en cada paso imprimimos una cantidad al azar de barras (|), e imprimimos estas barras en los n√∫meros impares y espacios vac√≠os en los pares, obtenemos una especie de fondo blanco con muchos espacios distribuidos aleatoriamente.\nfor (i in 1:n) { cantidad \u0026lt;- sample(1:16, 1) # n√∫meros al azar entre 1 y 16 barras \u0026lt;- paste(rep(\u0026#34;|\u0026#34;, cantidad), collapse = \u0026#34;\u0026#34;) # cantidad de barras if (i %% 2 == 0) cat(\u0026#34; \u0026#34;) else cat(barras) # imprimir vac√≠o si el n√∫mero es par, barras si es impar wait(t) # espera antes del siguiente paso } Si en cada paso del loop imprimimos una cantidad al azar de espacios en blanco, imprimimos estos espacios solamente en los pasos divisibles por 10, y el resto de los pasos imprimimos una barra, obtenemos un patr√≥n de ruido con figuras de vac√≠o cont√≠nuas hacia abajo, que parecen l√≠neas de zebra.\nfor (i in 1:n) { espacios \u0026lt;- rep(\u0026#34; \u0026#34;, sample(1:6, 1)) # espacios al azar entre 1 y 6 vacio \u0026lt;- paste(espacios, collapse = \u0026#34;\u0026#34;) # unir los espacios resultantes if (i %% 10 == 0) cat(vacio) else cat(\u0026#34;|\u0026#34;) # imprimir vac√≠o en todos los pasos excepto en m√∫ltiplos de 10 wait(3e-04) # espera } En el siguiente, por cada n√∫mero de los pasos del loop, se imprime una cantidad de barras (si el n√∫mero es impar) o vac√≠o (si el n√∫mero es par) dependiendo del √∫ltimo d√≠gito del n√∫mero. Por ejemplo, en el paso 543 se imprimen 3 barras, porque 3 es el √∫ltimo n√∫mero de 543, y es impar.\nSe genera una especie de cuadrantes con cierto degradado, o diagonales crecientes con espaciado y figuras geom√©tricas, dependiendo del tama√±o del texto y/o de la ventana de la consola.\nfor (i in 1:n) { vacio \u0026lt;- paste(rep(\u0026#34; \u0026#34;, i %% 10), collapse = \u0026#34;\u0026#34;) barras \u0026lt;- paste(rep(\u0026#34;|\u0026#34;, i %% 10), collapse = \u0026#34;\u0026#34;) if (i %% 2 == 0) cat(vacio) else cat(barras) wait(2e-03) } Encuentro maravilloso que los patrones cambien seg√∫n el tama√±o de la consola (la cantidad de columnas de texto, en realidad), y espero poder explorar m√°s en ese sentido.\nEn este otro intento gener√© un n√∫mero al azar en cada paso, y se imprimen barras y vac√≠os en esa cantidad, dependiendo de si el paso es es par o impar. El resultado es un ruido con barras anchas, que genera manchas que se conectan entre si.\nfor (i in 1:n) { cantidad \u0026lt;- sample(1:18, 1) barras \u0026lt;- paste(rep(\u0026#34;|\u0026#34;, cantidad), collapse = \u0026#34;\u0026#34;) vacio \u0026lt;- paste(rep(\u0026#34; \u0026#34;, cantidad), collapse = \u0026#34;\u0026#34;) if (i %% 2 == 0) cat(vacio) else cat(barras) wait(2e-03) } Para el siguiente intento me bas√© en el c√≥digo anterior, pero en un loop sobre los n√∫meros de una distribuci√≥n poisson con un lambda de 1. El resultado es mucho m√°s ruidoso, con figuras geom√©tricas espor√°dicas interesantes.\nfor (i in rpois(n, 1)) { barras \u0026lt;- paste(rep(\u0026#34;|\u0026#34;, i), collapse = \u0026#34;\u0026#34;) vacio \u0026lt;- paste(rep(\u0026#34; \u0026#34;, i), collapse = \u0026#34;\u0026#34;) if (i %% 2 == 0) cat(vacio) else cat(barras) wait(t) } Si se crea una secuencia de pares de vac√≠o y barras del mismo largo (||| ||| |||), se generan barras verticales o diagonales dependiendo de la cantidad de columnas de la consola.\nfor (i in 1:n) { cantidad \u0026lt;- 8 barras \u0026lt;- paste(rep(\u0026#34;|\u0026#34;, cantidad), collapse = \u0026#34;\u0026#34;) vacio \u0026lt;- paste(rep(\u0026#34; \u0026#34;, cantidad), collapse = \u0026#34;\u0026#34;) if (i %% 2 == 0) cat(vacio) else cat(barras) wait(2e-3) } En esta √∫ltima prueba gener√© dos loops dentro de cada paso del loop principal, donde los loops internos van del 1 al 4 creando una secuencia que genera esa cantidad de elementos, una vez del 1 al 4, y luego del 4 al 1:\n| | | | | | | | | El resultado son secuencias que en ciertos anchos de consola se ven onduladas, luego se producen patrones diagonales m√°s espaciados entre ellos.\nfor (i in 1:n) { x = 4 for (y in 1:x) { cat(rep(\u0026#34; \u0026#34;, y) |\u0026gt; paste(collapse = \u0026#34;\u0026#34;)) cat(\u0026#34;|\u0026#34;) } for (y in x:1) { cat(rep(\u0026#34; \u0026#34;, y) |\u0026gt; paste(collapse = \u0026#34;\u0026#34;)) cat(\u0026#34;|\u0026#34;) } wait(t*20) } Me encant√≥ esta primera aproximaci√≥n al arte generativo, y ojal√° poder seguir descrubriendo nuevas formas de generar patrones interesantes! Ser√≠a ideal desarrollar una aplicaci√≥n interactiva donde los patrones fluyan continuamente y vayan siendo alterados directamente desde el c√≥digo, en tiempo real.\nLa funci√≥n Sys.sleep(x) hace que R pause por X segundos. Ac√° renombr√© la funci√≥n a wait(), simplemente porque me carga el nombre Sys.sleep con may√∫scula y puntos.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-08-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-08-27/","tags":"curiosidades ; arte generativo ; loops","title":"Generando ruido visual con R"},{"content":"Darle un toque de color a tus gr√°ficos produce visualizaciones con m√°s personalidad y mayor impacto. Pero cambiar el color de cada elemento puede ser engorroso. Para ayudarte con eso existe el paquete {thematic}! En este post vemos c√≥mo usar {thematic} para cambiar f√°cilmente los colores de tus gr√°ficos.\nPrimero generemos datos al azar para crear una visualizaci√≥n de demostraci√≥n:\nlibrary(dplyr) # crear datos al azar datos \u0026lt;- tibble(a = 1:10, b = rnorm(10, mean = 7, sd = 2) ) Ahora creemos un gr√°fico b√°sico:\nlibrary(ggplot2) grafico \u0026lt;- datos |\u0026gt; ggplot() + aes(x = as.factor(a), y = b) + geom_col(width = 0.5) + geom_text(aes(label = round(b, 0), y = b + 0.6), size = 3, fontface = \u0026#34;bold\u0026#34;) grafico Agreguemos algunas capas extra para mejorar la apariencia de nuestro gr√°fico:\ngrafico \u0026lt;- grafico + labs(title = \u0026#34;Gr√°fico de barras\u0026#34;, subtitle = \u0026#34;N√∫meros al azar\u0026#34;, x = \u0026#34;Eje horizontal\u0026#34;, y = \u0026#34;Eje vertical\u0026#34;, caption = \u0026#34;Fuente: de los deseos\u0026#34;) + scale_y_continuous(expand = expansion(c(0, 0.05))) + theme(plot.title = element_text(face = \u0026#34;bold\u0026#34;), panel.grid.minor.y = element_line(linetype = 2, linewidth = .5), axis.ticks.x = element_blank()) grafico Ahora que tenemos un gr√°fico, probemos {thematic}. La idea es que tenemos que activar la funci√≥n que genera los temas con thematic_on(), y en el momento que la activamos, definimos los colores principales de nuestro tema. Estos colores son de fondo (bg) y de frente (fg), que como su nobre lo indica, definen el color base del gr√°fico y el color de los elementos principales.\nlibrary(thematic) thematic_on(fg = \u0026#34;#553A74\u0026#34;, bg = \u0026#34;#EAD2FA\u0026#34;) grafico Solamente con definir dos colores con thematic_on() e imprimir el gr√°fico obtenemos el gr√°fico con el tema aplicado. Muy lindo üíú\nPara encontrar pares de colores interesantes, recomiendo el sitio Pigment, que genera pares de colores a los que puedes ajustar su saturaci√≥n y su nivel de iluminaci√≥n.\nVeamos algunos ejemplos de como queda el mismo gr√°fico con otros pares de colores:\nthematic_on(fg = \u0026#34;#6A3F5B\u0026#34;, bg = \u0026#34;#E28B9F\u0026#34;) grafico thematic_on(fg = \u0026#34;#81BFC3\u0026#34;, bg = \u0026#34;#684D5B\u0026#34;) grafico thematic_on(fg = \u0026#34;#524337\u0026#34;, bg = \u0026#34;#C4B495\u0026#34;) grafico Para desactivar la aplicaci√≥n del tema de colores, usa thematic_off() y volver√°s a la aburrida normalidad.\nthematic_off() grafico ¬°As√≠ de simple! Claramente es una forma b√°sica y r√°pida de personalizar la apariencia de las visualizaciones, pero el resultado suele ser positivo considerando el poqu√≠simo esfuerzo necesario para lograrlo. Eficiencia, yey! ü•∞\n","date":"2025-08-26T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggplot_temas/","tags":"visualizaci√≥n de datos ; ggplot2 ; gr√°ficos","title":"Temas de colores personalizados para tus gr√°ficos {ggplot2}"},{"content":"¬øQuieres darle un toque personalizado a tus gr√°ficos? O tal vez alinearlos mejor al mensaje que quieres entregar, o a los lineamientos est√©ticos de tu organizaci√≥n. En esta breve gu√≠a te explico c√≥mo cambiar las tipograf√≠as, tipos de letra o fuentes de tus gr√°ficos hechos en R con {ggplot2}.\nPara demostrar, primero creemos datos ficticios siguiento distribuciones normales:\nlibrary(ggplot2) library(dplyr) # crear datos al azar datos \u0026lt;- tibble(a = rnorm(20, mean = 10, sd = 1), b = rnorm(20, mean = 10, sd = 1), c = round(rnorm(20, mean = 10, sd = 1), 1)) Ahora creemos un gr√°fico de dispersi√≥n como muestra, con un poco de texto extra:\ngrafico \u0026lt;- datos |\u0026gt; ggplot() + aes(x = a, y = b) + geom_point(size = 2, alpha = 0.4) + labs(title = \u0026#34;Gr√°fico de dispersi√≥n\u0026#34;, subtitle = \u0026#34;N√∫meros al azar\u0026#34;, x = \u0026#34;Eje horizontal\u0026#34;, y = \u0026#34;Eje vertical\u0026#34;, caption = \u0026#34;Fuente: de los deseos\u0026#34;) + theme_light(base_size = 12) + theme(plot.title = element_text(face = \u0026#34;bold\u0026#34;)) Por defecto, {ggplot2} usa las tipograf√≠as Helvetica en Mac y Arial en Windows:\ngrafico A pesar de no ser malas tipograf√≠as, se vuelven aburridas r√°pidamente.\nSi necesitas aprender a usar {ggplot2} para gr√°ficos en R, primero revisa este tutorial introductorio! Tipograf√≠as instaladas Podemos cambiar la tipograf√≠a de los gr√°ficos {ggplot2} f√°cilmente si √©stas se encuentran instaladas en tu computador. Por ejemplo, La tipograf√≠a Menlo que viene por defecto en Mac.\nPara establecer la tipograf√≠a de los gr√°ficos, modificamos desde el tema (theme()) los elementos de texto (text = element_text()), especificando en el argumento family el nombre de la tipograf√≠a:\n# especificar tipograf√≠a desde el tema grafico + theme(text = element_text(family = \u0026#34;Menlo\u0026#34;)) Si agregamos capas de texto al gr√°fico (con geom_text(), geom_label() u otros), tenemos que especificar la tipograf√≠a que usaremos en cada capa. En el siguiente ejemplo, agregamos con geom_text_repel() una capa de texto que se repele de los puntos y otras etiquetas de texto autom√°ticamente.\n# especificar tipograf√≠a para geom_text() y tambi√©n para el tema grafico + ggrepel::geom_text_repel(aes(label = c), family = \u0026#34;Menlo\u0026#34;) + theme(text = element_text(family = \u0026#34;Menlo\u0026#34;)) Tipograf√≠as web desde Google Fonts Si no tienes la tipograf√≠a que buscas instalada en tu computadora, puedes usar tipograf√≠as web sin necesidad de instalar ni descargar nada. En la p√°gina Google Fonts existe un cat√°logo de cientos de tipograf√≠as de todo tipo, gratuitas y de c√≥digo abierto.\nEntra a Google Fonts y busca una tipograf√≠a. Recomiendo seleccionar tipograf√≠as en Espa√±ol (para que tengan soporte para tildes y e√±es), y usar las opciones del lado izquierdo para encontrar tipograf√≠as por varias cualidades, como que evoquen calma o innovaci√≥n, o seg√∫n el estilo de fuente como serif (con terminaciones al final de los trazos) o sans serif (sin terminaciones al final de los trazos).\nCuando la encuentres, copia el nombre de la tipograf√≠a para agregarla a tu entorno de R con la funci√≥n font_add_google() del paquete {showtext}. Este paquete te permite agregar tipograf√≠as a R para usarlas en tus gr√°ficos.\nPara usar la tipograf√≠a debes agregarla con font_add_google(), luego activar {showtext} ejecutando showtext_auto(), y finalmente especificar la resoluci√≥n de tu pantalla con showtext_opts(dpi = 300).\nlibrary(showtext) # descargar una tipograf√≠a desde google fonts font_add_google(name = \u0026#34;Pacifico\u0026#34;) # activar tipograf√≠as showtext_auto() showtext_opts(dpi = 300) # usar la tipograf√≠a desde Google Fonts grafico + ggrepel::geom_text_repel(aes(label = c), family = \u0026#34;Pacifico\u0026#34;) + theme(text = element_text(family = \u0026#34;Pacifico\u0026#34;)) Ahora puedes usar cientos de tipograf√≠a con tus gr√°ficos en R! ü•≥ Solamente busca la que necesites en Google Fonts y podr√°s usarla en {ggplot2}.\nTipograf√≠as descargadas Si descargaste tipograf√≠as desde otros sitios (en formatos como ttf, otf, woff y otros) tambi√©n puedes agregarlas a R con {showtext}. Para agregar las tipograf√≠as, usa font_add(), especificando los archivos que corresponden a los estilos de letras como regular, bold e italic.\nPor ejemplo, vamos a Google Fonts y descargamos la tipograf√≠a Arvo.\nal descargarla obtendremos archivos como los siguientes:\nArvo-Regular.ttf Arvo-Bold.ttf Arvo-Italic.ttf Agregamos las tipograf√≠as a R con font_add(), asumiendo que las guardamos en una carpeta llamada tipograf√≠as:\n# agregar una tipograf√≠a desde un archivo font_add(\u0026#34;Arvo\u0026#34;, regular = \u0026#34;tipograf√≠as/Arvo-Regular.ttf\u0026#34;, bold = \u0026#34;tipograf√≠as/Arvo-Bold.ttf\u0026#34;, italic = \u0026#34;tipograf√≠as/Arvo-Italic.ttf\u0026#34;) Luego seguimos los mismos pasos de antes para usarlas en nuestros gr√°ficos {ggplot2}:\n# activar tipograf√≠as showtext_auto() showtext_opts(dpi = 300) # probar tipograf√≠a descargada como archivo desde Google Fonts grafico + ggrepel::geom_text_repel(aes(label = c), family = \u0026#34;Arvo\u0026#34;) + theme(text = element_text(family = \u0026#34;Arvo\u0026#34;)) Este m√©todo puede optimizar la ejecuci√≥n de nuestros scripts, dado que la funci√≥n font_add_google() descarga las tipograf√≠as cada vez que ejecutamos la funci√≥n, mientras que si descargamos los archivos directamente no necesitamos descargar m√∫ltiples veces los archivos.\nTambi√©n se puede usar la funci√≥n setup_font(\u0026quot;arvo\u0026quot;, \u0026quot;tipograf√≠as\u0026quot;) del paquete {gfonts} para descargar autom√°ticamente las tipograf√≠as de Google Fonts en tu proyecto de R, y as√≠ usarlas sin descargas ni necesidad de conexi√≥n a internet. Para averiguar los nombres de las tipograf√≠as puedes ejecutar gfonts::get_all_fonts().\n","date":"2025-08-26T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggplot_tipografias/","tags":"visualizaci√≥n de datos ; ggplot2","title":"Tipograf√≠as personalizadas en gr√°ficos {ggplot2}"},{"content":"Si necesitas saber a qu√© hora es un evento que ocurre en otro pa√≠s, puedes usar {lubridate} para convertir las zonas horarias:\nPrimero definimos la fecha del evento, la zona horaria del evento y tu zona horaria:\nfecha_evento \u0026lt;- \u0026#34;2025-08-22 18:00:00\u0026#34; zona_horaria_evento \u0026lt;- \u0026#34;Mexico/General\u0026#34; zona_horaria_local \u0026lt;- \u0026#34;Chile/Continental\u0026#34; Si no sabes cu√°l es tu zona horaria, en esta tabla hay una lista de identificadores de zona horaria (TZ Identifier).\nLuego usamos {lubridate} para convertir la fecha/hora en al zona horaria de tu inter√©s:\nlibrary(lubridate) ymd_hms(fecha_evento, tz = zona_horaria_evento) |\u0026gt; with_tz(zona_horaria_local) [1] \u0026quot;2025-08-22 20:00:00 -04\u0026quot; Ahora s√© que el taller que voy a dar para estudiantes de M√©xico va a ser a las 20 horas de Chile y no a las 16 como yo pensaba üôÑüòÇ\nOtro ejemplo:\nlibrary(lubridate) ymd_hms(\u0026#34;2025-08-27 16:00:00\u0026#34;) |\u0026gt; with_tz(\u0026#34;Europe/Vienna\u0026#34;) [1] \u0026quot;2025-08-27 18:00:00 CEST\u0026quot; Este tip lo aprend√≠ en el sitio de RainborR, una comunidad de usuarixs de R que tambi√©n son parte de la comunidad LGBT+ üè≥Ô∏è‚Äçüåà\n","date":"2025-08-22T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-08-22/","tags":"consejos ; curiosidades ; fechas","title":"Convertir zonas horarias con R"},{"content":"El left join es una de las operaciones b√°sicas del trabajo con datos, en el sentido de que realiza una operaci√≥n sencilla que a la vez es muy √∫til. Sirve tanto para limpiar datos como para procesarlos y obtener nuevas relaciones entre ellos.\nUn left join realiza una uni√≥n o combinaci√≥n entre dos tablas de datos a partir de una variable en com√∫n o clave (key). En otras palabras, un left join toma dos tablas que tienen datos distintos, pero que comparten una variable o columna en com√∫n, y usa esta variable en com√∫n para unir las observaciones de ambas tablas.\nEsquema de una uni√≥n entre tablas con left join En el ejemplo anterior, tenemos dos tablas, ambas con tres variables distintas, pero en ambas tablas tenemos una variable que contiene informaci√≥n equivalente. En la vida real, esto podr√≠an ser nombres de personas, nombres de pa√≠ses, identificadores √∫nicos de personas o instituciones, fechas, etc√©tera. Esta variable compartida entre las tablas es la llave que usaremos para la uni√≥n.\nAl realiazr la uni√≥n con left join obtenemos una nueva tabla que combina las observaciones de ambas, uniendo las filas de la primera tabla (x) con las filas de al segunda tabla (y) que se correspondan seg√∫n la llave en com√∫n.\nEsquema del resultado del left join Ejemplo de una uni√≥n de tablas en R Para unir dos tablas en R, usamos la funci√≥n left_join() de {dplyr}.\nlibrary(dplyr) Primero creemos una tabla de base con datos de ejemplo.\nfrutas_x \u0026lt;- tibble(fruta = c(\u0026#34;pera\u0026#34;, \u0026#34;manzana\u0026#34;, \u0026#34;uva\u0026#34;), color = c(\u0026#34;verde\u0026#34;, \u0026#34;roja\u0026#34;, \u0026#34;morada\u0026#34;)) fruta color pera verde manzana roja uva morada En esa tabla tenemos tres observaciones que corresponden a animales, descritos en la primera columna, y una segunda columna con caracter√≠sticas de los mismos.\nAhora creemos una segunda tabla, que adem√°s de tener la misma columna que describe las frutas, agrega una nueva variable sobre las frutitas üçêüçéüçá\nfrutas_y \u0026lt;- tibble(fruta = c(\u0026#34;pera\u0026#34;, \u0026#34;manzana\u0026#34;, \u0026#34;uva\u0026#34;), sabor = c(\u0026#34;deliciosa\u0026#34;, \u0026#34;buena\u0026#34;, \u0026#34;ricolina\u0026#34;)) fruta sabor pera deliciosa manzana buena uva ricolina Dado que ambas tablas comparten la variable fruta, si hacemos un left join ambas tablas se cruzar√°n en base a esta variable, resultando en una tabla nueva:\nfrutas_2 \u0026lt;- left_join(frutas_x, frutas_y) Joining with `by = join_by(fruta)` fruta color sabor pera verde deliciosa manzana roja buena uva morada ricolina El resultado de la uni√≥n es una nueva tabla que tiene las tres variables √∫nicas obtenidas del cruce de las dos tablas distintas. En este caso, el left join nos permite agregar informaci√≥n sobre una misma unidad de observaci√≥n proveniente de distintas fuentes.\nOtro ejemplo Veamos un segundo ejemplo con m√°s filas y m√°s columnas, √©sta vez sobre animalitos üêàüêÄüêï\nanimales_x \u0026lt;- tibble(animal = c(\u0026#34;gato\u0026#34;, \u0026#34;rat√≥n\u0026#34;, \u0026#34;perro\u0026#34;, \u0026#34;pez\u0026#34;), color = c(\u0026#34;gris\u0026#34;, \u0026#34;negro\u0026#34;, \u0026#34;blanco\u0026#34;, \u0026#34;azul\u0026#34;), tama√±o = c(34, 16, 50, 3)) animal color tama√±o gato gris 34 rat√≥n negro 16 perro blanco 50 pez azul 3 La primera tabla contiene los nombres de animales (identificador √∫nico), sus colores y sus medidas. La segunda tabla tambi√©n contiene nombres, pero agrega su cantidad de patas1 y sus edades.\nanimales_y \u0026lt;- tibble(animal = c(\u0026#34;perro\u0026#34;, \u0026#34;gato\u0026#34;, \u0026#34;pez\u0026#34;), patas = c(4, 3, 0), edad = c(8, 3, 1)) animal patas edad perro 4 8 gato 3 3 pez 0 1 Las dos tablas tienen distinta cantidad de observaciones, y adem√°s las observaciones clave (columna animal) que se usar√°n como llave de uni√≥n est√°n desordenadas.\nCuando los data frames tienen distinta cantidad de filas, el orden en que hacemos la uni√≥n es importante: en un left join la primera tabla (o izquierda) es la tabla principal, a la cual se le agregan las columnas de una segunda tabla, en base a las coincidencias de la columna clave. Por lo tanto, si unimos o cruzamos las tablas poniendo primero la tabla m√°s grande y despu√©s la m√°s peque√±a, obtendremos casos perdidos por las filas de la primera tabla que no obtuvieron coincidencias en la segunda.\nanimales_3 \u0026lt;- left_join(animales_x, animales_y) Joining with `by = join_by(animal)` animal color tama√±o patas edad gato gris 34 3 3 rat√≥n negro 16 NA NA perro blanco 50 4 8 pez azul 3 0 1 Como podemos ver, obtenemos celdas con NA en la observaci√≥n rat√≥n, debido a que en la segunda tabla (animales_y) no hab√≠an datos sobre este animalito. Una pena üòî\nTambi√©n ser√≠a una opci√≥n hacer el cruce al rev√©s, poniendo primero la tabla animales_y (3 filas) y despu√©s animales_x (4 filas), con el objetivo de que las observaciones de la tabla animales_x complementen las observaciones de animales_y donde hayan coincidencias, y descartando los casos que no tienen en com√∫n:\nanimales_3 \u0026lt;- left_join(animales_y, animales_x) Joining with `by = join_by(animal)` animal patas edad color tama√±o perro 4 8 blanco 50 gato 3 3 gris 34 pez 0 1 azul 3 Ahora no tenemos datos perdidos, porque si bien animales_x ten√≠a m√°s observaciones que animales_y, animales_y conten√≠a todas las observaciones de animales_x identificadas por la variable animal, lo que podemos confirmar comparando las diferencias entre ambas columnas con la funci√≥n waldo::compare():\nlibrary(waldo) compare(sort(animales_x$animal), sort(animales_y$animal)) `old`: \u0026quot;gato\u0026quot; \u0026quot;perro\u0026quot; \u0026quot;pez\u0026quot; \u0026quot;rat√≥n\u0026quot; `new`: \u0026quot;gato\u0026quot; \u0026quot;perro\u0026quot; \u0026quot;pez\u0026quot; Caso licencias falsas Un caso ic√≥nico de uso de left join fue el estudio realizado por la Contralor√≠a General de la Rep√∫blica de Chile, donde se cruzaron bases de datos que ten√≠an en com√∫n la posibilidad de identificar funcionarios p√∫blicos:\nSe trata de un estudio a partir del cruce de informaci√≥n de las salidas del pa√≠s registradas por la Polic√≠a de Investigaciones (PDI), la base de funcionarios p√∫blicos y las licencias m√©dicas que se otorgaron entre el 2023 y 2024. (Fuente: B√≠o B√≠o)\nLa hip√≥tesis ser√≠a que una persona que sale del pa√≠s durante su licencia m√©dica ser√≠a probablemente una persona que consigui√≥ una licencia falsa para tomarse vacaciones üèñÔ∏è‚òÄÔ∏è\nSimulemos lo que podr√≠a haber hecho la Contralor√≠a para detectar estos casos. Asumimos que contaron con (al menos) tres bases de datos: una de funcionarios p√∫blicos, una de licencias m√©dicas, y otra de viajes al extranjero, las tres teniendo en com√∫n el RUN (c√≥digo de identificaci√≥n √∫nico de ciudadanos chilenos) para poder cruzar las personas.\noptions(scipen = 9999) funcionarios \u0026lt;- tibble(run = c(10000001, 10000002, 10000003), nombre = c(\u0026#34;mar√≠a\u0026#34;, \u0026#34;pepito\u0026#34;, \u0026#34;juanito\u0026#34;), ministerio = c(\u0026#34;defensa\u0026#34;, \u0026#34;econom√≠a\u0026#34;, \u0026#34;hacienda\u0026#34;)) run nombre ministerio 10000001 mar√≠a defensa 10000002 pepito econom√≠a 10000003 juanito hacienda Tenemos identificados tres funcionarios p√∫blicos de distintos servicios.\nLuego tenemos una base de datos con licencias m√©dicas de trabajadores que pueden o no ser funcionarios p√∫blicos. Con la base de los RUN de funcionarios p√∫blicos podemos identificar si las licencias corresponden a funcionarios p√∫blicos y no a trabajadores del sector privado.\nlicencias \u0026lt;- tibble(run = c(10000001, 10000002, 10000003, 10000004), licencia = c(FALSE, FALSE, TRUE, TRUE), licencia_inicio = c(NA, \u0026#34;2024-04-10\u0026#34;, \u0026#34;2024-02-04\u0026#34;, \u0026#34;2010-09-18\u0026#34;), licencia_fin = c(NA, \u0026#34;2024-04-13\u0026#34;, \u0026#34;2024-02-18\u0026#34;, \u0026#34;2030-12-31\u0026#34;)) run licencia licencia_inicio licencia_fin 10000001 FALSE NA NA 10000002 FALSE 2024-04-10 2024-04-13 10000003 TRUE 2024-02-04 2024-02-18 10000004 TRUE 2010-09-18 2030-12-31 Lo importante de esta tabla es que tenemos una fecha de inicio y una fecha de fin de la licencia m√©dica.\nFinalmente tenemos la informaci√≥n de salidas del pa√≠s de distintas personas, que pueden o no ser funcionarios p√∫blicos, y que pueden o no haber estado con licencia m√©dica ü§î\nviajes \u0026lt;- tibble(run = c(10000005, 10000001, 10000002, 10000003, 10000008), viaje_destino = c(\u0026#34;Bolivia\u0026#34;, \u0026#34;Per√∫\u0026#34;, \u0026#34;Argentina\u0026#34;, \u0026#34;Italia\u0026#34;, \u0026#34;Espa√±a\u0026#34;), viaje_fecha = c(\u0026#34;2021-01-06\u0026#34;, \u0026#34;2021-02-15\u0026#34;, \u0026#34;2023-06-23\u0026#34;, \u0026#34;2024-02-09\u0026#34;, \u0026#34;2025-08-17\u0026#34;) ) run viaje_destino viaje_fecha 10000005 Bolivia 2021-01-06 10000001 Per√∫ 2021-02-15 10000002 Argentina 2023-06-23 10000003 Italia 2024-02-09 10000008 Espa√±a 2025-08-17 Ahora que tenemos datos simulados, usaremos {dplyr} para trabajar con los datos y encontrar respuestas.\nSi necesitas aprender lo b√°sico del manejo de datos con R, revisa este tutorial b√°sico de {dplyr}! Lo primero ser√≠a filtrar las licencias m√©dicas para que solamente correspondan con funcionarios p√∫blicos (tambi√©n podr√≠a hacerse con left_join() pero creo que es m√°s pertinente un filtro)\nlicencias_f \u0026lt;- licencias |\u0026gt; # s√≥lo funcionarios p√∫blicos filter(run %in% funcionarios$run) Luego, cruzamos los datos de licencias de funcionarios p√∫blicos con el registro de salidas del pa√≠s:\n# cruzar con viajes cruce \u0026lt;- licencias_f |\u0026gt; left_join(viajes, join_by(run)) Finalmente revisamos si los viajes fueron durante el tiempo de licencia m√©dica, y si los viajes fueron fuera del pa√≠s. Podemos hacer esto con un filtro, o preferentemente creando una columna nueva (irregular) que indique si se cumple o no la evaluaci√≥n.\n# revisar si viajaron fuera del pa√≠s durante licencia resultado \u0026lt;- cruce |\u0026gt; # crear una nueva variable mutate(irregular = licencia == TRUE \u0026amp; # personas on licencia viaje_destino != \u0026#34;Chile\u0026#34; \u0026amp; # viajes fuera de Chile between(viaje_fecha, licencia_inicio, licencia_fin) # viaje durante el tiempo de licencia ) |\u0026gt; select(-viaje_destino) run licencia licencia_inicio licencia_fin viaje_fecha irregular 10000001 FALSE NA NA 2021-02-15 FALSE 10000002 FALSE 2024-04-10 2024-04-13 2023-06-23 FALSE 10000003 TRUE 2024-02-04 2024-02-18 2024-02-09 TRUE ‚ö†Ô∏è Detectamos un caso de funcionario p√∫blico que viaj√≥ fuera del pa√≠s durante su licencia m√©dica! La √∫ltima columna marca TRUE si se trata de un caso irregular.\nConclusi√≥n Podemos usar left_join() para completar los datos sobre nuestra unidad de an√°lisis si la informaci√≥n viene diseminada en distintas tablas o archivos. Pero tambi√©n podemos utilizarla para complementar datos desde distintas fuentes, aumentando la informaci√≥n que tenemos sobre las observaciones que estemos estudiando, o bien, para realizar cruces de informaci√≥n que nos entreguen coincidencias relevantes.\nel gatito lamentablemente sufri√≥ un accidente y perdi√≥ una patita trasera üòø\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-08-16T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/left_join/","tags":"procesamiento de datos ; limpieza de datos","title":"Unir o cruzar datos con left_join()"},{"content":"Al terminar el procesamiento o limpieza de un conjunto de datos, usualmente necesitamos entregar la base en un formato m√°s amigable para otros colegas o usuarios/as, lo que significa: Excel. Exportar datos de R a Excel es f√°cil: con la funci√≥n writexl::write_xlsx() podemos guardar cualquier dataframe en Excel. Pero esta funci√≥n hace s√≥lo eso, y el archivo resultante es b√°sico y hasta feo.\nSin embargo, existe el paquete {openxlsx}, que adem√°s de leer y escribir archivos Excel, nos entrega funciones para generar archivos Excel desde R que contengan todo tipo de formato, estilo de tablas, y manipulaci√≥n celda por celda del archivo resultante, con lo que podemos generar planillas de Excel atractivas desde R.\nLa gracia es que podremos usar estas herramientas de forma reproducible (poder re-hacer gratis la planilla con datos actualizados o corregidos), y tambi√©n podremos combinar la programaci√≥n de R para crear estilos condicionales, crear cientos de archivos Excel, o planillas de cientos de hojas, y mucho m√°s.\nCarguemos un conjunto de datos de indicadores de calidad de vida urbana de Chile, del Sistema de Indicadores y Est√°ndares de Desarrollo Urbano.\nlibrary(arrow) datos \u0026lt;- read_parquet(\u0026#34;https://github.com/bastianolea/siedu_indicadores_urbanos/raw/main/datos/siedu_indicadores_desarrollo_urbano.parquet\u0026#34;) datos # A tibble: 6,701 √ó 12 codigo_comuna codigo_region codigo_provincia nombre_region nombre_provincia \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 1107 01 011 Tarapac√° Iquique 2 1107 01 011 Tarapac√° Iquique 3 1107 01 011 Tarapac√° Iquique 4 1107 01 011 Tarapac√° Iquique 5 1107 01 011 Tarapac√° Iquique 6 1107 01 011 Tarapac√° Iquique 7 1107 01 011 Tarapac√° Iquique 8 1107 01 011 Tarapac√° Iquique 9 1107 01 011 Tarapac√° Iquique 10 1107 01 011 Tarapac√° Iquique # ‚Ñπ 6,691 more rows # ‚Ñπ 7 more variables: nombre_comuna \u0026lt;chr\u0026gt;, id \u0026lt;chr\u0026gt;, a√±o \u0026lt;dbl\u0026gt;, variable \u0026lt;chr\u0026gt;, # valor \u0026lt;dbl\u0026gt;, medida \u0026lt;chr\u0026gt;, estandar \u0026lt;chr\u0026gt; Filtremos los datos para dejar tres indicadores, y s√≥lo los valores m√°s recientes para cada unidad territorial.\nlibrary(dplyr) datos \u0026lt;- datos |\u0026gt; # filtrar variables filter(variable %in% c(\u0026#34;Distancia a plazas p√∫blicas\u0026#34;, \u0026#34;N√∫mero de v√≠ctimas mortales en siniestros de tr√°nsito por cada 100.000 habitantes\u0026#34;, \u0026#34;Porcentaje de cobertura de la red de ciclov√≠a sobre la red vial\u0026#34;)) |\u0026gt; # dejar s√≥lo valores m√°s recientes por comuna group_by(nombre_region, nombre_comuna, variable) |\u0026gt; filter(a√±o == max(a√±o)) |\u0026gt; ungroup() datos |\u0026gt; select(-starts_with(\u0026#34;codigo\u0026#34;)) # A tibble: 340 √ó 9 nombre_region nombre_provincia nombre_comuna id a√±o variable valor \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Tarapac√° Iquique Alto Hospicio BPU_‚Ä¶ 2018 Distanc‚Ä¶ 275. 2 Tarapac√° Iquique Alto Hospicio DE_28 2021 N√∫mero ‚Ä¶ 9.70 3 Tarapac√° Iquique Alto Hospicio EA_93 2021 Porcent‚Ä¶ 1.46 4 La Araucan√≠a Malleco Angol BPU_‚Ä¶ 2018 Distanc‚Ä¶ 342. 5 La Araucan√≠a Malleco Angol DE_28 2021 N√∫mero ‚Ä¶ 12.4 6 La Araucan√≠a Malleco Angol EA_93 2021 Porcent‚Ä¶ 4.59 7 Antofagasta Antofagasta Antofagasta BPU_‚Ä¶ 2018 Distanc‚Ä¶ 426. 8 Antofagasta Antofagasta Antofagasta DE_28 2021 N√∫mero ‚Ä¶ 7.84 9 Antofagasta Antofagasta Antofagasta EA_93 2021 Porcent‚Ä¶ 2.74 10 Arica y Parinacota Arica Arica BPU_‚Ä¶ 2018 Distanc‚Ä¶ 324. # ‚Ñπ 330 more rows # ‚Ñπ 2 more variables: medida \u0026lt;chr\u0026gt;, estandar \u0026lt;chr\u0026gt; Ahora pivotemos los datos para crear una t√≠pica tabla de Excel donde los indicadores est√©n en columnas hacia el lado, mientras que hacia abajo est√°n las unidades u observaciones; en este caso, comunas.\nlibrary(tidyr) datos \u0026lt;- datos |\u0026gt; select(nombre_region, nombre_comuna, codigo_comuna, variable, valor) |\u0026gt; pivot_wider(names_from = variable, values_from = valor) |\u0026gt; arrange(codigo_comuna) datos |\u0026gt; select(-starts_with(\u0026#34;codigo\u0026#34;)) # A tibble: 117 √ó 5 nombre_region nombre_comuna Distancia a plazas p√∫b‚Ä¶¬π N√∫mero de v√≠ctimas m‚Ä¶¬≤ \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Tarapac√° Iquique 282. 3.52 2 Tarapac√° Alto Hospicio 275. 9.70 3 Antofagasta Antofagasta 426. 7.84 4 Antofagasta Calama 274. 8.28 5 Atacama Copiap√≥ 245. 8.66 6 Atacama Tierra Amarilla 289. 41.7 7 Atacama Vallenar 241. 12.2 8 Coquimbo La Serena 303. 6.29 9 Coquimbo Coquimbo 291. 10.3 10 Coquimbo Ovalle 275. 18.0 # ‚Ñπ 107 more rows # ‚Ñπ abbreviated names: ¬π‚Äã`Distancia a plazas p√∫blicas`, # ¬≤‚Äã`N√∫mero de v√≠ctimas mortales en siniestros de tr√°nsito por cada 100.000 habitantes` # ‚Ñπ 1 more variable: # `Porcentaje de cobertura de la red de ciclov√≠a sobre la red vial` \u0026lt;dbl\u0026gt; Si guardamos este archivo con {writexl}, obtenemos una planilla b√°sica de Excel:\nlibrary(writexl) write_xlsx(datos, \u0026#34;indicadores.xlsx\u0026#34;) Este resultado puede ser suficiente para algo r√°pido, pero definitivamente no es algo presentable ni atractivo.\nCrear planillas Excel personalizadas con {openxlsx} El primer paso para crear nuestro Excel es crear la planilla con la funci√≥n createWorkbook(). Esta funci√≥n se asigna a un objeto que representar√° a nuestra planilla.\nlibrary(openxlsx) tabla \u0026lt;- createWorkbook() Iremos aplicando distintas funciones de {openxlsx} sobre este objeto tabla para ir modificando la planilla Excel resultante.\nCon nuestra planilla creada, tenemos que crear una hoja de Excel para que podamos ponerle datos a la planilla.\naddWorksheet(tabla, \u0026#34;Hoja\u0026#34;) Podemos usar esta funci√≥n una o varias veces para crear una o varias hojas en nuestra planilla.\nGuardar la planilla Excel En cualquier momento del proceso puedes guardar la planilla como archivo Excel para previsualizar como est√° quedando tu tabla, aunque en este paso del tutorial nuestra planilla est√° vac√≠a.\n# guardar saveWorkbook(tabla, \u0026#34;indicadores.xlsx\u0026#34;, overwrite = TRUE) Escribir datos en la hoja de Excel Ahora tenemos que rellenar la planilla con datos con la funci√≥n writeDataTable(), a la que hay que especificarle primero la planilla que vamos a editar (tabla), y la hoja (\u0026quot;Hoja\u0026quot;) en que queremos escribir los datos. En el argumento x entregamos el dataframe que queremos escribir en la hoja de la planilla.\n# tabla con formato personalizado writeDataTable(tabla, \u0026#34;Hoja\u0026#34;, x = datos, # la tabla que queremos escribir en el Excel tableStyle = \u0026#34;TableStyleLight9\u0026#34;, # estilo de la tabla startRow = 1, startCol = 1, colNames = TRUE, bandedCols = TRUE, bandedRows = FALSE, withFilter = FALSE, # keepNA = TRUE, # na.string = \u0026#34;sin datos\u0026#34; ) Esta funci√≥n tiene varios argumentos que permiten personalizar la planilla. El m√°s relevante es tableStyle, con el que le damos uno de los temas de Excel a la tabla. Podemos encontrar los temas de Excel en el bot√≥n Dar formato como tabla del panel Inicio de Excel.\nEn este panel, si pones el cursor sobre los √≠conos puedes ver que cada estilo tiene un n√∫mero (9 es una tabla azul con fila de encabezado, 13 es la misma pero morada, 5 es una tabla celeste con encabezado sin relleno, etc.), y una intensidad (claro, medio y oscuro)\nAs√≠ va quedando nuestra planilla!\nModificar ancho de columnas Si tenemos columnas que requieren m√°s ancho, podemos definirlo con setColWidths(). En esta y otras funciones de {openxlsx}, en el argumento cols le decimos qu√© columnas queremos afectar, y luego le decimos el valor que queremos darle a cada columna correspondiente.\n# ancho de columnas setColWidths(tabla, \u0026#34;Hoja\u0026#34;, cols = c(1, 2, 3, 4, 5, 6), widths = c(22, 22, 13, 30, 30, 30) ) En este ejemplo, afectamos las 6 columnas: a las 1 y 2 le damos 22 de ancho, luego a la 3 le damos 13, y a las tres finales (columnas con los indicadores) les damos un mayor ancho de 30.\nSi el texto a√∫n no cabe en las celdas, podemos definir un estilo a las celdas para que el texto se corte y aumente el alto de las celdas con mucho texto. Para definir un estilo usamos addStyle() y le damos un estilo que se hace con createStyle(). Luego, se define las filas (rows) y columnas (cols) que recibir√°n este estilo.\n# flujo de texto addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(wrapText = TRUE), rows = 1:nrow(datos)+1, cols = c(1, 4, 5, 6), stack = TRUE, gridExpand = T) En este caso le puse que las filas a las que se aplica el estilo sean todas las filas del dataframe (nrow(datos)) m√°s 1, porque recordemos que en Excel la fila de los nombres de columna cuenta como una fila. Por eso el estilo se aplica desde la fila 1 a la nrow(datos)+1.\nDefinir estilo de texto Ahora quiero que las primeras dos columnas vayan en negrita. Hacemos lo mismo que en el paso anterior, pero ahora creamos un estilo distinto con createStyle():\n# celdas en negrita addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(textDecoration = \u0026#34;BOLD\u0026#34;), rows = 1:nrow(datos)+1, cols = c(1, 2), stack = TRUE, gridExpand = T) Es importante definir los argumentos stack = TRUE, gridExpand = T para que los estilos se sumen en vez de reemplazarse.\nNotamos que, cuando el texto de las celdas fluye para usar m√∫ltiples l√≠neas, los valores quedan alineados verticalmente hacia abajo, y se ven feos, as√≠ que los alinearemos verticalmente en el centro:\n# centrado vertical addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(valign = \u0026#34;center\u0026#34;), rows = 1:nrow(datos)+1, cols = 1:length(datos), stack = TRUE, gridExpand = T) N√≥tese que aplicamos este estilo a todas las filas (1:nrow(datos)+1) y a todas las columnas 1:length(datos).\nFormatear variables num√©ricas Los n√∫meros con decimales pueden ser ajustados definiendo el estilo createStyle(numFmt = \u0026quot;0.00\u0026quot;) o similar, donde el texto representa la cantidad de decimales que queremos mostrar:\n# decimales addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(numFmt = \u0026#34;0.00\u0026#34;), rows = 1:nrow(datos)+1, cols = c(6), stack = TRUE, gridExpand = TRUE) addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(numFmt = \u0026#34;0.0\u0026#34;), rows = 1:nrow(datos)+1, cols = c(4, 5), stack = TRUE, gridExpand = TRUE) Estilo condicional de celdas de acuerdo a los valores de los datos Como hemos visto hasta ahora, todos los estilos se aplican definiendo la posici√≥n de las filas y columnas que queremos modificar. Por ejemplo, si queremos modificar la cuarta fila de la segunda columna, ser√≠a rows = 4, cols = 2.\nPodemos aprovechar esta l√≥gica para aplicar estilos que dependan del valor de los datos.\nPor ejemplo, si tenemos un vector de datos:\ndatos[[4]] [1] 282.38 274.86 425.99 273.83 245.02 288.62 241.10 303.18 291.29 [10] 275.40 698.60 331.96 337.03 1014.74 487.85 422.81 195.91 258.19 [19] 335.53 349.64 692.08 463.75 383.77 579.18 418.08 326.72 533.01 [28] 629.13 1066.37 394.09 193.46 341.26 309.32 271.24 237.21 626.54 [37] 196.91 261.74 243.70 277.05 250.93 334.88 260.42 298.01 397.34 [46] 630.78 278.38 250.96 269.13 361.94 842.69 174.37 268.58 241.55 [55] 249.80 242.14 405.63 342.34 269.90 211.65 459.62 203.42 223.62 [64] 302.26 355.57 241.34 207.37 198.72 260.57 271.98 264.33 325.99 [73] 379.62 206.06 218.95 196.25 442.02 330.57 475.15 213.77 197.15 [82] 238.16 170.11 349.66 260.62 219.73 345.05 185.01 206.69 344.91 [91] 260.17 216.00 252.60 429.94 224.27 444.36 187.97 692.96 708.93 [100] 263.33 302.88 519.54 220.60 303.81 489.65 327.53 335.11 196.11 [109] 385.91 468.69 255.61 313.70 385.68 323.99 232.25 313.80 288.51 Podemos evaluar una comparaci√≥n para ver qu√© valores cumplen o no; en este caso, qu√© valores son superiores a 400:\ndatos[[4]] \u0026gt; 400 [1] FALSE FALSE TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE TRUE FALSE [13] FALSE TRUE TRUE TRUE FALSE FALSE FALSE FALSE TRUE TRUE FALSE TRUE [25] TRUE FALSE TRUE TRUE TRUE FALSE FALSE FALSE FALSE FALSE FALSE TRUE [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE TRUE FALSE FALSE [49] FALSE FALSE TRUE FALSE FALSE FALSE FALSE FALSE TRUE FALSE FALSE FALSE [61] TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE [73] FALSE FALSE FALSE FALSE TRUE FALSE TRUE FALSE FALSE FALSE FALSE FALSE [85] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE TRUE FALSE TRUE [97] FALSE TRUE TRUE FALSE FALSE TRUE FALSE FALSE TRUE FALSE FALSE FALSE [109] FALSE TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE Ahora que sabemos qu√© valores cumplen, con la funci√≥n which() podemos obtener su posici√≥n:\nwhich(datos[[4]] \u0026gt; 400) [1] 3 11 14 15 16 21 22 24 25 27 28 29 36 46 51 57 61 77 79 [20] 94 96 98 99 102 105 110 Es decir, obtenemos un vector que dice en qu√© filas se cumple la condici√≥n. Teniendo esto, podemos crear formatos condicionales seg√∫n los datos: creamos un estilo con createStyle() que defina un relleno, borde y color de borde, que se aplique solamente a las celdas donde se cumple la condici√≥n, pero sum√°ndole 1 para saltarnos la primera fila (nombres de columnas en Excel).\n# color condicional addStyle(tabla, \u0026#34;Hoja\u0026#34;, # crear estilo de color de relleno style = createStyle(fgFill = \u0026#34;#E6B8B7\u0026#34;, border = c(\u0026#34;top\u0026#34;, \u0026#34;bottom\u0026#34;), borderColour = c(\u0026#34;#DA9694\u0026#34;, \u0026#34;#DA9694\u0026#34;)), # filas a las que se va a aplicar el estilo rows = which(datos[[4]] \u0026gt; 400)+1, # celdas donde x es mayor a 400, + 1 para saltarse la primera fila cols = 4, stack = TRUE, gridExpand = T) # otro estilo para otra columna addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(fgFill = \u0026#34;#E6B8B7\u0026#34;, border = c(\u0026#34;top\u0026#34;, \u0026#34;bottom\u0026#34;), borderColour = c(\u0026#34;#DA9694\u0026#34;, \u0026#34;#DA9694\u0026#34;)), rows = which(datos[[5]] \u0026gt; 10)+1, cols = 5, stack = TRUE, gridExpand = T) # un tercer estilo con colores distintos addStyle(tabla, \u0026#34;Hoja\u0026#34;, style = createStyle(fgFill = \u0026#34;#D7E4BC\u0026#34;, border = c(\u0026#34;top\u0026#34;, \u0026#34;bottom\u0026#34;), borderColour = c(\u0026#34;#C4D79B\u0026#34;, \u0026#34;#C4D79B\u0026#34;)), rows = which(datos[[6]] \u0026gt; 5)+1, cols = 6, stack = TRUE, gridExpand = T) En este ejemplo aplicamos tres estilos condicionales a tres columnas distintas, cada uno con un criterio personalizado para destacar celdas con valores que cumplen la condici√≥n apropiada.\nCuando estemos satisfechxs con nuestra planilla, la guardamos como Excel.\n# guardar saveWorkbook(tabla, \u0026#34;indicadores.xlsx\u0026#34;, overwrite = TRUE) Otros Aqu√≠ voy a ir dejando otras funcionalidades √∫tiles de {openxlsx}:\nDefinir el tama√±o que tendr√° la ventana al abrir la planilla\n# tama√±o de la ventana setWindowSize(tabla, yWindow = 12, xWindow = 12, windowWidth = \u0026#34;20000\u0026#34;, windowHeight = \u0026#34;15000\u0026#34;) Cambiar la altura de las celdas:\n# altura para celdas con texto setRowHeights(tabla, \u0026#34;Hoja\u0026#34;, rows = c(6, 7, 12, 13), heights = c(64, 64, 64)) Otros tutoriales: Creating Professional Excel Reports with R: A Comprehensive Guide to openxlsx Package Making pretty Excel files in R ","date":"2025-08-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/excel_openxlsx/","tags":"limpieza de datos ; procesamiento de datos ; automatizaci√≥n ; tablas","title":"Crea planillas de Excel con formato personalizado desde R con {openxlsx}"},{"content":"En una clase reciente me preguntaron c√≥mo saber de una d√≥nde hay datos perdidos o missing en un conjunto de datos. La respuesta que di fue usar summarize() para contar la cantidad de datos perdidos en todas las columnas de un dataframe:\nlibrary(dplyr) # manipulaci√≥n de datos library(messy) # ensuciar datos # agregar datos perdidos al azar iris_m \u0026lt;- iris |\u0026gt; messy::make_missing(cols = names(iris)) iris_m |\u0026gt; # resumir los datos summarize( # en todas las columnas across(everything(), # contar la cantidad de missing ~sum(is.na(.x)) ) ) Sepal.Length Sepal.Width Petal.Length Petal.Width Species 1 12 21 16 21 11 Pero hay formas m√°s convenientes de hacerlo!\nEl paquete {visdat} tiene funciones para visualizar tus conjuntos de datos completos, para poder entenderlos de manera visual antes de proseguir con la limpieza o an√°lisis. El paquete entrega varias funciones vis_x() para visualzar la tabla de datos entera, destacando distintos aspectos de la misma.\ninstall.packages(\u0026#34;visdat\u0026#34;) library(visdat) En este post de ROpenSci hay una rese√±a m√°s completa del paquete, pero te dejo ejemplos √∫tiles a continuaci√≥n:\nVisualizar datos perdidos Para visualizar si es que hay datos perdidos en nuestro dataframe, y adem√°s saber d√≥nde est√°n esos datos perdidos, usamos la funci√≥n vis_miss():\nvis_miss(iris_m) {visdat} nos muestra visualmente toda la tabla de datos como un rect√°ngulo, destacando los datos perdidos. ¬°S√∫per √∫til!\nCon el argumento cluster podemos agrupar los datos perdidos para tener una mejor noci√≥n de la proporci√≥n en cada columna.\nvis_miss(iris_m, cluster = TRUE) Visualizar el tipo de las columnas Con vis_dat() vemos con colores distintos las columnas que corresponden a tipos distintos (num√©rico, caracter, factor, etc.)\nvis_dat(iris) Visualizar los valores de las variables num√©ricas Para explorar los datos de tipo num√©rico, podemos usar vis_value() para visualizar con una escala de colores los valores de cada columna, d√°ndonos una noci√≥n sobre las cifras dentro de nuestra tabla:\niris |\u0026gt; select(where(is.numeric)) |\u0026gt; vis_value() Visualizar valores num√©ricos que cumplan una condici√≥n Para indagar en los datos num√©ricos, podemos entregar una condici√≥n dentro de una funci√≥n lambda para aplicarla a todas las columnas y visualizar los resultados:\nvis_expect(iris, ~.x \u0026gt;= 5) Warning in Ops.factor(.x, 5): '\u0026gt;=' not meaningful for factors ","date":"2025-08-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/visdat/","tags":"visualizaci√≥n de datos ; datos perdidos ; limpieza de datos ; consejos","title":"Echa un vistazo preliminar a tus datos con {visdat}"},{"content":" √çndice Validaci√≥n b√°sica Funciones de validaci√≥n Validaci√≥n avanzada Si est√°s procesando muchos datos y/o datos que vienen de distintas fuentes con R, validarlos puede ayudarte a encontrar problemas antes de que sea tarde! üò±\n¬øQu√© es la validaci√≥n de datos? Son las distintas pruebas que crearemos para confirmar que nuestros datos cumplen ciertos criterios. El objetivo es entregarnos la certeza de que nuestros datos son como esperamos luego de procesarlos. Para lograrlo, ponemos a prueba nuestros datos en distintos puntos de nuestros procesos de an√°lisis de datos.\nPor ejemplo: luego de cargar un conjunto de datos a R y realizar una limpieza b√°sica, ¬ørealmente los datos quedaron como deb√≠an quedar?\n¬øTenemos datos perdidos en variables donde no esperamos que los hayan? ¬øLa tabla tiene la cantidad de filas esperadas? En una variable num√©rica, ¬øexisten observaciones que se salen del rango esperable? Como a√±os en el futuro, edades imposibles, etc. Las columnas que contienen n√∫meros, ¬øson realmente num√©ricas, o hay texto en algunas celdas escurridizas? ¬øLas variables categ√≥ricas o de texto est√°n bien escritas, o vienen cosas repetidas en min√∫sculas y otras en may√∫sculas? ¬øUna variable categ√≥rica contiene exactamente las categor√≠as posibles, o tiene m√°s o menos que las esperadas? √âste tipo de revisiones las hacemos generalmente de forma manual mientras exploramos los datos. Pero la idea de la validaci√≥n de datos es que formalicemos estas pruebas para poder aplicarlas en distintos momentos, y a distintos conjuntos de datos.\nValidaci√≥n b√°sica En el fondo, una validaci√≥n no es m√°s que evaluar una expresi√≥n condicional para ver si se cumple o no se cumple. Creemos un conjunto de datos de prueba:\nlibrary(dplyr) animales \u0026lt;- tribble(~animal, ~patas, ~lindura, ~color, \u0026#34;mapache\u0026#34;, 4, 100, \u0026#34;gris\u0026#34;, \u0026#34;gato\u0026#34;, 80, 90, \u0026#34;negro\u0026#34;, \u0026#34;gallina\u0026#34;, 2, NA, \u0026#34;plumas\u0026#34;) Para validar los datos, puedes usar expresiones ifs para crear pruebas que revisan si tus resultados cumplen con criterios m√≠nimos, como contener ciertas columnas, que no hayan datos perdidos, o lo que necesites.\nCreemos una expresi√≥n condicional para revisar si es que nuestra tabla de datos tiene al menos una observaci√≥n:\n# validar si el dataframe tiene filas if (nrow(animales) \u0026gt; 0) { message(\u0026#34;tabla con filas!\u0026#34;) } else { warning(\u0026#34;tabla sin filas\u0026#34;) } tabla con filas! Con este c√≥digo confirmamos que los datos cumplen con este criterio m√≠nimo. Si modificamos los datos y probamos de nuevo, la validaci√≥n nos avisar√° que hay un problema con los datos:\n# modificar el dataframe y ver si sigue cumpliendo animales2 \u0026lt;- animales |\u0026gt; filter(patas == 0) if (nrow(animales2) \u0026gt; 0) { message(\u0026#34;tabla con filas!\u0026#34;) } else { warning(\u0026#34;tabla sin filas :(\u0026#34;) } Warning: tabla sin filas :( Siguiendo la misma idea, podemos crear otras validaciones para confirmar que los datos vienen como esperamos:\n# revisar que no hayan datos perdidos en columna `lindura` if (sum(is.na(animales$lindura)) == 0) { message(\u0026#34;sin datos perdidos en variable `lindura`\u0026#34;) } else { stop(\u0026#34;datos perdidos en variable `lindura`, ¬øacaso demasiada lindura?\u0026#34;) } Error: datos perdidos en variable `lindura`, ¬øacaso demasiada lindura? # revisar que variable `patas` no tenga observaciones fuera del rango posible if (all(between(animales$patas, 2, 8))) { message(\u0026#34;cantidad de patas aceptable\u0026#34;) } else { stop(\u0026#34;demasiadas patas!\u0026#34;) } Error: demasiadas patas! # revisar que los valores de `colores` sean v√°lidos if (all(animales$color %in% c(\u0026#34;verde\u0026#34;, \u0026#34;negro\u0026#34;, \u0026#34;caf√©\u0026#34;, \u0026#34;gris\u0026#34;, \u0026#34;blanco\u0026#34;))) { message(\u0026#34;colores aceptables\u0026#34;) } else { stop(\u0026#34;variable colores tiene datos fuera de lo esperado\u0026#34;) } Error: variable colores tiene datos fuera de lo esperado Al ejecutar esta validaciones obtenemos mensajes que nos indican el estado de los datos, o su calidad.\nDentro de las condicionales puedes agregar warning() o message() para recibir avisos en tu consola dependiendo de lo que se obtiene en cada prueba. Tambi√©n puedes usar stop() para que detener la ejecuci√≥n si la validaci√≥n sale negativa, en el caso de que sea muy importante de resolver el problema con los datos de manera inmediata en vez de continuar con el flujo de procesamiento.\nOtra alternativa para crear validaciones es usar la funci√≥n stopifnot(), a la que le entregamos una condici√≥n que esperamos que se cumpla, y si no se cumple, la ejecuci√≥n se detiene:\nstopifnot(\u0026#34;valores perdidos\u0026#34; = is.na(animales$lindura)) Error: valores perdidos La diferencia es que con stopifnot() tenemos menos control sobre qu√© hacer cuando se cumple o no se cumple la condici√≥n, y solamente te avisa si es que no se cumple.\nFunciones de validaci√≥n El siguiente paso es reunir todas estas pruebas en una sola funci√≥n, para que puedas reutilizarla en distintas versiones de la tabla, y en distintos conjuntos de datos.\nCreamos una funci√≥n con function(), donde el argumento data va a representar el conjunto de datos que pasemos a la funci√≥n.\nrevisar \u0026lt;- function(data) { # prueba de filas if (nrow(data) \u0026gt; 0) { message(\u0026#34;filas ok\u0026#34;) } else { warning(\u0026#34;tabla sin filas\u0026#34;) } # prueba de perdidos if (any(is.na(data$lindura))) { warning(\u0026#34;datos perdidos\u0026#34;) } else { message(\u0026#34;sin datos perdidos\u0026#34;) } # prueba de rangos if (all(between(data$patas, 2, 8))) { message(\u0026#34;rango aceptable\u0026#34;) } else { warning(\u0026#34;datos fuera de rango\u0026#34;) } # prueba de valores categ√≥ricos if (all(data$color %in% c(\u0026#34;verde\u0026#34;, \u0026#34;negro\u0026#34;, \u0026#34;caf√©\u0026#34;, \u0026#34;rosado\u0026#34;, \u0026#34;gris\u0026#34;, \u0026#34;blanco\u0026#34;))) { message(\u0026#34;valores esperados\u0026#34;) } else { warning(\u0026#34;valores inesperados\u0026#34;) } } Ahora podemos aplicar la funci√≥n a los datos para validarlos en cualquier momento:\nrevisar(animales) filas ok Warning in revisar(animales): datos perdidos Warning in revisar(animales): datos fuera de rango Warning in revisar(animales): valores inesperados Podemos corregir los datos y volver a aplicar la validaci√≥n para confirmar que ahora est√°n correctos:\n# corregir datos luego de las pruebas animales_3 \u0026lt;- animales |\u0026gt; filter(patas \u0026lt;= 8) |\u0026gt; mutate(color = recode(color, \u0026#34;plumas\u0026#34; = \u0026#34;blanco\u0026#34;)) |\u0026gt; mutate(lindura = if_else(is.na(lindura), 0, lindura)) # validar revisar(animales_3) filas ok sin datos perdidos rango aceptable valores esperados Finalmente, podemos volver a aplicar la validaci√≥n a un conjunto de datos actualizado o una versi√≥n distinta de una tabla con las mismas caracter√≠sticas:\nanimales_4 \u0026lt;- tribble(~animal, ~patas, ~lindura, ~color, \u0026#34;perro\u0026#34;, 4, 50, \u0026#34;caf√©\u0026#34;, \u0026#34;ratita\u0026#34;, 3, 99, \u0026#34;caf√©\u0026#34;, \u0026#34;chancho\u0026#34;, 4, 70, \u0026#34;rosado\u0026#34;, \u0026#34;ara√±a\u0026#34;, 8, -100, \u0026#34;negro\u0026#34;) animales_4 |\u0026gt; revisar() filas ok sin datos perdidos rango aceptable valores esperados animales_4 |\u0026gt; filter(lindura \u0026gt; 50) |\u0026gt; revisar() filas ok sin datos perdidos rango aceptable valores esperados Estas peque√±as buenas pr√°cticas te van a ayudar a reducir la incertidumbre en rutinas largas de procesamiento de datos!\nValidaci√≥n avanzada El paquete de R {pointblank} se especializa en validaci√≥n de datos, as√≠ que si requieres algo m√°s avanzado para garantizar la calidad de tus datos y la estabilidad de tus procesos, revisa este post con un tutorial!\n","date":"2025-08-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/validacion_basica/","tags":"procesamiento de datos ; consejos ; automatizaci√≥n ; control de flujo ; funciones","title":"Validaci√≥n b√°sica de datos con R"},{"content":" Last.fm es una plataforma donde las personas van registrando la m√∫sica que escuchan diariamente, y luego pueden obtener estad√≠sticas sobre sus gustos musicales y recomendaciones basadas en los gustos de usuarios similares.\nTen√≠a ganas de reproducir en R uno de los gr√°ficos que aparecen en el reporte mensual:\nAs√≠ que me apliqu√© con {ggplot2}, usando un paquete que agrega una visualizaci√≥n similar, y usando otro paquete para descargar los datos de mi perfil de Last.fm.\nObtenci√≥n de datos Para obtener los datos de mis canciones escuchadas us√© el paquete {lastfmR}:\ndevtools::install_github(\u0026#34;ppatrzyk/lastfmR\u0026#34;) library(lastfmR) La obtenci√≥n de los datos de Last.fm se hace con las siguientes funciones:\nscrobbles \u0026lt;- get_scrobbles(user = \u0026#34;bastimapache\u0026#34;) artist_info \u0026lt;- get_library_info(user = \u0026#34;bastimapache\u0026#34;) scrobbles # A tibble: 17,000 √ó 4 date artist track album \u0026lt;POSIXt\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 2025-07-27 18:38:27 Bullet for My Valentine Tears Don't Fall The Poison 2 2025-07-25 15:35:20 Premiata Forneria Marconi Geranio Per un amico 3 2025-07-25 15:13:14 Premiata Forneria Marconi Il Banchetto Per un amico 4 2025-07-25 15:06:31 Premiata Forneria Marconi Per Un Amico Per un amico 5 2025-07-25 15:01:41 Premiata Forneria Marconi Generale Per un amico 6 2025-07-25 14:48:01 Premiata Forneria Marconi Appena un po' Per un amico 7 2025-07-25 13:46:32 The Body \u0026amp; OAA Docile Gift Enemy of Love 8 2025-07-25 13:43:07 The Body \u0026amp; OAA Ignorant Messiah Enemy of Love 9 2025-07-25 13:40:40 The Body \u0026amp; OAA Miserable Freedom Enemy of Love 10 2025-07-25 13:37:31 The Body \u0026amp; OAA Barren of Joy Enemy of Love # ‚Ñπ 16,990 more rows artist_info # A tibble: 3,882 √ó 5 artist user_scrobbles global_listeners global_scrobbles artist_tags \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; 1 Opeth 5006 1066799 110560572 Progressiv‚Ä¶ 2 Magma 4905 158887 3353010 Zeuhl; Pro‚Ä¶ 3 Between the Bur‚Ä¶ 4519 411709 27305709 Progressiv‚Ä¶ 4 Erik Satie 3439 1690933 35397288 Classical;‚Ä¶ 5 ASIAN KUNG-FU G‚Ä¶ 3318 601332 33012597 J-rock; ja‚Ä¶ 6 Gojira 3289 898440 71798696 death meta‚Ä¶ 7 Boris 3178 538299 21493173 drone; Sto‚Ä¶ 8 Rosetta 3148 140465 6019868 Post-Metal‚Ä¶ 9 The Beatles 3019 5830439 885054050 classic ro‚Ä¶ 10 Mastodon 3006 1139246 72786659 Progressiv‚Ä¶ # ‚Ñπ 3,872 more rows Los datos obtenidos son el historial de canciones escuchadas, y los artistas escuchados que adem√°s incluye las etiquetas de cada artista, que corresponden a los g√©neros o subg√©neros musicales que las y los usuarios de Last.fm agregan.\nProcesamiento de datos Teniendo estos dos conjuntos de datos, los unimos seg√∫n la variable del nombre de artista, para que cada canci√≥n escuchada tenga las etiquetas del artista:\nlibrary(dplyr) library(lubridate) library(tidyr) scrobbles_tags \u0026lt;- scrobbles |\u0026gt; tibble() |\u0026gt; left_join(artist_info |\u0026gt; select(artist, artist_tags)) Luego, como cada artista puede tener m√°s de una etiqueta, separamos las etiquetas en distintas columnas:\nscrobbles_tags_2 \u0026lt;- scrobbles_tags |\u0026gt; separate(artist_tags, sep = \u0026#34;; \u0026#34;, into = paste(\u0026#34;artist_tags\u0026#34;, 1:10, sep = \u0026#34;_\u0026#34;)) glimpse(scrobbles_tags_2) Rows: 17,000 Columns: 14 $ date \u0026lt;POSIXt\u0026gt; 2025-07-27 18:38:27, 2025-07-25 15:35:20, 2025-07-25‚Ä¶ $ artist \u0026lt;chr\u0026gt; \u0026quot;Bullet for My Valentine\u0026quot;, \u0026quot;Premiata Forneria Marconi\u0026quot;,‚Ä¶ $ track \u0026lt;chr\u0026gt; \u0026quot;Tears Don't Fall\u0026quot;, \u0026quot;Geranio\u0026quot;, \u0026quot;Il Banchetto\u0026quot;, \u0026quot;Per Un ‚Ä¶ $ album \u0026lt;chr\u0026gt; \u0026quot;The Poison\u0026quot;, \u0026quot;Per un amico\u0026quot;, \u0026quot;Per un amico\u0026quot;, \u0026quot;Per un a‚Ä¶ $ artist_tags_1 \u0026lt;chr\u0026gt; \u0026quot;metalcore\u0026quot;, \u0026quot;Progressive rock\u0026quot;, \u0026quot;Progressive rock\u0026quot;, \u0026quot;P‚Ä¶ $ artist_tags_2 \u0026lt;chr\u0026gt; \u0026quot;metal\u0026quot;, \u0026quot;italian progressive rock\u0026quot;, \u0026quot;italian progressi‚Ä¶ $ artist_tags_3 \u0026lt;chr\u0026gt; \u0026quot;hardcore\u0026quot;, \u0026quot;italian\u0026quot;, \u0026quot;italian\u0026quot;, \u0026quot;italian\u0026quot;, \u0026quot;italian\u0026quot;,‚Ä¶ $ artist_tags_4 \u0026lt;chr\u0026gt; \u0026quot;emocore\u0026quot;, \u0026quot;Progressive\u0026quot;, \u0026quot;Progressive\u0026quot;, \u0026quot;Progressive\u0026quot;,‚Ä¶ $ artist_tags_5 \u0026lt;chr\u0026gt; \u0026quot;seen live\u0026quot;, \u0026quot;italian prog\u0026quot;, \u0026quot;italian prog\u0026quot;, \u0026quot;italian p‚Ä¶ $ artist_tags_6 \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶ $ artist_tags_7 \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶ $ artist_tags_8 \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶ $ artist_tags_9 \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶ $ artist_tags_10 \u0026lt;chr\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶ Ahora que tenemos hasta 10 columnas de etiquetas, transformamos los datos a formato largo, para obtener una sola variable que contenga hacia abajo todas las etiquetas de cada artista.\nscrobbles_tags_3 \u0026lt;- scrobbles_tags_2 |\u0026gt; pivot_longer(cols = starts_with(\u0026#34;artist_tags\u0026#34;), names_to = \u0026#34;tags_n\u0026#34;, values_to = \u0026#34;tags\u0026#34;) |\u0026gt; filter(!is.na(tags)) |\u0026gt; select(-tags_n) |\u0026gt; mutate(tags = tolower(tags)) scrobbles_tags_3 |\u0026gt; slice(65:75) |\u0026gt; select(artist, tags) # A tibble: 11 √ó 2 artist tags \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 The Body \u0026amp; OAA drone 2 The Body \u0026amp; OAA drone metal 3 The Body \u0026amp; OAA noise 4 The Body \u0026amp; OAA experimental 5 The Body \u0026amp; OAA drone 6 The Body \u0026amp; OAA drone metal 7 Alberich noise 8 Alberich power electronics 9 Alberich industrial 10 Alberich death industrial 11 Alberich electronic Excluimos algunas etiquetas de g√©neros musicales que son demasiado amplios:\nscrobbles_tags_4 \u0026lt;- scrobbles_tags_3 |\u0026gt; filter(tags != \u0026#34;seen live\u0026#34;, !tags %in% c(\u0026#34;metal\u0026#34;, \u0026#34;electronic\u0026#34;, \u0026#34;hardcore\u0026#34;, \u0026#34;experimental\u0026#34;)) |\u0026gt; add_count(tags, name = \u0026#34;tag_n\u0026#34;) Luego especificamos cu√°ntas etiquetas m√°ximas queremos tener, y extraemos el Top 15 de g√©neros musicales m√°s escuchados por mi:\nn_tags \u0026lt;- 15 top_tags \u0026lt;- scrobbles_tags_4 |\u0026gt; distinct(tags, tag_n) |\u0026gt; slice_max(tag_n, n = n_tags) |\u0026gt; pull(tags) top_tags [1] \u0026quot;black metal\u0026quot; \u0026quot;death metal\u0026quot; \u0026quot;noise\u0026quot; [4] \u0026quot;jazz\u0026quot; \u0026quot;post-black metal\u0026quot; \u0026quot;grindcore\u0026quot; [7] \u0026quot;ambient\u0026quot; \u0026quot;progressive metal\u0026quot; \u0026quot;sludge\u0026quot; [10] \u0026quot;brutal death metal\u0026quot; \u0026quot;avant-garde\u0026quot; \u0026quot;doom metal\u0026quot; [13] \u0026quot;drone\u0026quot; \u0026quot;post-rock\u0026quot; \u0026quot;deathcore\u0026quot; Filtramos todas las canciones escuchadas para que solamente queden las que corresponden a uno de estos 15 g√©neros m√°s escuchados, y dejamos solamente la primera etiqueta de cada canci√≥n:\nscrobbles_tags_5 \u0026lt;- scrobbles_tags_4 |\u0026gt; filter(tags %in% top_tags) |\u0026gt; group_by(date) |\u0026gt; slice_max(tag_n, n = 1) scrobbles_tags_5 # A tibble: 14,127 √ó 6 # Groups: date [14,110] date artist track album tags tag_n \u0026lt;POSIXt\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 2023-11-06 13:23:28 Dreamcrusher INCINERATOR INCINERATOR noise 2633 2 2023-11-06 13:29:44 Dreamcrusher Cathedral Of Moths INCINERATOR noise 2633 3 2023-11-06 13:29:44 Dreamcrusher Pseudogender INCINERATOR noise 2633 4 2023-11-06 13:36:34 Dreamcrusher Pseudogender INCINERATOR noise 2633 5 2023-11-06 13:36:34 Dreamcrusher Vulpeculae Freeze INCINERATOR noise 2633 6 2023-11-06 13:44:43 Dreamcrusher Vulpeculae Freeze INCINERATOR noise 2633 7 2023-11-06 13:44:43 Dreamcrusher Bane INCINERATOR noise 2633 8 2023-11-06 13:57:07 Merzbow Promotion Man Merzbeat noise 2633 9 2023-11-06 13:57:07 Dreamcrusher Bane INCINERATOR noise 2633 10 2023-11-06 14:06:04 Pharmakon No Natural Order Contact noise 2633 # ‚Ñπ 14,117 more rows Finalmente hacemos el conteo de g√©neros musicales por semana:\nscrobbles_tags_6 \u0026lt;- scrobbles_tags_5 |\u0026gt; mutate(date = floor_date(date, \u0026#34;week\u0026#34;)) |\u0026gt; count(date, tags) scrobbles_tags_6 # A tibble: 858 √ó 3 # Groups: date [90] date tags n \u0026lt;dttm\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 2023-11-05 00:00:00 ambient 23 2 2023-11-05 00:00:00 avant-garde 1 3 2023-11-05 00:00:00 black metal 60 4 2023-11-05 00:00:00 death metal 16 5 2023-11-05 00:00:00 grindcore 1 6 2023-11-05 00:00:00 jazz 21 7 2023-11-05 00:00:00 noise 35 8 2023-11-05 00:00:00 post-rock 4 9 2023-11-05 00:00:00 progressive metal 12 10 2023-11-05 00:00:00 sludge 17 # ‚Ñπ 848 more rows Visualizaci√≥n Para reproducir el gr√°fico us√© el paquete {ggstream} que facilita la creaci√≥n de gr√°ficos de √°reas apiladas una sobre otra.\ninstall.packages(\u0026#34;ggstream\u0026#34;) library(ggplot2) library(ggview) library(scales) library(stringr) library(ggstream) Primero creamos paletas de colores para el gr√°fico:\npaleta \u0026lt;- c(\u0026#34;#C490FF\u0026#34;, \u0026#34;#62D4B6\u0026#34;, \u0026#34;#223689\u0026#34;, \u0026#34;#5911AC\u0026#34;, \u0026#34;#894BD2\u0026#34;, \u0026#34;#165159\u0026#34;, \u0026#34;#3262B8\u0026#34;) show_col(paleta) color_base = \u0026#34;#5911AC\u0026#34; color_fondo = col_mix(color_base, \u0026#34;black\u0026#34;, amount = 0.8) color_texto = col_mix(color_base, \u0026#34;white\u0026#34;, amount = 0.7) color_detalle = col_mix(color_base, \u0026#34;white\u0026#34;, amount = 0.1) |\u0026gt; col_saturate(-15) show_col(c(color_base, color_fondo, color_texto, color_detalle)) Luego definimos algunos elementos del tema del gr√°fico, como el fondo oscuro y las letras claras, y la eliminaci√≥n de elementos del panel del gr√°fico que no necesitamos:\ntheme_set( theme(panel.background = element_rect(color = color_fondo, fill = color_fondo), plot.background = element_rect(color = color_fondo, fill = color_fondo), legend.background = element_rect(color = color_fondo, fill = color_fondo), panel.grid = element_blank(), axis.ticks = element_blank(), axis.text = element_blank(), axis.title = element_blank(), text = element_text(color = color_texto), legend.key.size = unit(3, \u0026#34;mm\u0026#34;), legend.key.spacing.y = unit(2, \u0026#34;mm\u0026#34;), legend.margin = margin(l = 2, t = 10), plot.margin = margin(4, 4, 4, 4, \u0026#34;mm\u0026#34;)) ) scrobbles_tags_5 |\u0026gt; filter(date \u0026gt; \u0026#34;2024-08-1\u0026#34;) |\u0026gt; # l√≠mite inferior de fecha ggplot() + aes(date, n, color = tags, fill = tags) + # geometr√≠a principal geom_stream(bw = .7, sorting = \u0026#34;inside_out\u0026#34;, color = color_fondo, size = 0.1, show.legend = F) + # puntos invisibles para hacer una leyenda con puntos geom_point(size = 0, alpha = 0) + # texto del gr√°fico, geom_stream_label( aes(label = case_when(tags %in% top_tags[1:7] ~ str_wrap(tags, 12), # s√≥lo texto del top 7 de tags .default = \u0026#34;\u0026#34;)), bw = .7, sorting = \u0026#34;inside_out\u0026#34;, color = \u0026#34;white\u0026#34;, size = 2, fontface = \u0026#34;bold\u0026#34;, lineheight = 0.8, hjust = 0.5, vjust = 0.5, n_grid = 200) + # escala de colores en base a la paleta scale_fill_manual(values = colorRampPalette(paleta)(n_tags), aesthetics = c(\u0026#34;color\u0026#34;, \u0026#34;fill\u0026#34;)) + # escala horizontal de fechas annotate(geom = \u0026#34;text\u0026#34;, x = as.POSIXct(c(\u0026#34;2024-09-15\u0026#34;, \u0026#34;2024-12-15\u0026#34;, \u0026#34;2025-03-15\u0026#34;, \u0026#34;2025-06-15\u0026#34;)), label = format(as_date(fechas), \u0026#34;%m/%y\u0026#34;), y = -160, color = color_detalle, size = 3) + coord_cartesian(expand = F, clip = \u0026#34;off\u0026#34;) + # leyenda: sacar leyenda de relleno, y usar la de los puntos invisibles para que salga de puntos guides(fill = guide_none(), color = guide_legend(title = NULL, override.aes = list(size = 3, alpha = 1))) + # textos labs(title = \u0026#34;G√©neros musicales m√°s escuchados\u0026#34;, caption = \u0026#34;Last.fm/user/bastimapache\u0026#34;) + theme(plot.title = element_text(face = \u0026#34;bold\u0026#34;, margin = margin(b = -10), hjust = 0), plot.caption = element_text(color = color_detalle, hjust = 1, size = 8, vjust = 0), plot.caption.position = \u0026#34;plot\u0026#34;) No se parece mucho el gr√°fico que quer√≠a copiar, quiz√° porque el original iba en un rango de tiempo mucho m√°s breve, pero me gust√≥ igual.\nAlgunos comentarios sobre esta visualizaci√≥n:\ncrear paletas de colores haciendo mezclas de colores es m√°s conveniente que andarlos eligiendo con un programa es complicado clasificar la m√∫sica por g√©neros, sobre todo cuando la m√∫sica que te gusta es rara y est√° muy metida en combinaciones de subg√©neros. Elegir la etiqueta m√°s popular de cada artista quiz√° no es la mejor idea, pero elegir varias etiquetas por artista igual podr√≠a inflar la representaci√≥n de ciertos g√©neros con respecto a otros siempre va a ser dif√≠cil ponerle colores a gr√°ficos con m√°s de ocho categor√≠as, as√≠ que en este caso los colores son casi de adorno el paquete {ggstream} es s√∫per conveniente para generar este tipo de visualizaciones, y tiene un mont√≥n de opciones para modificarlas y tener alternativas, pero realiza un mont√≥n de transformaciones de los datos por dentro, lo que dificulta su compatibilidad con algunas otras cosas de {ggplot2}; por ejemplo, cambia la escala de fechas para transformar los n√∫meros, y eso te dificulta poder modificar la forma en que se ve la escala de fechas, lo que resolv√≠ simplemente agregando las fechas con annotate(). junto con lo anterior, se devuelve casi obligatorio tener que usar la funci√≥n geom_stream_label() para agregar textos, lo que te quita harta libertad quiz√°s relacionado a lo anterior: trat√© de grabar la evoluci√≥n del gr√°fico con {camcorder}, pero por alguna raz√≥n no pescaba al pasar a {ggstream} el paquete {lastfmR} de obtenci√≥n de datos solamente extrajo las √∫ltimas 17.000 canciones escuchadas, pero en mi caso eso fue un poco m√°s de un a√±o de datos, as√≠ que fue suficiente. De todos modos hay ene paquetes y tutoriales para sacar datos de Last.fm, y ambi√©n hay otras alternativas para bajar todos los datos de tu perfil, pero en este caso no cre√≠ que fuera necesario, sobre todo porque tengo un lapsus de un par de a√±os donde dej√© de usar Last.fm! Despu√©s de esta, hice una variaci√≥n de la misma visualizaci√≥n, pero en vez de mostrar g√©neros musicales, muestra artistas. Como ya ten√≠a todo el c√≥digo para hacer la visualizaci√≥n y procesar los datos, modificarlo para este nuevo fin fue muy f√°cil. Pueden ver todo el c√≥digo que necesit√© en el script lastfm_artists.R en el repositorio..\nAl ver las marcadas tendencias que hab√≠an en mi rotaci√≥n de artistas m√°s escuchados, me entr√≥ la curiosidad y gener√© un ranking de artistas por semana:\nEste fue bastante m√°s complejo que los anteriores, porque tuve que programar toda la l√≥gica para llegar a hacer un ranking que no tuviera empates1, y luego de eso, hacer el seguimiento de los artistas que iban repiti√©ndose semana a semana, para ver c√≥mo iban cambiando en su posici√≥n de ranking entre las distintas semanas2. Todo este c√≥digo se puede ver en el script lastfm_weekly.R en el repositorio..\nEn t√©rminos visuales, este gr√°fico en realidad es una tabla hecha con geom_tile(), con l√≠neas verticales con annotate(\u0026quot;segment\u0026quot;) que hacen una separaci√≥n entre semanas, l√≠neas que van conectando a los artistas consecutivos hechas con geom_step(), y efecto de sombra a medida que el ranking es menor que se hicieron con un geom_tile() donde la transparencia era ligada al ranking. Tambi√©n tiene distinto tama√±o y grosor de letra para los artistas en el n√∫mero 1, y colores que responden a recodificaci√≥n de los g√©neros musicales en categor√≠as m√°s generales en vez de ponerle un color a cada subg√©nero del mundo. Menci√≥n especial al circulito con un 1 hecho con annotate().\nSi bien a este gr√°fico tampoco lo grab√© con {camcorder} mientras lo hac√≠a, luego de terminarlo hice una especie de simulaci√≥n paso por paso de c√≥mo se genera la visualizaci√≥n de principio a fin:\nAqu√≠ la dificultad era que el ranking se define por el porcentaje semanal de canciones escuchadas que pertenecen a cada artista, pero ocurr√≠a que, si los n√∫meros eran muy bajos, los porcentajes se repet√≠an, porque un mismo artista era escuchado la misma cantidad de veces que otros. En estos casos, el desempate se hizo agreg√°ndole a los artistas un porcentaje que ten√≠a que ver con el porcentaje de canciones escuchadas en total \u0026mdash;de todos los tiempos\u0026mdash; que del artista, y de esta manera dar privilegio al artista m√°s escuchado en general en el ranking semanal. Tambi√©n se agrega un peque√±√≠simo n√∫mero aleatorio para desempatar otros casos.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nEl problema en estos casos era que se pod√≠a ir trazando una l√≠nea que muestre el cambio de posici√≥n semanal de un artista, pero la dificultad era hacer que la l√≠nea se cortara si el artista deja de ser escuchado una semana, pero que volviera a aparecer si vuelve a ser escuchado en una semana futura. La soluci√≥n fue generar una variable que agrupa con un n√∫mero √∫nico las escuchas consecutivas semanales de un artista, y si el artista no entra en el ranking en una o m√°s semanas se genera un grupo distinto. Luego se usan estos grupos para que las l√≠neas se unan solamente cuando las escuchas son consecutivas, en vez de qu√© se haga una l√≠nea que pase por encima de semanas donde el artista no entr√≥ al ranking.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-07-30T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-07-28/","tags":"ggplot2 ; visualizaci√≥n de datos ; blog ; gr√°ficos ; animaciones","title":"Gr√°fico de mis artistas y g√©neros musicales m√°s escuchados seg√∫n Last.fm"},{"content":"Veamos un mini ejemplo de automatizaci√≥n de tareas con R: los resultados del Censo 2024 vienen en 20 archivos, en 20 enlaces distintos!\n¬øEl problema? para obtenerlos, tendr√≠amos que entrar al sitio con el navegador, ir al enlace de descargas, bajar cada uno de los 20 archivos manualmente, y guardarlos en una carpeta para poder usarlos.\nEn un script de R, con {rvest} extraemos todos los enlaces del sitio, y con {purrr} descargamos todos los archivos de una üöÄ\nBeneficios? Muchos!\nNo tendr√°s que apretar 20 veces un bot√≥n como un perdedor/a üòé Obtendr√°s una fuente reproducible de los datos originales ü§ì Creaste trazabilidad de los datos (nadie puede alegar que son manipulados) üïµüèª‚Äç‚ôÄÔ∏è Puedes actualizarlos o volver a descargarlos en otro equipo con un clic Creaste un proceso que puedes aplicar a otros sitios! Fastidiaste a la gente del INE descargando 20 archivos en menos de 1 segundo üò£ Lo primero obtener el c√≥digo fuente de la p√°gina y extraer los en enlaces que est√°n en cada bot√≥n con web scraping. Puedes aprender c√≥mo extraer elementos de una p√°gina web con este tutorial de web scraping o viendo este taller donde lo explico en un video.\nenlace \u0026lt;- \u0026#34;https://censo2024.ine.gob.cl/estadisticas/\u0026#34; # extraer enlaces de descarga enlaces \u0026lt;- rvest::read_html(enlace) |\u0026gt; # descargar sitio rvest::html_elements(\u0026#34;.fusion-button\u0026#34;) |\u0026gt; # botones rvest::html_attr(\u0026#34;href\u0026#34;) |\u0026gt; # enlaces stringr::str_subset(\u0026#34;xls\u0026#34;) # s√≥lo excel enlaces [1] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P1-Discapacidad.xlsx\u0026quot; [2] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P2-Pueblos-indigenas.xlsx\u0026quot; [3] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P3_Lenguas-indigenas.xlsx\u0026quot; [4] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P4-Afrodescendencia.xlsx\u0026quot; [5] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P5_Genero.xlsx\u0026quot; [6] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P6_Religion-o-credo.xlsx\u0026quot; [7] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P7_Educacion.xlsx\u0026quot; [8] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/06/P8-Escolaridad-poblacion-inmigrante-internacional.xlsx\u0026quot; [9] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/05/V2_Caracteristicas-vivienda-y-viv-irrecuperables.xlsx\u0026quot; [10] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/05/V3_N-de-dormitorios-hacinamiento-y-viv-con-mas-de-un-hogar.xlsx\u0026quot; [11] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/05/V4_Servicios_basicos_de_la_vivienda.xlsx\u0026quot; [12] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/05/H1_Servicios-basicos-hogar-y-tenencia-vivienda.xlsx\u0026quot; [13] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/05/V5_Tipologias-de-viviendas-censadas.xlsx\u0026quot; [14] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/04/D5_Migracion-interna.xlsx\u0026quot; [15] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/04/D4_Inmigracion-Internacional.xlsx\u0026quot; [16] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/04/D6_Fecundidad.xlsx\u0026quot; [17] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/03/D1_Poblacion-censada-por-sexo-y-edad-en-grupos-quinquenales.xlsx\u0026quot; [18] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/03/D2_Indice-de-envejecimiento-por-sexo.xlsx\u0026quot; [19] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/03/D3_Poblacion-censada-por-tipo-de-operativo.xlsx\u0026quot; [20] \u0026quot;https://censo2024.ine.gob.cl/wp-content/uploads/2025/03/V1_Viviendas-y-hogares-censados.xlsx\u0026quot; Obtuvimos todos los enlaces que est√°n en la p√°gina! Ahora usaremos un poco de magia (regex) con {stringr} para que solamente queden los enlaces que apuntan a archivos Excel:\n# extraer nombres de archivos archivos \u0026lt;- stringr::str_extract(enlaces, \u0026#34;(?\u0026lt;=\\\\d{2}/\\\\d{2}/).*\u0026#34;) archivos [1] \u0026quot;P1-Discapacidad.xlsx\u0026quot; [2] \u0026quot;P2-Pueblos-indigenas.xlsx\u0026quot; [3] \u0026quot;P3_Lenguas-indigenas.xlsx\u0026quot; [4] \u0026quot;P4-Afrodescendencia.xlsx\u0026quot; [5] \u0026quot;P5_Genero.xlsx\u0026quot; [6] \u0026quot;P6_Religion-o-credo.xlsx\u0026quot; [7] \u0026quot;P7_Educacion.xlsx\u0026quot; [8] \u0026quot;P8-Escolaridad-poblacion-inmigrante-internacional.xlsx\u0026quot; [9] \u0026quot;V2_Caracteristicas-vivienda-y-viv-irrecuperables.xlsx\u0026quot; [10] \u0026quot;V3_N-de-dormitorios-hacinamiento-y-viv-con-mas-de-un-hogar.xlsx\u0026quot; [11] \u0026quot;V4_Servicios_basicos_de_la_vivienda.xlsx\u0026quot; [12] \u0026quot;H1_Servicios-basicos-hogar-y-tenencia-vivienda.xlsx\u0026quot; [13] \u0026quot;V5_Tipologias-de-viviendas-censadas.xlsx\u0026quot; [14] \u0026quot;D5_Migracion-interna.xlsx\u0026quot; [15] \u0026quot;D4_Inmigracion-Internacional.xlsx\u0026quot; [16] \u0026quot;D6_Fecundidad.xlsx\u0026quot; [17] \u0026quot;D1_Poblacion-censada-por-sexo-y-edad-en-grupos-quinquenales.xlsx\u0026quot; [18] \u0026quot;D2_Indice-de-envejecimiento-por-sexo.xlsx\u0026quot; [19] \u0026quot;D3_Poblacion-censada-por-tipo-de-operativo.xlsx\u0026quot; [20] \u0026quot;V1_Viviendas-y-hogares-censados.xlsx\u0026quot; Finalmente, creamos un loop que vaya por cada uno de los enlaces, descargue cada uno de los archivos, y le ponga el nombre al archivo correspondiente:\n# crear carpeta dir.create(\u0026#34;datos/originales\u0026#34;, showWarnings = F) # por cada posici√≥n de los enlaces (x va del 1 al n) seq_along(enlaces) |\u0026gt; purrr::walk( ~{message(\u0026#34;descargando \u0026#34;, enlaces[.x]) # enlace correspondiente a x # descargar archivo en el enlace download.file(enlaces[.x], # nombre del archivo a guardar destfile = paste0(\u0026#34;datos/originales/\u0026#34;, archivos[.x]) # nombre de archivo de x ) Sys.sleep(1) # espera post-descarga }) Con este breve script obtuviste un proceso que te permite descargar autom√°ticamente todos los datos, lo cual es una forma certera de crear una trazabilidad y una fuente real de los datos, adem√°s de darte un proceso que puedes volver a utilizar en otros sitios para optimizar tu trabajo!\nPuedes encontrar el c√≥digo de este ejemplo (y los datos) en este repositorio sobre extracci√≥n y limpieza de los datos del Censo 2024.\n","date":"2025-07-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-07-27/","tags":"datos ; Chile ; automatizaci√≥n ; loops ; purrr ; web scraping","title":"Descargar todos los archivos de la p√°gina web del Censo 2024 con {rvest}"},{"content":"Taller online que impart√≠ para el Congreso Estudiantil de Sociolog√≠a Interdisciplinaria. En este taller introduje a estudiantes de sociolog√≠a al lenguaje de programaci√≥n R, explicando los beneficios del an√°lisis de datos desarrollado en flujos de trabajo basados en la programaci√≥n, y las posibilidades que se abren para producir estudios y obtener resultados usando c√≥digo. Puse √©nfasis en el uso de tecnolog√≠as y datos abiertos, y en el principal beneficio de la programaci√≥n (en mi opini√≥n): el poder actualizar resultados, aplicaciones y visualizaciones autom√°ticamente.\nHerramientas y Estrategias contra la Corrupci√≥n: Talleres para la Medici√≥n y An√°lisis de la Corrupci√≥n en Chile desde el An√°lisis de Datos y Herramientas Abiertas Sesi√≥n 2: Extracci√≥n de Datos desde Medios: Web scraping y Criterios de Selecci√≥n/ An√°lisis y Visualizaci√≥n de Datos\nWeb scraping en investigaci√≥n social: definici√≥n, casos de uso. Selecci√≥n de medios y criterios √©ticos. Exploraci√≥n de estructuras HTML simples (solo como contexto). Uso de la app de Basti√°n para extraer datos de prensa. Visualizaci√≥n b√°sica en RStudio con ggplot2 Aplicaciones vistas en la sesi√≥n Visualizador de casos de corrupci√≥n en Chile Visualizador de an√°lisis de prensa digital en Chile C√≥digo En este repositorio est√° todo el c√≥digo usado en el taller.\nEjemplo de web scraping de un medio digital chileno: scraping.qmd\nEjemplo de modelamiento de t√≥picos en an√°lisis de texto: modelamiento_stm.R\nAn√°lisis de datos de un corpus de noticias de corrupci√≥n (6.000 noticias): explorar.qmd, los datos est√°n disponibles en: datos/prensa_corrupcion.parquet\nDatos Base de datos de casos de corrupci√≥n: https://github.com/bastianolea/corrupcion_chile/ (descargar en formato Excel) Datos de prensa chilena: https://github.com/bastianolea/prensa_chile Datos obtenidos en ejemplo de web scraping: datos/noticias.csv Base de datos con noticias de corrupci√≥n (6.000 noticias), desde 2023 a julio de 2025: datos/prensa_corrupcion.parquet Base de datos con muestra de noticias chilenas (10.000, al azar) de toda tem√°tica del a√±o 2024: datos/prensa_datos_muestra.csv Gr√°ficos Densidad Gr√°fico de densidad de conceptos m√°s frecuentes en noticias sobre corrupci√≥n, desde 2023 a julio de 2025 Nube de palabras Conceptos m√°s frecuentes en noticias sobre corrupci√≥n, por fuente period√≠stica Correlaciones Correlaciones de conceptos m√°s fuertes para seis conceptos relacionados a corrupci√≥n ","date":"2025-07-23T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/taller_corrupcion_cesi/","tags":"web scraping ; Chile ; visualizaci√≥n de datos ; an√°lisis de texto ; videos","title":"Video: Taller Medici√≥n y An√°lisis de la Corrupci√≥n en Chile desde el An√°lisis de Datos y Herramientas Abiertas"},{"content":"En este blog ya hemos cubierto un par de herramientas de web scraping, cada una con sus caracter√≠sticas y beneficios: {rvest}, un paquete f√°cil y r√°pido de usar para extraer datos desde sitios webs comunes, y {RSelenium}, una interfaz en R para utilizar un software de automatizaci√≥n de navegadores bastante popular, aunque un poco menos amigable.\nAhora veremos c√≥mo extraer datos desde p√°ginas web usando un paquete de R que, a grandes rasgos, hace web scraping controlando Google Chrome.\nSi necesitas aprender lo b√°sico del web scraping, primero revisa este tutorial de {rvest} El paquete {chromote} permite utilizar desde R Chrome DevTools para controlar navegadores Chromium, como Google Chrome, entre otros. Esto significa que podremos usar Chrome para conectarnos a los sitios web e interpretarlos usando su propio motor para cargar sitios web din√°micos y complejos, como con {RSelenium}.\nInstalamos el paquete, si es que no lo tenemos a√∫n:\ninstall.packages(\u0026#34;chromote\u0026#34;) Cargamos {chromote} y especificamos que queremos utilizar el nuevo modo sin interfaz gr√°fica (headless) de Chrome, ya recientemente hubo una actualizaci√≥n de este modo que cambi√≥ la forma en que se usa.\nlibrary(chromote) options(chromote.headless = \u0026#34;new\u0026#34;) Ahora abrimos una nueva sesi√≥n en el navegador para poder empezar a controlarlo:\nchrome \u0026lt;- ChromoteSession$new() Lo que hicimos aqu√≠ fue crear un objeto chrome te representa la instancia del navegador que abrimos, y desde el cual podremos ir ejecutando las instrucciones.\nComo {chromote} principalmente funciona sin un interfaz gr√°fica, igual que {rvest}, podremos seguir desde nuestra consola de R sin tener que cambiar de aplicaci√≥n.\nAhora podemos aplicar una de las fortalezas de estas estrategia para web scraping, que es especificar un agente de usuario personalizado. Lo que hace esto es decirle a los sitios web que te est√°s conectando desde un navegador com√∫n y corriente, en vez de que detecten que estas haciendo scraping de manera program√°tica, es decir, que no sospechen que eres un robot ü§ñ\nnavegador \u0026lt;- \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36\u0026#34; chrome$Network$setUserAgentOverride(userAgent = navegador) De este modo estamos simulando que usamos un navegador real, lo que puede ayudarte a resolver problemas con conexiones a determinados sitios.\nNavegar a p√°ginas web Ahora podemos controlar el navegador para dirigirlo a una p√°gina web con $Page$navigate(). Luego podemos ejecutar $Page$loadEventFired() para que la sesi√≥n se bloquee hasta que la p√°gina web est√© completamente cargada. Esto es s√∫per conveniente cuando los sitios son complejos, para evitar extraer el c√≥digo del sitio antes de qu√© est√© completamente cargado.\nenlace \u0026lt;- \u0026#34;https://bastianolea.rbind.io\u0026#34; chrome$Page$navigate(enlace) # navegar a la p√°gina chrome$Page$loadEventFired() # esperar a que cargue Extraer el c√≥digo fuente Una vez que estamos en el sitio que deseamos, ejecutamos lo siguiente para extraer el c√≥digo fuente de la p√°gina:\nfuente \u0026lt;- chrome$Runtime$evaluate(\u0026#34;document.querySelector(\u0026#39;html\u0026#39;).outerHTML\u0026#34;)$result$value # obtener datos Ahora contamos con todo el c√≥digo HTML que genera el contenido de la p√°gina web, podemos recurrir a {rvest} para interpretar el c√≥digo y as√≠ extraer los contenidos que necesitemos:\nlibrary(rvest) # leer c√≥digo fuente del sitio web sitio \u0026lt;- read_html(fuente) # extraer un p√°rrafo de texto sitio |\u0026gt; html_elements(\u0026#34;.page-main\u0026#34;) |\u0026gt; html_elements(\u0026#34;p\u0026#34;) |\u0026gt; html_text2() [1] \u0026quot;Este sitio contiene todo tipo de recursos sobre programaci√≥n con el lenguaje R para an√°lisis de datos, con un foco en las ciencias sociales. En el blog comparto consejos, novedades y tutoriales de R para que otras personas aprendan a programar en este lenguaje.\u0026quot; Otros Si queremos vigilar visualmente el control que hacemos sobre Chrome con {chromote}:\nchrome$view() Tambi√©n podemos tomar capturas de pantalla de lo que est√° viendo nuestro navegador remoto:\nchrome$screenshot(\u0026#34;pantallazo.png\u0026#34;) Finalmente, para terminar la sesi√≥n y apagar el proceso del navegador remoto, ejecutamos lo siguiente:\nchrome$close() ","date":"2025-07-17T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_scraping_chromote/","tags":"web scraping","title":"Web scraping usando Google Chrome desde R con {chromote}"},{"content":"Selenium es un programa para automatizar y controlar navegadores web, lo que lo vuelve en una buena herramienta para realizar web scraping. El paquete de R {RSelenium} nos permitir√° controlar un navegador por medio de c√≥digo de R, lo cual abre infinitas posibilidades al momento de automatizar la obtenci√≥n de datos e informaci√≥n desde sitios web din√°micos y/o complejos.\nEn este tutorial aprenderemos a usar {RSelenium} para programar scripts de R que automaticen el control de un navegador para interactuar con sitios web y as√≠ scrapear datos m√°s dif√≠ciles de obtener.\nSi necesitas aprender lo b√°sico del web scraping, primero revisa este tutorial de {rvest} En otro post aprendimos a hacer web scraping con {rvest}, un paquete muy sencillo de usar para obtener informaci√≥n desde sitios web. Entonces ¬øpor qu√© aprender tambi√©n {RSelenium}? La diferencia es que Selenium es capaz de controlar un navegador web real en tu computador, como Chrome o Firefox, lo cual puede marcar la diferencia para extraer datos de sitios que buscan dificultar o impedir el acceso a herramientas automatizadas de web scraping.\nIniciar un cliente La primera que necesitamos para hacer web scraping es un navegador web. La funci√≥n rsDriver() se encarga de la descarga e instalaci√≥n de un navegador para poder usarlo desde R. Elegimos Firefox, y opcionalmente definimos un puerto1.\nlibrary(RSelenium) driver \u0026lt;- rsDriver(browser = \u0026#34;firefox\u0026#34;, port = 4560L, verbose = F, chromever = NULL, phantomver = NULL) √âste c√≥digo pondr√° a descargar el navegador y lo abrir√°:\nAparece una ventana de navegador con la barra superior en rojo, indicando que est√° siendo controlado por otro programa, en este caso por R.\nAhora tenemos que pasarle el control a un objeto de R que representa al navegador remoto:\nremote \u0026lt;- driver$client Navegar a un sitio web Desde el navegador remoto podemos ir ejecutando las acciones que necesitamos. Lo primero es navegar al sitio web que nos interesa\nremote$navigate(\u0026#34;https://www.portaltransparencia.cl/PortalPdT/directorio-de-organismos-regulados/?org=MU291\u0026#34;) Si nos vamos a ver el navegador, vemos que la p√°gina efectivamente se ha cargado.\nDesde esta p√°gina web de Transparencia podemos extraer datos sobre la gesti√≥n de organismos p√∫blicos, pero para llegar a ellos tenemos que hacer clic en varios enlaces. Usaremos {RSelenium} para navegar el sitio y obtener los datos, generando un script que podremos reutilizar para actualizar los datos, obtener datos de manera masiva de este sitio, u obtener los datos del mismo portal pero de otro organismo p√∫blico, dado que funcionan igual.\nIdentificar elementos En este punto podemos usar el navegador para ir explorando el sitio. Obviamente podr√≠amos ir haciendo clic en el mismo navegador, pero no es la idea. La idea es poder automatizar el proceso por medio de un script que controle las acciones que se hacen en el navegador. Lo que s√≠ podemos hacer es usar las herramientas del navegador para ayudarnos.\nSi hacemos clic derecho sobre cualquier elemento del sitio y elegimos Inspeccionar, se abrir√° el panel de herramientas de desarrollador web.\nCon este panel podemos inspeccionar el c√≥digo fuente del sitio web, desde donde podremos extraer texto, enlaces, im√°genes, tablas, y m√°s.\nEn el panel de herramientas de desarrollador apretamos el bot√≥n de selecci√≥n (destacado con un c√≠rculo en la imagen anterior, o comando + shift + C) para que cuando pasemos el cursor sobre los elementos del sitio web, se destaque el c√≥digo fuente correspondiente.\nCu√°ndo identificamos el elemento que necesitamos, vamos al c√≥digo correspondiente, hacemos clic derecho, y copiamos el xpath o el selector css. Ambas son formas de identificar de manera √∫nica elementos en un sitio web, pero esta vez copiaremos el xpath.\nInteractuar con elementos Ahora que tenemos identificado el enlace que queremos apretar por medio de su xpath, le decimos al navegador que le haga clic:\nremote$findElement(\u0026#34;xpath\u0026#34;, \u0026#39;//*[@id=\u0026#34;A6428:formInfo:j_idt39:0:datalist:3:j_idt43:4:j_idt47\u0026#34;]\u0026#39;)$ clickElement() Funcion√≥! El navegador naveg√≥ al enlace que le pedimos.\nAhora repetimos el proceso para navegar al enlace Municipal:\nremote$findElement(\u0026#34;xpath\u0026#34;, \u0026#39;//*[@id=\u0026#34;A6428:formInfo:j_idt76:0:j_idt78\u0026#34;]\u0026#39;)$ clickElement() Ahora el sitio muestra una selecci√≥n de todos los a√±os que tienen datos. Si volvemos a repetir el proceso, nos damos cuenta de que el xpath del a√±o 2025 termina con un 0, y el del a√±o 2024 termina en 1, el de 2023 en 2, y as√≠ sucesivamente.\nEsto significa que podr√≠amos automatizar el acceso a todos los a√±os simplemente creando un loop que vaya desde 0 a 10 (a√±o 2015). Pero por ahora accedamos al segundo a√±o:\nremote$findElement(\u0026#34;xpath\u0026#34;, \u0026#39;//*[@id=\u0026#34;A6428:formInfo:j_idt94:0:j_idt95\u0026#34;]\u0026#39;)$ clickElement() Ahora llegamos a una p√°gina con los meses, donde se repita el mismo patr√≥n: todos los meses comparten un xpath que termina con el n√∫mero del cero a la cantidad de meses presentes.\nSi navegamos alguno de los meses, finalmente llegamos a los datos que est√°bamos buscando:\nremote$findElement(\u0026#34;xpath\u0026#34;, \u0026#39;//*[@id=\u0026#34;A6428:formInfo:j_idt110:0:j_idt111\u0026#34;]\u0026#39;)$ clickElement() Obtener el c√≥digo fuente del sitio Ahora que llegamos a una tabla de datos, podemos pedirle al navegador que nos entregue todo el c√≥digo de fuente del sitio, para continuar el scraping con el paquete {rvest}:\nlibrary(rvest) fuente \u0026lt;- remote$getPageSource()[[1]] sitio \u0026lt;- read_html(fuente) Si necesitas aprender a usar {rvest}, revisa este tutorial primero Podemos usar la funci√≥n html_elements() para extraer elementos del sitio por su selector CSS, y convertirlos en texto. Por ejemplo, extraer el texto que est√° en el t√≠tulo de la tabla:\nsitio |\u0026gt; html_elements(\u0026#34;.section-title\u0026#34;) |\u0026gt; html_text2() [1] \u0026quot;04. Personal y remuneraciones\u0026quot; Extraer tablas Si es que el sitio web tiene datos en forma de tabla, podemos extraerlo f√°cilmente con la funci√≥n html_table()\ntabla \u0026lt;- sitio |\u0026gt; html_table() tabla[[1]] # A tibble: 100 √ó 19 Estamento `Nombre completo` `Cargo o funci√≥n` `Grado EUS o jornada` \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 Auxiliar ACEVEDO BERTRIN, ANDR‚Ä¶ CUADRILLA OPERAC‚Ä¶ 14 2 Administrativo AEDO ACEVEDO, ESTEFAN‚Ä¶ ADMINISTRATIVA H‚Ä¶ 11 3 Administrativo AGUILAR MARTINEZ, ELI‚Ä¶ ADMINISTRATIVO D‚Ä¶ 12 4 Administrativo AHUMADA COFRE, GERALD‚Ä¶ ADMINISTRATIVA V‚Ä¶ 16 5 Profesional ALARCON HERRERA, CARL‚Ä¶ PROFESIONAL DE A‚Ä¶ 6 6 Administrativo ALARCON NEIRA, CLAUDI‚Ä¶ INSPECTOR VIGILA‚Ä¶ 14 7 Auxiliar ALCAINO MARTINEZ, EDU‚Ä¶ AUXILIAR ASEO Y ‚Ä¶ 14 8 Administrativo ALDERETE ALMENDRAS, N‚Ä¶ ADMINISTRATIVA V‚Ä¶ 16 9 Administrativo ALTAMIRANO ROJAS, ANN‚Ä¶ SECRETARIA ADMIN‚Ä¶ 11 10 Administrativo ALVAREZ FARFAN, CYNTH‚Ä¶ INSPECTORA FERIA‚Ä¶ 16 # ‚Ñπ 90 more rows # ‚Ñπ 15 more variables: `Calificaci√≥n profesional o formaci√≥n` \u0026lt;chr\u0026gt;, # Regi√≥n \u0026lt;chr\u0026gt;, `Asignaciones especiales` \u0026lt;chr\u0026gt;, # `Remuneraci√≥n bruta mensualizada` \u0026lt;chr\u0026gt;, # `Remuneraci√≥n l√≠quida mensualizada` \u0026lt;chr\u0026gt;, # `Remuneraciones adicionales` \u0026lt;chr\u0026gt;, `Remuneraci√≥n Bonos incentivos` \u0026lt;chr\u0026gt;, # `Derecho a horas extraordinarias` \u0026lt;chr\u0026gt;, ‚Ä¶ Ahora que tenemos los datos, s√≥lo resta guardarlos en nuestro proyecto de R y seguir proces√°ndolos en otro script.\ntabla[[1]] |\u0026gt; readr::write_rds(\u0026#34;datos.rds\u0026#34;) Descargar archivos Finalmente, tenemos la opci√≥n de descargar los datos de este sitio como un archivo en el bot√≥n Descargar CSV que aparece arriba. Pero a diferencia de los enlaces, generalmente los botones de los sitios web no conllevan un enlace, sino que esperan que los aprietes para ejecutar un acci√≥n internamente que te entrega el archivo. En estos casos, ser√≠a imposible obtener el enlace del bot√≥n y descargar el archivo enlazado con download.file(\u0026quot;enlace\u0026quot;), Sino que simplemente hay que perder el bot√≥n y esperar que el sitio te entregue el archivo.\nUtilizamos las herramientas del navegador para identificar el xpath o selector CSS del bot√≥n para presionarlo.\n# descargar archivo remote$findElement(\u0026#39;css selector\u0026#39;, \u0026#39;.fa-file-csv\u0026#39;)$ clickElement() Como estamos controlando un navegador web real, el archivo descargado aparecer√° en la carpeta de descargas de tu computadora, no en tu proyecto de R. Pero podemos mover el archivo desde la carpeta de descargas a tu proyecto con el siguiente c√≥digo:\nlibrary(fs) # crear una carpeta en tu proyecto dir_create(\u0026#34;datos\u0026#34;) # mover archivo descargado al proyecto file_move(path = \u0026#34;~/Downloads/TransparenciaActiva.csv\u0026#34;, new_path = \u0026#34;datos/TransparenciaActiva.csv\u0026#34;) Opcionalmente, al crear el navegador con rsDriver(), puedes configurar el navegador para especificar la ubicaci√≥n de las descargas:\nlibrary(here) perfil \u0026lt;- makeFirefoxProfile( list(browser.download.dir = here()) ) rsDriver(browser = \u0026#34;firefox\u0026#34;, chromever = NULL, phantomver = NULL, extraCapabilities = perfil) Terminar la navegaci√≥n Cu√°ndo termines de usar el navegador, tienes que cerrar la sesi√≥n. Esto se hace principalmente para liberar el puerto que asignaste al navegador al crearlo.\ndriver$server$stop() Pero te preguntar√°s, ¬øpor qu√© hicimos todo esto si desde el principio pod√≠amos apretar el bot√≥n de descargas y obtener los datos? Lo primero es porque de esta manera tenemos un script con el que podemos seguir las instrucciones paso a paso para volver a descargar exactamente el mismo archivo en el futuro. Pero tambi√©n, porque podemos usar este Skip para modificarlo y obtener un archivo de otra fecha, o incluso modificar la direcci√≥n de ra√≠z del scraping y obtener el archivo equivalente pero de otro organismo p√∫blico.\nEl potencial del web scraping no solamente obtener datos, sino obtenerlos de una manera tal que podamos automatizar la obtenci√≥n masiva de los mismos.\nOtros Tomar captura de pantalla Tambi√©n es posible capturar lo que est√° mostrando el navegador por medio de una captura de pantalla:\nremote$screenshot(file = \u0026#39;pantallazo_1.jpg\u0026#39;) Este tipo de acciones no es posible con herramientas de web scraping como {rvest}, que funcionan navegando directamente el c√≥digo fuente del sitio, sin cargarlo como normalmente har√≠a un navegador web.\nDesplazarse por el sitio Otro tipo de acciones que a veces son necesarias de hacer para obtener datos en un sitio es scrollear por el mismo para que se carguen los elementos. Esto puede hacerse en Selenium ejecutando un script:\n# scrolear remote$executeScript(paste(\u0026#34;window.scrollBy(0, \u0026#34;, 500, \u0026#34;);\u0026#34;)) # verificar visualmente remote$screenshot(file = \u0026#39;pantallazo_2.jpg\u0026#39;) Cambiar dimensiones de la ventana remote$setWindowSize(width = 640, height = 480) Obtener dimensiones de la ventana ventana_alto \u0026lt;- remote$executeScript(\u0026#34;return window.innerHeight\u0026#34;)[[1]] ventana_ancho \u0026lt;- remote$executeScript(\u0026#34;return window.innerWidth\u0026#34;)[[1]] Grabar tu interacci√≥n con el navegador Usa Selenium IDE para grabar interacciones con un sitio. Puedes instalar esta extensi√≥n de Firefox para grabar tu interacci√≥n con un sitio web, y que queden registrado todos los pasos que hiciste en el sitio, de manera que puedas reproducirlos despu√©s en un script.\nEl puerto es como la conexi√≥n entre tu computador y el navegador, por lo que no pueden haber dos navegadores en un mismo puerto. Si necesitas abrir m√°s de un navegador, o te aparece ocupado el puerto, intenta con otro.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-07-15T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_scraping_selenium/","tags":"web scraping ; datos","title":"Tutorial: web scraping controlando un navegador web con {RSelenium} en R"},{"content":"Uno de los principales beneficios del an√°lisis de datos en base a programaci√≥n es que el c√≥digo es reutilizable. Esto significa que cualquier cosa que hayas hecho puedes reutilizarla, y as√≠ ahorrar trabajo. El siguiente paso es reutilizar el c√≥digo de tal forma que sirva para aplicarlo a varios casos a la vez, incluso cientos o miles de veces.\nLa reutilizaci√≥n de c√≥digo es s√∫per conveniente para la visualizaci√≥n de datos: una vez que dise√±aste un gr√°fico, con muy pocas modificaciones puedes adaptarlo para que funcione con una fuente de datos distintas, una fuente actualizada, o para que visualice distintas variables.\nEn este post vamos a ver c√≥mo automatizar la creaci√≥n de gr√°ficos para que solamente tengas que dise√±ar una visualizaci√≥n que te genere m√∫ltiples resultados.\nLo que necesitamos para automatizar la generaci√≥n de gr√°ficos es:\nPreparar los datos para la visualizaci√≥n Dise√±ar una visualizaci√≥n que pueda adaptarse a distintos datos o variables Crear un loop o iteraci√≥n donde el c√≥digo que genera el gr√°fico se ejecute m√∫ltiples veces en base a lo que necesites replicar. Datos Para este tutorial usaremos un conjunto de datos relativamente grande sobre educaci√≥n, sacado de mi repositorio de datos sociales abiertos. Se trata de una bases de datos de resultados de puntajes de la Prueba de Acceso a la Educaci√≥n Superior (PAES).\nDado que los datos ya vienen limpios y procesados desde su fuente original en el repositorio de GitHub, podemos cargarlos directamente desde su repositorio usando el enlace:\nlibrary(arrow) # cargar datos desde GitHub datos \u0026lt;- read_parquet(\u0026#34;https://github.com/bastianolea/puntajes_prueba_paes/raw/main/datos/puntajes_paes_2024.parquet\u0026#34;) Antes que nada, miremos los datos:\nlibrary(dplyr) glimpse(datos) Rows: 304,420 Columns: 12 $ nombre_comuna \u0026lt;chr\u0026gt; \u0026quot;√ëu√±oa\u0026quot;, \u0026quot;Santiago\u0026quot;, \u0026quot;San Antonio\u0026quot;, \u0026quot;Concepci√≥n\u0026quot;, \u0026quot;Pe‚Ä¶ $ codigo_comuna \u0026lt;dbl\u0026gt; 13120, 13101, 5601, 8101, 9113, 13130, 7101, 13118, 1‚Ä¶ $ nombre_region \u0026lt;chr\u0026gt; \u0026quot;Metropolitana de Santiago\u0026quot;, \u0026quot;Metropolitana de Santia‚Ä¶ $ codigo_region \u0026lt;chr\u0026gt; \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;05\u0026quot;, \u0026quot;08\u0026quot;, \u0026quot;09\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;07\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;,‚Ä¶ $ a√±o \u0026lt;dbl\u0026gt; 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,‚Ä¶ $ cod_sexo \u0026lt;chr\u0026gt; \u0026quot;Femenino\u0026quot;, \u0026quot;Femenino\u0026quot;, \u0026quot;Masculino\u0026quot;, \u0026quot;Femenino\u0026quot;, \u0026quot;Fem‚Ä¶ $ promedio_notas \u0026lt;dbl\u0026gt; 6.50, NA, NA, 5.10, 6.35, 5.45, 6.50, 6.10, NA, NA, 5‚Ä¶ $ paes_complectora \u0026lt;dbl\u0026gt; 711, NA, 484, 597, 491, 364, NA, 584, 510, NA, NA, NA‚Ä¶ $ paes_matematica1 \u0026lt;dbl\u0026gt; NA, NA, 513, 498, 436, 424, NA, 498, 478, NA, NA, NA,‚Ä¶ $ paes_matematica2 \u0026lt;dbl\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶ $ paes_histciesoc \u0026lt;dbl\u0026gt; 739, NA, 520, 647, 373, 405, NA, 654, 540, NA, NA, NA‚Ä¶ $ paes_ciencias \u0026lt;dbl\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 4‚Ä¶ En este conjunto de datos, de 304 mil observaciones, cada fila representa a una persona que dio la Prueba de Acceso a la Educaci√≥n Superior (PAES), y en las columnas se detallan caracter√≠sticas de las personas y los puntajes obtenidos. Las columnas que empiezan con paes_ contienen los puntajes.\nExploremos visualmente dos de las variables con un gr√°fico de dispersi√≥n:\nlibrary(ggplot2) datos |\u0026gt; # filter(nombre_region == \u0026#34;Metropolitana de Santiago\u0026#34;) |\u0026gt; ggplot() + aes(paes_matematica1, paes_complectora) + geom_jitter(height = 10, width = 10, size = 0.2, alpha = 0.1) + theme_classic() + coord_fixed() + labs(x = \u0026#34;Matem√°ticas\u0026#34;, y = \u0026#34;Comprensi√≥n lectora\u0026#34;) Obtenemos una tenebrosa nube que correlaciona los puntajes de la prueba de comprensi√≥n lectora y la de matem√°titas. En este gr√°fico cada punto es un estudiante, y la ubicaci√≥n del punto corresponde al puntaje que obtuvo en las pruebas de Matem√°tica y Comprensi√≥n Lectora. Como los datos vienen con m√°s variables de caracterizaci√≥n de las observaciones, podemos filtrar los datos por comuna:\nlibrary(dplyr) datos |\u0026gt; filter(nombre_comuna == \u0026#34;La Florida\u0026#34;) # A tibble: 6,306 √ó 12 nombre_comuna codigo_comuna nombre_region codigo_region a√±o cod_sexo \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Masculi‚Ä¶ 2 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Masculi‚Ä¶ 3 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino 4 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Masculi‚Ä¶ 5 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino 6 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino 7 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino 8 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino 9 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino 10 La Florida 13110 Metropolitana de Sa‚Ä¶ 13 2024 Femenino # ‚Ñπ 6,296 more rows # ‚Ñπ 6 more variables: promedio_notas \u0026lt;dbl\u0026gt;, paes_complectora \u0026lt;dbl\u0026gt;, # paes_matematica1 \u0026lt;dbl\u0026gt;, paes_matematica2 \u0026lt;dbl\u0026gt;, paes_histciesoc \u0026lt;dbl\u0026gt;, # paes_ciencias \u0026lt;dbl\u0026gt; Esto significa qeu podemos generar gr√°ficos para subgrupos de la poblaci√≥n; en este caso, gr√°ficos por unidades administrativas o comunas.\nGr√°fico Si necesitas aprender a visualizar datos desde cero, revisa este tutorial de {ggplot2} Podemos intentar volver a generar el mismo gr√°fico con exactamente el mismo c√≥digo, pero antes filtrando una comuna, para obtener s√≥lo los resultados de estudiantes que viven en la comuna de La Florida:\ndatos |\u0026gt; # filtrar datos filter(nombre_comuna == \u0026#34;La Florida\u0026#34;) |\u0026gt; # gr√°fico ggplot() + aes(paes_matematica1, paes_complectora) + geom_jitter(shape = 3, height = 5, width = 5, size = 0.4, alpha = 0.5) + theme_classic() + coord_fixed() + labs(subtitle = \u0026#34;La Florida\u0026#34;, x = \u0026#34;Matem√°ticas\u0026#34;, y = \u0026#34;Comprensi√≥n lectora\u0026#34;) Obviamente podemos filtrar por cualquier otra comuna (o cualquier otra variable) y obtendremos el gr√°fico de los estudiantes correspondientes.\nMejoremos un poco la visualizaci√≥n, ahora adem√°s con la reutilizaci√≥n en mente:\n# el nombre de la comuna que seleccionamos para visualizar comuna \u0026lt;- \u0026#34;Lo Espejo\u0026#34; # filtrado de los gr√°ficos datos \u0026lt;- datos |\u0026gt; # crear variable que indica si la observacion pertenece o no a la comuna seleccionada mutate(seleccion = if_else(nombre_comuna == comuna, true = \u0026#34;Destacada\u0026#34;, false = \u0026#34;Otras\u0026#34;)) |\u0026gt; # ordenar las observaciones seg√∫n la selecci√≥n de comuna arrange(desc(seleccion)) |\u0026gt; # redondear punteajes mutate(across(c(paes_matematica1, paes_complectora), ~signif(.x, 2))) # gr√°fico b√°sico grafico_base \u0026lt;- datos |\u0026gt; ggplot() + aes(paes_matematica1, paes_complectora, color = seleccion, alpha = seleccion) + geom_point(size = 0.4) # modificar detalles del gr√°fico grafico_bonito \u0026lt;- grafico_base + # escala de colores para destacar la comuna seleccionada scale_color_manual(values = c(\u0026#34;Otras\u0026#34; = \u0026#34;grey85\u0026#34;, \u0026#34;Destacada\u0026#34; = \u0026#34;#6E3A98\u0026#34;)) + # escala de transparencia para mejorar visualizaci√≥n scale_alpha_manual(values = c(\u0026#34;Otras\u0026#34; = 0.1, \u0026#34;Destacada\u0026#34; = 0.3)) + # temas theme_classic() + theme(legend.position = \u0026#34;none\u0026#34;) + # ocultar leyenda coord_fixed(expand = FALSE) + # gr√°fico cuadrado labs(subtitle = comuna, # nombre de la comuna elegida title = \u0026#34;Puntajes de prueba PAES 2024\u0026#34;, x = \u0026#34;Matem√°ticas\u0026#34;, y = \u0026#34;Comprensi√≥n lectora\u0026#34;) grafico_bonito Efectivamente obtenemos un gr√°fico m√°s bonito ‚ò∫Ô∏è donde especificamos de antemano un objeto comuna con el nombre de la unidad administrativa que queremos visualizar. Luego, este objeto se usa para filtrar los datos y para poner un t√≠tulo al gr√°fico.\nTambi√©n usamos la funci√≥n signif() para redondear los puntajes a dos d√≠gitos significativos; es decir, un n√∫mero como 456 se vuelve 450, para simplificar el ordenamiento de los puntos en el plano del gr√°fico.\nFunci√≥n Si nunca has creado una funci√≥n en R, revisa esta gu√≠a El siguiente paso es opcional, pero lo recomiendo porque simplifica bastante la lectura del c√≥digo y su mantenimiento futuro. Vamos a crear una funci√≥n que genere el mismo gr√°fico que antes, para facilitar su reutilizaci√≥n.\nPara crear una funci√≥n, simplemente incluimos el c√≥digo dentro de function() { } y definimos los argumentos de la funci√≥n en function() y dentro de la misma. Pero como somos bacanes, en vez de function() vamos a usar la abreviatura \\() üòé\ngrafico \u0026lt;- \\(datos, comuna) { datos |\u0026gt; mutate(seleccion = if_else(nombre_comuna == comuna, true = \u0026#34;Destacada\u0026#34;, false = \u0026#34;Otras\u0026#34;)) |\u0026gt; arrange(desc(seleccion)) |\u0026gt; mutate(across(c(paes_matematica1, paes_complectora), ~signif(.x, 2))) |\u0026gt; ggplot() + aes(paes_matematica1, paes_complectora, color = seleccion, alpha = seleccion) + geom_point(size = 0.4) + scale_color_manual(values = c(\u0026#34;Otras\u0026#34; = \u0026#34;grey85\u0026#34;, \u0026#34;Destacada\u0026#34; = \u0026#34;#6E3A98\u0026#34;)) + scale_alpha_manual(values = c(\u0026#34;Otras\u0026#34; = 0.1, \u0026#34;Destacada\u0026#34; = 0.3)) + theme_classic() + theme(legend.position = \u0026#34;none\u0026#34;) + coord_fixed(expand = FALSE) + labs(subtitle = comuna, title = \u0026#34;Puntajes de prueba PAES 2024\u0026#34;, x = \u0026#34;Matem√°ticas\u0026#34;, y = \u0026#34;Comprensi√≥n lectora\u0026#34;) } Hacer una funci√≥n en R es como empaquetar tu c√≥digo en su propio programita para que sea m√°s f√°cil de usar sin tener que copiar y pegar todo el c√≥digo cada vez que lo necesites. Tambi√©n tiene el beneficio de que, si necesitas corregir o mejorar el c√≥digo, lo modificas una sola vez y el cambio va a aparecer en todos los dem√°s lugares que la uses.\nAhora que creamos la funci√≥n, solo tenemos que ejecutar grafico() para generar el gr√°fico!\ngrafico(datos, \u0026#34;La Reina\u0026#34;) grafico(datos, \u0026#34;Cerrillos\u0026#34;) Automatizaci√≥n Una vez que hayamos desarrollado el c√≥digo que genera la visualizaci√≥n, y que hayamos probado y confirmado que el c√≥digo va a servir en distintas situaciones (en nuestro caso, filtrando distintas comunas), podemos introducir el c√≥digo a un loop para generar todas las variaciones que queramos del mismo gr√°fico.\nEn el caso de nuestro conjunto de datos, esto ser√≠a hacer un gr√°fico por cada comuna en la base de datos. Si hici√©ramos esto a mano, tendr√≠amos que copiar y pegar m√°s de 300 veces el mismo c√≥digo üò∞ As√≠ que, para no tener que hacer las cosas a mano como los perdedores, vamos a automatizar el proceso de generaci√≥n de gr√°ficos.\nDefinamos primero la lista de elementos por los que queremos crear los gr√°ficos. Esto pueden ser a√±os, pa√≠ses, nombres, o en nuestro caso, divisiones administrativas como pueden ser comunas.\ncomunas \u0026lt;- unique(datos$nombre_comuna) El vector anterior nos da todas las categor√≠as de la variable nombre_comuna del dataset datos, eliminando duplicados con unique(). Estos ser√°n los valores por los que iremos iterando: por cada uno de estos valores vamos a querer que se produzca un gr√°fico distinto.\nEn otras palabras, queremos aplicar nuestra funci√≥n grafico() (o el c√≥digo para generar el gr√°fico) una vez por cada comuna en el dataset. Para esto utilizaremos un bucle o loop en R nos permite repetir un conjunto de instrucciones varias veces.\nSi nunca has hecho un loop en R, [revisa esta gu√≠a]( https://bastianolea.rbind.io/blog/r_introduccion/r_intermedio/#bucles Si bien en R podemos crear loops o bucles con for, usaremos map() del paquete {purrr} para lograr lo mismo de una forma m√°s elegante y eficiente.\nDentro de map(), primero entregamos los elementos por los que queremos iterar (en nuestro caso, los nombres de las comunas), y luego se aplica una funci√≥n1, dentro de la cual ponemos lo que queremos que pase en cada paso de la iteraci√≥n. O sea que, por cada elemento de comunas, se va a aplicar el c√≥digo del gr√°fico.\nDentro de la funci√≥n, simplemente ponemos el c√≥digo que genera el gr√°fico, y luego le pedimos que guarde el resultado en nuestro computador. Es muy importante que los nombres de archivo sean distintos! De lo contrario los resultados se van a ir sobrescribiendo unos a otros üôÑ As√≠ que usamos el nombre de la comuna dentro de paste() para crear nombres de archivo √∫nicos.\nlibrary(purrr) map(comunas[1:12], # elementos por los que se va a iterar \\(comuna) { # cada elemento va a pasar a la funci√≥n como un objeto llamado `comuna` # crear gr√°ficos grafico \u0026lt;- grafico(datos, comuna) # guardar gr√°ficos ggsave(plot = grafico, filename = paste0(\u0026#34;graficos/Gr√°fico Paes \u0026#34;, comuna, \u0026#34;.jpeg\u0026#34;), # nombre del archivo width = 6, height = 6) }) [[1]] [1] \u0026quot;graficos/Gr√°fico Paes √ëu√±oa.jpeg\u0026quot; [[2]] [1] \u0026quot;graficos/Gr√°fico Paes Santiago.jpeg\u0026quot; [[3]] [1] \u0026quot;graficos/Gr√°fico Paes San Antonio.jpeg\u0026quot; [[4]] [1] \u0026quot;graficos/Gr√°fico Paes Concepci√≥n.jpeg\u0026quot; [[5]] [1] \u0026quot;graficos/Gr√°fico Paes Perquenco.jpeg\u0026quot; [[6]] [1] \u0026quot;graficos/Gr√°fico Paes San Miguel.jpeg\u0026quot; [[7]] [1] \u0026quot;graficos/Gr√°fico Paes Talca.jpeg\u0026quot; [[8]] [1] \u0026quot;graficos/Gr√°fico Paes Macul.jpeg\u0026quot; [[9]] [1] \u0026quot;graficos/Gr√°fico Paes Quilicura.jpeg\u0026quot; [[10]] [1] \u0026quot;graficos/Gr√°fico Paes San Joaqu√≠n.jpeg\u0026quot; [[11]] [1] \u0026quot;graficos/Gr√°fico Paes Valpara√≠so.jpeg\u0026quot; [[12]] [1] \u0026quot;graficos/Gr√°fico Paes Limache.jpeg\u0026quot; Con tan s√≥lo ejecutar el c√≥digo anterior, obtendremos m√°s de 300 gr√°ficos! Pero como son tantos, le puse comunas[1:10] para que s√≥lo se hagan las primeras 10 üòÖ\nProcesando\u0026hellip;\nGrabaci√≥n en tiempo real de los gr√°ficos siendo generados dentro de un loop de purrr::map() Optimizaci√≥n Naturalmente, generar cientos de gr√°ficos puede demorar unos minutos, sobre todo si los datos son muy grandes (y en nuestro caso, cada gr√°fico tiene m√°s de 300 mil puntos\u0026hellip;).\nLo bueno es que podemos aprovechar todo el potencial de nuestras computadoras modificando el c√≥digo para que el proceso sea multiprocesador; es decir, que se usen todos los procesadores de nuestro computador al mismo tiempo. Tan s√≥lo especificamos cu√°ntos procesadores queremos usar con plan(multisession, workers = 6), y luego reemplazamos map() por future_map() de {furrr}:\nlibrary(furrr) plan(multisession, workers = 8) future_map(comunas[1:20], \\(comuna) { grafico \u0026lt;- grafico(datos, comuna) ggsave(plot = grafico, filename = paste0(\u0026#34;graficos/Gr√°fico Paes \u0026#34;, comuna, \u0026#34;.jpeg\u0026#34;), # nombre del archivo width = 6, height = 6) }) Visualizaci√≥n de uso de CPU al procesar gr√°ficos multicore con R, demostrando que se usan todos los procesadores al mismo tiempo Procesando\u0026hellip;\nGrabaci√≥n en tiempo real de los gr√°ficos siendo generados, usando 8 procesadores Listo! üéâ Imag√≠nate todo el tiempo que ahorramos: podemos obtener cientos de gr√°ficos con tan s√≥lo presionar el bot√≥n Run (o la combinaci√≥n control + enter), y si tenemos que actualizar, modificar o mejorar los gr√°ficos, simplemente cambiamos el c√≥digo en la funci√≥n y volvemos a ejecutar el loop. Excelente! Esto hace que aprender a programar valga la pena, cierto?\u0026hellip; cierto? ü•∫\nEn vez de una funci√≥n, usaremos una funci√≥n an√≥nima, lo que significa que crearemos la funci√≥n dentro de map() solamente porque es m√°s r√°pido.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-07-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggplot_purrr/","tags":"visualizaci√≥n de datos ; automatizaci√≥n ; purrr ; loops ; ggplot2 ; optimizaci√≥n","title":"Generar m√∫ltiples gr√°ficos autom√°ticamente con R"},{"content":"Existe un gr√°fico estad√≠stico muy famoso por haber aparecido en la portada del disco Unknown Pleasures de Joy Division:\nSe trata de un gr√°fico de densidad, donde las densidades est√°n apiladas verticalmente y se sobreponen, dando una apariencia monta√±osa, cordillerana y casi tridimensional.\nEn este post reproduciremos este gr√°fico en R, pero usando datos socioecon√≥micos de la Encuesta de caracterizaci√≥n socioecon√≥mica nacional (Casen) 2022.\nEste post es sobre visualizaci√≥n de datos con {ggplot2}. Si quieres aprender, puedes revisar este tutorial sobre visualizaci√≥n de datos desde cero! Los paquetes que usaremos son los siguientes:\nlibrary(arrow) # carga de datos en formato parquet library(dplyr) # manipulaci√≥n de datos library(ggplot2) # visualizaci√≥n de datos library(scales) # escalas para gr√°ficos library(ggridges) # geometr√≠a de densidad apilada para {ggplot2} library(forcats) # orden ordenamiento de datos tipo factor library(tidyr) # transformaci√≥n y ordenamiento de datos Vamos a obtener los datos de la Casen de forma m√°s r√°pida desde un repositorio de datos de ingresos de la encuesta Casen, en el cual dispongo los datos en un formato m√°s r√°pido de cargar.\nComo dato al margen, los datos de ese repositorio se usan en una aplicaci√≥n interactiva desarrollada en R. donde puedes comparar la densidades de las distribuciones de ingreso de cualquier comuna de Chile.\nAplicaci√≥n web comparador de ingresos Casen, desarrollada en R. Pru√©bala aqu√≠. Datos Primero cargamos los datos de poblaci√≥n comunal, que solamente usaremos para luego seleccionar las comunas con mayor poblaci√≥n del pa√≠s. Como en el siguiente c√≥digo los datos se cargan directamente desde el repositorio, no necesita descargar ning√∫n archivo para poder ejecutar este c√≥digo en tu computadora.\n# cargar datos de poblaci√≥n poblacion \u0026lt;- arrow::read_parquet(\u0026#34;https://github.com/bastianolea/casen_comparador_ingresos/raw/main/datos/censo_proyecciones_a√±o.parquet\u0026#34;) # obtener poblaci√≥n comunal poblacion_comunas \u0026lt;- poblacion |\u0026gt; filter(a√±o == 2024) |\u0026gt; arrange(desc(poblaci√≥n)) Luego cargamos los datos de la encuesta Casen desde el repositorio:\n# cargar encuesta casen casen2022_2 \u0026lt;- arrow::read_parquet(\u0026#34;https://github.com/bastianolea/casen_comparador_ingresos/raw/main/datos/casen_ingresos.parquet\u0026#34;) Procesamiento Para poder usar estos datos de la forma correcta necesitamos procesarlos en base al dise√±o de encuestas de muestreo complejo, en el que se basa la Casen. Esto debido a que la encuesta requiere de la aplicaci√≥n de factores de expansi√≥n para poder obtener resultados que busquen representar a la poblaci√≥n real. Para m√°s informaci√≥n, revisa este post donde lo explico.\n# procesar encuesta de dise√±o complejo library(srvyr) casen_svy \u0026lt;- casen2022_2 |\u0026gt; # filtrar 80 comunas con m√°s poblaci√≥n filter(comuna %in% poblacion_comunas$comuna[1:80]) |\u0026gt; # crear dise√±o de encuestas complejas as_survey(weights = expc, strata = estrato, ids = id_persona, nest = TRUE) En el c√≥digo anterior se carg√≥ el conjunto de datos, se filtraron las 80 comunas con m√°s poblaci√≥n, para no tener un gr√°fico eterno, y se aplic√≥ el dise√±o de encuestas complejas con as_survey().\nUna vez que tenemos el objeto survey que nos permite trabajar con los datos usando la metodolog√≠a apropiada de factor de expansi√≥n, calculamos la cantidad de personas a la que representa cada observaci√≥n en la encuesta. Usaremos la variable de ingresos propios de la ocupaci√≥n principal, yoprcor.\n# calcular cantidades usando factor de expansi√≥n casen_ingresos \u0026lt;- casen_svy |\u0026gt; group_by(comuna, yoprcor) |\u0026gt; summarize(n = survey_total(), p = survey_mean()) Si realizamos los datos, nos encontramos con las observaciones de la encuesta, que incluyen la informaci√≥n de la comuna y la variable de ingresos que elegimos, pero adem√°s, tenemos la columna n que nos indica a cu√°ntas personas representa cada observaci√≥n de la encuesta, gracias a la aplicaci√≥n del factor de expansi√≥n.\n# A tibble: 9,155 √ó 6 # Groups: comuna [80] comuna yoprcor n n_se p p_se \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Alto Hospicio 14789 36 36 0.000260 0.000233 2 Alto Hospicio 20000 32 32 0.000231 0.000213 3 Alto Hospicio 30000 211 109. 0.00152 0.000691 4 Alto Hospicio 40000 36 36 0.000260 0.000233 5 Alto Hospicio 45000 36 36 0.000260 0.000233 6 Alto Hospicio 50000 527 262. 0.00380 0.00124 7 Alto Hospicio 60000 405 333. 0.00292 0.00207 8 Alto Hospicio 70000 48 48 0.000346 0.000334 9 Alto Hospicio 75000 77 52.1 0.000556 0.000332 10 Alto Hospicio 80000 264 136. 0.00191 0.000779 # ‚Ñπ 9,145 more rows Ahora limpiamos un poco los datos, calculamos las medianas de ingresos comunales, y limitamos los ingresos m√°ximos en una cifra que considero un ingreso suficientemente alto como para mostrar la inequidad de ingresos sin que los ingresos bajos se vuelvan invisibles.\n# limpiar datos y limitar ingresos casen_ingresos_2 \u0026lt;- casen_ingresos |\u0026gt; rename(variable = yoprcor) |\u0026gt; filter(!is.na(variable)) |\u0026gt; # calcular mediana de ingresos group_by(comuna) |\u0026gt; mutate(mediana = median(variable, na.rm = T)) |\u0026gt; # limitar ingresos m√°ximos, ordenar comunas filter(variable \u0026lt; 2500000) |\u0026gt; ungroup() |\u0026gt; # ordenar las comunas de mayor a menor por su mediana de ingresos mutate(comuna = as.factor(comuna), comuna = fct_reorder(comuna, mediana)) Finalmente, preparamos los datos para la visualizaci√≥n. El tipo de visualizaci√≥n que vamos a usar, el gr√°fico de densidad, realiza un c√°lculo de densidades; es decir, distribuye todas las observaciones a trav√©s del eje horizontal del gr√°fico, y eleva a una curva en relaci√≥n a la cantidad de personas que percibe los ingresos correspondientes a cada punto del eje.\nEntonces, necesitamos que cada observaci√≥n de nuestra tabla corresponda a una persona que percibe un ingreso espec√≠fico.\nComo vimos m√°s atr√°s, tenemos una columna de comunas, una columna de la cifra de los ingresos (yoprcor), y la columna n que indica cu√°ntas personas perciben cada ingreso. Por lo tanto, tenemos que alargar nuestra base de datos para que cada ingreso percibido aparezca repetido en tantas filas como personas se indican en n. En otras palabras, tenemos que hacer el ejercicio inverso a contar las personas que perciben un ingreso; es decir, des-contar la tabla de datos: justamente lo que hace la funci√≥n uncount():\n# expandir observaciones casen_ingresos_3 \u0026lt;- casen_ingresos_2 |\u0026gt; mutate(n = as.integer(n)) |\u0026gt; uncount(weights = n) Obtenemos una tabla de datos con 6 millones de filas, donde cada fila representa a una persona.\nGr√°fico de densidad apilada El gr√°fico que queremos hacer tiene en el eje horizontal los ingresos, y en el eje vertical las comunas, y cada una de estas filas del eje vertical mostrar√° la densidad de ingresos de cada comuna.\nEn su versi√≥n m√°s b√°sica ser√≠a algo as√≠:\ncasen_ingresos_3 |\u0026gt; ggplot() + aes(x = variable, y = comuna) + geom_density_ridges() A este gr√°fico horripilante le aplicaremos un poco de magia de {ggplot2} para darle la apariencia que merece.\nEl punto clave es la funci√≥n geom_density_ridges(), que produce las densidades apiladas o crestas. El argumento scale define la elevaci√≥n de cada densidad por encima de la que tiene detr√°s, y bandwidth controla que tanto se suavizan los datos al calcular la curva de densidad, aumentando disminuyendo el detalle de las figuras. Al extremo derecho del gr√°fico agregu√© la mediana de ingresos de cada comuna con geom_text().\nnumber_options(decimal.mark = \u0026#34;,\u0026#34;, big.mark = \u0026#34;.\u0026#34;) # opciones de n√∫meros grandes casen_ingresos_3 |\u0026gt; ggplot() + aes(x = variable, y = comuna) + # densidades geom_density_ridges(rel_min_height = 0, scale = 4, bandwidth = 30000, fill = \u0026#34;black\u0026#34;, color = \u0026#34;white\u0026#34;) + # textos de medianas a la derecha geom_text(data = ~distinct(.x, variable, comuna, mediana), aes(label = label_currency()(mediana |\u0026gt; signif(digits = 2)), x = 2500000), nudge_x = 120000, color = \u0026#34;white\u0026#34;, size = 2.5, check_overlap = T, hjust = 0, vjust = 0.3) + # expandir escala horizontal scale_x_continuous(expand = expansion(c(0, 0.09)), breaks = c(0, .5, 1, 1.5, 2, 2.5)*1000000, labels = label_currency()) + # no cortar geometr√≠as fuera del plano de coordenadas coord_cartesian(clip = \u0026#34;off\u0026#34;) + # tema theme_void(base_family = \u0026#34;Helvetica\u0026#34;) + # texto eje horizontal theme(axis.text.x = element_text(size = 6, color = \u0026#34;white\u0026#34;, margin = margin(t = 4))) + # texto eje vertical theme(axis.text.y = element_text(size = 7, color = \u0026#34;white\u0026#34;, hjust = 1, vjust = 0.3, margin = margin(r = 7))) + # fondo theme(panel.background = element_rect(fill = \u0026#34;black\u0026#34;, linewidth = 0), plot.background = element_rect(fill = \u0026#34;black\u0026#34;, linewidth = 0), plot.margin = unit(c(5, 4, 5, 4), \u0026#34;mm\u0026#34;)) + theme(plot.title = element_text(size = 10, hjust = 0.4, colour = \u0026#34;white\u0026#34;, margin = margin(b = 3)), plot.subtitle = element_text(size = 8, hjust = 0.4, colour = \u0026#34;white\u0026#34;, margin = margin(b = 6))) + # textos labs(title = \u0026#34;Distribuci√≥n de ingresos por comuna: Chile\u0026#34; |\u0026gt; toupper(), subtitle = \u0026#34;Ingreso de la ocupaci√≥n principal, CASEN 2022\u0026#34;) Toca la imagen o este enlace para ver en tama√±o completo Evidentemente, este gr√°fico es m√°s est√©tico que funcional. Sin embargo, se trata de un ejercicio de visualizaci√≥n basada en datos reales. El gr√°fico nos permite ver r√°pidamente la concentraci√≥n de ingresos en la mayor√≠a de las comunas en torno al sueldo m√≠nimo, cada una con distintas desviaciones respecto a esta columna monta√±osa. Las densidades de m√°s arriba corresponden a comunas de mayores ingresos, y por lo tanto sus distribuciones muestran una mayor cantidad de personas que perciben ingresos mayores a 500.000, incluso form√°ndose una peque√±a monta√±ita sobre los 2 millones. A medida que bajamos la vista por el gr√°fico vemos como las dem√°s comunas van acercando sus densidades hacia la mediana nacional.\n","date":"2025-07-12T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-07-11/","tags":"ggplot2 ; gr√°ficos","title":"Gr√°fico de densidad tipo Joy Division en {ggplot2}"},{"content":" En este post veremos a agregar textos que se distancian entre s√≠ autom√°ticamente a tus gr√°ficos. Esto sirve, por ejemplo, para mejorar visualizaciones de datos a las que queremos agregarle texto que identifique las observaciones, a√∫n cuando las observaciones son demasiadas como para etiquetarlas a todas.\nUsaremos el paquete de R {ggrepel} para etiquetar puntos en un gr√°fico con textos que se repelen entre s√≠ de forma autom√°tica.\nEste post requiere conocimientos de {ggplot2}. Si quieres aprender a hacer gr√°ficos en R, revisa este tutorial sobre visualizaci√≥n de datos primero. Datos A modo de ejemplo, usaremos datos del plebiscito de entrada de 2020 en Chile, obtenidos desde el repositorio de datos sobre los plebiscitos constitucionales. √âste repositorio, parte de mi mini sitio de datos sociales chilenos, ofrece versiones limpias y listas para usar de los resultados electorales de estos procesos.\nlibrary(arrow) plebiscito \u0026lt;- read_parquet(\u0026#34;https://github.com/bastianolea/plebiscitos_chile/raw/main/datos/plebiscito_2020_comunas.parquet\u0026#34;) Como los datos est√°n alojados en el repositorio, pueden cargarse directamente en tu sesi√≥n de R tan s√≥lo carg√°ndolos desde el enlace anterior, sin necesidad de descargarse en tu computador.\nLos datos vienen con cada fila representando una opci√≥n de voto por comuna del pa√≠s, con su respectiva cantidad de votos, y se ven as√≠:\nlibrary(dplyr) head(plebiscito) # A tibble: 6 √ó 6 cut_region region cut_comuna comuna opciones votos \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 1101 Iquique Apruebo 61103 2 1 Tarapac√° 1101 Iquique Rechazo 18879 3 1 Tarapac√° 1101 Iquique Votos En Blanco 114 4 1 Tarapac√° 1101 Iquique Votos Nulos 275 5 1 Tarapac√° 1107 Alto Hospicio Apruebo 21589 6 1 Tarapac√° 1107 Alto Hospicio Rechazo 4534 Procesamiento Vamos a hacer un gr√°fico de dispersi√≥n con {ggplot2}, para el cual necesitamos dos columnas con las dos opciones de voto: apruebo y rechazo. Como en el conjunto de datos que cargamos las opciones vienen en una columna (opciones), y el conteo viene en otra (votos), transformaremos la estructura de los datos a un formato ancho usando pivot_wider():\nlibrary(tidyr) plebiscito_ancho \u0026lt;- plebiscito |\u0026gt; pivot_wider(names_from = opciones, values_from = votos) |\u0026gt; janitor::clean_names() Lo que hizo pivot_wider() fue a usar la variable opciones para crear nuevas columnas, y la variable votos para rellenar las nuevas columnas con valores. De este modo, nuestros datos pasaron del formato largo al formato ancho, con una columna que contiene los votos del apruebo y otra del rechazo:\nhead(plebiscito_ancho) # A tibble: 6 √ó 8 cut_region region cut_comuna comuna apruebo rechazo votos_en_blanco \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapac√° 1101 Iquique 61103 18879 114 2 1 Tarapac√° 1107 Alto Hospicio 21589 4534 37 3 1 Tarapac√° 1401 Pozo Almonte 3730 1076 11 4 1 Tarapac√° 1402 Cami√±a 293 207 2 5 1 Tarapac√° 1403 Colchane 131 374 3 6 1 Tarapac√° 1404 Huara 1136 379 6 # ‚Ñπ 1 more variable: votos_nulos \u0026lt;dbl\u0026gt; Ahora usaremos {dplyr} para calcular qu√© opci√≥n gan√≥ en cada comuna del pa√≠s, y el porcentaje de votos que obtuvo:\nlibrary(dplyr) plebiscito_comunas \u0026lt;- plebiscito_ancho |\u0026gt; group_by(cut_comuna) |\u0026gt; # calcular resultado final mutate(resultado = case_when(apruebo \u0026gt; rechazo ~ \u0026#34;Apruebo\u0026#34;, rechazo \u0026gt;= apruebo ~ \u0026#34;Rechazo\u0026#34;), .before = apruebo) |\u0026gt; # calcular porcentaje de votos mutate(porcentaje = apruebo/(apruebo+rechazo)) |\u0026gt; ungroup() head(plebiscito_comunas) # A tibble: 6 √ó 10 cut_region region cut_comuna comuna resultado apruebo rechazo votos_en_blanco \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 1 Tarapa‚Ä¶ 1101 Iquiq‚Ä¶ Apruebo 61103 18879 114 2 1 Tarapa‚Ä¶ 1107 Alto ‚Ä¶ Apruebo 21589 4534 37 3 1 Tarapa‚Ä¶ 1401 Pozo ‚Ä¶ Apruebo 3730 1076 11 4 1 Tarapa‚Ä¶ 1402 Cami√±a Apruebo 293 207 2 5 1 Tarapa‚Ä¶ 1403 Colch‚Ä¶ Rechazo 131 374 3 6 1 Tarapa‚Ä¶ 1404 Huara Apruebo 1136 379 6 # ‚Ñπ 2 more variables: votos_nulos \u0026lt;dbl\u0026gt;, porcentaje \u0026lt;dbl\u0026gt; Gr√°fico Para realizar un gr√°fico de densidad, y especificamos las dos variables que pondremos en los ejes x e y, y una variable que representar√° el color de cada observaci√≥n, las cuales se visualizar√°n como puntos usando geom_point():\nlibrary(ggplot2) plebiscito_comunas |\u0026gt; ggplot() + aes(rechazo, apruebo, color = resultado) + geom_point() Ahora mejoraremos un poco el gr√°fico anterior: definiremos el formato de los n√∫meros de las escalas con scales::number_options(), ajustaremos el tama√±o transparencia de los puntos de geom_point(), luego aplicaremos escalas num√©ricas m√°s bonitas con scale_{x}_continuous(), y finalmente ajustaremos un poco el tema y textos del gr√°fico:\nlibrary(scales) # formato de n√∫meros number_options(decimal.mark = \u0026#34;,\u0026#34;, big.mark = \u0026#34;.\u0026#34;) grafico_resultado \u0026lt;- plebiscito_comunas |\u0026gt; ggplot() + aes(rechazo, apruebo, color = resultado) + geom_point(size = 3, alpha = 0.5) + scale_x_continuous(labels = label_number()) + scale_y_continuous(labels = label_number()) + theme_minimal() + theme(legend.text = element_text(margin = margin(l = 2))) + labs(x = \u0026#34;Rechazo\u0026#34;, y = \u0026#34;Apruebo\u0026#34;, color = \u0026#34;Resultado\u0026#34;) grafico_resultado Ahora, al gr√°fico anterior, le agregaremos inocentemente etiquetas de texto a cada punto, a ver qu√© pasa:\ngrafico_resultado + geom_text(aes(label = comuna), size = 2, color = \u0026#34;grey30\u0026#34;, hjust = 0) Absolutamente nefasto. Son tantos puntos que los textos se transforman en una masa gris debido a la concentraci√≥n.\nUn intento desesperado de corregir esto podr√≠a ser el argumento check_overlap, eliminar√° los textos que aparezcan encima de otros:\ngrafico_resultado + geom_text(aes(label = comuna), size = 2, color = \u0026#34;grey30\u0026#34;, hjust = 0, check_overlap = TRUE) Sin embargo, esta soluci√≥n es demasiado b√°sica, y a√∫n hay textos que aparece encima de puntos, o fuera del margen del gr√°fico.\nEn estos casos resulta ideal geom_text_repel() como reemplazo de geom_text():\nlibrary(ggrepel) grafico_resultado + geom_text_repel(aes(label = comuna), size = 2.5, color = \u0026#34;grey30\u0026#34;, point.padding = 2 # margen de cada punto ) La funci√≥n geom_text_repel() calcula la posesi√≥n de las etiquetas de texto con respecto a las dem√°s, y decide el posicionamiento √≥ptimo para que la mayor cantidad de textos aparezcan, sin que salgan encima de otros textos, ni encima de los puntos.\nEsta funci√≥n tiene varios argumentos para ajustar el algoritmo que decide la ubicaci√≥n de los textos. Uno de ellos es max.overlaps, cuyo defecto es 10, y determina la cantidad m√°xima de etiquetas que pueden estar unas encima de otras antes de qu√© sean descartadas por estar demasiado concentrados en un mismo lugar. Si aumentamos este argumento, la funci√≥n tomar√° en cuenta etiquetas de texto en ubicaciones m√°s complejas, e intentar√° graficarlas movi√©ndolas m√°s lejos de los puntos, o moviendo otras etiquetas de texto a posiciones m√°s lejanas del punto que lo origina. Para mejorar el resultado, podemos aumentar el valor del argumento max.time, el cual le da m√°s tiempo al algoritmo para buscar resolver el posicionamiento de los textos.\ngrafico_resultado + geom_text_repel(aes(label = comuna), size = 2.5, color = \u0026#34;grey30\u0026#34;, segment.size = 0.1, # ancho de l√≠neas (si es que salen) max.overlaps = 30, max.time = 1) En el gr√°fico anterior, aparecen nuevas etiquetas que no salieron antes, algunas de ellas conectadas por l√≠neas con el punto correspondiente.\nTambi√©n podemos determinar ciertos par√°metros para que aparezcan o no aparezcan ciertos textos en el gr√°fico. En el siguiente ejemplo, agregamos una condicional para que solamente aparezcan textos que superen ciertos valores de cada eje, excluyendo los dem√°s.\ngrafico_resultado + geom_text_repel(aes(label = ifelse(rechazo \u0026gt; 30000 | apruebo \u0026gt; 100000, comuna, \u0026#34; \u0026#34;)), size = 2.5, color = \u0026#34;grey30\u0026#34;, segment.size = 0, max.overlaps = 30) Es importante dejar las observaciones que queremos excluir de el etiquetado de texto con un texto vac√≠o o un espacio (\u0026quot; \u0026quot;), y no solamente filtrar las observaciones del dataset, porque as√≠ los puntos del gr√°fico seguir√°n teniendo un texto vac√≠o encima de ellos, lo que har√° que el resto de las etiquetas de texto tambi√©n se alejen de los puntos sin etiqueta.\nHaremos un acercamiento al gr√°fico, definiendo los l√≠mites verticales y horizontales con coord_cartesian(), para que hayan puntos m√°s dispersos:\ngrafico_resultado + coord_cartesian(xlim = c(0, 10000), ylim = c(0, 50000), clip = \u0026#34;off\u0026#34;) + geom_text_repel( aes(label = ifelse(rechazo \u0026gt; 3000 \u0026amp; rechazo \u0026lt; 10000 | apruebo \u0026gt; 20000 \u0026amp; apruebo \u0026lt; 50000, comuna, \u0026#34; \u0026#34;)), size = 2.5, color = \u0026#34;grey30\u0026#34;, segment.size = 0, max.overlaps = 30, max.time = 5) En este caso aplicamos condicionales m√°s estrictas para que aparezcan o desaparezcan los puntos, con el objetivo de que aparezca la mayor cantidad de textos de un sector espec√≠fico del gr√°fico.\nTambi√©n podemos utilizar criterios estad√≠sticos para incluir o excluir el etiquetado de textos. Por ejemplo, en el siguiente gr√°fico solamente mostramos el nombre de los puntos cuyo valor es superior al percentil 73 de cada variable.\ngrafico_resultado + geom_text_repel(aes(label = case_when(rechazo \u0026gt; quantile(rechazo, 0.73) ~ comuna, apruebo \u0026gt; quantile(apruebo, 0.73) ~ comuna)), size = 2.5, color = \u0026#34;grey30\u0026#34;, segment.size = 0, max.overlaps = 30, max.time = 5) + scale_x_continuous(labels = label_number(), limits = c(0, 10000)) + scale_y_continuous(labels = label_number(), limits = c(0, 30000)) + labs(x = \u0026#34;Rechazo (detalle)\u0026#34;, y = \u0026#34;Apruebo (detalle)\u0026#34;) Gr√°fico interactivo Finalmente, una mejor soluci√≥n para estos casos ser√≠a permitir a las y los usuarios explorar la informaci√≥n de todas las observaciones del gr√°fico mediante la interactividad. El paquete {ggiraph} para visualizaciones interactivas nos puede ayudar a transformar cualquier gr√°fico de {ggplot2} en un gr√°fico interactivo, donde los usuarios pueden tocar o poner el Mouse encima de un elemento para obtener m√°s informaci√≥n. S√≥lo es necesario agregarle _interactive a las funciones geom_ del gr√°fico, y especificar el texto que aparecer√° cu√°ndo se ponga el cursor encima de cada elemento en tooltip dentro de aes():\nlibrary(ggiraph) library(glue) grafico_interactivo \u0026lt;- plebiscito_comunas |\u0026gt; ggplot() + aes(rechazo, apruebo, color = resultado) + geom_point_interactive(size = 3, alpha = 0.5, aes(tooltip = glue(\u0026#34;\u0026lt;b\u0026gt;{comuna}\u0026lt;/b\u0026gt;: gana {resultado} con un {percent(porcentaje, 0.1)}\u0026#34;)) ) + geom_text_repel(aes(label = comuna), size = 2.5, color = \u0026#34;grey30\u0026#34;, segment.size = 0.1, point.padding = 2) + scale_x_continuous(labels = label_number()) + scale_y_continuous(labels = label_number()) + theme_minimal() + theme(legend.text = element_text(margin = margin(l = 2))) + labs(x = \u0026#34;Rechazo\u0026#34;, y = \u0026#34;Apruebo\u0026#34;, color = \u0026#34;Resultado\u0026#34;) Para que el gr√°fico se vea y funcione interactivamente, debemos mostrarlo mediante la funci√≥n girafe():\ngirafe(ggobj = grafico_interactivo, # dimensiones del gr√°fico width_svg = 7, height_svg = 5, # opciones para los tooltips options = list( # ocultar barra de opciones opts_toolbar(hidden = \u0026#34;selection\u0026#34;, saveaspng = FALSE), # color al poner el cursor encima opts_hover(css = \u0026#34;fill: white; stroke: black;\u0026#34;), # personalizar la apariencia del tooltip opts_tooltip(opacity = 0.7, use_fill = TRUE, css = \u0026#34;font-family: sans-serif; font-size: 70%; color: white; padding: 4px; border-radius: 5px;\u0026#34;)) ) Vemos que en el gr√°fico anterior, podemos obtener informaci√≥n extra de cada observaci√≥n tan s√≥lo poniendo el cursor encima, lo cual ampl√≠a bastante las posibilidades de comunicaci√≥n, por ejemplo, permitiendo saber informaci√≥n de los puntos de los sectores m√°s densos, o agregando la informaci√≥n de otras variables del conjunto de datos, como el porcentaje.\nPr√≥ximamente: ejemplos para aplicar {ggrepel} en mapas y otras visualizaciones geoespaciales.\n","date":"2025-07-11T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggrepel/","tags":"visualizaci√≥n de datos ; ggplot2 ; gr√°ficos ; texto","title":"Etiquetas de texto que se repelen entre s√≠ con {ggrepel}"},{"content":"El an√°lisis de correlaci√≥n es una t√©cnica estad√≠stica que nos permite identificar si existen relaciones lineales entre distintas variables.\nLo que hace una correlaci√≥n es indicarnos si dos variables tienen una relaci√≥n entre s√≠, en el sentido de que el aumento o disminuci√≥n de una de las variables ocurra en concordancia con la otra variable, ya sea una correlaci√≥n positiva (si una variable aumenta, la otra tambi√©n) o correlaci√≥n negativa (si una variable aumenta, la otra disminuye).\nUn ejemplo de correlaci√≥n positiva ser√≠a: mientras m√°s solcito, m√°s calor. Una correlaci√≥n negativa ser√≠a: a mayor fr√≠o, menos ganas de levantarse üò¥\nEn R podemos realizar an√°lisis de correlaci√≥n en conjuntos de datos enteros, y de este modo podemos encontrar todas las correlaciones que existen entre las variables de los datos. Esto se lograr√≠a tomando todas las variables y cruz√°ndolas todas con todas, para luego identificar cu√°les se correlacionan, en qu√© direcci√≥n y con qu√© intensidad.\nCargar datos Para hacer m√°s interesante el tutorial, vamos a cargar dos conjuntos de datos sociales, obtenidos de mi repositorio de datos sociales p√∫blicos.\nEn esta oportunidad cargaremos un conjunto de datos del Sistema de Informaci√≥n Municipal (Sinim), que es una base de datos sobre los municipios chilenos mantenida anualmente por la Subsecretar√≠a de Desarrollo Regional y Administrativo (Subdere), y el conjunto de datos del Sistema de Indicadores y Est√°ndares de Desarrollo Urbano, conjunto desarrollado por el Instituto Nacional de Estad√≠sticas de Chile que agrupa estad√≠sticas Sobre medio ambiente, planificaci√≥n de ciudades, desarrollo sostenible, acceso a servicios b√°sicos, y movilidad.\nGracias al repositorio de datos sociales, tenemos enlaces directos a conjuntos de datos sociales listos para usar, y cargarlos a tu sesi√≥n de R es tan f√°cil como cargar el dato directamente desde internet:\nlibrary(arrow) # cargar datos sinim sinim \u0026lt;- arrow::read_parquet(\u0026#34;https://github.com/bastianolea/sinim_datos_comunales/raw/main/datos/sinim_2019-2023.parquet\u0026#34;) # cargar datos de siedu siedu \u0026lt;- arrow::read_parquet(\u0026#34;https://github.com/bastianolea/siedu_indicadores_urbanos/raw/main/datos/siedu_indicadores_desarrollo_urbano.parquet\u0026#34;) Limpieza de datos Antes que nada, vamos a cargar {dplyr} para el manejo y la limpieza de los datos.\nlibrary(dplyr) Ech√©mosle un vistazo a los datos con glimpse():\nglimpse(sinim) Rows: 842,510 Columns: 11 $ municipio \u0026lt;chr\u0026gt; \u0026quot;IQUIQUE\u0026quot;, \u0026quot;ALTO HOSPICIO\u0026quot;, \u0026quot;POZO ALMONTE\u0026quot;, \u0026quot;CAMI√ëA\u0026quot;, \u0026quot;C‚Ä¶ $ cut_comuna \u0026lt;chr\u0026gt; \u0026quot;01101\u0026quot;, \u0026quot;01107\u0026quot;, \u0026quot;01401\u0026quot;, \u0026quot;01402\u0026quot;, \u0026quot;01403\u0026quot;, \u0026quot;01404\u0026quot;, \u0026quot;0‚Ä¶ $ a√±o_id \u0026lt;int\u0026gt; 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, ‚Ä¶ $ a√±o \u0026lt;int\u0026gt; 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 20‚Ä¶ $ variable_id \u0026lt;chr\u0026gt; \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, \u0026quot;879\u0026quot;, ‚Ä¶ $ variable \u0026lt;chr\u0026gt; \u0026quot;Ingresos Propios Permanentes (IPP)\u0026quot;, \u0026quot;Ingresos Propios ‚Ä¶ $ variable_desc \u0026lt;chr\u0026gt; \u0026quot;Indicador Bep Ingresos (variable sistema antiguo)\u0026quot;, \u0026quot;In‚Ä¶ $ area \u0026lt;chr\u0026gt; \u0026quot;01. ADMINISTRACION Y FINANZAS MUNICIPALES\u0026quot;, \u0026quot;01. ADMI‚Ä¶ $ subarea \u0026lt;chr\u0026gt; \u0026quot;A. INGRESOS MUNICIPALES (M$)\u0026quot;, \u0026quot;A. INGRESOS MUNICIPALES‚Ä¶ $ unidad \u0026lt;chr\u0026gt; \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M$\u0026quot;, \u0026quot;M‚Ä¶ $ valor \u0026lt;dbl\u0026gt; 34745945, 4107522, 3776040, 108439, 160661, 1067476, 333‚Ä¶ glimpse(siedu) Rows: 6,701 Columns: 12 $ codigo_comuna \u0026lt;dbl\u0026gt; 1107, 1107, 1107, 1107, 1107, 1107, 1107, 1107, 1107,‚Ä¶ $ codigo_region \u0026lt;chr\u0026gt; \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;, \u0026quot;01\u0026quot;,‚Ä¶ $ codigo_provincia \u0026lt;chr\u0026gt; \u0026quot;011\u0026quot;, \u0026quot;011\u0026quot;, \u0026quot;011\u0026quot;, \u0026quot;011\u0026quot;, \u0026quot;011\u0026quot;, \u0026quot;011\u0026quot;, \u0026quot;011\u0026quot;, \u0026quot;011‚Ä¶ $ nombre_region \u0026lt;chr\u0026gt; \u0026quot;Tarapac√°\u0026quot;, \u0026quot;Tarapac√°\u0026quot;, \u0026quot;Tarapac√°\u0026quot;, \u0026quot;Tarapac√°\u0026quot;, \u0026quot;Tara‚Ä¶ $ nombre_provincia \u0026lt;chr\u0026gt; \u0026quot;Iquique\u0026quot;, \u0026quot;Iquique\u0026quot;, \u0026quot;Iquique\u0026quot;, \u0026quot;Iquique\u0026quot;, \u0026quot;Iquique\u0026quot;‚Ä¶ $ nombre_comuna \u0026lt;chr\u0026gt; \u0026quot;Alto Hospicio\u0026quot;, \u0026quot;Alto Hospicio\u0026quot;, \u0026quot;Alto Hospicio\u0026quot;, \u0026quot;A‚Ä¶ $ id \u0026lt;chr\u0026gt; \u0026quot;BPU_8\u0026quot;, \u0026quot;BPU_17\u0026quot;, \u0026quot;EA_34\u0026quot;, \u0026quot;EA_22a\u0026quot;, \u0026quot;EA_22\u0026quot;, \u0026quot;EA_33‚Ä¶ $ a√±o \u0026lt;dbl\u0026gt; 2018, 2019, 2019, 2021, 2021, 2022, 2018, 2018, 2018,‚Ä¶ $ variable \u0026lt;chr\u0026gt; \u0026quot;Cantidad de jornadas diarias completas de trabajo de‚Ä¶ $ valor \u0026lt;dbl\u0026gt; 32.750000, 0.580000, 1.220618, 168.223082, 484.296058‚Ä¶ $ medida \u0026lt;chr\u0026gt; \u0026quot;Jornadas diarias / 10.000 habs\u0026quot;, \u0026quot;Relaci√≥n (N√∫mero d‚Ä¶ $ estandar \u0026lt;chr\u0026gt; \u0026quot;Sin est√°ndar\u0026quot;, \u0026quot;Sin est√°ndar\u0026quot;, \u0026quot;Hasta 1 kilogramo / ‚Ä¶ Notamos que ambos conjuntos de datos vienen en el formato largo, d√≥nde tenemos una columna con los nombres de las variables o indicadores, y otra columna con los valores correspondientes. As√≠ tenemos una tabla con menor cantidad de columnas, donde cada fila es una observaci√≥n que corresponde a una comuna del pa√≠s, en un a√±o espec√≠fico, para una de las variables del conjunto de datos, con su valor correspondiente.\nHaremos tres cosas con los datos:\nPrimero haremos una selecci√≥n de variables interesantes de cada conjunto de datos. Luego, como ambos conjuntos de datos poseen mediciones de distintos a√±os en cada una de sus indicadores o estad√≠sticos, realizaremos una agrupaci√≥n por comuna y variable para dejar las mediciones m√°s recientes en cada indicador y en cada comuna. Finalmente, dejaremos s√≥lo las columnas que nos interesan # filtrar variables sinim_2 \u0026lt;- sinim |\u0026gt; filter(variable %in% c(\u0026#34;Ingresos Propios Permanentes per C√°pita (IPPP)\u0026#34;, \u0026#34;Disponibilidad Presupuestaria Municipal por Habitante (M$)\u0026#34;, \u0026#34;Inversi√≥n Municipal\u0026#34;, \u0026#34;Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total\u0026#34;, \u0026#34;Participaci√≥n de Ingresos por Transferencias en el Ingreso Total\u0026#34;, \u0026#34;Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal\u0026#34;, \u0026#34;Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos Municipales de Educaci√≥n\u0026#34;, \u0026#34;Metros Cuadrados (M2) de Areas Verdes con Mantenimiento por Habitante\u0026#34;, \u0026#34;Porcentaje de mujeres funcionarias municipales\u0026#34;, \u0026#34;Densidad de Poblaci√≥n por Km2\u0026#34;, \u0026#34;Poblaci√≥n Comunal, Estimada por el INE\u0026#34;, \u0026#34;Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)\u0026#34;)) # dejar s√≥lo la medici√≥n m√°s reciente de cada variable en cada comuna sinim_3 \u0026lt;- sinim_2 |\u0026gt; group_by(cut_comuna, variable) |\u0026gt; slice_max(a√±o) |\u0026gt; ungroup() |\u0026gt; mutate(cut_comuna = as.numeric(cut_comuna)) # seleccionar columnas sinim_4 \u0026lt;- sinim_3 |\u0026gt; select(cut_comuna, variable, valor) # filtrar variables siedu_2 \u0026lt;- siedu |\u0026gt; filter(variable %in% c( \u0026#34;Consumo de energ√≠a el√©ctrica per c√°pita residencial\u0026#34;, \u0026#34;Tiempo de viaje en hora punta ma√±ana\u0026#34;, \u0026#34;Superficie de √°reas verdes p√∫blicas por habitante\u0026#34;, \u0026#34;N√∫mero de microbasurales por cada 10.000 habitantes\u0026#34;, \u0026#34;Poblaci√≥n estimada de migrantes internacionales por comuna\u0026#34;, \u0026#34;Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional\u0026#34;, \u0026#34;Porcentaje de viviendas en situaci√≥n de hacinamiento\u0026#34;, \u0026#34;Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes\u0026#34;, \u0026#34;Tasa de conexiones residenciales fijas de internet por cada 100 habitantes\u0026#34;)) # dejar s√≥lo la medici√≥n m√°s reciente de cada variable en cada comuna siedu_3 \u0026lt;- siedu_2 |\u0026gt; group_by(codigo_comuna, variable) |\u0026gt; slice_max(a√±o) |\u0026gt; ungroup() # seleccionar columnas siedu_4 \u0026lt;- siedu_3 |\u0026gt; select(cut_comuna = codigo_comuna, variable, valor) Veamos c√≥mo van quedando los datos:\nsinim_4 # A tibble: 3,806 √ó 3 cut_comuna variable valor \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1101 Densidad de Poblaci√≥n por Km2 1.02e2 2 1101 Disponibilidad Presupuestaria Municipal por Habitante (M$) 4.27e2 3 1101 Ingresos Propios Permanentes per C√°pita (IPPP) 1.92e2 4 1101 Inversi√≥n Municipal 2.57e6 5 1101 Participaci√≥n de Ingresos por Transferencias en el Ingreso‚Ä¶ 4.38e1 6 1101 Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total 6.4 e0 7 1101 Poblaci√≥n Comunal, Estimada por el INE 2.31e5 8 1101 Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal 7.58e1 9 1101 Porcentaje de Hogares de 0-40% de Ingresos respecto del To‚Ä¶ 4.44e1 10 1101 Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos e‚Ä¶ 7.61e1 # ‚Ñπ 3,796 more rows siedu_4 # A tibble: 891 √ó 3 cut_comuna variable valor \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 1101 Consumo de energ√≠a el√©ctrica per c√°pita residencial 7.09e2 2 1101 N√∫mero de microbasurales por cada 10.000 habitantes 1.21e1 3 1101 Poblaci√≥n estimada de migrantes internacionales por comuna 4.46e4 4 1101 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidi‚Ä¶ 1.97e1 5 1101 Porcentaje de viviendas en situaci√≥n de hacinamiento 9.92e0 6 1101 Superficie de √°reas verdes p√∫blicas por habitante 2.13e0 7 1101 Tasa de conexiones residenciales fijas de internet por cad‚Ä¶ 2.14e1 8 1101 Tasa de v√≠ctimas de delitos violentos por casos policiales‚Ä¶ 1.46e2 9 1101 Tiempo de viaje en hora punta ma√±ana 3 e1 10 1107 Consumo de energ√≠a el√©ctrica per c√°pita residencial 4.84e2 # ‚Ñπ 881 more rows Unir datos Vamos a combinar estos dos conjuntos de datos para tener una mezcla de variables de temas socioecon√≥micos que ser√≠a interesante correlacionar. Como hicimos que ambos conjuntos de datos est√©n ordenados bajo la misma l√≥gica, para unirlos s√≥lo necesitamos agregar las filas de un conjunto al otro.\ndatos \u0026lt;- bind_rows(sinim_4, siedu_4) Ahora que los datos est√°n unidos, contamos con 20 variables para correlacionar.\ndatos |\u0026gt; distinct(variable) |\u0026gt; print(n=Inf) # A tibble: 20 √ó 1 variable \u0026lt;chr\u0026gt; 1 Densidad de Poblaci√≥n por Km2 2 Disponibilidad Presupuestaria Municipal por Habitante (M$) 3 Ingresos Propios Permanentes per C√°pita (IPPP) 4 Inversi√≥n Municipal 5 Participaci√≥n de Ingresos por Transferencias en el Ingreso Total 6 Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total 7 Poblaci√≥n Comunal, Estimada por el INE 8 Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal 9 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) 10 Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos‚Ä¶ 11 Porcentaje de mujeres funcionarias municipales 12 Consumo de energ√≠a el√©ctrica per c√°pita residencial 13 N√∫mero de microbasurales por cada 10.000 habitantes 14 Poblaci√≥n estimada de migrantes internacionales por comuna 15 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional 16 Porcentaje de viviendas en situaci√≥n de hacinamiento 17 Superficie de √°reas verdes p√∫blicas por habitante 18 Tasa de conexiones residenciales fijas de internet por cada 100 habitantes 19 Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habit‚Ä¶ 20 Tiempo de viaje en hora punta ma√±ana Pivotar datos a ancho El √∫ltimo paso antes del an√°lisis de correlaci√≥n es pivotar la estructura de los datos al formato ancho., porque las funciones que realizan correlaciones en R esperan que los datos vengan de esta forma.\nSi bien en el formato largo tenemos una columna con el nombre de las variables y otra columna con el valor de cada variable, siendo cada fila una observaci√≥n, en el formato ancho cada columna corresponde a una variable, mientras que cada fila corresponde a una observaci√≥n.\nlibrary(tidyr) datos_ancho \u0026lt;- datos |\u0026gt; # pivotar a ancho pivot_wider(id_cols = cut_comuna, # columna que identifica las observaciones values_from = valor, # columna con los valores names_from = variable # columna con los nombres de columna ) Se consultamos los nombres de las columnas, confirmamos que ahora cada variable se encuentra una columna individual:\nnames(datos_ancho) [1] \u0026quot;cut_comuna\u0026quot; [2] \u0026quot;Densidad de Poblaci√≥n por Km2\u0026quot; [3] \u0026quot;Disponibilidad Presupuestaria Municipal por Habitante (M$)\u0026quot; [4] \u0026quot;Ingresos Propios Permanentes per C√°pita (IPPP)\u0026quot; [5] \u0026quot;Inversi√≥n Municipal\u0026quot; [6] \u0026quot;Participaci√≥n de Ingresos por Transferencias en el Ingreso Total\u0026quot; [7] \u0026quot;Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total\u0026quot; [8] \u0026quot;Poblaci√≥n Comunal, Estimada por el INE\u0026quot; [9] \u0026quot;Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal\u0026quot; [10] \u0026quot;Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)\u0026quot; [11] \u0026quot;Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos Municipales de Educaci√≥n\u0026quot; [12] \u0026quot;Porcentaje de mujeres funcionarias municipales\u0026quot; [13] \u0026quot;Consumo de energ√≠a el√©ctrica per c√°pita residencial\u0026quot; [14] \u0026quot;N√∫mero de microbasurales por cada 10.000 habitantes\u0026quot; [15] \u0026quot;Poblaci√≥n estimada de migrantes internacionales por comuna\u0026quot; [16] \u0026quot;Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional\u0026quot; [17] \u0026quot;Porcentaje de viviendas en situaci√≥n de hacinamiento\u0026quot; [18] \u0026quot;Superficie de √°reas verdes p√∫blicas por habitante\u0026quot; [19] \u0026quot;Tasa de conexiones residenciales fijas de internet por cada 100 habitantes\u0026quot; [20] \u0026quot;Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes\u0026quot; [21] \u0026quot;Tiempo de viaje en hora punta ma√±ana\u0026quot; Correlaci√≥n El paquete {corrr}, parte del framework tidymodels, nos facilita realizar una correlaci√≥n cuyo resultado viene en una tabla ordenada con tan s√≥lo una funci√≥n: correlate()\nlibrary(corrr) correlaci√≥n \u0026lt;- datos_ancho |\u0026gt; select(-cut_comuna) |\u0026gt; correlate() correlaci√≥n # A tibble: 20 √ó 21 term Densidad de Poblaci√≥‚Ä¶¬π Disponibilidad Presu‚Ä¶¬≤ Ingresos Propios Per‚Ä¶¬≥ `Inversi√≥n Municipal` Participaci√≥n de Ing‚Ä¶‚Å¥ Participaci√≥n del Fo‚Ä¶‚Åµ Poblaci√≥n Comunal, E‚Ä¶‚Å∂ Porcentaje de Ejecuc‚Ä¶‚Å∑ Porcentaje de Hogare‚Ä¶‚Å∏ Porcentaje de Puntaj‚Ä¶‚Åπ Porcentaje de mujere‚Ä¶Àü Consumo de energ√≠a e‚Ä¶Àü N√∫mero de microbasur‚Ä¶Àü Poblaci√≥n estimada d‚Ä¶Àü Porcentaje de la pob‚Ä¶Àü Porcentaje de vivien‚Ä¶Àü Superficie de √°reas ‚Ä¶Àü Tasa de conexiones r‚Ä¶Àü Tasa de v√≠ctimas de ‚Ä¶Àü Tiempo de viaje en h‚Ä¶Àü \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Densidad de Poblaci√≥n por Km2 NA -0.0969 -0.0445 0.222 0.0415 -0.255 0.480 0.192 -0.311 0.0238 -0.0105 0.0691 -0.119 0.516 -0.0295 0.379 -0.112 0.248 0.657 0.213 2 Disponibilidad Presupuestaria Municip‚Ä¶ -0.0969 NA 0.782 -0.0794 0.110 0.0764 -0.190 -0.217 -0.327 -0.0743 -0.0905 0.681 -0.0329 -0.0473 -0.247 -0.371 0.404 0.148 -0.0675 -0.232 3 Ingresos Propios Permanentes per C√°pi‚Ä¶ -0.0445 0.782 NA 0.0366 0.0233 -0.224 -0.0802 -0.117 -0.359 -0.106 -0.0711 0.762 -0.0139 0.0200 -0.308 -0.391 0.512 0.214 -0.0761 -0.286 4 Inversi√≥n Municipal 0.222 -0.0794 0.0366 NA 0.00615 -0.290 0.555 0.0647 -0.317 0.153 -0.0946 0.222 -0.113 0.142 -0.409 -0.297 0.162 0.375 0.0877 -0.0957 5 Participaci√≥n de Ingresos por Transfe‚Ä¶ 0.0415 0.110 0.0233 0.00615 NA -0.331 0.0326 -0.0573 -0.0969 0.0340 0.00478 -0.134 -0.0293 -0.150 0.00375 0.0973 -0.188 0.0971 0.238 0.0176 6 Participaci√≥n del Fondo Com√∫n Municip‚Ä¶ -0.255 0.0764 -0.224 -0.290 -0.331 NA -0.400 -0.263 0.511 -0.1000 -0.0315 -0.543 -0.0714 -0.220 0.406 0.273 -0.336 -0.370 -0.222 0.238 7 Poblaci√≥n Comunal, Estimada por el INE 0.480 -0.190 -0.0802 0.555 0.0326 -0.400 NA 0.213 -0.416 0.110 -0.0592 -0.0770 -0.0972 0.404 -0.298 -0.0503 -0.0699 0.421 0.313 -0.0764 8 Porcentaje de Ejecuci√≥n Presupuestari‚Ä¶ 0.192 -0.217 -0.117 0.0647 -0.0573 -0.263 0.213 NA -0.0976 0.0992 0.00160 0.000366 0.0701 -0.0124 -0.0596 0.0518 0.00593 0.0264 0.149 0.182 9 Porcentaje de Hogares de 0-40% de Ing‚Ä¶ -0.311 -0.327 -0.359 -0.317 -0.0969 0.511 -0.416 -0.0976 NA -0.143 -0.0263 -0.487 0.121 -0.279 0.733 0.462 -0.260 -0.664 -0.195 0.257 10 Porcentaje de Puntajes PSU Igual o Su‚Ä¶ 0.0238 -0.0743 -0.106 0.153 0.0340 -0.1000 0.110 0.0992 -0.143 NA -0.0230 0.277 -0.0532 0.230 -0.572 -0.316 0.0845 0.412 0.0600 -0.235 11 Porcentaje de mujeres funcionarias mu‚Ä¶ -0.0105 -0.0905 -0.0711 -0.0946 0.00478 -0.0315 -0.0592 0.00160 -0.0263 -0.0230 NA -0.0355 0.0486 -0.130 0.206 0.0925 -0.142 -0.0206 -0.0459 0.210 12 Consumo de energ√≠a el√©ctrica per c√°pi‚Ä¶ 0.0691 0.681 0.762 0.222 -0.134 -0.543 -0.0770 0.000366 -0.487 0.277 -0.0355 NA 0.0685 0.0691 -0.346 -0.482 0.450 0.342 -0.0319 -0.155 13 N√∫mero de microbasurales por cada 10.‚Ä¶ -0.119 -0.0329 -0.0139 -0.113 -0.0293 -0.0714 -0.0972 0.0701 0.121 -0.0532 0.0486 0.0685 NA -0.0890 0.0742 0.0720 -0.120 -0.251 -0.0503 -0.191 14 Poblaci√≥n estimada de migrantes inter‚Ä¶ 0.516 -0.0473 0.0200 0.142 -0.150 -0.220 0.404 -0.0124 -0.279 0.230 -0.130 0.0691 -0.0890 NA -0.230 0.246 -0.145 0.0871 0.523 -0.119 15 Porcentaje de la poblaci√≥n en situaci‚Ä¶ -0.0295 -0.247 -0.308 -0.409 0.00375 0.406 -0.298 -0.0596 0.733 -0.572 0.206 -0.346 0.0742 -0.230 NA 0.628 -0.169 -0.681 0.0239 0.301 16 Porcentaje de viviendas en situaci√≥n ‚Ä¶ 0.379 -0.371 -0.391 -0.297 0.0973 0.273 -0.0503 0.0518 0.462 -0.316 0.0925 -0.482 0.0720 0.246 0.628 NA -0.235 -0.505 0.454 0.266 17 Superficie de √°reas verdes p√∫blicas p‚Ä¶ -0.112 0.404 0.512 0.162 -0.188 -0.336 -0.0699 0.00593 -0.260 0.0845 -0.142 0.450 -0.120 -0.145 -0.169 -0.235 NA 0.135 -0.0458 -0.241 18 Tasa de conexiones residenciales fija‚Ä¶ 0.248 0.148 0.214 0.375 0.0971 -0.370 0.421 0.0264 -0.664 0.412 -0.0206 0.342 -0.251 0.0871 -0.681 -0.505 0.135 NA 0.172 -0.338 19 Tasa de v√≠ctimas de delitos violentos‚Ä¶ 0.657 -0.0675 -0.0761 0.0877 0.238 -0.222 0.313 0.149 -0.195 0.0600 -0.0459 -0.0319 -0.0503 0.523 0.0239 0.454 -0.0458 0.172 NA -0.0366 20 Tiempo de viaje en hora punta ma√±ana 0.213 -0.232 -0.286 -0.0957 0.0176 0.238 -0.0764 0.182 0.257 -0.235 0.210 -0.155 -0.191 -0.119 0.301 0.266 -0.241 -0.338 -0.0366 NA # ‚Ñπ abbreviated names: ¬π‚Äã`Densidad de Poblaci√≥n por Km2`, ¬≤‚Äã`Disponibilidad Presupuestaria Municipal por Habitante (M$)`, ¬≥‚Äã`Ingresos Propios Permanentes per C√°pita (IPPP)`, ‚Å¥‚Äã`Participaci√≥n de Ingresos por Transferencias en el Ingreso Total`, ‚Åµ‚Äã`Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total`, ‚Å∂‚Äã`Poblaci√≥n Comunal, Estimada por el INE`, ‚Å∑‚Äã`Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal`, ‚Å∏‚Äã`Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)`, # ‚Åπ‚Äã`Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos Municipales de Educaci√≥n`, Àü‚Äã`Porcentaje de mujeres funcionarias municipales`, Àü‚Äã`Consumo de energ√≠a el√©ctrica per c√°pita residencial`, Àü‚Äã`N√∫mero de microbasurales por cada 10.000 habitantes`, Àü‚Äã`Poblaci√≥n estimada de migrantes internacionales por comuna`, Àü‚Äã`Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional`, Àü‚Äã`Porcentaje de viviendas en situaci√≥n de hacinamiento`, # Àü‚Äã`Superficie de √°reas verdes p√∫blicas por habitante`, Àü‚Äã`Tasa de conexiones residenciales fijas de internet por cada 100 habitantes`, Àü‚Äã`Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes`, Àü‚Äã`Tiempo de viaje en hora punta ma√±ana` En la tabla anterior (muy rudimentaria a√∫n) podemos ver el cruce entre todas las variables. La tabla se lee partiendo por una fila, que representa una de las variables, y cada vez que esta fila se intercepta con una columna, el valor representa el cruce de la variable de la fila con la variable de la columna.\nComo estamos cruzando todas con todas las variables, obviamente cada variable tambi√©n se cruza consigo misma, lo cual resulta en un NA.\nComo el resultado es muy grande, y la cantidad de columnas muy alta, {corrr} ofrece la funci√≥n stretch() para convertir f√°cilmente el resultado a un formato largo:\ncorrelaci√≥n |\u0026gt; stretch() # A tibble: 400 √ó 3 x y r \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Densidad de Poblaci√≥n por Km2 Densidad de Poblaci√≥n por Km2 NA 2 Densidad de Poblaci√≥n por Km2 Disponibilidad Presupuestaria Municipal por‚Ä¶ -0.0969 3 Densidad de Poblaci√≥n por Km2 Ingresos Propios Permanentes per C√°pita (IP‚Ä¶ -0.0445 4 Densidad de Poblaci√≥n por Km2 Inversi√≥n Municipal 0.222 5 Densidad de Poblaci√≥n por Km2 Participaci√≥n de Ingresos por Transferencia‚Ä¶ 0.0415 6 Densidad de Poblaci√≥n por Km2 Participaci√≥n del Fondo Com√∫n Municipal en ‚Ä¶ -0.255 7 Densidad de Poblaci√≥n por Km2 Poblaci√≥n Comunal, Estimada por el INE 0.480 8 Densidad de Poblaci√≥n por Km2 Porcentaje de Ejecuci√≥n Presupuestaria Deve‚Ä¶ 0.192 9 Densidad de Poblaci√≥n por Km2 Porcentaje de Hogares de 0-40% de Ingresos ‚Ä¶ -0.311 10 Densidad de Poblaci√≥n por Km2 Porcentaje de Puntajes PSU Igual o Superior‚Ä¶ 0.0238 # ‚Ñπ 390 more rows Esto nos puede servir para encontrar las correlaciones con una de las variables en particular; por ejemplo, encontrar la correlaci√≥n de las variables con el tiempo de viaje en hora punta por las ma√±anas:\ncorrelaci√≥n |\u0026gt; stretch() |\u0026gt; filter(x == \u0026#34;Tiempo de viaje en hora punta ma√±ana\u0026#34;) |\u0026gt; select(y, r) |\u0026gt; head() # A tibble: 6 √ó 2 y r \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Densidad de Poblaci√≥n por Km2 0.213 2 Disponibilidad Presupuestaria Municipal por Habitante (M$) -0.232 3 Ingresos Propios Permanentes per C√°pita (IPPP) -0.286 4 Inversi√≥n Municipal -0.0957 5 Participaci√≥n de Ingresos por Transferencias en el Ingreso Total 0.0176 6 Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total 0.238 Interpretaci√≥n de correlaciones La columna r nos indica el valor de la correlaci√≥n de la variable filtrada con todo el resto de las variables.\nComo las correlaciones pueden ser positivas o negativas, el valor de la correlaci√≥n (r) puede ser positivo o negativo. Los valores de correlaci√≥n van del 0 al 1 (o del 0 al -1), donde una correlaci√≥n igual a 0 significa que no existe correlaci√≥n, y una correlaci√≥n igual a 1 significa que la correlaci√≥n es total. Usualmente, una correlaci√≥n mayor a 0,3 se considera moderada, y mayor a 0,5 se considera fuerte, pero las interpretaciones De estos valores son m√∫ltiples.\nOrdenemos las variables por su intensidad de correlaci√≥n con el tiempo de viaje:\ncorrelaci√≥n |\u0026gt; stretch() |\u0026gt; filter(x == \u0026#34;Tiempo de viaje en hora punta ma√±ana\u0026#34;) |\u0026gt; select(y, r) |\u0026gt; arrange(desc(abs(r))) |\u0026gt; head() # A tibble: 6 √ó 2 y r \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Tasa de conexiones residenciales fijas de internet por cada 100 habitantes -0.338 2 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional 0.301 3 Ingresos Propios Permanentes per C√°pita (IPPP) -0.286 4 Porcentaje de viviendas en situaci√≥n de hacinamiento 0.266 5 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) 0.257 6 Superficie de √°reas verdes p√∫blicas por habitante -0.241 En las primeras 3 filas podemos ver correlaciones negativas fuertes: las comunas del pa√≠s donde los tiempos de viaje de viaje en hora punta por la ma√±ana son mayores, tambi√©n son comunas donde los puntajes en la prueba de selecci√≥n universitaria (PSU) son menores, y menores son los recursos municipales por habitante. Dicho de otro modo, a menores recursos municipales por habitantes, mayor tiempo de viaje en hora punta por la ma√±ana.\nEn las filas 4 y 5 vemos unas correlaciones positivas moderadas: los tiempos de viaje en horario punta por las ma√±anas tambi√©n son m√°s altos en las comunas donde existen m√°s hogares con ingresos bajos (seg√∫n el Registro Social de Hogares), y donde los municipios dependen m√°s del financiamiento del Fondo Com√∫n Municipal.\nB√∫squeda de correlaciones C√≥mo tenemos todos los valores de correlaci√≥n en una misma columna gracias a stretch(), podemos filtrar los valores para encontrar solamente con relaciones fuertes. Podemos lograr esto filtrando valores mayores a 0,5 o menores a -0,5, o filtrando valores mayores a el valor absoluto de 0,5 (abs(0.5)). Luego ordenamos los valores de mayor a menor, usando el valor absoluto de r (el valor en positivo).\ncorrelaci√≥n |\u0026gt; stretch(remove.dups = T) |\u0026gt; filter(r \u0026gt; 0.5 | r \u0026lt; -0.5) |\u0026gt; arrange(desc(abs(r))) |\u0026gt; head() # A tibble: 6 √ó 3 x y r \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Disponibilidad Presupuestaria Municipal por Habitante (M$) Ingresos Propios Permanentes per C√°pita (IPPP) 0.782 2 Ingresos Propios Permanentes per C√°pita (IPPP) Consumo de energ√≠a el√©ctrica per c√°pita residencial 0.762 3 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional 0.733 4 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional Tasa de conexiones residenciales fijas de internet por cada 100 habitantes -0.681 5 Disponibilidad Presupuestaria Municipal por Habitante (M$) Consumo de energ√≠a el√©ctrica per c√°pita residencial 0.681 6 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) Tasa de conexiones residenciales fijas de internet por cada 100 habitantes -0.664 Evidentemente, las correlaciones m√°s fuertes son entre variables similares: los hogares de menores ingresos correlacionan con la poblaci√≥n en situaci√≥n de pobreza, la disponibilidad de presupuesto municipal por habitante se correlaciona con los ingresos municipales perc√°pita, y otras obviedades. Habr√≠a que afinar la selecci√≥n de variables para remover aquellas que representan a un mismo fen√≥meno social subyacente.\nVisualizaci√≥n Otra gracia de {corrr} es que facilita visualizar las correlaciones por medio de un gr√°fico con la funci√≥n rplot(), que produce un gr√°fico {ggplot2} con nuestra matriz de correlaci√≥n.\nEn teor√≠a, visualizar una correlaci√≥n ser√≠a as√≠ de f√°cil:\ndatos |\u0026gt; correlate() |\u0026gt; rplot() Como nuestra matriz de correlaci√≥n tiene muchas variables, tendremos que agregar algunos ajustes para que se vea bien.\nlibrary(ggplot2) correlaci√≥n |\u0026gt; rearrange() |\u0026gt; # ordenar por intensidad rplot(print_cor = T, # agregar valores encima legend = F) + # sin leyenda # cortar los nombres de variable scale_y_discrete(labels = scales::label_wrap(70)) + scale_x_discrete(labels = scales::label_wrap(70)) + # variables inferiores inclinadas theme(axis.text.x = element_text(angle = 40, hjust = 1), axis.text = element_text(lineheight = 0.9, color = \u0026#34;black\u0026#34;)) Con esta visualizaci√≥n, podemos ver el color y el tama√±o de los c√≠rculos para encontrar r√°pidamente los cruces entre variables que est√°n correlacionados.\nA la r√°pida, podemos ver que arriba a la izquierda la variable de consumo de energ√≠a el√©ctrica se correlaciona con los recursos municipales, y abajo la izquierda podemos ver qu√© el porcentaje de hogares en los tramos menores de ingresos se correlaciona con menos conexiones a Internet y menos consumo el√©ctrico. Tambi√©n al centro del gr√°fico podemos ver una alta correlaci√≥n entre la tasa de v√≠ctimas de delitos violentos y la densidad poblacional.\nAlternativas El paquete {ggcorrplot} es muy usado para obener gr√°ficos de correlaciones, y tiene opciones que permiten personalizar la forma de visualizarlas:\nlibrary(ggcorrplot) corr \u0026lt;- round(cor(mtcars), 1) ggcorrplot(corr) Tambi√©n permite presentar con c√≠rculos:\nggcorrplot(corr, method = \u0026#34;circle\u0026#34;) Y tiene la opci√≥n de entregar una matriz de correlaci√≥n de los valores p para excluir las correlaciones con coeficientes que no sean estad√≠sticamente significativos:\nggcorrplot(corr, hc.order = TRUE, type = \u0026#34;lower\u0026#34;, p.mat = cor_pmat(mtcars)) Otra funci√≥n de R que permite realizar correlaciones y visualizarlas de inmediato es ggcor() del paquete {GGally}, que entrega varios tipos de gr√°ficos estad√≠sticos para an√°lisis exploratorios de datos.\ndatos_ancho |\u0026gt; select(-cut_comuna) |\u0026gt; GGally::ggcorr(hjust = 1, nbreaks = 5, layout.exp = 10, label = TRUE) El resultado es menos atractivo, pero si es bastante m√°s legible.\nManualmente Finalmente, y como no pod√≠a faltar, tambi√©n podemos crear un gr√°fico de la matriz de correlaci√≥n desde cero con {ggplot2}. Esto no es tan complejo gracias a que correlate() y stretch() entregan los resultados bien ordenaditos.\ndatos_ancho |\u0026gt; correlate() |\u0026gt; rearrange() |\u0026gt; stretch() |\u0026gt; # gr√°fico ggplot() + aes(x, y, fill = r) + geom_tile(color = \u0026#34;white\u0026#34;, linewidth = 0.6) + # geometr√≠a de cuadros o mosaicos geom_text(aes(label = round(r, 1)), color = \u0026#34;black\u0026#34;, size = 3) + # texto # escala de color de los cuadros scale_fill_gradient2(high = \u0026#34;indianred2\u0026#34;, mid = \u0026#34;white\u0026#34;, low = \u0026#34;skyblue1\u0026#34;, na.value = \u0026#34;white\u0026#34;) + # formato de las escalas de los ejes scale_y_discrete(labels = scales::label_wrap(50), expand = c(0, 0)) + scale_x_discrete(labels = scales::label_wrap(60), expand = c(0, 0)) + # ajustes de tema theme_minimal() + theme(axis.text = element_text(lineheight = 0.9, color = \u0026#34;black\u0026#34;), axis.text.x = element_text(angle = 40, hjust = 1), axis.title = element_blank(), legend.key.width = unit(2, \u0026#34;mm\u0026#34;)) Tambi√©n podemos aprovechar el vuelo para hacer una bonita obra de arte con nuestras correlaciones:\ndatos_ancho |\u0026gt; correlate() |\u0026gt; rearrange() |\u0026gt; stretch() |\u0026gt; ggplot() + aes(x, y, fill = r) + geom_tile(color = \u0026#34;white\u0026#34;, linewidth = 0.6) + scale_fill_gradient2(high = \u0026#34;#865BAB\u0026#34;, mid = \u0026#34;white\u0026#34;, low = \u0026#34;#AB5B90\u0026#34;, na.value = \u0026#34;white\u0026#34;) + guides(fill = guide_none()) + theme_void() + coord_fixed() Como siempre, {ggplot2} es una herramienta extremadamente vers√°til para visualizar cualquier tipo de informaci√≥n. Puedes aprender a crear visualizaciones de datos desde cero en R siguiendo este tutorial de {ggplot2}.\nSi te gust√≥ este contenido, puedes ayudarme don√°ndome un cafecito si presionas el siguiente bot√≥n. Te lo agradecer√≠a mucho y me anima a seguir compartiendo!\n","date":"2025-07-09T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/correlaciones/","tags":"estad√≠stica ; ggplot2 ; gr√°ficos ; visualizaci√≥n de datos","title":"An√°lisis y visualizaci√≥n de correlaciones en R"},{"content":" {ggview} es un paquete de R que te ayuda a crear gr√°ficos en {ggplot2} manteniendo un tama√±o fijo.\nEn RStudio, los gr√°ficos que aparecen en el panel de gr√°ficos (Plots) se adaptan al tama√±o de dicho panel. Por ejemplo, si tu panel es chico, el gr√°fico no tendr√≠a espacio para verse bien:\nPero si ampl√≠as el tama√±o del panel lo suficiente, el gr√°fico se ver√° mejor:\nEsto es conveniente para ir explorando visualizaciones, pero puede confundirte cuando quieras guardar el gr√°fico. Una vez que tu gr√°fico est√° listo, procedes a guardarlo\u0026hellip;\nggsave(\u0026#34;grafico.jpg\u0026#34;) Pero cuando abres el gr√°fico, sorpresa, se ve distinto! üôÑ\nEsto es porque las dimensiones del panel Plots no son las mismas que las dimensiones con que se guardan por defecto los gr√°ficos. En la funci√≥n ggsave() puedes especificar ancho, alto y resoluci√≥n de la imagen que se va a guardar. Entonces, lo que podr√≠as hacer es intentar configurar ggsave() para que el gr√°fico se guarde como t√∫ esperas\u0026hellip; pero a veces esto se vuelve en un juego de ir adivinando, intentando n√∫meros varias veces hasta que le achuntas al gr√°fico que esperabas.\nUna mejor alternativa es usar {ggview} para previsualizar tus gr√°ficos con un tama√±o fijo:\nlibrary(ggview) grafico + canvas(7, 5) De esta forma, no importa el tama√±o de tu ventana de RStudio: tu gr√°fico se previsualizar√° con la resoluci√≥n y proporci√≥n que tu especifiques.\nRecomiendo empezar a usar ggview::canvas() cuando tu gr√°fico ya est√° casi completo y te pones a afinar detalles est√©ticos finales.\nCuando ya sea la hora de guardar el gr√°fico como una imagen, si usas la funci√≥n ggview::save_ggplot() (no confundir con la com√∫n, ggsave()), el gr√°fico se guardar√° con las dimensiones que hab√≠as puesto en canvas() y se ver√° exactamente como lo estabas previsualizando en RStudio!\ngrafico_2 \u0026lt;- grafico + canvas(7, 5) save_ggplot(grafico_2, \u0026#34;grafico_2.jpg\u0026#34;) # mantiene las dimensiones Instala {ggview} ejecutando lo siguiente en tu consola:\ninstall.packages(\u0026#34;ggview\u0026#34;) ","date":"2025-07-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggview/","tags":"visualizaci√≥n de datos ; gr√°ficos ; ggplot2","title":"Controla las dimensiones de tus gr√°ficos con {ggview}"},{"content":"Consejo: si tus documentos Quarto salen pesados por tener muchos gr√°ficos, intenta cambiar en el YAML el siguiente argumento para que los gr√°ficos incluidos vayan en formato .jpg en vez de .png (por defecto).\nfig-format: \u0026#34;jpeg\u0026#34; Las im√°genes .jpg son m√°s livianas, porque usan compresi√≥n, aunque pueden tener un poco menos de calidad y no tienen fondo transparente. Por otro lado, las im√°genes .png son lossless (no tienen compresi√≥n ni p√©rdida de calidad) y transparencia, pero a cambio son m√°s pesadas.\nAc√° se nota la diferencia de tama√±os entre un mismo reporte con gr√°ficos en .png y .jpg: una reducci√≥n de un 39,9% en el peso del archivo con s√≥lo agregar una l√≠nea.\n","date":"2025-07-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-07-08/","tags":"quarto ; consejos","title":"Reduce el tama√±o de tus reportes Quarto con este truco"},{"content":"Una de las formas m√°s intuitivas de visualizar datos de texto son las nubes de palabras. En las nubes de palabras seleccionamos un subconjunto de las palabras del texto que queremos analizar y las distribuimos en un gr√°fico, donde las palabras que aparecen m√°s frecuentemente aparecen m√°s grandes, y usualmente al centro. Sirven para ver r√°pidamente los conceptos clave de un documento o un corpus de documentos.\nEn este post veremos dos formas de crear nubes de palabras con R: con {wordcloud2} y con {ggplot2}. Para empezar, necesitamos una base de datos que tenga informaci√≥n de texto; por ejemplo, una base donde cada fila contenga una respuesta abierta de una encuesta, una rese√±a de un producto, un p√°rrafo de un texto, un cap√≠tulo de un libro, o un libro completo.\nCon el siguiente c√≥digo descargaremos una base de datos con 10.000 documentos de texto, en este caso se trata de noticias de la prensa chilena. Los datos son obtenidos de este repositorio de obtenci√≥n automatizada de textos de noticias de prensa escrita chilena.\nlibrary(dplyr) # direcci√≥n web donde se encuentran los datos url_datos \u0026lt;- \u0026#34;https://raw.githubusercontent.com/bastianolea/prensa_chile/refs/heads/main/datos/prensa_datos_muestra.csv\u0026#34; # lectura de los datos ubicados en internet noticias \u0026lt;- readr::read_csv2(url_datos) noticias |\u0026gt; select(titulo, cuerpo, fecha) # A tibble: 10,000 √ó 3 titulo cuerpo fecha \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; 1 \u0026quot;Hombre de 66 a√±os fue asesinado en plena v√≠a p√∫blica en M‚Ä¶ \u0026quot;El h‚Ä¶ 2024-07-21 2 \u0026quot;Revive el cuarto cap√≠tulo de Indecisos: Candidatos a alca‚Ä¶ \u0026quot;Este‚Ä¶ 2024-09-03 3 \u0026quot;Menos personas circulando y miedo de los residentes: As√≠ ‚Ä¶ \u0026quot;Poca‚Ä¶ 2024-04-08 4 \u0026quot;CEO de Walmart Chile sostiene que si la empresa no da ‚Äúse‚Ä¶ \u0026quot;Hace‚Ä¶ 2024-12-22 5 \u0026quot;Pdte. Boric entreg√≥ mensaje por la muerte de Pi√±era y rec‚Ä¶ \u0026quot;El p‚Ä¶ 2024-02-06 6 \u0026quot;Encuentran dos cad√°veres en un canal de regad√≠o en Pirque\u0026quot; \u0026quot;Pers‚Ä¶ 2024-07-13 7 \u0026quot;Magisterio denuncia \\\u0026quot;abandono de la educaci√≥n p√∫blica\\\u0026quot; ‚Ä¶ \u0026quot;Carl‚Ä¶ 2024-02-21 8 \u0026quot;‚ÄúEl d√≠a que la democracia triunf√≥ sobre la dictadura‚Äù: Mi‚Ä¶ \u0026quot;Los ‚Ä¶ 2024-10-05 9 \u0026quot;Accidente de tr√°nsito deja un fallecido y tres heridos en‚Ä¶ \u0026quot;En h‚Ä¶ 2024-12-22 10 \u0026quot;Dos personas resultan baleadas tras intentar evitar asalt‚Ä¶ \u0026quot;Aton‚Ä¶ 2024-11-02 # ‚Ñπ 9,990 more rows En este conjunto de datos, los textos completos de los documentos vienen en la columna cuerpo:\nnoticias |\u0026gt; select(cuerpo) # A tibble: 10,000 √ó 1 cuerpo \u0026lt;chr\u0026gt; 1 \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue abordada p‚Ä¶ 2 \u0026quot;Este martes 3 de septiembre fue el cuarto cap√≠tulo de la nueva temporada de‚Ä¶ 3 \u0026quot;Pocas personas circulan en la toma \\\u0026quot;Nuevo Amanecer\\\u0026quot; de Cerrillos, luego d‚Ä¶ 4 \u0026quot;Hace unos d√≠as, Walmart Chile anunci√≥ un plan de inversi√≥n en Chile de US$1‚Ä¶ 5 \u0026quot;El presidente Gabriel Boric lament√≥ el fallecimiento del expresidente Sebas‚Ä¶ 6 \u0026quot;Personal del Grupo de Operaciones Policiales Especiales (GOPE) de Carabiner‚Ä¶ 7 \u0026quot;Carlos Rodr√≠guez, presidente regional de los Profesores, asegur√≥ que el Min‚Ä¶ 8 \u0026quot;Los ministros de Educaci√≥n, Nicol√°s Cataldo, y del Interior, Carolina Toh√°,‚Ä¶ 9 \u0026quot;En horas de la ma√±ana de este domingo, ocurri√≥ un lamentable accidente en l‚Ä¶ 10 \u0026quot;Aton / Imagen Referencial Dos personas resultaron heridas a bala en un inte‚Ä¶ # ‚Ñπ 9,990 more rows Usualmente los datos de texto van a venir de esta forma, con todo el texto de cada documento dentro de una celda. Para poder analizar los datos en este formato tenemos que tokenizar los textos: transformar la estructura de los datos para pasar desde filas que contienen documentos, p√°rrafos u oraciones, a filas que contienen palabras individuales, una palabra por observaci√≥n.\nUsaremos la funci√≥n unnest_tokens de {tidytext} para tokenizar y limpiar1 el texto:\nlibrary(tidytext) palabras \u0026lt;- noticias |\u0026gt; # tokenizar columna que contiene los documentos unnest_tokens(input = cuerpo, drop = FALSE, output = palabra, token = \u0026#34;words\u0026#34;, # limpieza m√≠nima de texto to_lower = TRUE, strip_punct = TRUE, strip_numeric = TRUE) |\u0026gt; # eliminar stopwords o palabras vac√≠as filter(!palabra %in% stopwords::stopwords(\u0026#34;spanish\u0026#34;)) palabras |\u0026gt; select(palabra, cuerpo) # A tibble: 1,817,901 √ó 2 palabra cuerpo \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 hecho \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 2 ocurri√≥ \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 3 horas \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 4 madrugada \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 5 v√≠ctima \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 6 abordada \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 7 grupo \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 8 sujetos \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 9 atac√≥ \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ 10 arma \u0026quot;El hecho ocurri√≥ en horas de la madrugada, cuando la v√≠ctima fue ‚Ä¶ # ‚Ñπ 1,817,891 more rows Luego de tokenizaci√≥n, vemos que la columna que contiene el texto completo de los documentos est√° acompa√±ada de una nueva variable que contiene cada palabra por separado. De esta forma puedes continuar analizando el documento con palabras individuales, pero teniendo como referencia al texto completo donde aparece cada palabra si es que lo necesitas.\nA partir de la variable de palabras individuales, vamos a hacer un conteo de las palabras m√°s frecuentes:\npalabras_conteo \u0026lt;- palabras |\u0026gt; count(palabra, sort = TRUE) palabras_conteo # A tibble: 74,911 √ó 2 palabra n \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 chile 7208 2 a√±os 5457 3 seg√∫n 5071 4 parte 4952 5 personas 4921 6 si 4912 7 regi√≥n 4830 8 ser 4656 9 pa√≠s 4628 10 gobierno 4599 # ‚Ñπ 74,901 more rows R√°pidamente podemos ver dos problemas: tenemos demasiadas palabras individuales (m√°s de 80 mil), y tenemos palabras muy cortas, como la palabra si, as√≠ que haremos una peque√±a limpieza:\npalabras_conteo \u0026lt;- palabras_conteo |\u0026gt; # largo m√≠nimo de palabras filter(nchar(palabra) \u0026gt;= 3) |\u0026gt; # s√≥lo las palabras m√°s frecuentes slice_max(n, n = 2000) Tambi√©n podemos realizar una b√∫squeda dentro de las palabras y contar cu√°ntas veces aparece cada una:\npalabras_conteo |\u0026gt; filter(palabra %in% c(\u0026#34;guerra\u0026#34;, \u0026#34;paz\u0026#34;)) # A tibble: 2 √ó 2 palabra n \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; 1 guerra 398 2 paz 267 Nube de palabras con {wordcloud2} {wordcloud2} es un paquete muy sencillo de usar que permite visualizar datos de nubes de palabras con muy poca configuraci√≥n.\nSi no tienes el paquete instalado, puedes instalarlo con el siguiente c√≥digo:\ndevtools::install_github(\u0026#34;lchiffon/wordcloud2\u0026#34;) Para crear una nube de palabras con {wordcloud2} solo necesitas que la primera columna del dataframe contenga las palabras, y la segunda contenga el conteo de frecuencia de las palabras:\nlibrary(wordcloud2) palabras_conteo |\u0026gt; # s√≥lo palabras que aparezcan n veces filter(n \u0026gt; 1000) |\u0026gt; wordcloud2(backgroundColor = \u0026#34;#EAD1FA\u0026#34;, color = \u0026#34;#543A74\u0026#34;) Usamos algunas de las opciones de personalizaci√≥n de wordcloud2() para obtener el resultado que necesitamos. Personalmente no me gusta mucho que las palabras aparezcan tan en √°ngulo, y prefiero que las palabras sean menos grandes para que se vea una mayor cantidad.\npalabras_conteo |\u0026gt; filter(n \u0026gt; 1000) |\u0026gt; wordcloud2(backgroundColor = \u0026#34;#EAD1FA\u0026#34;, color = \u0026#34;#543A74\u0026#34;, # personalizaci√≥n rotateRatio = 0.1, # rotaci√≥n m√°xima gridSize = 8, # espaciado entre cada palabra size = 0.5, # tama√±o del texto en general minSize = 11) # tama√±o m√≠nimo de las letras Nube de palabras con {ggplot2} y {ggwordcloud} Otra forma de hacer nubes de palabras es agregando una geometr√≠a personalizada a {ggplot2}: geom_text_wordcloud() del paquete {ggwordcloud}\nInstalar el paquete:\ndevtools::install_github(\u0026#34;lepennec/ggwordcloud\u0026#34;) Configuramos un tema general para los gr√°ficos, para que se vean bonitos aqu√≠ ü•∞\nlibrary(ggplot2) library(ggwordcloud) # definir el tema para todos los gr√°ficos theme_set( theme_void() + theme(plot.background = element_rect(fill = \u0026#34;#EAD1FA\u0026#34;, linewidth = 0)) ) Para crear la nube de palabras con {ggplot2}, solamente tenemos que especificar en la est√©tica aes() la variable que contiene las palabras (palabra) y la variable que controla el tama√±o de las mismas (n). Luego simplemente indicar que los datos van a visualizarse por medio de la geometr√≠a geom_text_wordcloud(), que se encargar√° de distribuir los textos en el √°rea del gr√°fico.\npalabras_conteo |\u0026gt; filter(n \u0026gt; 2000) |\u0026gt; ggplot() + aes(label = palabra, size = n) + geom_text_wordcloud(shape = \u0026#34;circle\u0026#34;, color = \u0026#34;#543A74\u0026#34;) + # definir rango de tama√±os de las palabras scale_size_continuous(range = c(3, 20)) El beneficio de usar esta estrategia es que te entrega toda la flexibilidad de visualizar datos con {ggplot2}. Por ejemplo, podemos agregar un mapeo de la transparencia y el color para crear una nube donde las palabras menos frecuentes sean m√°s transparentes y donde ciertas palabras claves tengan un color distinto:\npalabras_conteo |\u0026gt; filter(n \u0026gt; 2000) |\u0026gt; mutate(clave = ifelse(palabra %in% c(\u0026#34;gobierno\u0026#34;, \u0026#34;presidente\u0026#34;, \u0026#34;boric\u0026#34;, \u0026#34;ministerio\u0026#34;), \u0026#34;clave\u0026#34;, \u0026#34;otras\u0026#34;)) |\u0026gt; ggplot() + aes(label = palabra, size = n, alpha = n, color = clave) + geom_text_wordcloud(shape = \u0026#34;circle\u0026#34;, grid_size = 6) + # definir rango de tama√±o de palabras scale_size_continuous(range = c(3, 15)) + # especificar colores de las palabras clave scale_color_manual(values = c(\u0026#34;clave\u0026#34; = \u0026#34;#D93E98\u0026#34;, \u0026#34;otras\u0026#34; = \u0026#34;#543A74\u0026#34;)) + # definir el rango de la transparencia de palabras scale_alpha_continuous(range = c(0.4, 1)) Tambi√©n podemos crear una variable que destaques ciertas palabras espec√≠ficas dentro de la nube:\npalabras_conteo |\u0026gt; filter(n \u0026gt; 1500) |\u0026gt; # crear variable que destaque palabras espec√≠ficas mutate(clave = ifelse(palabra %in% c(\u0026#34;gobierno\u0026#34;, \u0026#34;chile\u0026#34;, \u0026#34;presidente\u0026#34;, \u0026#34;boric\u0026#34;, \u0026#34;ministerio\u0026#34;, \u0026#34;ministra\u0026#34;, \u0026#34;interior\u0026#34;, \u0026#34;partido\u0026#34;, \u0026#34;p√∫blico\u0026#34;), \u0026#34;clave\u0026#34;, \u0026#34;otras\u0026#34;)) |\u0026gt; ggplot() + aes(label = palabra, size = n, # mapear transparencia a la variable con palabras clave alpha = clave) + geom_text_wordcloud(shape = \u0026#34;circle\u0026#34;, color = \u0026#34;#543A74\u0026#34;, rm_outside = TRUE) + # especificar rango de tama√±os scale_size_continuous(range = c(3, 15)) + # especificar nivel de transparencia de las palabras clave y de las dem√°s scale_alpha_manual(values = c(\u0026#34;clave\u0026#34; = 1, \u0026#34;otras\u0026#34; = 0.3)) Warning in wordcloud_boxes(data_points = points_valid_first, boxes = boxes, : Some words could not fit on page. They have been removed. Con esta aproximaci√≥n podemos crear visualizaciones m√°s personalizadas y complejas a partir de datos de texto, sobre todo si tenemos variables adicionales que nos digan m√°s informaci√≥n sobre las palabras que queremos graficar, c√≥mo puede ser alguna otro criterio de prevalencia de palabras en los documentos, alguna clasificaci√≥n de las palabras en t√≥picos o temas, una agrupaci√≥n de los documentos de donde provienen las palabras, etc.\nLa limpieza del texto es un paso clave en este tipo de an√°lisis, que para simplificar esta gu√≠a, omitiremos. Es muy importante procesar los textos para poder eliminar palabras vac√≠as, palabras mal escritas, remover s√≠mbolos, remover palabras irrelevantes, e incluso lematizar palabras para agrupar diferentes conjugaciones de una misma palabra en una sola.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-07-05T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/nubes_de_palabras/","tags":"visualizaci√≥n de datos ; gr√°ficos ; ggplot2 ; an√°lisis de texto","title":"Visualizando texto como nubes de palabras en R"},{"content":"Complementando el post sobre ordenar regiones de Chile de norte a sur, en esta publicaci√≥n veremos c√≥mo ordenar las comunas del pa√≠s de norte a sur. Esto puede servirnos para mostrar datos a nivel comunal de una gran cantidad de regiones de una manera m√°s intuitiva, en los casos donde ordenarlas por orden alfab√©tico no entrega mucha informaci√≥n, o cuando queramos mostrar en nuestras visualizaciones o tablas que el factor geogr√°fico incide en el dato principal.\nPartamos con una tabla de datos de varias comunas del pa√≠s. Es necesario que estas comunas cuenten con su c√≥digo √∫nico territorial, el c√≥dgo num√©rico que identifica de manera √∫nica a cada regi√≥n del pa√≠s. Si tu base de datos no tiene los c√≥digos √∫nicos territoriales, tendr√°s que realizar una uni√≥n entre los nombres de las comunas y los c√≥digos, que puedes encontrar en csv y rds en este respositorio..\nlibrary(dplyr) comunas \u0026lt;- tibble::tribble( ~nombre_comuna, ~codigo_comuna, \u0026#34;Rancagua\u0026#34;, 6101, \u0026#34;San Fernando\u0026#34;, 6301, \u0026#34;Coyhaique\u0026#34;, 11101, \u0026#34;La Pintana\u0026#34;, 13112, \u0026#34;Rengo\u0026#34;, 6115, \u0026#34;Puerto Montt\u0026#34;, 10101, \u0026#34;San Pedro de la Paz\u0026#34;, 8108, \u0026#34;Alto Hospicio\u0026#34;, 1107, \u0026#34;Chill√°n\u0026#34;, 16101, \u0026#34;Angol\u0026#34;, 9201, \u0026#34;Talcahuano\u0026#34;, 8110, \u0026#34;Calama\u0026#34;, 2201, \u0026#34;Concepci√≥n\u0026#34;, 8101, \u0026#34;Hualp√©n\u0026#34;, 8112, \u0026#34;La Serena\u0026#34;, 4101, \u0026#34;Calera\u0026#34;, 5502, \u0026#34;Valdivia\u0026#34;, 14101, \u0026#34;Cerro Navia\u0026#34;, 13103, \u0026#34;Lampa\u0026#34;, 13302, \u0026#34;Quinta Normal\u0026#34;, 13126, \u0026#34;Huechuraba\u0026#34;, 13107, \u0026#34;Linares\u0026#34;, 7401, \u0026#34;Tom√©\u0026#34;, 8111, \u0026#34;Vi√±a del Mar\u0026#34;, 5109, \u0026#34;Recoleta\u0026#34;, 13127, \u0026#34;Talagante\u0026#34;, 13601, \u0026#34;Valpara√≠so\u0026#34;, 5101, \u0026#34;Coronel\u0026#34;, 8102, \u0026#34;Buin\u0026#34;, 13402, \u0026#34;Macul\u0026#34;, 13118, \u0026#34;Punta Arenas\u0026#34;, 12101, \u0026#34;Talca\u0026#34;, 7101, \u0026#34;Los √Ångeles\u0026#34;, 8301, \u0026#34;Puente Alto\u0026#34;, 13201, \u0026#34;Copiap√≥\u0026#34;, 3101, \u0026#34;Curic√≥\u0026#34;, 7301, \u0026#34;Coquimbo\u0026#34;, 4102, \u0026#34;Melipilla\u0026#34;, 13501, \u0026#34;Vitacura\u0026#34;, 13132, \u0026#34;Antofagasta\u0026#34;, 2101, \u0026#34;Chiguayante\u0026#34;, 8103, \u0026#34;Renca\u0026#34;, 13128, \u0026#34;Quilicura\u0026#34;, 13125, \u0026#34;Pedro Aguirre Cerda\u0026#34;, 13121, \u0026#34;Ovalle\u0026#34;, 4301, \u0026#34;San Bernardo\u0026#34;, 13401, \u0026#34;Los Andes\u0026#34;, 5301, \u0026#34;San Joaqu√≠n\u0026#34;, 13129, \u0026#34;Colina\u0026#34;, 13301, \u0026#34;Quillota\u0026#34;, 5501, \u0026#34;Pe√±alol√©n\u0026#34;, 13122, \u0026#34;Estaci√≥n Central\u0026#34;, 13106, \u0026#34;San Ram√≥n\u0026#34;, 13131, \u0026#34;Lo Prado\u0026#34;, 13117, \u0026#34;Arica\u0026#34;, 15101, \u0026#34;San Antonio\u0026#34;, 5601, \u0026#34;Cerrillos\u0026#34;, 13102, \u0026#34;Santiago\u0026#34;, 13101, \u0026#34;Lo Barnechea\u0026#34;, 13115, \u0026#34;Temuco\u0026#34;, 9101, \u0026#34;La Florida\u0026#34;, 13110, \u0026#34;San Felipe\u0026#34;, 5701, \u0026#34;√ëu√±oa\u0026#34;, 13120, \u0026#34;La Cisterna\u0026#34;, 13109, \u0026#34;Machal√≠\u0026#34;, 6108, \u0026#34;Independencia\u0026#34;, 13108, \u0026#34;La Granja\u0026#34;, 13111, \u0026#34;Villa Alemana\u0026#34;, 5804, \u0026#34;San Miguel\u0026#34;, 13130, \u0026#34;Las Condes\u0026#34;, 13114, \u0026#34;Lo Espejo\u0026#34;, 13116, \u0026#34;Quilpu√©\u0026#34;, 5801, \u0026#34;Conchal√≠\u0026#34;, 13104, \u0026#34;Pe√±aflor\u0026#34;, 13605, \u0026#34;El Bosque\u0026#34;, 13105, \u0026#34;Maip√∫\u0026#34;, 13119, \u0026#34;La Reina\u0026#34;, 13113, \u0026#34;Pudahuel\u0026#34;, 13124, \u0026#34;Providencia\u0026#34;, 13123, \u0026#34;Padre Hurtado\u0026#34;, 13604, \u0026#34;Iquique\u0026#34;, 1101, \u0026#34;Osorno\u0026#34;, 10301 ) Puedes copiar y pegar este c√≥digo para obtener en tu sesi√≥n de R la tabla con comunas. Si ejecutamos esta tabla de datos, veremos que las regiones no est√°n ordenadas geogr√°ficamente:\ncomunas # A tibble: 82 √ó 2 nombre_comuna codigo_comuna \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Rancagua 6101 2 San Fernando 6301 3 Coyhaique 11101 4 La Pintana 13112 5 Rengo 6115 6 Puerto Montt 10101 7 San Pedro de la Paz 8108 8 Alto Hospicio 1107 9 Chill√°n 16101 10 Angol 9201 # ‚Ñπ 72 more rows Si hacemos un gr√°fico con estas comunas, veremos que el orden del eje con las comunas ser√° alfab√©tico, dado que las comunas son una variable de tipo car√°cter o texto:\nlibrary(ggplot2) comunas |\u0026gt; ggplot() + aes(codigo_comuna, nombre_comuna, fill = codigo_comuna) + geom_col() + theme_minimal() + scale_x_continuous(expand = c(0, 0)) Tampoco nos servir√≠a ordenarla por los c√≥digos √∫nicos territoriales, dado que √©stos empiezan con el c√≥digo de las regiones, y como vimos en el otro post, los c√≥digos regionales no ordenan geogr√°ficamente las regiones, y menos a las comunas.\nUna forma de ordenar las comunas de Chile geogr√°ficamente de norte a sur es vali√©ndonos de la geograf√≠a vertical del pa√≠s. Podemos obtener un mapa de Chile con el paquete {chilemapas}, y luego extraer la latitud de las comunas, para usarla como variable de ordenamiento de las comunas.\nLa funci√≥n chilemapas::mapa_comunas de {chilemapas} nos entrega un dataframe con los datos geogr√°ficos del pa√≠s a nivel comunal.\nlibrary(dplyr) library(chilemapas) Loading required package: sf Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE La documentacion del paquete y ejemplos de uso se encuentran en https://pacha.dev/chilemapas/. Visita https://buymeacoffee.com/pacha/ si deseas donar para contribuir al desarrollo de este software. # obtener mapa mapa_chile \u0026lt;- chilemapas::mapa_comunas |\u0026gt; mutate(codigo_comuna = as.numeric(codigo_comuna)) |\u0026gt; select(codigo_comuna, geometry) mapa_chile # A tibble: 345 √ó 2 codigo_comuna geometry \u0026lt;dbl\u0026gt; \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; 1 1401 (((-68.86081 -21.28512, -68.92172 -21.30035, -68.98939 -21.317‚Ä¶ 2 1403 (((-68.65113 -19.77188, -68.81182 -19.74362, -68.81575 -19.733‚Ä¶ 3 1405 (((-68.65113 -19.77188, -68.63545 -19.78062, -68.62511 -19.785‚Ä¶ 4 1402 (((-69.31789 -19.13651, -69.2717 -19.23735, -69.14291 -19.2967‚Ä¶ 5 1404 (((-69.39615 -19.06125, -69.40025 -19.06897, -69.40296 -19.071‚Ä¶ 6 1107 (((-70.1095 -20.35131, -70.12438 -20.31578, -70.10985 -20.2743‚Ä¶ 7 1101 (((-70.09894 -20.08504, -70.1023 -20.11401, -70.12001 -20.1551‚Ä¶ 8 2104 (((-68.98863 -25.38016, -68.98731 -25.38411, -68.98696 -25.393‚Ä¶ 9 2101 (((-70.60654 -23.43054, -70.60175 -23.43515, -70.60133 -23.438‚Ä¶ 10 2201 (((-67.94302 -22.38175, -67.95564 -22.39233, -67.96315 -22.393‚Ä¶ # ‚Ñπ 335 more rows A partir de este mapa, usamos el paquete {sf} para extraer los centroides de las comunas, que son el punto central de la geometr√≠a de cada pol√≠gono. Luego, a partir del centroide podemos obtener la latitud de estos puntos, para ver qu√© tan al norte o sur est√° cada comuna.\nlibrary(sf) # extraer latitud desde los pol√≠gonos comunales mapa_chile_latitud \u0026lt;- mapa_chile |\u0026gt; mutate(centroide = st_centroid(geometry), longitud = sf::st_coordinates(centroide)[,1], latitud = sf::st_coordinates(centroide)[,2]) mapa_chile_latitud # A tibble: 345 √ó 5 codigo_comuna geometry centroide longitud \u0026lt;dbl\u0026gt; \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; \u0026lt;POINT [¬∞]\u0026gt; \u0026lt;dbl\u0026gt; 1 1401 (((-68.86081 -21.28512, -68‚Ä¶ (-69.50811 -20.77126) -69.5 2 1403 (((-68.65113 -19.77188, -68‚Ä¶ (-68.84517 -19.35443) -68.8 3 1405 (((-68.65113 -19.77188, -68‚Ä¶ (-68.91311 -20.48006) -68.9 4 1402 (((-69.31789 -19.13651, -69‚Ä¶ (-69.50102 -19.36999) -69.5 5 1404 (((-69.39615 -19.06125, -69‚Ä¶ (-69.66358 -19.60151) -69.7 6 1107 (((-70.1095 -20.35131, -70.‚Ä¶ (-70.01261 -20.18971) -70.0 7 1101 (((-70.09894 -20.08504, -70‚Ä¶ (-70.04836 -20.92498) -70.0 8 2104 (((-68.98863 -25.38016, -68‚Ä¶ (-69.8618 -25.30966) -69.9 9 2101 (((-70.60654 -23.43054, -70‚Ä¶ (-69.40757 -24.27784) -69.4 10 2201 (((-67.94302 -22.38175, -67‚Ä¶ (-68.62665 -22.16826) -68.6 # ‚Ñπ 335 more rows # ‚Ñπ 1 more variable: latitud \u0026lt;dbl\u0026gt; Con esto podemos simplemente ordenar por latitud y generar un orden num√©rico del 1 al 345.\norden_comunas \u0026lt;- mapa_chile_latitud |\u0026gt; arrange(desc(latitud), longitud) |\u0026gt; mutate(orden_comuna = row_number()) |\u0026gt; select(codigo_comuna, orden_comuna) orden_comunas # A tibble: 345 √ó 2 codigo_comuna orden_comuna \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; 1 15202 1 2 15201 2 3 15101 3 4 15102 4 5 1403 5 6 1402 6 7 1404 7 8 1107 8 9 1405 9 10 1401 10 # ‚Ñπ 335 more rows Obtenemos una tabla con los c√≥digos √∫nicos territoriales y la latitud de cada comuna. Ahora podemos unir estas columnas con nuestros datos usando left_join():\n# a los datos originales, agregarle la tabla con el orden de las comunas comunas_ordenadas \u0026lt;- comunas |\u0026gt; left_join(orden_comunas, join_by(codigo_comuna)) |\u0026gt; # ordenar observaciones arrange(orden_comuna) comunas_ordenadas # A tibble: 82 √ó 3 nombre_comuna codigo_comuna orden_comuna \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; 1 Arica 15101 3 2 Alto Hospicio 1107 8 3 Iquique 1101 11 4 Calama 2201 15 5 Antofagasta 2101 19 6 Copiap√≥ 3101 25 7 La Serena 4101 32 8 Coquimbo 4102 34 9 Ovalle 4301 38 10 San Felipe 5701 56 # ‚Ñπ 72 more rows Intentamos nuevamente con el gr√°fico a ver c√≥mo sale:\n# intento incorrecto de gr√°fico ordenado comunas_ordenadas |\u0026gt; arrange(orden_comuna) |\u0026gt; ggplot() + aes(x = codigo_comuna, y = nombre_comuna, fill = codigo_comuna) + geom_col() + theme_minimal() + guides(fill = guide_none()) + scale_x_continuous(expand = c(0, 0)) Al igual como nos pas√≥ con el ordenamiento de regiones, la variable nombre_comuna es una variable de texto (tipo caracter) y que no tiene un orden intr√≠nseco, as√≠ que se asume que su orden es alfab√©tico. Por lo tanto, tenemos que darle un orden a esta variable, convirti√©ndola a factor con el orden de una segunda variable num√©rica usando fct_reorder(); en otras palabras, darle a nombre_comuna el orden que tiene la variable num√©rica orden_comuna:\nlibrary(forcats) # ordenar variable a partir de una segunda variable num√©rica comunas_ordenadas_2 \u0026lt;- comunas_ordenadas |\u0026gt; mutate(nombre_comuna = fct_reorder(nombre_comuna, orden_comuna, .desc = T)) Ahora si repetimos el mismo gr√°fico que antes, vemos que el orden de las comunas ahora s√≠ es geogr√°fico! Arica est√° arriba y Punta Arenas abajo, como corresponde.\n# crear un gr√°fico comunas_ordenadas_2 |\u0026gt; ggplot() + aes(x = orden_comuna, y = nombre_comuna, fill = orden_comuna) + geom_col() + theme_minimal() + guides(fill = guide_none()) + scale_x_continuous(expand = c(0, 0)) Aparecen visualmente de norte a sur (de arriba a abajo) porque al ordenarlas le pusimos un orden descendiente (.desc = TRUE), y √©sto es necesario porque generalmente en los gr√°ficos el origen o inicio de los ejes es en 1 y el valor de la variable aumenta a medida que se aleja del origen.\n","date":"2025-06-25T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ordenar_comunas/","tags":"mapas ; Chile","title":"Ordenar las comunas de Chile de norte a sur en R"},{"content":" Los datos an√≥malos o outliers son datos que se alejan considerablemente de los dem√°s. Estos datos pueden resultar problem√°ticos para ciertos an√°lisis, pueden ser indicio de errores en la recolecci√≥n o limpieza de datos, o pueden requerir que tomemos ciertas decisiones para corregirlos o excluirlos.\nEn este post simularemos un dataset con datos an√≥malos, y luego mostraremos algunas formas de visualizaci√≥n de datos an√≥malos en {ggplot2} para tomar decisiones al respecto. Al final crearemos un gr√°fico interactivo con {ggiraph} que permita poner el cursor sobre las observaciones para obtener m√°s informaci√≥n.\nPrimero creemos un conjunto de datos que contenga n√∫meros al azar, 90 n√∫meros entre 1 y 100, y 10 n√∫meros m√°s grandes, para que sean nuestros outliers simulados:\nlibrary(dplyr) library(ggplot2) set.seed(1993) valor \u0026lt;- c(sample(1:100, size = 90), # n√∫meros al azar sample(120:190, size = 10)) # outliers Obtenemos un vector con los dos conjuntos de n√∫meros al azar.\nCon la funci√≥n tibble() convertimos el vector de n√∫meros en una columna de un dataframe, y usando nuevamente sample() crearemos dos columnas con palabras al azar para complementar estos datos simulados:\ndatos \u0026lt;- tibble(valor) |\u0026gt; # procesar datos por fila en vez de por la columna entera (vectorizaci√≥n) rowwise() |\u0026gt; # por fila, elegir tres s√≠labas al azar y unirlas en un s√≥lo texto, que ser√° el \u0026#34;nombre\u0026#34; de las observaciones mutate(nombre = sample(c(\u0026#34;ma\u0026#34;, \u0026#34;pa\u0026#34;, \u0026#34;che\u0026#34;, \u0026#34;cha\u0026#34;), 3, F) |\u0026gt; paste(collapse = \u0026#34;\u0026#34;)) |\u0026gt; # desagrupar y crear otra variable con trres valores posibles, y que por lo tanto distribuya los datos en tres grupos ungroup() |\u0026gt; mutate(grupo = sample(c(\u0026#34;ma\u0026#34;, \u0026#34;pa\u0026#34;, \u0026#34;che\u0026#34;), n(), T)) datos # A tibble: 100 √ó 3 valor nombre grupo \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 45 chapache pa 2 95 chechapa ma 3 83 chamapa ma 4 92 mapache pa 5 40 chamache che 6 42 pachama pa 7 75 mapacha che 8 65 machepa che 9 55 chachema che 10 18 chapama che # ‚Ñπ 90 more rows sample(c(\u0026#34;ma\u0026#34;, \u0026#34;pa\u0026#34;, \u0026#34;che\u0026#34;, \u0026#34;cha\u0026#34;), 3, F) |\u0026gt; paste(collapse = \u0026#34;\u0026#34;) [1] \u0026quot;mapache\u0026quot; Detecci√≥n de datos an√≥malos Para identificar los outliers, utilizaremos el criterio del rango intercuart√≠lico. El rango intercuart√≠lico se calcula con la funci√≥n IQR() y es el rango de los datos entre el primer y tercer cuartil (el percentil 25 y el percentil 75; es decir, la diferencia entre el dato ubicado en el 75% mayor y el 25% mayor de la distribuci√≥n de los datos).\nEn otras palabras, el IQR es una cifra que indica qu√© tanta distancia existe en la \u0026ldquo;mitad\u0026rdquo; de tus datos, si los esparcieras todos en una distribuci√≥n, como aparece en el siguiente gr√°fico1.\nLuego, el rango intercuart√≠lico se multiplica por 1,5, y se suma al valor del tercer cuartil (percentil 75), de modo que se identifiquen como outliers los datos que sean mayores2 al tercer cuartil m√°s 1,5 veces el rango intercuart√≠lico. Puedes calcular cualquier percentil de un vector o columna con la funci√≥n quantile(x, .75), donde el n√∫mero identifica al percentil.\nAplicamos el c√°lculo a la variable valor:\ndatos_outliers \u0026lt;- datos |\u0026gt; mutate(umbral = quantile(valor, 0.75) + 1.5 * IQR(valor)) Esto nos dar√° una cifra que operar√° como el umbral respecto del cual se clasificar√°n los outliers. Es conveniente calcular este umbral dentro del dataframe, porque si queremos calcular outliers desagregados por otra variable, simplemente mantenemos la f√≥rmula y agregamos antes un group_by() para realizar el c√°lculo por grupos.\nCrearemos una columna que simplemente nos diga si los valores son mayores o menores al umbral:\ndatos_outliers \u0026lt;- datos_outliers |\u0026gt; mutate(outlier = valor \u0026gt;= umbral) datos_outliers # A tibble: 100 √ó 5 valor nombre grupo umbral outlier \u0026lt;int\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;lgl\u0026gt; 1 45 chapache pa 167 FALSE 2 95 chechapa ma 167 FALSE 3 83 chamapa ma 167 FALSE 4 92 mapache pa 167 FALSE 5 40 chamache che 167 FALSE 6 42 pachama pa 167 FALSE 7 75 mapacha che 167 FALSE 8 65 machepa che 167 FALSE 9 55 chachema che 167 FALSE 10 18 chapama che 167 FALSE # ‚Ñπ 90 more rows Obtenemos la variable outlier con TRUE si es outlier, y FALSE si no lo es.\nAhora vamos a visualizar estos datos con el paquete {ggplot2}. Si necesitas una introducci√≥n a esta librer√≠a de visualizaci√≥n de datos, te recomiendo revisar este tutorial, donde explicamos en mayor detalle varias de estas visualizaciones.\nGr√°fico de cajas o boxplot El boxplot es una visualizaci√≥n que en su mismo dise√±o incluye la opci√≥n de mostrar los outliers, as√≠ que se trata de la opci√≥n natural para este tipo de visualizaciones exploratorias. As√≠ que con esto concluye este tutorial. Bromita ü•∞\ndatos_outliers |\u0026gt; ggplot() + aes(x = valor, y = 1) + # gr√°fico de boxplot geom_boxplot(alpha = 0.4, fill = \u0026#34;black\u0026#34;, outlier.color = \u0026#34;#F94C6A\u0026#34;, outlier.size = 4, outlier.alpha = 0.7) + # configuraci√≥n de outliers # temas theme_minimal() + scale_y_continuous(expand = expansion(c(0.5, 0.5))) # aumentar margen del eje vertical En un boxplot, los puntos al extremo de la caja representan los casos an√≥malos.\nPero la gracia de este tutorial es entrenar nuestras capacidades de visualizaci√≥n de datos, as√≠ que veamos otras formas de visualizarlos:\nGr√°fico de puntos Una forma sencilla de visualizar outliers ser√≠a simplemente visualizar las observaciones del dataser como puntos, coloreando los puntos si son outliers.\ndatos_outliers |\u0026gt; ggplot() + aes(x = valor, y = 1, color = outlier) + # gr√°fico de puntos geom_point(size = 4, alpha = 0.6) + # escala de colores scale_color_manual(values = c(\u0026#34;black\u0026#34;, \u0026#34;#F94C6A\u0026#34;)) + # temas theme_minimal() + # ocultar leyenda guides(color = guide_none(), y = guide_none()) Puntos con dispersi√≥n Como existe una concentraci√≥n densa en parte de la distribuci√≥n, podemos usar la funci√≥n geom_jitter() para que los puntos se dispersen verticalmente (width = 0, porque si se dispersan horizontalmente se ubicar√≠an incorrectamente con respecto a su valor)\ndatos_outliers |\u0026gt; ggplot() + aes(x = valor, y = 1, color = outlier) + # gr√°fico de puntos con dispersi√≥n geom_jitter(size = 4, alpha = 0.6, width = 0) + scale_color_manual(values = c(\u0026#34;black\u0026#34;, \u0026#34;#F94C6A\u0026#34;)) + theme_minimal() + guides(color = guide_none(), y = guide_none()) Gr√°fico de viol√≠n El gr√°fico de viol√≠n tambi√©n nos permite observar la distribuci√≥n de los datos, pero por s√≠ solo no nos muestra las observaciones exactas, por lo que no entrega informaci√≥n certera sobre los outliers, sino que nos da indicios de que la distribuci√≥n de los datos tiene colas que podr√≠an contener outliers.\ndatos_outliers |\u0026gt; ggplot() + aes(x = valor, y = 1) + # gr√°fico de viol√≠n geom_violin(fill = \u0026#34;black\u0026#34;, alpha = 0.4) + theme_minimal() + guides(y = guide_none()) # ocultar eje y Combinar visualizaciones Una buena opci√≥n es combinar las visualizaciones anteriores en una sola. De fondo podemos poner la distribuci√≥n de los datos con geom_violin(), y encima poner los puntos de las observaciones; para las observaciones normales podemos usar geom_jitter() para dispersar los datos, y para los outliers, como son poquitos, geom_point() para que se ubiquen en concordancia con la distribuci√≥n del viol√≠n.\ngrafico_outliers \u0026lt;- datos_outliers |\u0026gt; ggplot() + aes(x = valor, y = 1, color = outlier) + # gr√°fico de viol√≠n geom_violin(aes(y = 1, x = valor), inherit.aes = F, alpha = 0.2, lwd = 0.1, fill = \u0026#34;black\u0026#34;) + # puntos para los outliers geom_point(data = ~filter(.x, outlier), # s√≥lo para observaciones que son outlier size = 4, alpha = 0.6) + # puntos dispersados para el resto de los datos geom_jitter(data = ~filter(.x, !outlier), # s√≥lo para observaciones que no son outlier size = 4, alpha = 0.6) + # escala de colores scale_color_manual(values = c(\u0026#34;black\u0026#34;, \u0026#34;#F94C6A\u0026#34;)) + # temas theme_minimal() + theme(axis.title = element_blank()) + guides(color = guide_none(), y = guide_none()) + scale_y_continuous(expand = expansion(c(0.2, 0.2))) # aumentar margen del eje vertical grafico_outliers Para combinar estas visualizaciones, aprovechamos la capacidad de {ggplot2} de especificar los datos que se usan en cada capa o geometr√≠a de la visualizaci√≥n por medio del argumento data. Normalmente, el argumento data se rellena por defecto con los datos que entregamos a la funci√≥n ggplot(), pero si especificamos el argumento podemos hacer que cada capa use datos completamente distintos. En nuestro caso, no queremos datos distintos, sino aplicar filtros a los datos de cada capa, lo que se logra con data = ~filter(.x, ...)3, donde ... ser√≠a el filtro que necesitemos. En la visualizaci√≥n anterior, queremos que geom_point() s√≥lo muestre los datos que son outlier == FALSE, y que geom_jitter() s√≥lo muestre los datos que son outlier == TRUE4.\ndata = ~filter(.x, outlier) Etiquetas de texto Al identificar outliers, una buena opci√≥n es mostrar etiquetas de texto para estos casos con geom_text(). De este modo podemos identificar exactamente a qu√© observaciones corresponden las anomal√≠as. En el caso de que fueran muchas etiquetas, podemos usar geom_text_repel() del paquete {ggrepel} para que las etiquetas de texto se acomoden si es que caen encima de otras.\nlibrary(ggrepel) grafico_outliers \u0026lt;- grafico_outliers + # agregar texto al gr√°fico anterior ggrepel::geom_text_repel(data = ~filter(.x, outlier), # s√≥lo para observaciones que son outlier aes(label = nombre), # variable con el texto a mostrar fontface = \u0026#34;bold\u0026#34;, size = 4, point.padding = 4, angle = 90, hjust = 0) grafico_outliers Ahora sabemos que mapacha, pachache, chepama y chachema son outliers ü§®\nDividir por grupos Otra forma de afinar el an√°lisis es separar la visualizaci√≥n en los valores de la variable de agrupaci√≥n que tengamos con facet_wrap(). En este caso, como la variable grupo tiene 3 valores posibles, se multiplica la visualizaci√≥n por tres.\ngrafico_outliers \u0026lt;- grafico_outliers + # separar gr√°fico en facetas seg√∫n la variable grupo facet_wrap(~grupo, ncol = 1, scales = \u0026#34;fixed\u0026#34;) + theme(strip.text = element_text(face = \u0026#34;bold\u0026#34;)) # t√≠tulo de facetas en negrita grafico_outliers Gr√°fico interactivo Para mejorar la exploraci√≥n de los datos podemos convertir f√°cilmente cualquier gr√°fico de {ggplot2} en gr√°ficos interactivos gracias al paquete {ggiraph}. Principalmente, lo que agregaremos son tooltips o cajas emergentes que aparecer√°n cuando se pose el cursor sobre un punto del gr√°fico y que muestren informaci√≥n extra.\nCon {ggiraph} solamente se requieren cambios m√≠nimos para volver interactivo cualquier gr√°fico. Entre ellos es agregar _interactive a las funciones que crean las geometr√≠as del gr√°fico:\nPasar de geom_point() a geom_point_interactive() Pasar de geom_jitter() a geom_jitter_interactive() Habiendo hecho este cambio, dentro de las geometr√≠as geom_x_interactive() ahora podremos definir la est√©tica tooltip dentro de aes() para que aparezca contenido cuando se ponga el cursor sobre los elementos del gr√°fico. En este caso, haremos que los tooltips muestren el nombre de la observaci√≥n y su valor, y la palabra outlier si corresponde. Tambi√©n podemos agregar html para dar estilo al texto; por ejemplo, las etiquetas \u0026lt;b\u0026gt; para letra negrita.\nSi queremos que los puntos del gr√°fico se iluminen o cambien de color al poner el cursor encima, adicionalmente tenemos que definir la est√©tica data_id que identifique de forma √∫nica los elementos del gr√°fico (puede servir para hacer que varios se iluminen al mismo tiempo si elijes una variable que no identifique de forma √∫nica los valores).\nCopiamos el c√≥digo anterior y hacemos los cambios apropiados al gr√°fico:\nlibrary(ggiraph) grafico_outliers_interactivo \u0026lt;- datos_outliers |\u0026gt; ggplot() + aes(x = valor, y = 1, color = outlier, # variable que identifica de forma √∫nica a los elementos del gr√°fico data_id = nombre) + geom_violin(aes(y = 1, x = valor), inherit.aes = F, alpha = 0.2, lwd = 0.1, fill = \u0026#34;black\u0026#34;) + # puntos para los outliers ggiraph::geom_point_interactive(data = ~filter(.x, outlier), # texto \u0026#34;outlier\u0026#34; con el valor aes(tooltip = paste(\u0026#34;\u0026lt;b\u0026gt;outlier:\u0026lt;/b\u0026gt; \u0026#34;, valor, sep = \u0026#34;\u0026#34;)), size = 4, alpha = 0.6) + # puntos dispersados para el resto de los datos ggiraph::geom_jitter_interactive(data = ~filter(.x, !outlier), # nombre de observaci√≥n y valor aes(tooltip = paste(\u0026#34;\u0026lt;b\u0026gt;\u0026#34;, nombre, \u0026#34;:\u0026lt;/b\u0026gt; \u0026#34;, valor, sep = \u0026#34;\u0026#34;)), size = 4, alpha = 0.6) + ggrepel::geom_text_repel(data = ~filter(.x, outlier), aes(label = nombre), fontface = \u0026#34;bold\u0026#34;, size = 4, point.padding = 4, angle = 90, hjust = 0) + scale_color_manual(values = c(\u0026#34;black\u0026#34;, \u0026#34;#F94C6A\u0026#34;)) + theme_minimal() + theme(axis.title = element_blank()) + guides(color = guide_none(), y = guide_none()) + scale_y_continuous(expand = expansion(c(0.2, 0.2))) # aumentar margen del eje vertical Finalmente, para permitir la interactividad del gr√°fico, debemos generarlo con la funci√≥n girafe(), la cual recibe el objeto con el gr√°fico adem√°s de varias opciones para personalizar la visualizaci√≥n:\ngirafe(ggobj = grafico_outliers_interactivo, # dimensiones del gr√°fico width_svg = 9, height_svg = 4, # opciones para los tooltips options = list( # ocultar barra de opciones opts_toolbar(hidden = \u0026#34;selection\u0026#34;, saveaspng = FALSE), # color al poner el cursor encima opts_hover(css = \u0026#34;fill: white; stroke: black;\u0026#34;), # personalizar la apariencia del tooltip opts_tooltip(opacity = 0.7, use_fill = TRUE, css = \u0026#34;font-family: sans-serif; font-size: 70%; color: white; padding: 4px; border-radius: 5px;\u0026#34;)) ) Toca o posa el cursor sobre un punto para ver la informaci√≥n extra! ¬øPuedes encontrar el punto que dice pamache? ü¶ù\nEl c√≥digo para este gr√°fico est√° disponible en este Gist.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nEn este ejemplo solamente buscaremos outliers que est√©n por sobre la distribuci√≥n de los datos, pero si queremos buscar datos outliers por debajo; es decir, valores peque√±os an√≥malos, la f√≥rmula es la misma pero restando el 1.5 * IQR al primer cuartil.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nEsto funciona porque, al anteponer la colita de chancho (~) a la funci√≥n, creamos una funci√≥n lambda que reciba los datos directamente sin tener que especificar el nombre del objeto (conveniente, por ejemplo, si pasaste directo de modificar los datos a hacer el gr√°fico sin crear un objeto intermedio).\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nEn R, decir variable == TRUE es lo mismo que decir simplemente variable, porque variable es TRUE; o sea que puedes hacer filter(variable) en vez de filter(variable == TRUE), y de la misma forma, filter(!variable) en vez de filter(variable == FALSE).\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-06-18T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-06-18/","tags":"limpieza de datos ; ggplot2 ; gr√°ficos ; visualizaci√≥n de datos ; estad√≠stica","title":"Gr√°ficos para identificar datos outliers o an√≥malos en R"},{"content":"La mayor√≠a de las funciones de R, as√≠ como R mismo, se ejecutan en un √∫nico proceso dentro de tu computadora, dado que R es un software de un s√≥lo hilo (single threaded).\nLos computadores modernos en general tienen entre 2 y 8 n√∫cleos (cores), algunos incluso muchos m√°s. Una mayor cantidad de n√∫cleos o procesadores permite a tu computadora hacer m√°s operaciones paralelas. Por ejemplo, si tu computador tiene 6 n√∫cleos y R est√° procesando datos, R usar√° 1 n√∫cleo al 100%, y te quedar√°n 5 n√∫cleos en desuso, que podr√≠an estar ejecutando otras tareas. En otras palabras, R est√° usando s√≥lo el 100% de tu computador, cuando podr√≠a estar usando el 600%.\nExisten programas que son capaces de distribuir cargas de procesamiento en m√∫ltiples n√∫cleos de tu computador, lo cual les permite terminar sus tareas m√°s r√°pido o realizar tareas m√°s complejas. Siguiendo el ejemplo, si tienes 6 n√∫cleos y una tarea que usa 1 n√∫cleo se demora 30 segundos en realizarse, en teor√≠a podr√≠as usar los 6 n√∫cleos para realizar la tarea en una fracci√≥n del tiempo original (~5 segundos).\nPero esto asume varias cosas:\nque es posible separar en partes la tarea que las partes de la tarea se pueden procesar simult√°neamente1 que procesar paralelamente la tarea trae beneficios de rendimiento2. Asumiendo que lo anterior se cumple, podemos realizar c√°lculos a trav√©s de m√∫ltiples procesadores (multicore) en R, aprovechando la totalidad de la capacidad de c√≥mputo de nuestros computadores para optimizar el rendimiento de nuestros procesos.\nEjemplo Usaremos un conjunto de datos que contiene 10.000 noticias de prensa digital chilena; es decir, que contiene much√≠simo texto. Para hacer el ejemplo m√°s ilustrativo de un problema de procesamiento de grandes vol√∫menes de datos, multiplicaremos la base de datos para que sea 20 veces m√°s grande, y as√≠ se entienda la necesidad de optimizaci√≥n.\n# cargar datos desde repositorio prensa \u0026lt;- readr::read_csv2(\u0026#34;https://github.com/bastianolea/prensa_chile/raw/main/datos/prensa_datos_muestra.csv\u0026#34;) # para m√°s informaci√≥n: https://github.com/bastianolea/prensa_chile # multiplicar cantidad de datos prensa_b \u0026lt;- rep(list(prensa), 20) |\u0026gt; purrr::list_rbind() # ver datos prensa_b # A tibble: 200,000 √ó 4 titulo cuerpo fuente fecha \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; 1 \u0026#34;Hombre de 66 a√±os fue asesinado en plena v√≠a p√∫bli‚Ä¶ \u0026#34;El h‚Ä¶ Coope‚Ä¶ 2024-07-21 2 \u0026#34;Revive el cuarto cap√≠tulo de Indecisos: Candidatos‚Ä¶ \u0026#34;Este‚Ä¶ Megan‚Ä¶ 2024-09-03 3 \u0026#34;Menos personas circulando y miedo de los residente‚Ä¶ \u0026#34;Poca‚Ä¶ Megan‚Ä¶ 2024-04-08 4 \u0026#34;CEO de Walmart Chile sostiene que si la empresa no‚Ä¶ \u0026#34;Hace‚Ä¶ The C‚Ä¶ 2024-12-22 5 \u0026#34;Pdte. Boric entreg√≥ mensaje por la muerte de Pi√±er‚Ä¶ \u0026#34;El p‚Ä¶ CNN C‚Ä¶ 2024-02-06 6 \u0026#34;Encuentran dos cad√°veres en un canal de regad√≠o en‚Ä¶ \u0026#34;Pers‚Ä¶ Publi‚Ä¶ 2024-07-13 7 \u0026#34;Magisterio denuncia \u0026#39;abandono de la educaci√≥n p√∫bl‚Ä¶ \u0026#34;Carl‚Ä¶ Coope‚Ä¶ 2024-02-21 8 \u0026#34;‚ÄúEl d√≠a que la democracia triunf√≥ sobre la dictadu‚Ä¶ \u0026#34;Los ‚Ä¶ CNN C‚Ä¶ 2024-10-05 9 \u0026#34;Accidente de tr√°nsito deja un fallecido y tres her‚Ä¶ \u0026#34;En h‚Ä¶ T13 2024-12-22 10 \u0026#34;Dos personas resultan baleadas tras intentar evita‚Ä¶ \u0026#34;Aton‚Ä¶ Emol 2024-11-02 # ‚Ñπ 199,990 more rows Tenemos un dataset con 200 mil filas, donde cada fila es una noticia, y en la columna cuerpo est√° el texto completo de cada noticia.\nEjemplo de c√°lculo con 1 procesador El objetivo va a ser detectar noticias que contengan un conjunto de palabras en su cuerpo, contar cu√°ntas palabras est√°n presentes en cada noticia, y luego filtrar los datos para dejar s√≥lo las noticias que tengan x cantidad de t√©rminos.\nlibrary(dplyr) library(stringr) # lista de t√©rminos a buscar t√©rminos \u0026lt;- \u0026#34;delincuen(cia|te)|crimen|criminal|inseguridad|deli(to|ctual)|hurto|robo|asalt(o|ante)|narco|homicidio|asesina(to|do)\u0026#34; tictoc::tic() prensa_delincuencia \u0026lt;- prensa_b |\u0026gt; # extraer t√©rminos desde cada noticia, si es que est√°n presentes mutate(conceptos = str_extract_all(cuerpo, t√©rminos)) |\u0026gt; # contar cantidad de t√©rminos presentes en cada noticia mutate(n_conceptos = lengths(conceptos)) |\u0026gt; # filtrar para que tengan m√°s de x t√©rminos filter(n_conceptos \u0026gt; 2) tictoc::toc() Medimos el tiempo que se demora en realizar esta operaci√≥n usando las funciones tic() y toc() del paquete {tictoc}.\nEn mi computador R se demor√≥ 70 segundos en buscar los t√©rminos entre las 200.000 noticias (varios millones de palabras en total) y luego hacer el conteo y filtrado.\nUso de recursos con 1 procesador Como vemos en los gr√°ficos, solamente 1 n√∫cleo del computador mostr√≥ uso de recursos, y el resto de los n√∫cleos permanecieron inactivos. Esto significa que R no est√° aprovechando la capacidad de procesamiento de tu computador, y por lo tanto, el c√°lculo se demora m√°s de lo que podr√≠a. En otras palabras, si R ocupa 1 n√∫cleo y sobran 5 n√∫cleos en desuso, significa que podr√≠as ejecutar 5 sesiones de R m√°s, de forma paralela.\nEjemplo de c√°lculo con 6 procesadores Para realizar el c√°lculo optimizando para el uso de m√∫ltiples procesadores, primero usamos la funci√≥n split() para dividir los datos en varias partes iguales. Esto es equivalente a lo que mencionamos antes sobre dividir una tarea en partes.\nLuego, vamos a usar la funci√≥n future_map() del paquete {furrr}, Esta funci√≥n es similar a map() de {purrr}, que permite iterar sobre tus datos, pero al agregarle future_ har√° que cada iteraci√≥n se ejecute en un proceso separado, aprovechando los m√∫ltiples n√∫cleos de tu computador. En otras palabras, {furrr} crear√° 6 sesiones de R, y cada una procesar√° su parte de los datos.\nCargamos los paquetes que posibilitan esta optimizaci√≥n:\nlibrary(purrr) library(furrr) Definimos la cantidad de procesadores que usaremos:3\nplan(multisession, workers = 6) Modificamos el c√≥digo del c√°lculo levemente para pedirle que lo ejecute a cada una de las partes de nuestro dataset, recordando que los datos quedaron divididos en una lista que contiene 6 elementos, cada uno con una parte de los datos originales:\ntictoc::tic() # benchmark prensa_delincuencia \u0026lt;- prensa_b |\u0026gt; # separar el dataframe en una lista con x cantidad de dataframes de la misma cantidad de filas split(1:6) |\u0026gt; # calcular multiprocesador, una parte por cada procesador future_map(\\(parte) { parte |\u0026gt; mutate(conceptos = str_extract_all(cuerpo, t√©rminos)) |\u0026gt; mutate(n_conceptos = lengths(conceptos)) |\u0026gt; filter(n_conceptos \u0026gt; 2) }) |\u0026gt; # volver a unir los resultados en un solo dataframe list_rbind() tictoc::toc() El proceso se demora 18 segundos, apenas un 25% de lo que se demor√≥ antes! En el monitor de actividad vemos claramente la diferencia en el aprovechamiento de los recursos computacionales:\nUso de recursos con 6 procesadores Notamos que todos los procesadores del computador est√°n al 100%, a diferencia de antes. Si revisamos los procesos en el computador durante el c√°lculo, vemos que, aparte del proceso principal rsession, se crearon 6 procesos R que procesan los datos de forma paralela:\nEn conclusi√≥n, vimos que al usar 6 procesadores, obtenemos resultados 400%4 m√°s r√°pidos, con tan solo haber agregado un par de l√≠neas.\nNo todas las tareas son posibles de procesar de forma paralela, por ejemplo, 6 personas no se demoran menos en contar hasta 100 porque ser√≠a imposible.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nNo todas las tareas escalan de la misma forma; por ejemplo, si la tarea es lenta porque tiene que leer muchos datos, no se va a realizar m√°s r√°pido por leer simult√°neamente los datos, porque el cuello de botella es la velocidad de lectura y no el procesador.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nEl n√∫mero de workers (subprocesos) depende de tu computador; en este caso pondr√© 6, pero si tu computador tiene 8 entonces pone 8, aunque hay gente que recomienda usar n-1 para dejar un n√∫cleo libre para el sistema operativo.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n400% m√°s r√°pido porque se demor√≥ 18 segundos en vez de 70 segundos al usar 6 n√∫cleos en vez de 1. Pero entonces, ¬øpor qu√© no 600% m√°s r√°pido, si eran 6 procesadores? Esto se debe a que un procesamiento de este tipo tiene el costo extra (overhead) de tener que duplicar los datos y el entorno para cada subproceso, lo cual tambi√©n puede significar un aumento en el uso de la memoria.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-06-12T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/furrr_multiprocesador/","tags":"procesamiento de datos ; optimizaci√≥n ; loops ; purrr","title":"Procesamiento de datos multiprocesador en R con {furrr}"},{"content":"Hoy est√° de cumplea√±os el paquete {ggplot2} para visualizaci√≥n de datos en R! Este paquete es indispensable para explorar el mundo de los datos, ya que su filosof√≠a o gram√°tica est√° muy bien lograda, su simplicidad ayuda a llegar a resultados √∫tiles en pocos pasos, y su flexibilidad posibilita crear casi lo que desees, siempre siguiendo principios firmemente sostenidos en un enfoque de ciencia de datos. El paquete cumple 18 a√±os desde su creaci√≥n por Hadley Wickham, Chief Scientist de Posit y jefe del equipo Tidyverse.\nSe trata de una herramienta que uso d√≠a a d√≠a, as√≠ que con mucho cari√±o (ü§™) le hice un gr√°fico de mini celebraci√≥n en 20 l√≠neas üíú\nlibrary(ggplot2) library(dplyr) library(ggtext) library(ragg) tibble(x = sample(1:18), y = sample(1:18)) |\u0026gt; ggplot() + geom_text(aes(label = \u0026#34;‚≠êÔ∏è\u0026#34;, y, x), size = 4) + geom_text(aes(label = \u0026#34;üéà\u0026#34;, x, y, size = y)) + annotate(\u0026#34;text\u0026#34;, y = -1, x = 18/2, hjust = 0.5, label = \u0026#34;üéÇ\u0026#34;, size = 12) + theme_void() + coord_cartesian(xlim = c(0, 18), ylim = c(-2, 20)) + scale_size(range = c(4, 9)) + guides(size = guide_none()) + labs(title = \u0026#34;Feliz cumplea√±os \u0026lt;span style=\u0026#39;font-family: Menlo;\u0026#39;\u0026gt;{ggplot2}\u0026lt;/span\u0026gt; üéâ\u0026#34;) + theme(plot.title = element_markdown(family = \u0026#34;Helvetica\u0026#34;), plot.margin = margin(8, 8, 8, 8)) El gr√°fico usa n√∫meros al azar para poner globos y estrellas. Los globitos crecen con respecto al eje y, mientras que la torta simplemente se ubica abajo y al centro.\nParti√≥ de una idea mucho m√°s sencilla que coment√© en una publicaci√≥n de celebraci√≥n que hizo Hadley Wickham, desarrollador de {ggplot2}, {dplyr} y muchos m√°s paquetes del Tidyverse.\nEl original era as√≠ de simple:\ntibble(a = sample(1:18, 18), b = sample(1:18, 18)) |\u0026gt; ggplot() + aes(a, b, size = b) + geom_text(aes(label = \u0026#34;üéà\u0026#34;)) + theme_void() + guides(size = guide_none()) Intenta reproducirlo en tu R! Si no te resulta, puede deberse a que el backend gr√°fico por defecto de R tiene problemas con los textos complejos, como los emojis. En las configuraciones de RStudio, entra a General y luego en Graphics puedes cambiar el backend por uno como AGG (del paquete {ragg})\nSi quieres aprender {ggplot2} desde cero, revisa este tutorial gratuito que hice, donde te explico a usar esta √∫til y flexible herramienta desde lo m√°s sencillo, con muchos ejemplos de visualizaciones aplicadas a datos reales.\n","date":"2025-06-11T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-06-11/","tags":"ggplot2 ; gr√°ficos","title":"Feliz cumplea√±os, {ggplot2}!"},{"content":" Uno de beneficios concretos de los avances en inteligencia artificial generativa son las herramientas de autocompletado de c√≥digo1. Una de estas herramientas es GitHub Copilot, la cual puede integrarse directamente en RStudio para ayudarte a programar en R. En este post mostrar√© algunos casos de uso real donde Copilot me ha servido.\n¬øPara qu√© sirve? Copilot es un servicio de autocompletado de c√≥digo que puede integrarse directamente en RStudio. Sirve para recibir sugerencias de c√≥digo mientras programas, lo que puede ayudarte a escribir c√≥digo m√°s r√°pido. Esta herramienta utiliza modelos de lenguaje entrenados con una gran cantidad de c√≥digo fuente disponible p√∫blicamente, lo que le permite ofrecer sugerencias contextuales basadas en el c√≥digo que ya has escrito.\nInstalaci√≥n En las opciones globales de RStudio, entra a el √∫ltimo √≠tem, titulado Copilot. Presiona Activar, y se te pedir√° ingresar un c√≥digo de verificaci√≥n en el sitio web de GitHub que aparecer√° indicado, usando tu cuenta de GitHub. Visita aqu√≠ para m√°s instrucciones.\n¬øC√≥mo funciona? Luego de activar esta herramienta, simplemente empiezas a programar, y cada vez que te detengas, el modelo intentar√° autocompletar lo que est√©s escribiendo. Frente a tu cursor aparecer√° una sugerencia de c√≥digo basada en lo que ya hayas escrito y en los contenidos de tu script. El modelo es capaz de predecir lo que quieres programar, seg√∫n el lugar en el documento en que est√©s. Presionando la tecla tabulador podr√°s aceptar la sugerencia e incluirla instant√°neamente en tu c√≥digo.\nEn la pr√°ctica, esto te har√° ahorrar tiempo programando tareas simples y repetitivas, ya que en la mayor√≠a de estos casos el modelo lograr√° adivinar lo que intentas hacer. Pero si intentas hacer algo fuera de lo com√∫n o demasiado espec√≠fico, usualmente el modelo se queda atr√°s. Otras veces hay un tradeoff entre peque√±os errores y el beneficio de tener que escirbir menos.\nLa herramienta funciona mucho mejor si es que agregas comentarios a tu c√≥digo, ya sea indicando paso por paso a lo que intentas hacer, o antecediendo los bloques de c√≥digo con un comentario que describa tu objetivo. Incluso, muchas veces basta con escribir un comentario con lo que intentas hacer para que el modelo lo haga por ti.\nTambi√©n tienes la opci√≥n de permitir que el modelo tenga acceso a todos los archivos de tu proyecto. Esto mejora significativamente las sugerencias que te hace el modelo, ya que le entrega una mayor comprensi√≥n de lo que intentas hacer. Activa esta opci√≥n en las opciones globales de RStudio (index project files).\nEjemplos Luego de varias semanas utiliz√°ndolo, puedo decir que los resultados suelen ser muy positivos.\nCopilot entiende el contexto en que escribes; por ejemplo, ac√° sabe que estoy creando un input para una app Shiny, y lo rellena con la columna correspondiente del dataset correcto: En este otro ejemplo, rellena las opciones de un input de Shiny con los valores que defin√≠ cientos de l√≠neas arriba en el mismo script, ahorr√°ndome el tener que moverme por el script para encontrar los valores: En este caso, el modelo sugiere el uso de la funci√≥n get() para crear un objeto que contiene a otro objeto basado en el nombre de este segundo objeto, algo bien rebuscado pero que intuy√≥ a partir de lo que ten√≠a escrito al momento: Luego de lo anterior, el modelo supo que quer√≠a usar el objeto creado para seleccionar columnas de un dataframe reactivo! Ac√° me sorprendi√≥ mucho, porque s√≥lo con iniciar la creaci√≥n de unas columnas para la app, el modelo recomienda la estructura entera de tres columnas con tres selectores basados en las variables correspondientes, definidas en otra parte del script. Aqu√≠ se ve c√≥mo el modelo sugiere contenido cuando declaras lo que est√°s haciendo con comentarios: Y en este caso, el modelo entiende que estoy dentro de un bloque de {ggplot2}, pero que adem√°s sabe que estoy usando {plotly}, por lo que me ayuda a crear correctamente el texto de los tooltips del gr√°fico: Resulta que todas las d√©cadas de colaboraci√≥n desinteresada y proyectos de c√≥digo abierto en plataformas como GitHub, de preguntas y respuestas en StackOverflow, y miles de blogs de desarrolladores solidarios, terminaron siendo una mina de oro para entrenar modelos de lenguaje. Producto de la anterior es que hoy proliferan herramientas de inteligencia artificial con abundantes conocimientos de programaci√≥n.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-06-09T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/github_copilot/","tags":"consejos ; inteligencia artificial","title":"Sugerencias y autocompletado de c√≥digo con GitHub Copilot"},{"content":"Una de las gracias de generar documentos en Quarto es que podemos combinar la redacci√≥n con el c√≥digo. Pero esto puede ir m√°s all√° que simplemente escribir un p√°rrafo de texto y seguido de un p√°rrafo de c√≥digo. Podemos usar c√≥digo para literalmente generar texto, t√≠tulos y m√°s.\nEn otros tutoriales vimos c√≥mo podemos incluir resultados del c√≥digo dentro de nuestros p√°rrafos de texto, por ejemplo, para que una cifra que est√© dentro de una oraci√≥n venga directamente del resultado de un c√°lculo en vez de tener que escribirle de forma manual. Pero en esta gu√≠a vamos a ver c√≥mo podemos programar la generaci√≥n masiva de t√≠tulos, p√°rrafos y gr√°ficos en base a una iteraci√≥n, bucle o loop.\nGenerar contenido del reporte desde loops Dentro de un chunk de c√≥digo, podemos usar funciones que entreguen como output c√≥digo markdown. Esto nos servir√° para construir un documento a partir de un loop o iteraci√≥n. De este modo, podemos usar nuestros datos para generar una cantidad indeterminada de t√≠tulos, subt√≠tulos, p√°rrafos de textos, gr√°ficos o m√°s, que se generar√°n autom√°ticamente.\nUsaremos el paquete {pander} para que el chunk de R retorne contenido en Markdown que Quarto interpretar√° como parte del documento gracias a la opci√≥n #| results: \u0026quot;asis\u0026quot; que tenemos que definir al principio del chunk:\nlibrary(dplyr) library(pander) Como primer ejemplo, tendremos un vector que contiene tres elementos de texto. Para generar el contenido de nuestro documento, queremos generar un t√≠tulo y un p√°rrafo por cada elemento de texto del vector. Entonces, hacemos un loop que vaya iterando por cada elemento del vector, y para cada elemento va a crear un t√≠tulo, un peque√±o p√°rrafo, e insertar un emoji:\nanimales \u0026lt;- c(\u0026#34;gato\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;castor\u0026#34;) # unir nombres de columnas en un texto for (animal in animales) { # crear un t√≠tulo pandoc.header(paste(\u0026#34;T√≠tulo:\u0026#34;, animal), level = 4) # crear un p√°rrafo pandoc.p( paste(\u0026#34;Este texto fue generado por `{pander}` dentro de un _for loop_ para el animalito\u0026#34;, animal) ) # poner un animalito pandoc.p( case_when(animal == \u0026#34;gato\u0026#34;~ \u0026#34;üêà‚Äç‚¨õ\u0026#34;, animal == \u0026#34;mapache\u0026#34; ~ \u0026#34;ü¶ù\u0026#34;, animal == \u0026#34;castor\u0026#34; ~ \u0026#34;ü¶´\u0026#34;) ) } T√≠tulo: gato Este texto fue generado por {pander} dentro de un for loop para el animalito gato\nüêà‚Äç‚¨õ\nT√≠tulo: mapache Este texto fue generado por {pander} dentro de un for loop para el animalito mapache\nü¶ù\nT√≠tulo: castor Este texto fue generado por {pander} dentro de un for loop para el animalito castor\nü¶´\nComo podemos ver, el contenido anterior se gener√≥ autom√°ticamente como resultado del loop.\nLas funciones pandoc.header() y pandoc.p() sumadas a la opci√≥n results: asis nos ayudan a que el chunk retorne texto en markdown. Usando los mismos principios, podemos programar un loop que vaya retornando t√≠tulos, textos, y m√°s, para que el contenido del documento se vaya escribiendo solo. Si queremos incluir gr√°ficos, tenemos que imprimirlos expl√≠citamente con plot().\nEn este segundo ejemplo, iteraremos por los valores de una variable de un dataframe (la variable Species de iris, que tiene 3 valores posibles) y por cada valor crearemos un t√≠tulo, un gr√°fico que destaque dicho valor, y un texto que indique una cifra relacionada al valor. Luego del c√≥digo veremos el contenido resultante, generado de forma autom√°tica:\nlibrary(ggplot2) library(pander) library(dplyr) library(glue) # para pegar texto library(gghighlight) # para destacar valores en gr√°ficos # iteraci√≥n for (especie in unique(iris$Species)) { # t√≠tulo pandoc.header(paste(\u0026#34;Especie\u0026#34;, especie), level = 3) # definir color color_especie \u0026lt;- case_when(especie == \u0026#34;setosa\u0026#34; ~ \u0026#34;#ff006e\u0026#34;, especie == \u0026#34;virginica\u0026#34; ~ \u0026#34;#8338ec\u0026#34;, especie == \u0026#34;versicolor\u0026#34; ~ \u0026#34;#3a86ff\u0026#34;) # crear gr√°fico grafico \u0026lt;- iris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width) + geom_point(size = 3, color = color_especie) + theme_void() + gghighlight::gghighlight(Species == especie) # imprimir gr√°fico plot(grafico) # crear texto largo_petalo \u0026lt;- iris |\u0026gt; filter(Species == especie) |\u0026gt; slice_max(Petal.Length) |\u0026gt; pull(Petal.Length) |\u0026gt; unique() # imprimir texto pandoc.p( # paste(\u0026#34;La observaci√≥n m√°s alta en largo de p√©talos en la especie\u0026#34;, especie, \u0026#34;es:\u0026#34;, largo_petalo) glue::glue(\u0026#34;La observaci√≥n m√°s alta en largo de p√©talos en la especie **{especie}** es: {largo_petalo}\u0026#34;) ) # l√≠nea divisoria # pandoc.horizontal.rule() } Especie setosa La observaci√≥n m√°s alta en largo de p√©talos en la especie setosa es: 1.9\nEspecie versicolor La observaci√≥n m√°s alta en largo de p√©talos en la especie versicolor es: 5.1\nEspecie virginica La observaci√≥n m√°s alta en largo de p√©talos en la especie virginica es: 6.9\nSi no te funciona, recuerda que el chunk tiene que tener #| results: \u0026quot;asis\u0026quot; definido al principio para que el output sea el correcto.\nUsando esta t√©cnica podemos producir documentos muy extensos con poco c√≥digo, lo que nos vuelve m√°s eficientes y tambi√©n nos ayuda para actualizar y retocar los reportes, dado que un cambio hecho una sola vez se replica en todos los elementos generados por el loop.\nEsto puede sernos √∫til si es que estamos generando un documento en el que estamos presentando resultados y tenemos que repetir varias veces contenido similar para los distintos valores de una variable, o si tenemos que mostrar muchos gr√°ficos similares para distintas variables, etc.\n","date":"2025-06-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/quarto_loop/","tags":"quarto ; loops ; automatizaci√≥n ; gr√°ficos","title":"Generar contenido en serie usando loops en un reporte Quarto"},{"content":" √çndice Crear variable a partir de la detecci√≥n de texto Cambiar la capitalizaci√≥n de un texto Expresiones regulares Extraer caracteres desde un texto El paquete {stringr} facilita todo tipo de trabajo que implique texto en R.\nEn general, los datos que vienen como texto suelen necesitar una limpieza previa, y adicionalmente un procesamiento para poder aprovecharlos mejor.\nSigamos un ejemplo con una columna que viene con textos sobre compras en un servicio p√∫blico:\nlibrary(dplyr) library(stringr) # para trabajar con textos datos \u0026lt;- tibble( texto = c(\u0026#34;Licitaci√≥n p√∫blica N¬∞3432\u0026#34;, \u0026#34;Trato directo #3341\u0026#34;, \u0026#34;Licitaci√≥n privada 876\u0026#34;, \u0026#34;LICITACION PUBLICA N3430\u0026#34;, \u0026#34;Licitacion publica 3526 concluida\u0026#34;, \u0026#34;licitaci√≥n p√∫blica 2986 ok\u0026#34;, \u0026#34;sin informaci√≥n\u0026#34;) ) texto Licitaci√≥n p√∫blica N¬∞3432 Trato directo #3341 Licitaci√≥n privada 876 LICITACION PUBLICA N3430 Licitacion publica 3526 concluida licitaci√≥n p√∫blica 2986 ok sin informaci√≥n Como es de esperar, el texto viene sucio: escrito de distintas maneras, con y sin tildes, con y sin may√∫sculas, etc.\nCrear variable a partir de la detecci√≥n de texto Una primera limpieza de los datos puede ser identificar si un texto espec√≠fico est√° o no presente en la variable de texto sucio. Para ello podemos usar la funci√≥n str_detect(), que retorna TRUE o FALSE si en el texto que se le entrega como primer argumento est√° presente el texto en su segundo argumento. Por ejemplo:\nstr_detect(\u0026#34;un texto ac√° muy feo\u0026#34;, \u0026#34;feo\u0026#34;) # s√≠ (TRUE) [1] TRUE str_detect(\u0026#34;un texto ac√° muy bonito\u0026#34;, \u0026#34;feo\u0026#34;) #no (FALSE) [1] FALSE Aplicamos str_detect() dentro de un mutate() para crear una columna que indique la presencia de un texto a lo largo de la columna de texto:\ndatos |\u0026gt; mutate(licitacion = str_detect(texto, \u0026#34;Licitaci√≥n\u0026#34;)) # A tibble: 7 √ó 2 texto licitacion \u0026lt;chr\u0026gt; \u0026lt;lgl\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 TRUE 2 Trato directo #3341 FALSE 3 Licitaci√≥n privada 876 TRUE 4 LICITACION PUBLICA N3430 FALSE 5 Licitacion publica 3526 concluida FALSE 6 licitaci√≥n p√∫blica 2986 ok FALSE 7 sin informaci√≥n FALSE Vemos que s√≥lo entrega dos TRUE, siendo que en las filas 4, 5 y 6 tambi√©n deber√≠a encontrar coincidencias. Esto se debe a que existen diferencias en las letras min√∫sculas y may√∫sculas.\nCambiar la capitalizaci√≥n de un texto Un problema com√∫n con la limpieza de texto es encontrar diferencias en las may√∫sculas de las palabras. {stringr} tiene varias funciones para ayudarnos a cambiar textos a may√∫sculas, min√∫sculas, y m√°s.\nstr_to_lower(\u0026#34;HOLA, c√≥mo est√°s?\u0026#34;) [1] \u0026quot;hola, c√≥mo est√°s?\u0026quot; str_to_upper(\u0026#34;hola, c√≥mo est√°s?!\u0026#34;) [1] \u0026quot;HOLA, C√ìMO EST√ÅS?!\u0026quot; str_to_sentence(\u0026#34;hola, c√≥mo est√°s?\u0026#34;) [1] \u0026quot;Hola, c√≥mo est√°s?\u0026quot; Pero a veces necesitamos corregir la capitalizaci√≥n de textos que en su interior contienen palabras que empiezan con may√∫sculas, o siglas/acr√≥nimos, en cuyo caso convertir a min√∫sculas o a oraci√≥n arruinar√≠an la gram√°tica correcta.\n# texto que no empieza con may√∫scula texto \u0026lt;- \u0026#34;mi nombre es Cecilia y trabajo en la ONU.\u0026#34; # agregar may√∫scula inicial, pero se pierden las dem√°s may√∫sculas str_to_sentence(texto) [1] \u0026quot;Mi nombre es cecilia y trabajo en la onu.\u0026quot; En estos casos podemos realizar un reemplazo de texto con str_replace() que solamente reemplace la primera letra del texto por su versi√≥n may√∫scula, y deje las dem√°s intactas:\n# reemplazar s√≥lo primera letra de la primera palabra str_replace(texto, \u0026#34;^.\u0026#34;, toupper) [1] \u0026quot;Mi nombre es Cecilia y trabajo en la ONU.\u0026quot; Aqu√≠ usamos una expresi√≥n regular (^.) para indicar que queremos reemplazar solamente la primera letra del texto (el s√≠mbolo ^ indica el inicio del texto, y . indica cualquier s√≠mbolo).\nVolviendo al ejemplo de los datos, para corregir la detecci√≥n de datos con str_detect() cuando hay diferencias de may√∫sculas, primero convertimos el texto a min√∫sculas con str_to_lower(), y buscamos el t√©rmino en min√∫sculas:\ndatos |\u0026gt; mutate(licitacion = str_detect(str_to_lower(texto), \u0026#34;licitaci√≥n\u0026#34;)) # A tibble: 7 √ó 2 texto licitacion \u0026lt;chr\u0026gt; \u0026lt;lgl\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 TRUE 2 Trato directo #3341 FALSE 3 Licitaci√≥n privada 876 TRUE 4 LICITACION PUBLICA N3430 FALSE 5 Licitacion publica 3526 concluida FALSE 6 licitaci√≥n p√∫blica 2986 ok TRUE 7 sin informaci√≥n FALSE Obtenemos una coincidencia m√°s! Pero siguen faltando dos casos (casos 4 y 5) que deber√≠an retornar TRUE. En estos casos, el problema est√° con diferencias en los tildes de las palabras. Para solucionar esto, podemos hacer una b√∫squeda de texto usando regex.\nExpresiones regulares Las expresiones regulares o regex son formas de escribir patrones de b√∫squeda, y son soportadas por todas las funciones de {stringr}. Uno de estos patrones es el operador o (|). El operador o puede usarse para encontrar coincidencias con varias palabras distintas separadas con |:\nstr_detect(c(\u0026#34;hola\u0026#34;, \u0026#34;holo\u0026#34;, \u0026#34;holi\u0026#34;), \u0026#34;hola|holi\u0026#34;) [1] TRUE FALSE TRUE En este ejemplo, se coincide con un TRUE tanto el texto hola como holi. Pero en este ejemplo ambas palabras son muy similares; 75% similares, para ser exactos ü§ì‚òùüèº. Podemos poner entre par√©ntesis los caracteres espec√≠ficos que var√≠an, para que dentro de una misma palabra se acepten distintos caracteres:\nstr_detect(c(\u0026#34;hola\u0026#34;, \u0026#34;holo\u0026#34;, \u0026#34;holi\u0026#34;), \u0026#34;hol(a|i)\u0026#34;) [1] TRUE FALSE TRUE De este modo, se coincide con la palabra hol seguida tanto de a como de i; es decir, hola y holi.\nFinalmente, tambi√©n podemos pedirle que coincida una palabra que dentro de ella tenga cualquier caracter:\nstr_detect(c(\u0026#34;hola\u0026#34;, \u0026#34;holo\u0026#34;, \u0026#34;holi\u0026#34;), \u0026#34;hol.\u0026#34;) [1] TRUE TRUE TRUE Siguiendo estos ejemplos para volver a nuestros datos, podemos coincidir texto con y sin tildes al mismo tiempo si usamos regex para especificar que uno o varios caracteres pueden ser distintos; en este caso, la letra o con y sin tilde:\ndatos |\u0026gt; mutate(licitacion = str_detect(str_to_lower(texto), \u0026#34;licitaci(√≥|o)n\u0026#34;)) # A tibble: 7 √ó 2 texto licitacion \u0026lt;chr\u0026gt; \u0026lt;lgl\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 TRUE 2 Trato directo #3341 FALSE 3 Licitaci√≥n privada 876 TRUE 4 LICITACION PUBLICA N3430 TRUE 5 Licitacion publica 3526 concluida TRUE 6 licitaci√≥n p√∫blica 2986 ok TRUE 7 sin informaci√≥n FALSE Podemos usar el mismo c√≥digo pero dentro de un ifelse() para que, en vez de TRUE y FALSE, retorne lo que queramos para las condicies verdadera y falsa:\ndatos |\u0026gt; mutate(licitacion = ifelse(str_detect(str_to_lower(texto), \u0026#34;licitaci(√≥|o)n\u0026#34;), yes = \u0026#34;Licitaci√≥n\u0026#34;, no = \u0026#34;Otros\u0026#34;)) # A tibble: 7 √ó 2 texto licitacion \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 Licitaci√≥n 2 Trato directo #3341 Otros 3 Licitaci√≥n privada 876 Licitaci√≥n 4 LICITACION PUBLICA N3430 Licitaci√≥n 5 Licitacion publica 3526 concluida Licitaci√≥n 6 licitaci√≥n p√∫blica 2986 ok Licitaci√≥n 7 sin informaci√≥n Otros Tambi√©n podemos usar el operador .* de regex para indicar cualquier cantidad de caracteres entre el texto antes y despu√©s del operador. Por ejemplo:\nstr_detect(c(\u0026#34;hola\u0026#34;, \u0026#34;hooooooola\u0026#34;, \u0026#34;ho8787897la\u0026#34;, \u0026#34;hola hola\u0026#34;), \u0026#34;ho.*la\u0026#34;) [1] TRUE TRUE TRUE TRUE En el ejemplo, ho.*la significa coincidir con un texto que tenga ho, cualquier texto, y luego la; por lo tanto, coincide con hola, hooooooola, ho8787897la y cualquier otra variaci√≥n.\nPodemos usar esto para hacer coincidencias m√°s flexibles:\ndatos |\u0026gt; mutate(tipo = case_when(str_detect(str_to_lower(texto), \u0026#34;lic.*privada\u0026#34;) ~ \u0026#34;Licitaci√≥n privada\u0026#34;, str_detect(str_to_lower(texto), \u0026#34;lic.*p.blica\u0026#34;) ~ \u0026#34;Licitaci√≥n p√∫blica\u0026#34;, str_detect(str_to_lower(texto), \u0026#34;trato.*directo|contra.*direct\u0026#34;) ~ \u0026#34;Trato directo\u0026#34;) ) # A tibble: 7 √ó 2 texto tipo \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 Licitaci√≥n p√∫blica 2 Trato directo #3341 Trato directo 3 Licitaci√≥n privada 876 Licitaci√≥n privada 4 LICITACION PUBLICA N3430 Licitaci√≥n p√∫blica 5 Licitacion publica 3526 concluida Licitaci√≥n p√∫blica 6 licitaci√≥n p√∫blica 2986 ok Licitaci√≥n p√∫blica 7 sin informaci√≥n \u0026lt;NA\u0026gt; Si combinamos los aprendizajes hasta el momento, podemos crear una columna nueva que entregue distintos valores dependiendo del texto detectado, gracias a case_when():\ndatos |\u0026gt; # limpiar el texto de antemano mutate(texto_2 = str_to_lower(texto)) |\u0026gt; # detectar licitaciones mutate(licitacion = str_detect(texto_2, \u0026#34;licitaci(√≥|o)n\u0026#34;)) |\u0026gt; # detectar si son p√∫blicas, privadas, o de otro tipo mutate(tipo = case_when( # si son licitaciones, y si contiene \u0026#34;privada\u0026#34; licitacion \u0026amp; str_detect(texto_2, \u0026#34;privad(o|a)\u0026#34;) ~ \u0026#34;Licitaci√≥n privada\u0026#34;, # si son licitaciones y si contiene \u0026#34;p√∫blico\u0026#34; licitacion \u0026amp; str_detect(texto_2, \u0026#34;p(√∫|u)blic(a|o)\u0026#34;) ~ \u0026#34;Licitaci√≥n p√∫blica\u0026#34;, # otros valores str_detect(texto_2, \u0026#34;trato directo\u0026#34;) ~ \u0026#34;Trato directo\u0026#34;, # todos los dem√°s que no coincidieron en las condiciones anteriores .default = \u0026#34;Otros\u0026#34;)) # A tibble: 7 √ó 4 texto texto_2 licitacion tipo \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;lgl\u0026gt; \u0026lt;chr\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 licitaci√≥n p√∫blica n¬∞3432 TRUE Lici‚Ä¶ 2 Trato directo #3341 trato directo #3341 FALSE Trat‚Ä¶ 3 Licitaci√≥n privada 876 licitaci√≥n privada 876 TRUE Lici‚Ä¶ 4 LICITACION PUBLICA N3430 licitacion publica n3430 TRUE Lici‚Ä¶ 5 Licitacion publica 3526 concluida licitacion publica 3526 co‚Ä¶ TRUE Lici‚Ä¶ 6 licitaci√≥n p√∫blica 2986 ok licitaci√≥n p√∫blica 2986 ok TRUE Lici‚Ä¶ 7 sin informaci√≥n sin informaci√≥n FALSE Otros Extraer caracteres desde un texto Una √∫ltima alternativa para limpiar estos datos ser√≠a extraer texto espec√≠fico desde la variable de texto. Es decir, encontrar un tipo de texto dentro de otro texto, y solamente dejar ese texto extra√≠do. Por ejemplo: entre un texto extenso, extraer solamente una palabra espec√≠fica, si es que existe, o extraer solamente los n√∫meros que est√©ndentro del texto.\nPara esto podemos usar la funci√≥n str_extract() combinada con un operador regex para extraer secuencias de n√∫meros (\\\\d+):\ndatos |\u0026gt; mutate(numero = str_extract(texto, \u0026#34;\\\\d+\u0026#34;)) # A tibble: 7 √ó 2 texto numero \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Licitaci√≥n p√∫blica N¬∞3432 3432 2 Trato directo #3341 3341 3 Licitaci√≥n privada 876 876 4 LICITACION PUBLICA N3430 3430 5 Licitacion publica 3526 concluida 3526 6 licitaci√≥n p√∫blica 2986 ok 2986 7 sin informaci√≥n \u0026lt;NA\u0026gt; Para finalizar, unimos todas las t√©cnicas que vimos en este ejemplo, para terminar con una tabla de datos mucho m√°s √∫til que la que ten√≠amos al inicio!\ndatos_limpios \u0026lt;- datos |\u0026gt; # limpiar el texto de antemano mutate(texto_2 = str_to_lower(texto)) |\u0026gt; # detectar licitaciones mutate(licitacion = ifelse(str_detect(str_to_lower(texto), \u0026#34;licitaci(√≥|o)n\u0026#34;), yes = \u0026#34;Licitaci√≥n\u0026#34;, no = \u0026#34;Otros\u0026#34;)) |\u0026gt; # detectar si son p√∫blicas, privadas, o de otro tipo mutate(tipo = case_when( # si son licitaciones, y si contiene \u0026#34;privada\u0026#34; licitacion == \u0026#34;Licitaci√≥n\u0026#34; \u0026amp; str_detect(texto_2, \u0026#34;privad(o|a)\u0026#34;) ~ \u0026#34;Licitaci√≥n privada\u0026#34;, # si son licitaciones y si contiene \u0026#34;p√∫blico\u0026#34; licitacion == \u0026#34;Licitaci√≥n\u0026#34; \u0026amp; str_detect(texto_2, \u0026#34;p(√∫|u)blic(a|o)\u0026#34;) ~ \u0026#34;Licitaci√≥n p√∫blica\u0026#34;, # otros valores licitacion == \u0026#34;Otros\u0026#34; \u0026amp; str_detect(texto_2, \u0026#34;trato directo\u0026#34;) ~ \u0026#34;Trato directo\u0026#34;, # todos los dem√°s que no coincidieron en las condiciones anteriores .default = \u0026#34;Otros\u0026#34;)) |\u0026gt; # extraer n√∫meros mutate(numero = str_extract(texto, \u0026#34;\\\\d+\u0026#34;), numero = as.numeric(numero)) |\u0026gt; # convertir n√∫meros a num√©ricos # eliminar columnas innecesarias select(-contains(\u0026#34;texto\u0026#34;)) licitacion tipo numero Licitaci√≥n Licitaci√≥n p√∫blica 3432 Otros Trato directo 3341 Licitaci√≥n Licitaci√≥n privada 876 Licitaci√≥n Licitaci√≥n p√∫blica 3430 Licitaci√≥n Licitaci√≥n p√∫blica 3526 Licitaci√≥n Licitaci√≥n p√∫blica 2986 Otros Otros NA ","date":"2025-06-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/stringr_texto/","tags":"limpieza de datos ; texto","title":"Limpieza y recodificaci√≥n de datos de texto en R con {stringr}"},{"content":" {datapasta} es un paquete para R que te ayuda a copiar y pegar datos desde y hacia R.\nInstala {datapasta} ejecutando el siguiente c√≥digo:\ninstall.packages(\u0026#34;datapasta\u0026#34;, repos = c(mm = \u0026#34;https://milesmcbain.r-universe.dev\u0026#34;, getOption(\u0026#34;repos\u0026#34;))) Copiar {datapasta} puede ayudarte a compartir f√°cilmente datos, al convertir tus datos en texto que puedes copiar y pegar en otro lado, o editar manualmente. Usa la funci√≥n dpasta() sobre un dataframe para hacer que los datos aparezcan como en texto directamente debajo de donde la ejecutaste.\nPor ejemplo, creemos una tabla peque√±a:\nlibrary(dplyr) tabla \u0026lt;- iris |\u0026gt; slice_sample(n = 5) |\u0026gt; tibble() tabla # A tibble: 5 √ó 5 Sepal.Length Sepal.Width Petal.Length Petal.Width Species \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; 1 6 2.2 5 1.5 virginica 2 5.1 3.8 1.5 0.3 setosa 3 6.1 3 4.9 1.8 virginica 4 6.7 3.1 5.6 2.4 virginica 5 4.7 3.2 1.6 0.2 setosa Imag√≠nate que queremos corregir esta tabla, usarla como ejemplo, o compartirla con alguien. Entonces usamos la funci√≥n dpasta():\ndatapasta::dpasta(tabla) ¬°Magia! Aparecer√° el siguiente c√≥digo en nuestro script:\ntibble::tribble( ~Sepal.Length, ~Sepal.Width, ~Petal.Length, ~Petal.Width, ~Species, 6, 3, 4.8, 1.8, \u0026#34;virginica\u0026#34;, 5.7, 2.9, 4.2, 1.3, \u0026#34;versicolor\u0026#34;, 7.7, 2.8, 6.7, 2, \u0026#34;virginica\u0026#34;, 6.8, 2.8, 4.8, 1.4, \u0026#34;versicolor\u0026#34;, 4.6, 3.2, 1.4, 0.2, \u0026#34;setosa\u0026#34; ) Al ejecutar este c√≥digo podemos re-crear el dataframe. Es decir, obtenemos los datos como texto que luego podemos usar para crear un nuevo dataframe. Esto tiene varias utilidades:\ntransformar los datos a texto para poder editarlos manualmente (corregir cifras, agregar observaciones) compartir peque√±as tablas con otras personas (adjuntando los datos como texto en un scirpt o correo) corregir manualmente datos peque√±os para los que no valdr√≠a la pena programar soluciones (por ejemplo, cambiar faltas de ortograf√≠a) \u0026ldquo;guardar\u0026rdquo; datos en un script para eliminar la dependencia de un archivo externo, sobre todo si se trata de pocos datos (por ejemplo, para crear un diccionario de las variables o libro de c√≥digos) Este tipo de tablas de datos almacenadas como c√≥digo se llaman tribble, y su gracia es que muestran los datos tal como los ver√≠amos en un dataframe o planilla, con la conveniencia de que podemos editarlos, incluso agregar nuevas filas o columnas si seguimos su sencilla sintaxis.\nPegar {datapasta} tambi√©n nos ayuda a pegar en R datos que sacamos desde otro sitio, con la funci√≥n tribble_paste(). Usando esta funci√≥n podemos copiar datos de una tabla de Excel o de una p√°gina web y pegarlos como un dataframe en R.\n¬°Probemos\u0026quot; Selecciona la siguiente tabla1 y c√≥piala:\nPa√≠s PIB (PPP) PIB (per capita) Brazil 4958.122 23238 Mexico 3395.916 25462 Argentina 1493.423 31379 Colombia 1190.795 22421 Chile 710.195 35146 Peru 643.052 18688 Dominican Republic 336.082 30874 Ecuador 300.122 16578 Guatemala 282.833 15633 Venezuela 223.984 8397 datapasta::tribble_paste() En tu consola aparecer√° el c√≥digo necesario para cargar la tabla copiada en R!\ntibble::tribble( ~PA√çS, ~`PIB.(PPP)`, ~`PIB.(PER.CAPITA)`, \u0026#34;Brazil\u0026#34;, 4958.122, 23238L, \u0026#34;Mexico\u0026#34;, 3395.916, 25462L, \u0026#34;Argentina\u0026#34;, 1493.423, 31379L, \u0026#34;Colombia\u0026#34;, 1190.795, 22421L, \u0026#34;Chile\u0026#34;, 710.195, 35146L, \u0026#34;Peru\u0026#34;, 643.052, 18688L, \u0026#34;Dominican Republic\u0026#34;, 336.082, 30874L, \u0026#34;Ecuador\u0026#34;, 300.122, 16578L, \u0026#34;Guatemala\u0026#34;, 282.833, 15633L, \u0026#34;Venezuela\u0026#34;, 223.984, 8397L ) Esto nos va a resultar √∫til si queremos pegar datos dentro de R, pero qu√© pasa si queremos copiar datos desde R y pegarlos en Excel u otro software planillas de datos?\nPegar datos desde R a Excel La funci√≥n write_clip() del paquete {clipr} nos permite guardar datos en el portapapeles del sistema para poder pegarlos en Excel, Numbers, Google Sheets u otros programas:\npib_latam |\u0026gt; clipr::write_clip() Los datos quedar√°n copiados en el portapapeles de tu sistema, y vas a poder pegarlos en Excel:\nFuente: Wikipedia\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-06-06T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/datapasta/","tags":"consejos ; datos","title":"Copia y pega datos en R con {datapasta} y {clipr}"},{"content":"La franja larga y angosta que es Chile tiene el beneficio de que sus regiones se ubican casi perfectamente una sobre la otra, de norte a sur. Este orgen geogr√°fico natural de sus regiones resulta familiar para sus habitantes, por lo que se vuelve recomendable ordenar los datos a nivel regional siguiendo este orden geogr√°fico.\nCreemos una tabla o dataframe con las regiones de Chile. Ejecuta el siguiente c√≥digo en R para obtener una tabla:\nlibrary(dplyr) regiones \u0026lt;- tibble::tribble( ~codigo_region, ~nombre_region, 1, \u0026#34;Tarapac√°\u0026#34;, 2, \u0026#34;Antofagasta\u0026#34;, 3, \u0026#34;Atacama\u0026#34;, 4, \u0026#34;Coquimbo\u0026#34;, 5, \u0026#34;Valpara√≠so\u0026#34;, 6, \u0026#34;Libertador General Bernardo O\u0026#39;Higgins\u0026#34;, 7, \u0026#34;Maule\u0026#34;, 8, \u0026#34;Biob√≠o\u0026#34;, 9, \u0026#34;La Araucan√≠a\u0026#34;, 10, \u0026#34;Los Lagos\u0026#34;, 11, \u0026#34;Ays√©n del General Carlos Ib√°√±ez del Campo\u0026#34;, 12, \u0026#34;Magallanes y de la Ant√°rtica Chilena\u0026#34;, 13, \u0026#34;Metropolitana de Santiago\u0026#34;, 14, \u0026#34;Los R√≠os\u0026#34;, 15, \u0026#34;Arica y Parinacota\u0026#34;, 16, \u0026#34;√ëuble\u0026#34; ) En esta tabla tenemos el nombre de las 16 regiones del pa√≠s, y adem√°s una columna de c√≥digo de regi√≥n. El c√≥digo de regi√≥n corresponde al nombre antiguo que ten√≠an las regiones (instaurado en dictadura), y que hoy en d√≠a no se sigue utilizando, pero que sin embargo se mantiene como c√≥digo identificador de las regiones en la mayor√≠a de las bases de datos oficiales. Si bien este c√≥digo originalmente ordenaba las regiones, hoy en d√≠a la creaci√≥n de nuevas regiones (como √ëuble en 2017 o Arica y Parinacota en 2007) provoca que este ordenamiento antiguo no se corresponda con el orden geogr√°fico de las regiones.\nSi ejecutamos esta tabla de datos, veremos que las regiones no est√°n ordenadas geogr√°ficamente:\nregiones # A tibble: 16 √ó 2 codigo_region nombre_region \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 Tarapac√° 2 2 Antofagasta 3 3 Atacama 4 4 Coquimbo 5 5 Valpara√≠so 6 6 Libertador General Bernardo O'Higgins 7 7 Maule 8 8 Biob√≠o 9 9 La Araucan√≠a 10 10 Los Lagos 11 11 Ays√©n del General Carlos Ib√°√±ez del Campo 12 12 Magallanes y de la Ant√°rtica Chilena 13 13 Metropolitana de Santiago 14 14 Los R√≠os 15 15 Arica y Parinacota 16 16 √ëuble Para ordenar geogr√°ficamente las regiones de Chile podemos crear una variable nueva, que use el c√≥digo de las regiones para asignar un nuevo n√∫mero que ordene las regiones de norte a sur:\nregiones_ordenadas \u0026lt;- regiones |\u0026gt; # agregar orden de regi√≥n de norte a sur mutate(orden_region = case_match(codigo_region, 15 ~ 1, 1 ~ 2, 2 ~ 3, 3 ~ 4, 4 ~ 5, 5 ~ 6, 13 ~ 7, 6 ~ 8, 7 ~ 9, 16 ~ 10, 8 ~ 11, 9 ~ 12, 14 ~ 13, 10 ~ 14, 11 ~ 15, 12 ~ 16 )) Se recomienda hacer este tipo de operaciones usando el c√≥digo de las regiones, para evitar problemas por las distintas formas de escribir el nombre de cada regi√≥n1. Pero si lo quieres hacer por el nombre de las regiones, ser√≠a as√≠:\nregiones_ordenadas \u0026lt;- regiones |\u0026gt; # agregar orden de regi√≥n de norte a sur mutate(orden_region = case_match(nombre_region, \u0026#34;Tarapac√°\u0026#34; ~ 2, \u0026#34;Antofagasta\u0026#34; ~ 3, \u0026#34;Atacama\u0026#34; ~ 4, \u0026#34;Coquimbo\u0026#34; ~ 5, \u0026#34;Valpara√≠so\u0026#34; ~ 6, \u0026#34;Libertador General Bernardo O\u0026#39;Higgins\u0026#34; ~ 8, \u0026#34;Maule\u0026#34; ~ 9, \u0026#34;Biob√≠o\u0026#34; ~ 11, \u0026#34;La Araucan√≠a\u0026#34; ~ 12, \u0026#34;Los Lagos\u0026#34; ~ 14, \u0026#34;Ays√©n del General Carlos Ib√°√±ez del Campo\u0026#34; ~ 15, \u0026#34;Magallanes y de la Ant√°rtica Chilena\u0026#34; ~ 16, \u0026#34;Metropolitana de Santiago\u0026#34; ~ 7, \u0026#34;Los R√≠os\u0026#34; ~ 13, \u0026#34;Arica y Parinacota\u0026#34; ~ 1, \u0026#34;√ëuble\u0026#34; ~ 10 )) Si ejecutamos la nueva tabla con la columna orden_region, vemos que sigue desordenada, as√≠ que la ordenamos:\nregiones_ordenadas |\u0026gt; arrange(orden_region) # A tibble: 16 √ó 3 codigo_region nombre_region orden_region \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 15 Arica y Parinacota 1 2 1 Tarapac√° 2 3 2 Antofagasta 3 4 3 Atacama 4 5 4 Coquimbo 5 6 5 Valpara√≠so 6 7 13 Metropolitana de Santiago 7 8 6 Libertador General Bernardo O'Higgins 8 9 7 Maule 9 10 16 √ëuble 10 11 8 Biob√≠o 11 12 9 La Araucan√≠a 12 13 14 Los R√≠os 13 14 10 Los Lagos 14 15 11 Ays√©n del General Carlos Ib√°√±ez del Campo 15 16 12 Magallanes y de la Ant√°rtica Chilena 16 ¬°Ahora s√≠ aparecen ordenadas geogr√°ficamente! ¬øPero qu√© pasa si hacemos un gr√°fico con estas regiones?\nlibrary(ggplot2) regiones_ordenadas |\u0026gt; ggplot() + aes(x = codigo_region, y = nombre_region, fill = codigo_region) + geom_col() + theme_minimal() Las regiones nuevamente aparecen desordenadas. ¬øPor qu√©? Porque {ggplot2}, la librer√≠a de visualizaci√≥n de datos que usamos, as√≠ como muchos otros paquetes, no se basan en en el orden de las filas de la base de datos que usemos, sino en el orden de la variable. Como la variable nombre_region es una variable de texto (tipo caracter), no tiene un orden, as√≠ que se asume que su orden es alfab√©tico (en el gr√°fico vemos que abajo est√°n las regiones que empiezan con A, porque el eje y nace desde el cero que est√° abajo y aumenta hacia arriba).\nLa soluci√≥n ser√≠a darle un orden a la variable. En R, las variables de texto que contienen informaci√≥n sobre su ordenamiento se llaman factores. Un factor es una variable categ√≥rica de tipo ordinal; es decir, una variable de texto que tiene categor√≠as de texto, pero que estas categor√≠as tienen un ordenamiento entre ellas: por ejemplo, bajo, medio y alto deber√≠an tener un orden de 1 a 3, de lo contrario se ordenar√≠an alfab√©ticamente y alto quedar√≠a antes que bajo.\nEl paquete {forcats} facilita todo tipo de trabajo con variables tipo factor o categ√≥ricas. Entre sus funciones est√° fct_reorder(), que nos permite ordenar una variable de texto en base al ordenamiento que nos da una variable num√©rica: en nuestro caso, ordenar el nombre_region en base al orden_region:\nlibrary(forcats) # ordenar variable a partir de una segunda variable num√©rica regiones_ordenadas_2 \u0026lt;- regiones_ordenadas |\u0026gt; mutate(nombre_region = forcats::fct_reorder(nombre_region, orden_region)) Si ahora volvemos a hacer el gr√°fico, la variable nombre_region s√≠ aparecer√° ordenada:\n# crear un gr√°fico regiones_ordenadas_2 |\u0026gt; ggplot() + aes(x = orden_region, y = nombre_region, fill = orden_region) + geom_col() + theme_minimal() + guides(fill = guide_none()) Naturalmente, las regiones aparecen al rev√©s, porque el eje y parte desde abajo y aumenta hacia arriba, entonces la primera regi√≥n (la de m√°s al norte) aparece abajo. Pero ser√≠a esperable que las regiones est√©n ordenadas de norte a sur y de arriba hacia abajo (en el hemisferio sur), as√≠ que podemos invertir el orden del factor:\nregiones_ordenadas_2 |\u0026gt; # invertir orden de la variable mutate(nombre_region = forcats::fct_rev(nombre_region)) |\u0026gt; ggplot() + aes(x = orden_region, y = nombre_region, fill = orden_region) + geom_col() + theme_minimal() + guides(fill = guide_none()) ¬°Listo! Si te sirve, ac√° dejo un dataframe con las regiones del pa√≠s, su c√≥digo y su orden, para que puedas copiarlo y pegarlo en tu script de R, y luego agregarlo a tus datos usando left_join():\n# regiones_ordenadas |\u0026gt; # datapasta::dpasta() tibble::tribble( ~codigo_region, ~nombre_region, ~orden_region, 1, \u0026#34;Tarapac√°\u0026#34;, 2, 2, \u0026#34;Antofagasta\u0026#34;, 3, 3, \u0026#34;Atacama\u0026#34;, 4, 4, \u0026#34;Coquimbo\u0026#34;, 5, 5, \u0026#34;Valpara√≠so\u0026#34;, 6, 6, \u0026#34;Libertador General Bernardo O\u0026#39;Higgins\u0026#34;, 8, 7, \u0026#34;Maule\u0026#34;, 9, 8, \u0026#34;Biob√≠o\u0026#34;, 11, 9, \u0026#34;La Araucan√≠a\u0026#34;, 12, 10, \u0026#34;Los Lagos\u0026#34;, 14, 11, \u0026#34;Ays√©n del General Carlos Ib√°√±ez del Campo\u0026#34;, 15, 12, \u0026#34;Magallanes y de la Ant√°rtica Chilena\u0026#34;, 16, 13, \u0026#34;Metropolitana de Santiago\u0026#34;, 7, 14, \u0026#34;Los R√≠os\u0026#34;, 13, 15, \u0026#34;Arica y Parinacota\u0026#34;, 1, 16, \u0026#34;√ëuble\u0026#34;, 10 ) Por ejempo, Valpara√≠so puede encontrarse como Regi√≥n de Valpara√≠so, De Valpara√≠so, V regi√≥n de Valpara√≠so, etc., y para qu√© hablar de O\u0026rsquo;Higgins\u0026hellip;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-06-06T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ordenar_regiones/","tags":"consejos ; mapas ; Chile","title":"Ordenar las regiones de Chile de norte a sur en R"},{"content":"En este tutorial aprenderemos a crear reportes parametrizados con Quarto. Un reporte parametrizado es un reporte dise√±ado para que el contenido, incluyendo textos, gr√°ficos y m√°s, cambien al modificar una variable en su encabezado. En este sentido, por par√°metro nos referimos a un valor que podremos cambiar para alterar el resultado obtenido por un mismo reporte.\nDe esta manera, podemos generar m√∫ltiples versiones de un mismo reporte simplemente cambiando el par√°metro, por ejemplo, para dise√±ar un reporte con datos para un pa√≠s, en base a un conjuntos de datos de m√∫ltiples pa√≠ses, y luego obtener m√∫ltiples versiones del mismo reporte pero para distintos pa√≠ses. O generar un reporte con datos de un a√±o espec√≠fico, y luego generar versiones del mismo reporte para distintos a√±os.\nSi quieres aprender a crear documentos Quarto desde cero, revisa este tutorial! Si tengo un reporte donde los resultados dependen de un filtro en mis datos, definimos el valor de la variable a filtrar en el encabezado bajo la etiqueta params:\nparams: especie: \u0026#34;virginica\u0026#34; El c√≥digo completo de un reporte parametrizado b√°sico, que define una variable especie en el encabezado, ser√≠a as√≠:\nLuego, en el c√≥digo del documento, puedo acceder al contenido de especie usando params$especie. La idea de un reporte parametrizado, entonces, es que sin tocar el c√≥digo del documento, puedo cambiar el valor de la variable parametrizada desde el encabezado del reporte.\nLa idea de poder hacer esto es dise√±ar el reporte para producir resultados en base a la variable parametrizada, para que podamos obtener m√∫ltiples reportes solamente cambiando la variable parametrizada.* De este modo, podemos obtener el reporte desde un script distinto con la funci√≥n quarto_render() del paquete {quarto}:\nlibrary(quarto) quarto_render( input = \u0026#34;iris_params.qmd\u0026#34;, execute_params = list( especie = \u0026#34;setosa\u0026#34; ) ) As√≠ solamente se necesita cambiar especie para obtener un reporte en .html listo para presentar. En otras palabras, desde un script secundario, puedo controlar la renderizaci√≥n del reporte, y general m√∫ltiples copias cambiando en esta funci√≥n generadora de reportes el valor de la variable parametrizado, sin tener que entrar en el reporte mismo y editarlo cada vez.\nEsto podr√≠a servir para tener un script que, ejecutando varias veces la funci√≥n quarto_render(), genere decenas de copias de mi reporte, pero mostrando versiones distintas o filtradas del mismo conjunto de datos.\nEl potencial de esto es que, m√°s all√° de facilitar la generaci√≥n de m√∫ltiples versiones de un reporte, se pueden generar x cantidad de reportes de una vez por medio de una iteraci√≥n o loop que pase por todos los valores de la variable que parametrizamos:\nwalk(c(\u0026#34;virginica\u0026#34;, \u0026#34;setosa\u0026#34;, \u0026#34;versicolor\u0026#34;), ~{ quarto_render( input = \u0026#34;iris_params.qmd\u0026#34;, output_file = paste0(\u0026#34;iris_params_\u0026#34;, .x, \u0026#34;.html\u0026#34;), execute_params = list( especie = .x ) ) }) Hay que asegurarse de que los nombres de los reportes generados sean distintos, cambi√°ndolos en output_file = paste0(\u0026quot;iris_params_\u0026quot;, .x, \u0026quot;.html\u0026quot;) para que tengan en su nombre el valor del par√°metro usado.\nTambi√©n hay que preocuparse de que los reportes sean autocontenidos conteniendo embed-resources: true en el encabezado.\nDe esta forma obtenemos tres reportes con el trabajo de haber dise√±ado s√≥lo uno. Pero si nuestra variable de parametrizaci√≥n tiene 10 o 100 valores, habremos obtenido 10 o 100 reportes gratis!\nEjemplo pr√°ctico: reporte parametrizado de resultados electorales Para dar un ejemplo de parametrizaci√≥n de reportes, crearemos un peque√±o documento Quarto que carga datos de las elecciones presidenciales de 2021 y genera un reporte que muestra un gr√°fico, un texto redactado en base a los datos, y una tabla. Este documento estar√° parametrizado por la regi√≥n del pa√≠s de la cual se desean obtener los resultados.\nparams: region_elegida: \u0026#34;Los R√≠os\u0026#34; Puedes descargar el documento Quarto en este enlace y ejecutarlo en tu propio computador, ya que los datos se descargan directamente desde el repositorio.\nEl c√≥digo del documento Quarto es el siguiente:\nPodemos renderizar el documento parametrizado directamente desde RStudio presionando Render, o bien, podemos generar el resultado usando la funci√≥n quarto_render(), desde la cual se puede especificar tambi√©n el par√°metro; es decir, la regi√≥n del pa√≠s de la que queremos obtener un reporte:\n# generar un solo reporte quarto_render(input = \u0026#34;reporte_elecciones_params.qmd\u0026#34;, execute_params = list(region_elegida = \u0026#34;Valpara√≠so\u0026#34;)) El reporte resultante:\nCon tan s√≥lo cambiar el par√°metro a una regi√≥n distinta, como \u0026quot;Los R√≠os\u0026quot;, obtenemos instant√°neamente un nuevo reporte basado en los datos de esta regi√≥n:\nC√≥mo en nuestros datos tenemos una variable que contiene todas las regiones del pa√≠s, podemos introducir todos los nombres de las regiones a un loop para que se generen tantos reportes como regiones existen en los datos:\n# cargar los datos para generar reportes en base a un par√°metro que viene desde los datos # datos \u0026lt;- readr::read_csv2(\u0026#34;quarto_clases/reporte_parametrizado/datos/presidenciales_2021_region.csv\u0026#34;) datos \u0026lt;- readr::read_csv2(\u0026#34;https://github.com/bastianolea/presidenciales_2021_chile/raw/main/datos_procesados/presidenciales_2021_region.csv\u0026#34;) # todos los valores de la variable parametrizada regiones \u0026lt;- unique(datos$region) library(purrr) # loop con purrr que genere un documento por cada valor de la variable parametrizada walk(regiones, ~{ quarto_render(input = \u0026#34;reporte_elecciones_params.qmd\u0026#34;, output_file = paste0(\u0026#34;reporte_elecciones_\u0026#34;, .x, \u0026#34;.html\u0026#34;), execute_params = list(region_elegida = .x)) }) Con el c√≥digo anterior obtuvimos 16 reportes, uno por cada regi√≥n del pa√≠s, con tan s√≥lo haber dise√±ado un reporte!\n","date":"2025-04-15T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/quarto_params/","tags":"quarto ; loops","title":"Automatiza la generaci√≥n de reportes creando documentos parametrizados con Quarto y R"},{"content":" √çndice Crear un reporte Quarto Markdown Otras posibilidades Separadores Enlaces Notas al pie de p√°gina Im√°genes Configuraci√≥n b√°sica T√≠tulos √çndices o tablas de contenido T√≠tulos con numeraci√≥n Temas Documento autocontenido Disposici√≥n Columnas Pesta√±as Contenido al margen C√≥digo C√≥digo entre el texto Quarto es una herramienta de publicaci√≥n de documentos que te permite generar reportes de manera muy sencilla, utilizando bloques de c√≥digo de R. En estos reportes puedes incluir tablas, gr√°ficos, y mucho m√°s para poder compartir tus an√°lisis y resultados con otras personas.\nPuedes leer este mismo tutorial directamente desde un reporte Quarto en este enlace, y tambi√©n puedes ver un documento de ejemplo hecho siguiendo los pasos de este tutorial en este otro enlace. Crear un reporte Quarto En RStudio, crear un nuevo archivo desde New File, y elegir Quarto Document.\nCuando hagamos los cambios que deseemos, presionamos el bot√≥n Render para generar el reporte a partir del c√≥digo. El reporte se abre en el visor Viewer, y quedar√° guardado como un archivo .html para abrirlo con un navegador web.\nEl formato .html es el mismo formato que se usa para crear la mayor√≠a de los sitios web, porque un reporte Quarto es b√°sicamente una p√°gina web local. Es una forma m√°s moderna, accesible, flexible e interactiva de crear documentos, a diferencia de formatos enfocados en la impresi√≥n como .pdf o formatos propietarios y editables como .docx.\nMarkdown Markdown es la forma de escritura principal usada en Quarto. Permite escribir texto enriquecido a partir de texto plano (c√≥digo), usando s√≠mbolos de marcado para definir el estilo del texto. M√°s informaci√≥n en esta gu√≠a.\nLo que hace Markdown es ayudarnos a escribir c√≥digo html con s√≠mbolos de marcado f√°ciles de recordar.\nAlgunos de los estilos b√°sicos que puedes darle al texto son los siguientes:\n**negrita** *it√°lica* o _it√°lica_ \u0026lt;u\u0026gt;subrayado\u0026lt;/u\u0026gt; ~~tachado~~ `c√≥digo` El uso de estos s√≠mboos de marcado resultar√≠an en los siguientes textos:\nnegrita\nit√°lica o it√°lica\nsubrayado\ntachado\nc√≥digo\nLos cuales a su vez se ven as√≠ porque internamente fueron traducidos a html!\nPara crear un t√≠tulo en tu documento, antepone un signo gato (#) al texto. Mientras m√°s signos gato pongas, el titular ser√° de un nivel menor; es decir, se volver√°n subt√≠tulos.\nOtras posibilidades Separadores Puedes insertar separadores escribiendo cuatro guiones. Estos resultan en una l√≠nea vertical, como la de encima del subt√≠tulo anterior.\n---- Enlaces Para agregar un enlace en Markdown, escrirbimos el texto del enlace entre corchetes, y luego el enlace al que queremos dirigir entre par√©ntesis:\n[Texto](http://enlace.cl) El enlace se ver√≠a as√≠. Naturalmente, puedes mezclar estilos de texto dentro de un enlace.\nNotas al pie de p√°gina Para agregar una nota al pie se escribe el n√∫mero de la nota entre corchetes, antecedido por el s√≠mbolo de super√≠ndice o potencia ^.\nEjemplo de una nota al pie1. Tambi√©n se puede agregar directamente en el texto2.\nAgregar una nota al pie[^1]. [^1]: Esta es una nota al pie Tambi√©n se puede agregar directamente en el texto^[De esta forma]. Im√°genes Agregar una imagen es similar a la forma de hacer un enlace, excepto que la direcci√≥n del enlace debe ser a un archivo de imagen en la misma carpeta que el archivo Quarto (.qmd), y debes antecederlo por un signo de exclamaci√≥n (!);\n![](mapache.jpeg) Puedes encontrar m√°s consejos b√°sicos sobre Markdown en esta gu√≠a.\nConfiguraci√≥n b√°sica Los documentos Quarto se configuran principalmente desde su encabezado o header. El encabezado es el c√≥digo que se encuentra en las primeras l√≠neas, escrito entre tres guiones (---). Este c√≥digo est√° escrito en lenguaje yaml, y permite configurar casi todos los aspectos de apariencia, funcionalidad y exportaci√≥n del documento.\nT√≠tulos Puedes cambiar el t√≠tulo del documento en la etiqueta title.\n--- title: \u0026#34;Probando\u0026#34; --- Tambi√©n puedes agregar autor√≠a y fecha, simplemente agregando las configuraciones debajo de las existentes:\n--- title: \u0026#34;Probando\u0026#34; author: \u0026#34;Basti√°n Olea Herrera\u0026#34; date: 2025-04-01 lang: es --- Puedes cambiar el texto que aparece arriba de alguna de las etiquetas. Sugiero buscar en internet este tipo de cosas, ya que Quarto tiene muy buena documentaci√≥n.\n--- lang: es language: title-block-author-single: \u0026#34;Creado por\u0026#34; --- Puedes personalizar el titular del documento con estas etiquetas, para cambiar el color de fondo del t√≠tulo y el color del texto:\n--- title-block-banner: \u0026#34;#f0f3f5\u0026#34; title-block-banner-color: \u0026#34;black\u0026#34; --- Para m√°s informaci√≥n sobre el bloque titular, revisa esta gu√≠a.\n√çndices o tablas de contenido A medida que agregas t√≠tulos Markdown, puedes agregar una tabla de contenidos que se actualizar√° autom√°ticamente con los t√≠tulos que vayas agregando. Para m√°s informaci√≥n, revisa esta otra gu√≠a.\nActiva la tabla de contenidos reemplazando el format de tu documento por uno personalizable:\nformat: html toc: true Personaliza el nivel de titulares que aparecen en la tabla de contenidos con toc-depth:\nformat: html toc: true toc-expand: 2 Tambi√©n poner enlaces debajo del √≠ndice, por ejemplo a tu sitio web o redes sociales. Los enlaces pueden tener un √≠cono personalizado.\nformat: html: other-links: - text: Enlace 1 href: https://data.nasa.gov/ - text: Enlace 2 icon: file-code href: https://data.nasa.gov/ T√≠tulos con numeraci√≥n Si tienes una estructura de t√≠tulos y subt√≠tulos compleja, puedes agregar numeraci√≥n a los t√≠tulos tanto en la tabla de contenidos como en los mismos t√≠tulos.\nPara que las secciones se numeren autom√°ticamente en la tabla de contenidos agrega number-sections.\nformat: html toc: true toc-expand: 2 number-sections: true Temas Configura el tema de tu reporte para cambiar su apariencia completa, incluyendo colores, espaciados, tipograf√≠as y m√°s. Revisa la lista de temas en este enlace.\nTan solo agregando theme y el nombre del tema (de la lista de temas) cambiar√°s la apariencia completa de tu reporte.\n--- theme: lux --- Temas Cosmo, Lux y Darkly Personaliza la tipograf√≠a y el tama√±o global de las letras:\n--- mainfont: Courier fontsize: \u0026#34;20px\u0026#34; --- Documento autocontenido Los reportes Quarto son archivos web, y como tales requieren de dependencias externas, como scripts, estilos e im√°genes, que se guardan como archivos. √âstos se guardan en una carpeta con el mismo nombre de tu reporte. Pero esto puede resultar inconveniente para compartir los documentos, adem√°s de generar desorden.\nPara que el documento no tenga dependencias externas, sino que sea portable y auto-contenido en un s√≥lo archivo .html, podemos hacer que el reporte contenga todas sus dependencias dentro de s√≠ agregando lo siguiente a la etiqueta format en el encabezado de nuestro documento:\nformat: html: embed-resources: true Recomiendo siempre usar esta opci√≥n, a pesar de que puede generar archivos m√°s pesados.\nDisposici√≥n Veamos algunas formas de personalizar la disposici√≥n de los reportes, como columnas, pesta√±as y contenido en los m√°rgenes. Para m√°s informaci√≥n, consulta esta gu√≠a oficial\nColumnas Para escribir contenido en columnas, debes crear un bloque (::::) con el estilo .columns, y dentro de √©l, crear dos secciones con el estilo .column indicando el porcentaje del ancho que tomar√°n:\n:::: {.columns} ::: {.column width=\u0026#34;40%\u0026#34;} Columna izquierda ::: ::: {.column width=\u0026#34;60%\u0026#34;} Columna derecha ::: :::: Si quieres agregar un espacio entre ambas columnas, crea una columna vac√≠a que sea m√°s delgada:\n:::: {.columns} ::: {.column width=\u0026#34;40%\u0026#34;} Columna izquierda ::: ::: {.column width=\u0026#34;5%\u0026#34;} ::: ::: {.column width=\u0026#34;55%\u0026#34;} Columna derecha ::: :::: Pesta√±as Para poner contenido dentro de pesta√±as, crea un bloque con el estilo .panel-tabset, y dentro de √©ste, todos los t√≠tulos Markdown que pongas (##, ###, etc.) aparecer√°n en su propia pesta√±a:\n::: {.panel-tabset} ## Pesta√±a 1 Contenido de la pesta√±a 1 ## Pesta√±a 3 Contenido de la pesta√±a 2 ## Pesta√±a 3 Contenido de la pesta√±a 3 ::: Si usas como estilo {.panel-tabset .nav-pills}, los botones de las pesta√±as aparecer√°n rellenados.\nContenido al margen Puedes agregar cualquier contenido en los m√°rgenes del documento, como f√≥rmulas, aclaraciones, o incluso tablas y gr√°ficos, usando un bloque con el estilo .aside:\n::: {.aside} \\ Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. Esto es un ejemplo. ::: C√≥digo La gracia de Quarto es combinar c√≥digo con texto. De esta forma puedes combinar tus procesos, an√°lisis y desarrollos con la presentaci√≥n de tus resultados en un mismo lugar.\nPara agregar c√≥digo, creamos bloques o chunks, en los que podemos escribir c√≥digo de R, y sus resultados aparecer√°n en el documento.\nlibrary(ggplot2) iris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width) + geom_point(color = \u0026#34;purple4\u0026#34;, alpha = 0.4, size = 4) + theme_minimal() Si queremos que no aparezca el c√≥digo, y s√≥lo aparezca el output, agregamos #| echo: false al inicio del bloque. De este modo s√≥lo saldr√° el resultado del c√≥digo, sin el c√≥digo mismo. Por ejemplo, si en un bloque pongo head(iris) pero agrego antes #| echo: false, s√≥lo saldr√° el resultado, sin el c√≥digo:\nSepal.Length Sepal.Width Petal.Length Petal.Width Species 1 5.1 3.5 1.4 0.2 setosa 2 4.9 3.0 1.4 0.2 setosa 3 4.7 3.2 1.3 0.2 setosa 4 4.6 3.1 1.5 0.2 setosa 5 5.0 3.6 1.4 0.2 setosa 6 5.4 3.9 1.7 0.4 setosa Algunas funciones u operaciones en R entregan mensajes adem√°s del resultado esperado. Por ejemplo, cuando ocurren warnings. Para omitir que los bloques impriman mensajes y/o alertas, agregamos #| message: false y #| warning: false respectivamente.\n```{r} #| message: false #| warning: false library(dplyr) ``` Para configurar el tama√±o de los gr√°ficos, agregamos al bloque las opciones #| fig-width: 4 y/o #| fig-height: 6 para modificar el ancho o alto, respectivamente. Por defecto, los gr√°ficos son de 7 x 5.\n```{r} #| message: false #| warning: false #| fig-width: 4 #| fig-height: 8 iris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width) + geom_point(color = \u0026#34;orange\u0026#34;, alpha = 0.4, size = 4) + theme_minimal() ``` C√≥digo entre el texto Para integrar c√≥digo en el texto de los p√°rrafos de tu reporte, por ejemplo, para insertar una cifra, escribimos comillas invertidas (`), la letra r, y el c√≥digo cuyo output queremos que aparezca en el documento:\nDe esta forma podemos agregar texto que proviene desde nuestros datos: el dataset iris tiene 5 variables que describen 3 especies de plantas.\nAprender a generar documentos Quarto es una herramienta que puede llevar tus habilidades de an√°lisis de datos al siguiente nivel. Con Quarto puedes presentar tu resultado de forma mucho m√°s atractiva, pero tambi√©n puedes aprender a automatizar much√≠simo trabajo relacionado a reportabilidad.\nSi quieres seguir aprendiendo Quarto, por ejemplo a automatizar reportes con documentos Quarto parametrizados, o a generar contenido autom√°ticamente para tus reportes usando loops, revisa las siguientes publicaciones de este blog en la etiqueta Quarto!\nNota al pie.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nDe esta forma\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-04-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/quarto_reportes/","tags":"quarto","title":"Tutorial: presenta los resultados de tus an√°lisis de datos con R creando reportes y documentos Quarto"},{"content":"Amamos el castellano, con sus tildes y e√±es, y nos encanta que R no tenga problemas para usar estos s√≠mbolos en cualquier parte del lenguaje. Pero hay veces en las que necesitamos deshacernos de estos s√≠mbolos especiales, como tildes, e√±es, e incluso may√∫sculas.\nPor ejemplo:\nSi queremos dar nombres a carpetas (porque puede dar conflictos con otros sistemas operativos o para subir archivos a internet), Si queremos buscar coincidencias de texto con stringr::str_detect() y queremos aumentar probabilidades de coincidir al omitir variaciones de los caracteres, Si queremos hacer un left_join() entre dos bases de datos con formas distintas de guardar los datos (todos en may√∫scula, todos sin tilde pero con e√±es, etc.) Hay muchas formas distintas de hacerlo, dependiendo de lo que necesitemos. El paquete {stringr} se enfoca en el procesamiento de texto y tiene varias funciones que nos pueden ayudar.\nlibrary(stringr) texto_esp \u0026lt;- \u0026#34;T√âxt√≥ con Pequ√â√±√±√±os c√°r√°ct√©r√©s ro√±osos\u0026#34; Eliminar caracteres espec√≠ficos Podemos usar str_remove_all() para eliminar todos los caracteres problem√°ticos, separ√°ndolos con el operador o (|):\nstr_remove_all(texto_esp, \u0026#34;√±|√°|√©|√≠|√≥|√∫\u0026#34;) [1] \u0026quot;T√âxt con Pequ√âos crctrs roosos\u0026quot; Pero vemos que no funciona con caracteres en may√∫scula. As√≠ que convertimos todo el texto a min√∫sculas primero:\nstr_remove_all(tolower(texto_esp), \u0026#34;√±|√°|√©|√≠|√≥|√∫\u0026#34;) [1] \u0026quot;txt con pequos crctrs roosos\u0026quot; Sigue sin ser una buena opci√≥n, porque se pierden demasiados caracteres.\nReemplazar caracteres espec√≠ficos Una mejor opci√≥n ser√≠a reemplazar los caracteres problem√°ticos por otros. Por ejemplo, reemplazar letras con tilde por sus versiones sin tilde. Para eso podemos usar str_replace_all(), que permite recibir un vector con las letras que queremos encontrar y un signo = con la letra que reemplazamos en casa caso:\nstr_replace_all(tolower(texto_esp), c(\u0026#34;√±\u0026#34;=\u0026#34;n\u0026#34;, \u0026#34;√°\u0026#34;=\u0026#34;a\u0026#34;, \u0026#34;√©\u0026#34;=\u0026#34;e\u0026#34;, \u0026#34;√≠\u0026#34;=\u0026#34;i\u0026#34;, \u0026#34;√≥\u0026#34;=\u0026#34;o\u0026#34;, \u0026#34;√∫\u0026#34;=\u0026#34;u\u0026#34;)) [1] \u0026quot;texto con pequennnos caracteres ronosos\u0026quot; Una forma m√°s larga pero m√°s flexible de hacer esta limpieza ser√≠a incluir reemplazos para caracteres tanto en may√∫scula como min√∫scula, as√≠ mantenemos la capitalizaci√≥n de los caracteres pero reemplazamos las versiones problem√°ticas por las versiones seguras:\nstr_replace_all(texto_esp, c(\u0026#34;√ë\u0026#34;=\u0026#34;√±\u0026#34;, \u0026#34;√Å\u0026#34;=\u0026#34;A\u0026#34;, \u0026#34;√â\u0026#34;=\u0026#34;E\u0026#34;, \u0026#34;√ç\u0026#34;=\u0026#34;I\u0026#34;, \u0026#34;√ì\u0026#34;=\u0026#34;O\u0026#34;, \u0026#34;√ö\u0026#34;=\u0026#34;U\u0026#34;, \u0026#34;√±\u0026#34;=\u0026#34;√±\u0026#34;, \u0026#34;√°\u0026#34;=\u0026#34;a\u0026#34;, \u0026#34;√©\u0026#34;=\u0026#34;e\u0026#34;, \u0026#34;√≠\u0026#34;=\u0026#34;i\u0026#34;, \u0026#34;√≥\u0026#34;=\u0026#34;o\u0026#34;, \u0026#34;√∫\u0026#34;=\u0026#34;u\u0026#34;)) [1] \u0026quot;TExto con PequE√±√±√±os caracteres ro√±osos\u0026quot; La gracia de este m√©todo es que t√∫ tienes todo el control sobre los reemplazos. En este caso, reemplazamos caracteres con tilde por versiones sin tilde, pero mantenemos las e√±es.\nTransliterar El paquete para procesamiento de texto {stringi} (no confundir con {stringr}) cuenta con la funci√≥n stri_trans_general(), que procesa texto para convertirlo o transliterarlo a otros sistemas de escritura. Para lo que necesitamos, podemos pedirle que translitere nuestro texto a ASCII (est√°ndar de texto plano, American Standard Code for Information Interchange):\nstringi::stri_trans_general(texto_esp, \u0026#34;Latin-ASCII\u0026#34;) # transliterar, pero remueve e√±es [1] \u0026quot;TExto con PequEnnnos caracteres ronosos\u0026quot; Esta forma es m√°s breve, pero menos flexible. Vemos, por ejemplo, que reemplaza las e√±es, sin darnos mucha flexibilidad.\nOtra opci√≥n podr√≠a ser la siguiente, que transforma los s√≠mbolos especiales por versiones de varios caracteres:\niconv(texto_esp, to = \u0026#34;ASCII//translit\u0026#34;) # elimina tildes pero los reaplica como s√≠mbolos individuales [1] \u0026quot;T'Ext'o con Pequ'E~n~n~nos c'ar'act'er'es ro~nosos\u0026quot; El resultado es extra√±o, pero puede ser que en ciertos casos nos sirva.\nEliminar s√≠mbolos El paquete {textclean} contiene varias funciones avanzadas para limpieza de texto. Una de ellas es strip(), que elimina todos los s√≠mbolos, pero preservando tildes.\ntexto_num \u0026lt;- \u0026#34;Hoy!!! S√∫per ricas **empanadas** a $1.000 pesos... √ëam √±am\u0026#34; textclean::strip(texto_num) [1] \u0026quot;hoy s√∫per ricas empanadas a pesos √±am √±am\u0026quot; El resultado es solamente texto, con tildes y con e√±es, pero sin s√≠mbolos ni n√∫meros. Esta funci√≥n s√≠ posee ciertas opciones para ajustar la limpieza; por ejemplo, no remover n√∫meros, y dejar s√≥lo s√≠mbolos espec√≠ficos:\ntextclean::strip(texto_num, digit.remove = FALSE, char.keep = c(\u0026#34;!\u0026#34;)) [1] \u0026quot;hoy!!! s√∫per ricas empanadas a 1000 pesos √±am √±am\u0026quot; ","date":"2025-03-31T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-03-31/","tags":"consejos ; texto ; limpieza de datos","title":"Limpiar textos con s√≠mbolos, tildes o e√±es en R"},{"content":"Cuando obtenemos una lista de palabras que obtuvimos desde nuestros datos, y queremos incluirlas en alg√∫n reporte \u0026mdash;ya sea como el t√≠tulo de un gr√°fico, el subt√≠tulo de un cap√≠tulo, o un texto din√°mico basado en los datos\u0026mdash; vamos a querer que est√©n redactadas correctamente: separadas por comas. La funci√≥n paste() sirve para unir distintos objetos de tipo texto.\npaste(\u0026#34;primera\u0026#34;, \u0026#34;segunda\u0026#34;) [1] \u0026quot;primera segunda\u0026quot; Si queremos unir las dos palabras, podemos especificar un separador:\npaste(\u0026#34;primera\u0026#34;, \u0026#34;segunda\u0026#34;, sep = \u0026#34;, \u0026#34;) # unir palabras, separadas por comas [1] \u0026quot;primera, segunda\u0026quot; Pero si las palabras las estamos extrayendo desde los datos, lo m√°s probable es que vengan dentro de un vector de texto, como el siguiente:\npalabras \u0026lt;- c(\u0026#34;verde\u0026#34;, \u0026#34;azul\u0026#34;, \u0026#34;morado\u0026#34;, \u0026#34;fuscia\u0026#34;) Entonces, la uni√≥n entre los elementos de un vector se realiza con el argumento collapse de paste():\npaste(palabras, collapse = \u0026#34;, \u0026#34;) [1] \u0026quot;verde, azul, morado, fuscia\u0026quot; Con esto obtenemos un vector de texto de largo 1, que contiene los elementos del vector anterior, pero unidos, separados por una coma. Pero podemos mejorar este resultado si escribimos un poco m√°s de c√≥digo para que la redacci√≥n de los elementos sea m√°s apropiada: separando el √∫ltimo elemento por la palabra y. Primero obtendremos el largo del vector de palabras length(). Luego usaremos este largo para seleccionar las palabras desde la primera a la pen√∫ltima.\nlargo \u0026lt;- length(palabras) palabras_a \u0026lt;- palabras[1:largo-1] print(palabras_a) # todas las palabras menos la √∫ltima [1] \u0026quot;verde\u0026quot; \u0026quot;azul\u0026quot; \u0026quot;morado\u0026quot; Volvemos a usar el largo para extraer solamente la √∫ltima palabra:\npalabras_b \u0026lt;- palabras[largo] print(palabras_b) # la √∫ltima palabra [1] \u0026quot;fuscia\u0026quot; Unimos el vector de las primeras palabras, separ√°ndolas con comas:\n# unir las primeras palabras separadas por comas palabras_a2 \u0026lt;- paste(palabras_a, collapse = \u0026#34;, \u0026#34;) Ahora que tenemos dos objetos, uno con las primeras palabras separadas por comas, y otro con la √∫ltima palabra, unimos ambos objetos, separ√°ndolos con la palabra y:\n# agregar la √∫ltima palabra separada por \u0026#34;y\u0026#34; palabras_redactadas \u0026lt;- paste(palabras_a2, palabras_b, sep = \u0026#34; y \u0026#34;) print(palabras_redactadas) [1] \u0026quot;verde, azul, morado y fuscia\u0026quot; C√≥mo resultado, obtenemos un c√≥digo que genera la redacci√≥n de cualquier cantidad de palabras que vengan en un vector de texto. Podemos formalizar este invento creando una funci√≥n que simplifique esta tarea:\nredactar_palabras \u0026lt;- function(palabras) { largo \u0026lt;- length(palabras) palabras_a \u0026lt;- palabras[1:largo-1] # primeras palabras palabras_b \u0026lt;- palabras[largo] #√∫ltima palabra # unir las primeras palabras separadas por comas palabras_a2 \u0026lt;- paste(palabras_a, collapse = \u0026#34;, \u0026#34;) # agregar la √∫ltima palabra separada por \u0026#34;y\u0026#34; palabras_redactadas \u0026lt;- paste(palabras_a2, palabras_b, sep = \u0026#34; y \u0026#34;) # retornar palabras redactadas return(palabras_redactadas) } Gracias a esta funci√≥n, ahora podemos lograr la redacci√≥n de las palabras de forma mucho m√°s f√°cil y clara:\nredactar_palabras(palabras) [1] \u0026quot;verde, azul, morado y fuscia\u0026quot; Dicho lo anterior, y gracias a lo extenso que es el ecosistema de R, quiz√°s resulta m√°s r√°pido usar una funci√≥n que hace exactamente lo mismo y que viene en {glue}, un paquete del Tidyverse:\nlibrary(glue) glue::glue_collapse(palabras, sep = \u0026#34;, \u0026#34;, last = \u0026#34; y \u0026#34;) verde, azul, morado y fuscia A veces nos podemos reinventar la rueda cuando ya existen soluciones üò£ Pero esto no es tiempo perdido si es que nos permite aprender cosas nuevas y/o poner en pr√°ctica nuestras habilidades ü•∞\n","date":"2025-03-30T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-03-30/","tags":"texto","title":"Redactar una lista de palabras separadas por comas en R"},{"content":" √çndice Crear un repositorio en GitHub para compartir c√≥digo y/o datos Conectar R a GitHub Crear un repositorio local Subir el repositorio local a GitHub Crear un archivo readme.md Documentos Quarto Documento Quarto en GitHub Pages Sitios web Quarto en GitHub Pages Crear el sitio web Quarto Agregar p√°ginas a tu sitio Cambiar temas Publicar el sitio en GitHub Pages Blogs Quarto en GitHub Pages Crear un blog Quarto Agregar posts al blog Quarto Subir el blog Quarto a GitHub Pages Blog Hugo Apps Shiny Recursos: En este tutorial veremos cuatro formas relativamente sencillas, y ordenadas de menor a mayor dificultad, para crear nuestros propios espacios en internet para compartir nuestras creaciones, aprendizajes y qui√©nes somos usando R, y de forma completamente gratuita.\nEn una tarde podr√≠as tener tu propio sitio web para presentarte, para subir las cosas que has aprendido, o para destacar tu trabajo!\nSi quieres aprender a crear documentos Quarto desde cero, revisa este tutorial! Los contenidos son:\nCrear repositorios en GitGub Crear documentos Quarto Crear p√°ginas est√°ticas a partir de documentos Quarto con GitHub Pages Crear sitios web con Quarto Crear blogs con Quarto Crear blogs con Hugo Ap√©ro Lo m√°s probable es que todas las cosas que hemos aprendido sobre R y an√°lisis de datos fueron porque alguna persona linda y bondadosa comparti√≥ gratuita y abiertamente lo que sab√≠a o lo que cre√≥, para que los dem√°s se beneficien. Uno de los aspectos m√°s positivos de la comunidad de usuarixs de R es su disposici√≥n a compartir y ayudar a los dem√°s üíï ¬øPor qu√© no devolver la mano? ü•∞\nAntes que nada, todas las opciones de este tutorial requieren que sepas usar GitHub, para poder subir tus proyectos de R a GitHub. As√≠ que, para empezar, te resumir√© las instrucciones necesarias para hacerlo. Encuentra instrucciones m√°s detalladas sobre usar git y GitHub con R en este tutorial.\nCrear un repositorio en GitHub para compartir c√≥digo y/o datos Quiz√°s la forma m√°s sencilla de poder compartir en internet tus trabajos, desarrollos, o aprendizajes en R, es creando un repositorio de c√≥digo abierto en GitHub. En los reposos dormitorios, las personas dan a conocer el c√≥digo que producen, ofreci√©ndoselo a los dem√°s para que puedan reutilizarlos en sus propios proyectos, ya sean utilidades, an√°lisis de datos, clases o tutoriales, o incluso conjuntos de datos y paquetes de R.\nEn este primer paso del tutorial, aprenderemos a crear un repositorio local git para tus proyectos de R, y luego subir este repositorio local a un repositorio remoto en GitHub para poder compartirlo y que otrxs puedan encontrarlo.\nConectar R a GitHub Tutorial m√°s detallado sobre esto escrito por mi Libro tutorial para aprender a usar git con R: https://happygitwithr.com Para poder crear tus reposos remotos, primero tenemos que darle permiso a tu sesi√≥n de R para conectarse a tu cuenta de GitHub.\nGitHub es una plataforma online donde las personas pueden subir sus repositorios de Git, permitiendo a otros acceder a su c√≥digo, y contribuir a los repositorios, entre muchas otras funcionalidades.\nEl primer paso es instalar {usethis}, un paquete de R que automatiza muchas tareas repetitivas que se hacen al configurar tus proyectos.\ninstall.packages(\u0026#34;usethis\u0026#34;) Gracias a este paquete, los siguientes pasos se vuelven mucho m√°s sencillos:\n1. Configurar nombre de usuario y correo Luego, tienes que registrar cu√°l es tu cuenta de GitHub.\nusethis::use_git_config(user.name = \u0026#34;Basti\u0026#34;, user.email = \u0026#34;baolea@uc.cl\u0026#34;) 2. Crear un token en GitHub para permitir el acceso de R a tu cuenta Es necesario hacer esto para permitir que tu computador pueda usar tu cuenta de GitHub. Se hace por medio de tokens para no tener que escribir tu contrase√±a. Es una medida m√°s segura para poder iniciar sesi√≥n en un servicio online, porque adem√°s siempre puedes revocar la autorizaci√≥n desde tu cuenta de GitHub.\nusethis::create_github_token() Se abrir√° una ventana de GitHub en la que podr√°s generar y copiar el token. Ejecuta la siguiente funci√≥n, y cuando la consola te lo indique, pega el token que copiaste:\ngitcreds::gitcreds_set() 4. Confirmar que est√° funcionando bien: Con la siguientes funci√≥n obtendremos una especie de diagn√≥stico sobre la conexi√≥n con nuestra cuenta, para confirmar que todo est√© funcionando bien.\nusethis::git_sitrep() Crear un repositorio local Luego de haber configurado tu cuenta, puedes empezar a crear repositorios en tus proyectos de R. Recuerda que en cada proyecto puede haber un solo repositorio.\nusethis::use_git() Al ejecutar este comando, tu consola indicar√° cu√°les son los archivos modificados, y preguntar√° si quieres hacer commit de tus archivos. Commit significa agregar los archivos modificados a la versi√≥n del proyecto que guardaremos/respaldaremos.\nDe esta forma, activaste el control de versiones de git en tu proyecto de RStudio, lo que significa que tienes un repositorio local.\nSubir el repositorio local a GitHub Luego de tener el repositorio local, ahora toca subirlo como repositorio remoto a GitHub, para poder compartirlo con otrxs.\nusethis::use_github() Con este comando se crear√° un repositorio remoto en tu cuenta de GitHub con el mismo nombre que el proyecto, y se abrir√° una ventana de tu navegador con el repositorio subido. Este repositorio puedes envi√°rselo a otras personas, y ellos pueden clonar el repositorio en sus propias sesiones de R para poder ejecutar tu mismo c√≥digo.\nCrear un archivo readme.md Si tu proyecto/repositorio tiene un archivo readme.md, aparecer√° en GitHub como descripci√≥n del c√≥digo. Puedes usar este documento para explicar m√°s detalles acerca de lo que se trata el repositorio, dar instrucciones, especificar el orden de ejecuci√≥n de los scripts, indicar tus fuentes, etc.\nusethis::use_readme() Con el solo hecho de tener un archivo readme.md en tu repositorio ya cuentas con una especie de sitio web donde puedes explayarte y compartir cosas m√°s detalladas. Si bien no es la forma m√°s atractiva de hacerlo, cumple con la funci√≥n b√°sica de poder compartir tus creaciones con el resto de la comunidad! üíú\nSi necesitas m√°s informaci√≥n acerca del uso de git y GitHub con R, revisa el tutorial: Crear un repositorio Git para tu proyecto de R y comparte tu c√≥digo en GitHub\nDocumentos Quarto Los documentos Quarto combinan la escritura normal con el c√≥digo. La escritura, como los p√°rrafos, t√≠tulos, y subt√≠tulos se escriben usando la sintaxis markdown, un lenguaje de marcado que nos permite traducir textos en html usando sencillos s√≠mbolos.\nSi necesitas una gu√≠a m√°s detallada para aprender a crear documentos Quarto desde cero, incluyendo la inclusi√≥n de c√≥digo en reportes, personalizaci√≥n y m√°s, revisa este tutorial! Los reportes de Quarto suelen ser en formato PDF o HTML, siendo HTML el formato m√°s recomendado, porque adem√°s de ser m√°s compatible, permite ciertos elementos de interacci√≥n en tu reporte, como √≠ndices, barras de men√∫, pesta√±as, selectores, enlaces, y m√°s.\nPara crear un documento Quarto, en el men√∫ File elige New File y luego Quarto Document.\nSe abrir√° un documento de ejemplo que puedes usar como base para tus propios documentos. En este caso, agregamos un chunk con un gr√°fico sencillo, y presionamos el bot√≥n Render para generar el documento en html:\nComo vemos, obtenemos tres archivos en nuestro proyecto: el archivo .qmd que contiene el c√≥digo que genera el documento, el documento renderizado en formato html, y una carpeta que contiene recursos necesarios para visualizar el documento: El problema es que esta carpeta, que contiene cosas como im√°genes (de los gr√°ficos), estilos y scripts, dificultan la portabilidad del documento y la posibilidad de compartirlo con otros.\nLa buena noticia es que podemos generar un reporte Quarto autocontenido; es decir, que no se requieran archivos externos al documento html. Agregamos el siguiente c√≥digo al header del documento Quarto, en reemplazo del format: html:\nformat: html: embed-resources: true Hay que tener cuidado de que se respeten los espacios en blanco para que funcione bien. Si eliminas el reporte en html y la carpta _files y le das render nuevamente al documento Quarto, ver√°s que ahora se genera solamente el reporte en html, listo para poder ser compartido!\nDocumento Quarto en GitHub Pages Si tenemos un reporte en formato html, el salto a generar una p√°gina web est√°tica que puedas compartir con otras personas es muy sencillo de hacer. Para esto, podemos usar GitHub Pages para hacer que nuestro documento Quarto se transforme en una p√°gina de internet que otras personas pueden visitar tan s√≥lo con entrar al enlace.\nCon un reporte publicado como p√°gina web en GitHub Pages, en vez de enviar un documento por correo o similares, podremos hacer que el documento est√© disponible en una direcci√≥n web fija para que otras personas puedan verlo en l√≠nea.\nBeneficios:\nNo necesitas enviar tu reporte como un archivo adjunto No es necesario preocuparse si tu reporte contiene cientos de gr√°ficos o es muy pesado, ya que estar√° online Si necesitas modificar o actualizar algo de tu reporte, puedes hacer los cambios y actualizar tu reporte cuando quieras Las personas que tengan el enlace tendr√°n siempre la versi√≥n actualizada de tu reporte La publicaci√≥n de tu reporte es autom√°tica: subes los cambios a GitHub y tu reporte se actualizar√° en unos minutos El alojamiento online de tu reporte es gratuito Para hacer esto, necesitamos configurar primero el documento Quarto, subir nuestro documento Quarto a un repositorio de GitHub, y configurar el repositorio para que genere una p√°gina web est√°tica a partir del documento. Todas estas instrucciones est√°n detalladas en esta gu√≠a oficial, pero a continuaci√≥n te resumo lo principal.\nLa configuraci√≥n del documento Quarto consiste revisar el nombre del archivo, y en agregar un archivo de configuraci√≥n a nuestro proyecto que har√° que se guarden los archivos necesarios en una sola carpeta.\nEsto es importante, porque as√≠ GitHub Pages sabr√° que √©ste es el documento espec√≠fico que queremos que sea nuestra p√°gina web.\nRevisemos el nombre del documento Quarto*. Para que nuestro documento Quarto se publique como una p√°gina GitHub Pages, debe llamarse index.qmd (para que se genere un documento index.html), o bien, puede llamarse como queramos, pero agregando el siguiente c√≥digo al header yaml del documento Quarto:\nformat: html: output-file: \u0026#34;index\u0026#34; De este modo, el documento html resultante de nuestro documento Quarto se llamar√° index.html.\nEl siguiente paso de configuraci√≥n implica agregar un archivo de configuraci√≥n al proyecto. En el panel de archivos (File) de RStudio, presionamos el bot√≥n New File y creamos un archivo de texto en blanco, llamado _quarto.yml:\nEn _quarto.yml, pegamos el siguiente c√≥digo de configuraci√≥n:\nproject: output-dir: docs Con esta configuraci√≥n le estamos pidiendo Quarto que guarde los recursos que necesita dentro de una carpeta docs, que es lo que necesitamos para generar nuestra p√°gina web.\nSi le damos render al documento Quarto, se generar√° la carpeta docs con los recursos necesarios dentro.\nOtra configuraci√≥n que debemos crear para GitHub Pages se hace mediante la creaci√≥n de un archivo vac√≠o. En el proyecto desde RStudio creamos un nuevo archivo que se llame .nojekyll, y que est√© vac√≠o. Este archivo es para decirle a GitHub Pages que no procese el sitio con Jekyll, porque del sitio nos encargamos nosotres.\nAhora tenemos que subir estos cambios al repositorio remoto GitHub. En la pesta√±a Terminal de RStudio (al lado de la consola) ejecutamos los tres siguientes comandos:\ngit add . git commit -m \u0026#34;documento quarto en docs\u0026#34; git push Con el primer comando le pedimos que todos los archivos nuevos sean considerados para el commit, con el segundo creamos el commit y le damos un mensaje, y con el tercero hacemos push para subir los cambios al repositorio remoto.\nSi vamos a GitHub debiesen estar nuestros nuevos archivos arriba. Ahora vamos a configurar GitHub para que genere una p√°gina web a partir del documento Quarto. Vamos a la seccion Settings:\nDentro de Settings, en el men√∫ izquierdo vamos a Pages. Dentro de Pages, tenemos que seleccionar la rama del repositorio que queremos usar (usualmente main o master), y especificar que queremos apuntar a la carpeta /docs. Luego presionamos Save.\nSe tomar√° unos segundos o minutos en generar la p√°gina web, pero luego aparecer√° el siguiente mensaje que te permitir√° acceder al sitio:\n¬°Listo! Ahora puedes compartir tu p√°gina con todo el mundo. El enlace ser√° algo como https://usuario.github.io/repositorio/\nOjo que con este m√©todo s√≥lo podremos publicar un documento Quarto por repositorio.\nPuedes ver las instrucciones completas para este proceso en esta gu√≠a oficial.\nSitios web Quarto en GitHub Pages Otra opci√≥n que tenemos para construir sitios m√°s completos, pero tambi√©n basados en documentos Quarto, donde podamos combinar texto y c√≥digo, es crear un sitio web Quarto.\nCon esta modalidad de documentos Quarto podemos crear un sitio web con m√∫ltiples secciones, enlaces, p√°gina de presentaci√≥n, y m√°s, que te puede servir como un espacio en Internet para presentarte y que otras personas te encuentren, y puedan conocer tu trabajo y trayectoria.\nCrear el sitio web Quarto Al crear un nuevo proyecto desde RStudio podemos elegir la opci√≥n Quarto Website:\nSe abrir√°n una nueva sesi√≥n de R y veremos que nuestro proyecto ya viene con varios archivos dentro. Primero que nada, presionemos Render para previsualizar lo que tenemos como base:\nEl proyecto ya viene con un sitio web funcional, que podemos explorar. Viene con dos p√°ginas por defecto, index.qmd y about.qmd. Ambas puedes modificarlas a tu gusto con el contenido que desees.\nEstas p√°ginas aparecen en la barra de navegaci√≥n (arriba del sitio web, o en el lado izquierdo si la pantalla/ventana es peque√±a), para que tus usuarios puedan acceder a ellas.\nAgregar p√°ginas a tu sitio Para agregar nuevas p√°ginas al sitio, simplemente creamos nuevos documentos Quarto normalmente (New File, Quarto Document). Para hacer que sean agregados a la barra de navegaci√≥n, entra al archivo de configuraci√≥n de tu sitio, _quarto.yml. En este archivo, ver√°s la configuraci√≥n general de tu sitio:\nwebsite: title: \u0026#34;tutorial_sitio_web_quarto\u0026#34; navbar: left: - href: index.qmd text: Home - about.qmd Esa es la lista de p√°ginas de tu sitio web. Al igual como sale hecho con la p√°gina about.qmd, si agregas ah√≠ el nombre de un documento Quarto nuevo, ser√° agregado a la barra de navegaci√≥n.\nEstas p√°ginas tambi√©n pueden ser enlaces a cualquier otro sitio web. Por ejemplo, si quieres agregar un enlace a tu GitHub o a alguna red social, haz lo siguiente:\nwebsite: title: \u0026#34;tutorial_sitio_web_quarto\u0026#34; navbar: left: - href: index.qmd text: Home - about.qmd - icon: github href: https://github.com/bastianolea - icon: linkedin href: https://www.linkedin.com/in/bastianolea/ Los enlaces aparecer√°n con los logos de las redes sociales que definas! S√≥lo recuerda que los enlaces tienen que empezar con https://.\nCambiar temas Dentro del mismo documento _quarto.yml puedes cambiar el tema de tu sitio web, para darle un toque m√°s personalizado. Puedes elegir entre 25 temas, que puedes conocer en esta gu√≠a.\nformat: html: theme: lux css: styles.css toc: true La p√°gina about.qmd tambi√©n puede personalizarse.\nPublicar el sitio en GitHub Pages Para publicar el sitio en GitHub Pages tenemos que seguir las mismas instrucciones para publicar en GitHub Pages que seguimos en el paso anterior:\nPrimero, en el archivo de configuraci√≥n _quarto.yml agregamos output-dir: docs debajo de project: y hacemos Render al documento index.qmd.\nTambi√©n podemos ejecutar quarto render desde la pesta√±a de Terminal para reconstruir el sitio completo.\nEn el proyecto desde RStudio, creamos un nuevo archivo vac√≠o que se llame .nojekyll, para decirle a GitHub Pages que no procese el sitio con Jekyll. Si no haces esto, cuando entres a un post del blog te aparecer√° un error 404! üò®\nLuego debemos hacer que nuestro proyecto sea un repositorio git (usethis::use_git()) y subir el repositorio a GitHub (usethis::use_github()), o si ya era un repositorio git y ya estaba en GitHub, hacer git add., git commit -m \u0026quot;actualizacion\u0026quot;, y git push desde la pesta√±a Terminal.\nUna vez que subimos nuestros cambios al repositorio remoto, vamos al repositorio en GitHub, Settings, Pages, y configuramos el repositorio para que genere la p√°gina desde /docs:\nSiguiendo estas instrucciones ya tendr√°s tu sitio web b√°sico listo! ¬°Y gratis! ü•≥ Ahora s√≥lo falta hacerlo crecer agregando p√°ginas, enlaces, y toda la informaci√≥n que quieras.\nBlogs Quarto en GitHub Pages Una tercera opci√≥n para presentarte al mundo por internet usando Quarto es crear un blog Quarto.\nUn blog funciona casi igual que un sitio web Quarto, con la diferencia de que el contenido est√° centrado en m√∫ltiples documentos Quarto que poseen m√°s metadatos que le permiten agruparlos en categor√≠as, en base a etiquetas, y ordenarlos por fechas. De este modo, tendr√°s un sitio web de presentaci√≥n pero al que adem√°s podr√°s ir subi√©ndole contenido peri√≥dicamente para ir compartiendo las cosas que haces.\nRecordemos que todo lo que hemos aprendido sobre R ha sido gracias a personas que han querido compartir lo que saben, as√≠ que an√≠mate a compartir lo que aprendes y lo que has creado!\nCrear un blog Quarto Crear un nuevo proyecto desde RStudio, elegimos la opci√≥n Quarto Blog:\nDe la misma forma que cuando creamos el sitio web Quarto, el proyecto aparecer√° con los archivos necesarios para tener un blog m√≠nimo. Si presionamos Render podremos provisionar nuestro blog:\nAgregar posts al blog Quarto El funcionamiento del blog es id√©ntico al del sitio web, con la distinci√≥n de que la idea es ir agregando publicaciones.\nDentro de la carpeta posts veremos que se encuentran las dos publicaciones de ejemplo que vienen con el proyecto. Si abrimos una de ellas, veremos que en su encabezado posee los metadatos que caracterizan a cada publicaci√≥n:\n--- title: \u0026#34;Mi primera publicaci√≥n en mi blog Quarto\u0026#34; author: \u0026#34;Basti√°n Olea\u0026#34; date: \u0026#34;2025-03-28\u0026#34; categories: [noticias, R, programaci√≥n] image: \u0026#34;image.jpg\u0026#34; --- Entonces, para crear una nueva publicaci√≥n, creamos una carpeta dentro de posts (el nombre de la carpeta ser√° la direcci√≥n de la publicaci√≥n), y dentro de la carpeta creamos un documento Quarto llamado index.qmd con un encabezado que contenga t√≠tulo, autor, fecha, y etiquetas.\nSi presionamos Render para generar el post, veremos que en el panel Viewer de RStudio se previsualiza nuestro blog!\nSubir el blog Quarto a GitHub Pages Nuevamente, las instrucciones para hacer que nuestro blog aparezca GitHub Pages son las mismas:\nEn _quarto.yml agregamos output-dir: docs debajo de project:. En el proyecto, creamos un nuevo archivo que se llame .nojekyll, vac√≠o (para decirle a GitHub Pages que no procese el sitio con Jekyll) En la pesta√±a de terminal ejecutamos quarto render para construir el sitio completo. Creamos un repositorio git (usethis::use_git()) Subimos el repositorio a GitHub (usethis::use_github()) En GitHub, entramos a Settings, luego a Pages, y configuramos el repositorio para que genere la p√°gina desde /docs Siguiendo estas instrucciones ya tendr√°s tu sitio web b√°sico listo! ¬°Y gratis! ü•≥ Ahora s√≥lo falta hacerlo crecer agregando p√°ginas, enlaces, y toda la informaci√≥n que quieras.\nInstrucciones para subir a GitHub: https://quarto.org/docs/publishing/github-pages.html#render-to-docs\nInstrucciones para subir a Netlify: https://beamilz.com/posts/2022-06-05-creating-a-blog-with-quarto/en/#deploy-with-netlify\nBlog Hugo Un blog Hugo es otra forma de crear un blog desde R, que tambi√©n utiliza documentos Quarto, pero cuyo sistema de construcci√≥n es distinto. Al ser creados con Hugo, resultan sitios mucho m√°s personalizables, pero por lo mismo tambi√©n pueden ser m√°s complejos de mantener.\nComo ejemplo, mi propio sitio web lo cre√© con Hugo, y detall√© parte del proceso en un post.\nLas instrucciones de este proceso se escapan un poco al objetivo de esta gu√≠a, pero les dejo el siguiente enlace, que corresponde al tutorial oficial para crear un blog Hugo con el tema Ap√©ro, que detalla paso por paso todas las acciones que hay que hacer para construir un blog con Hugo, personalizarlo, y publicarlo usando Netlify.\nCabe mencionar que el tutorial mismo est√° construido en un blog Hugo Ap√©ro.\nTambi√©n recomiendo este libro, Create, Publish, and Analyze Personal Websites Using R and RStudio, que detalla todas las instrucciones de crear un sitio web con R y Hugo.\nEn resumidas cuentas, las instrucciones son:\nCrear un nuevo proyecto de R install.packages(\u0026quot;blogdown\u0026quot;) blogdown::install_hugo() Y ejecutar lo siguiente para crear tu blog Hugo Ap√©ro: library(blogdown) new_site(theme = \u0026#34;hugo-apero/hugo-apero\u0026#34;, format = \u0026#34;toml\u0026#34;, sample = FALSE, empty_dirs = TRUE) Luego ejecutas blogdown::serve_site() para previsualizar el blog creado.\nPara crear un post nuevo, tenemos una conveniente funci√≥n que nos ayuda:\n# crear un post blogdown::new_post(title = \u0026#34;Nubes aleatorias en ggplot\u0026#34;, subdir = \u0026#34;blog/\u0026#34;, file = \u0026#34;blog/ggplot_nubes/index.md\u0026#34;, # define el \u0026#34;slug\u0026#34;, la direcci√≥n url del post author = \u0026#34;Basti√°n Olea Herrera\u0026#34;, tags = c(\u0026#34;ggplot2\u0026#34;, \u0026#34;gr√°ficos\u0026#34;, \u0026#34;curiosidades\u0026#34;)) Apps Shiny Las aplicaciones Shiny son formas mucho m√°s avanzadas y flexibles para poder compartir desarrollos en R con el mundo. Se trata de aplicaciones web completamente personalizables y que adem√°s son interactivas; significa que detr√°s de la aplicaci√≥n web existe un proceso de R que est√° haciendo los c√°lculos para entregar resultados en tiempo real a sus usuarios.\nAc√° te dejo dos tutoriales para aprender a usar Shiny:\nTutorial Shiny Tutorial publicar en Shinyapps Y comparto tambi√©n un sitio m√≠o (creado con Quarto y alojado en GitHub Pages) para mostrar aplicaciones Shiny qeu he creado.\nRecursos: Tutorial Git con R Tutorial GitHub Pages Tutorial Quarto Tutorial sitios web Quarto Temas Quarto Tutorial Blog Quarto Tutorial Quarto y Netlifly Este contenido fue impartido en el marco de una charla abierta organizada por el Grupo de Usuarios de R de Madrid. ¬°Muchas gracias por invitarme!\n","date":"2025-03-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_quarto_github_pages/","tags":"quarto ; shiny ; git ; GitHub","title":"Tutorial: crea p√°ginas web y blogs con R+Quarto, y publ√≠calos online con GitHub Pages"},{"content":" El paquete {patchwork} ayuda a unir y combinar gr√°ficos de {ggplot2}. En esta gu√≠a veremos los principios del uso de este paquete, que nos permitir√° construir visualizaciones m√°s complejas\n√çndice Combinar dos gr√°ficos lado a lado Combinar dos gr√°ficos uno arriba del otro Combinar m√°s de dos gr√°ficos Poner un gr√°fico dentro de otro library(dplyr) library(ggplot2) library(patchwork) Primero crearemos dos gr√°ficos de muestra, a partir del dataset iris.\ngrafico_a \u0026lt;- iris |\u0026gt; # calcular promedios por especie group_by(Species) |\u0026gt; summarize(Sepal.Length = mean(Sepal.Length)) |\u0026gt; # gr√°fico ggplot() + aes(x = Sepal.Length, y = Species) + # barras geom_col(fill = \u0026#34;darkslategray3\u0026#34;, width = 0.6) + theme_void() grafico_b \u0026lt;- iris |\u0026gt; # conteo por especies count(Species) |\u0026gt; # porcentaje mutate(p = n/sum(n)) |\u0026gt; # gr√°fico ggplot() + aes(x = 1, y = p, fill = Species) + geom_col() + # escala de color scale_fill_brewer(name = \u0026#34;Set2\u0026#34;, type = \u0026#34;qual\u0026#34;) + # gr√°fico de torta coord_polar(theta = \u0026#34;y\u0026#34;) + theme_void() + guides(fill = guide_legend(title = NULL)) Combinar dos gr√°ficos lado a lado Gracias a {patchwork}, unir dos gr√°ficos uno al lado del otro es tan sencillo como \u0026ldquo;sumarlos\u0026rdquo;:\ngrafico_a + grafico_b Si queremos ajustar las proporciones de los gr√°ficos, agregamos la funci√≥n plot_layout() para especificar las proporciones. Haremos que uno de los gr√°ficos sea el doble de ancho que el otro:\ngrafico_a + grafico_b + plot_layout(widths = c(1, 2)) Combinar dos gr√°ficos uno arriba del otro Para combinar dos gr√°ficos en disposici√≥n vertical; es decir, uno arriba del otro, bsata con \u0026ldquo;dividir\u0026rdquo; los dos gr√°ficos:\ngrafico_a / grafico_b Combinar m√°s de dos gr√°ficos Creemos un tercer gr√°fico de nuestra para probar la combinaci√≥n de tres gr√°ficos en uno solo:\ngrafico_c \u0026lt;- iris |\u0026gt; ggplot() + geom_bar(aes(Petal.Width, fill = Species)) + scale_fill_brewer(name = \u0026#34;Set2\u0026#34;, type = \u0026#34;qual\u0026#34;) + scale_y_continuous(expand = expansion(c(0, 0.1))) + theme_void() + guides(fill = guide_legend(title = NULL)) Teniendo dos gr√°ficos, podemos disponerlos uno al lado dle otro, y el tercer gr√°fico debajo de los dos primeros; es decir, sumar a + b y luego dividirlos por c:\n(grafico_a + grafico_b) / grafico_c + plot_layout(guides = \u0026#34;collect\u0026#34;) En este caso agregamos una funci√≥n plot_layout() para combinar las leyendas de dos de los gr√°ficos, dado que las leyendas son iguales y ser√≠a redundante que cada gr√°fico las presente por separado.\nPara ajustar las proporciones en este caso, podemos primero crear la fila 1 del gr√°fico final, ajustando su proporci√≥n, y luego a esta fila agregarle el gr√°fico de abajo:\nfila_1 \u0026lt;- grafico_a + grafico_b + plot_layout(widths = c(3, 1)) fila_1 / grafico_c + plot_layout(guides = \u0026#34;collect\u0026#34;) Poner un gr√°fico dentro de otro grafico_d \u0026lt;- iris |\u0026gt; ggplot() + geom_bar(aes(x = 1), alpha = 0.6) + coord_polar(theta = \u0026#34;y\u0026#34;) + theme_void() Tambi√©n podemos necesitar insertar un gr√°fico dentro de otro, quiz√°s porque uno de los gr√°ficos representa un detalle del otro, y como tal puede que sea m√°s conveniente disponerlo dentro del primero.\nPara insertar un gr√°fico dentro de otro, se agrega a un gr√°fico la funci√≥n inset_element() con el gr√°fico que queremos insertar. Dentro de esta funci√≥n hay que definir los argumentos top, bottom, left y right, que corresponden al per√≠metro en el que se ubicar√° el gr√°fico insertado.\nPara ubicar el gr√°fico dentro, debemos entender que el l√≠mite superior del gr√°fico corresponde a top = 1, y el inferior a bottom = 0, mientras que el l√≠mite izquierdo es left = 0 y el derecho es right = 1. Si usamos estos argumentos, el gr√°fico insertado usar√≠a la totalidad del espacio del gr√°fico base:\ngrafico_c + inset_element(grafico_d, top = 1, bottom = 0, left = 0, right = 1) Notemos que las coordenadas corresponden con el centro del √°rea del gr√°fico, excluyendo el √°rea de la leyenda.\nSi ponemos que top = 0.5y right = 0.5, entonces el borde superior del gr√°fico insertado estar√° en la mitad del alto del gr√°fico base, y el borde derecho en la mitad del ancho; es decir, ubic√°ndolo en la esquina inferior izquierda.\ngrafico_c + inset_element(grafico_d, top = 0.5, bottom = 0, left = 0, right = 0.5) Sabiendo esto, podemos ajustar los argumentos de inset_element() para poner el gr√°fico exactamente donde queremos:\ngrafico_c + inset_element(grafico_b + guides(fill = guide_none()), top = .9, bottom = .4, left = .2, right = .5) Naturalmente, podr√≠amos combinar este gr√°fico con un gr√°fico insertado con otro gr√°fico m√°s, o con la cantidad que se nos ocurra:\ngrafico_c + guides(fill = guide_legend(position = \u0026#34;inside\u0026#34;, title = NULL)) + theme(legend.position.inside = c(.8, .7)) + inset_element(grafico_b + guides(fill = guide_none()), top = 1, bottom = .4, left = .2, right = .6) + (grafico_a / grafico_a / grafico_a / grafico_a / grafico_a / grafico_a) Otra forma de insertar un gr√°fico dentro de otro es ubic√°ndolo a una cierta distancia desde un borde; en este caso, insertaremos un gr√°fico que solo contiene un texto (el a√±o) en al esquina superior derecha, y para ello, definiremos que el borde izquierdo de la figura insertada inset_element() se ubique en el borde izquierdo del gr√°fico menos 3 cent√≠metros, el borde derecho de la figura insertada en el l√≠mite derecho del gr√°fico, el borde superior en el l√≠mite superior del gr√°fico, y el borde inferior de la figura a 2 cent√≠metros menos del l√≠mite superior del gr√°fico.\n# gr√°fico vac√≠o que solo contiene un texto texto_a√±o \u0026lt;- ggplot() + annotate(\u0026#34;text\u0026#34;, x = 1, y = 1, label = 2025, size = 7) + theme_void() grafico_c + inset_element( texto_a√±o, left = unit(1, \u0026#39;npc\u0026#39;) - unit(3, \u0026#39;cm\u0026#39;), right = 1, top = 1, bottom = unit(1, \u0026#39;npc\u0026#39;) - unit(2, \u0026#39;cm\u0026#39;), align_to = \u0026#34;full\u0026#34;) Podemos usar esta t√©cnica para insertar cualquier texto en cualquier posici√≥n de un gr√°fico, incluso fuera de los l√≠mites de las escalas (que ser√≠a una limitaci√≥n de hacer lo mismo con annotate().\nLa gracia de usar inset_element() es que posicionamos los elementos con respecto al tama√±o del gr√°fico (donde el borde izquierdo es 0 y el derecho es 1, y el borde inferior es 0 y el superior es 1) y no a las coordenadas de las variables x e y, lo que nos permite ubicar los elementos de forma independiente al sistema de coordenadas del gr√°fico.\n","date":"2025-03-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/patchwork/","tags":"visualizaci√≥n de datos ; gr√°ficos ; ggplot2","title":"Unir y combinar gr√°ficos {ggplot2} con {patchwork}"},{"content":"El uso del color es clave para comunicar, y el ecosistema de R tiene varios trucos convenientes para ayudarnos a usar el color de mejores formas.\nEn R, los colores se escriben como c√≥digo, y a grandes rasgos pueden ser colores con nombre (por ejemplo, \u0026quot;purple\u0026quot;), colores hexadecimales (escritos como c√≥digos de al menos 6 d√≠gitos, como #FFFFFF), o como parte de funciones que producen paletas de colores.\nA lo largo de este post usaremos la funci√≥n swatch() del paquete {shades}, que genera un gr√°fico que presenta el color o la paleta de colores a partir de un vector de colores, lo que nos ayudar√° a visualizar nuestros colores m√°s f√°cil. Una alternativa es la funci√≥n show_col() de {scales}, que hace lo mismo.\nlibrary(shades) library(scales) Crear colores La forma m√°s b√°sica de elegir un color en R es por su nombre. En R existen 657 colores con nombre. En la siguiente imagen puedes ver los principales:\nPara usarlos, simplemente usa su nombre:\ncolores \u0026lt;- c(\u0026#34;indianred\u0026#34;, \u0026#34;steelblue\u0026#34;, \u0026#34;grey60\u0026#34;) swatch(colores) Casi todos estos colores pueden ser modificados agregando un n√∫mero del 1 al 4 al final del nombre; por ejemplo, mediumorchid puede hacerse levemente m√°s claro o m√°s oscuro:\nescala \u0026lt;- c(\u0026#34;mediumorchid\u0026#34;, \u0026#34;mediumorchid1\u0026#34;, \u0026#34;mediumorchid2\u0026#34;, \u0026#34;mediumorchid3\u0026#34;, \u0026#34;mediumorchid4\u0026#34;) swatch(escala) Los grises (gray) tienen la particularidad de que puedes ponerles un n√∫mero entre 10 y 99 para ajustar su brillo:\nescala \u0026lt;- c(\u0026#34;gray10\u0026#34;, \u0026#34;gray30\u0026#34;, \u0026#34;gray50\u0026#34;, \u0026#34;gray70\u0026#34;, \u0026#34;gray90\u0026#34;) swatch(escala) Tambi√©n puedes escribir un color definiendo su tonalidad (hue), saturaci√≥n (saturation) y brillo (value) con hsv(), entendiendo que el matiz es la posici√≥n del color en la escala de todos los colores, que va del 0 al 1, empezando y terminando con el rojo:\ncolor \u0026lt;- hsv(h = 0, s = 1, v = 1) swatch(color) Para guiarse, la siguiente gr√°fica muestra la tonalidad de colores entre 0 y 1,\nSiguiendo el gr√°fico anterior, vemos que el tono 0.8 corresponde al color morado, as√≠ que podemos crearlo con hsv():\ncolor \u0026lt;- hsv(0.85, 1, 1) swatch(color) Luego podemos modificar la saturaci√≥n y brillo del color con los otros dos argumentos de hsv():\ncolor \u0026lt;- hsv(0.82, 0.5, 0.4) swatch(color) Extender paletas de colores Si tienes un vector de colores y necesitas alargarlo para tener m√°s colores basados en la paleta original, puedes hacerlo con la funci√≥n colorRampPalette(). Esta funci√≥n crea otra funci√≥n a partir de los colores, a la que luego le das el n√∫mero de colores que necesites obtener a partir de la paleta original:\n# paleta de 5 colores paleta \u0026lt;- c(\u0026#34;#f4b43f\u0026#34;, \u0026#34;#ec6a2d\u0026#34;, \u0026#34;#cc3b7b\u0026#34;, \u0026#34;#705ce6\u0026#34;, \u0026#34;#668cf6\u0026#34;) swatch(paleta) # extender la paleta de 5 colores a 12 colores colorRampPalette(paleta)(12) |\u0026gt; swatch() Tambi√©n podemos usar esta funci√≥n para crear con facilidad una paleta secuencial entre dos o m√°s colores:\ncolores \u0026lt;- c(\u0026#34;#df65b2\u0026#34;, \u0026#34;#fae55f\u0026#34;) # extender la paleta a 8 colores colorRampPalette(colores)(8) |\u0026gt; swatch() Paletas de colores Varios paquetes de R contienen sus propias paletas de colores predise√±adas. Uno de los conjuntos de paletas principales en visualizaci√≥n de datos, sobre todo para mapas, son las de Color Brewer, a las que puedes acceder con el paquete {RColorBrewer}:\nRColorBrewer::display.brewer.all() Cuando elijas una de las paletas, puedes usarla en cualquier gr√°fico de {ggplot2} con la funci√≥n scale_color_brewer() o scale_fill_brewer(), seg√∫n corresponda:\nlibrary(ggplot2) iris |\u0026gt; ggplot() + aes(x = Sepal.Length, y = Sepal.Width, color = Species) + geom_point(size = 4, alpha = 0.7) + scale_color_brewer(palette = \u0026#34;PuRd\u0026#34;) + theme_classic() Con el paquete {colorspace} tambi√©n podemos ver otras paletas disponibles:\nlibrary(colorspace) colorspace::hcl_palettes(plot = TRUE) Usar estas paletas en {ggplot2} es tan f√°cil como agregar la funci√≥n de escala apropiada para definir los colores del gr√°fico:\niris |\u0026gt; ggplot() + aes(Petal.Width, Sepal.Width, color = Sepal.Length) + geom_point(size = 4, alpha = 0.7) + colorspace::scale_color_continuous_sequential(palette = \u0026#34;Sunset\u0026#34;) + scale_y_continuous(expand = expansion(c(0, 0.1))) + theme_classic() Encuentro una lista que compila todas las paletas de colores de la comunidad de R en este repositorio.\nPaletas secuenciales Las paletas secuenciales consiste en un degradado entre dos o m√°s colores. Suelen usarse para representar una variable continua o num√©rica, cuyo valor va cambiando de forma cuantitativa.\nLa funci√≥n sequential_hcl() del paquete {colorspace} permite crear paletas secuenciales\ncolorspace::sequential_hcl(8, h = 300) |\u0026gt; swatch() colorspace::sequential_hcl(8, h = c(300, 100)) |\u0026gt; swatch() colorspace::sequential_hcl(5, h = 260, c = c(45, 25), l = c(25, 85), power = .9) |\u0026gt; swatch() Tambi√©n se pueden obtener vectores de colores a partir de las paletas existentes que vienen con el paquete {colorspace}:\ncolorspace::sequential_hcl(5, palette = \u0026#34;Red-Blue\u0026#34;) |\u0026gt; swatch() colorspace::sequential_hcl(5, palette = \u0026#34;Purple-Orange\u0026#34;) |\u0026gt; swatch() Paletas cualitativas Como su nombre √©tica, en las paletas cualitativas los colores van saltando para maximizar la diferencia entre ellos. Se utilizan para variables cualitativas, categ√≥ricas o discretas, donde cada elemento de una secuencia es independiente de los dem√°s, y el objetivo del uso del color es poder distinguirlos.\nLa funci√≥n rainbow_hcl() de {colorspace} entrega una t√≠pica paleta de arco√≠ris, pero con la posibilidad de modificar sus atributos de color en sus argumentos, tales como las tonalidades (hue) de inicio o final, la intensidad (chroma) de los tonos\ncolorspace::rainbow_hcl(7, c = 70) |\u0026gt; swatch() colorspace::rainbow_hcl(7, c = 100, start = 190, end = 380) |\u0026gt; swatch() colorspace::rainbow_hcl(6, c = 60, l = 30, start = 230, end = 370) |\u0026gt; swatch() √âste tipo de paletas usualmente re√∫ne colores en una escala tipo arco√≠ris, o bien re√∫ne colores tem√°ticos, distintos entre ellos, pero arm√≥nicos entre s√≠.\nTambi√©n pueden usarse los nombres de las paredes preexistentes para generar una secuencia cualitativa con ellos.\ncolorspace::qualitative_hcl(6, palette = \u0026#34;Cold\u0026#34;, c = 80) |\u0026gt; swatch() colorspace::qualitative_hcl(6, palette = \u0026#34;Warm\u0026#34;, c = 80) |\u0026gt; swatch() Paletas divergentes Las paletas divergentes se utilizan cuando una variable expresa a dos polos, una una misma magnitud donde los extremos son separados por una brecha central.\ncolorspace::diverging_hcl(n = 5, h = c(200, 300)) |\u0026gt; swatch() colorspace::diverging_hcl(n = 7, h = c(700, 180)) |\u0026gt; swatch() colorspace::diverging_hcl(n = 7, h = c(700, 180), c = 130, alpha = .7) |\u0026gt; swatch() Modificar colores Las funciones del paquete {shades} nos permitan obtener informaci√≥n detallada sobre cada uno de los colores, y usar esta misma informaci√≥n para modificarlos con mucho detalle.\nPor ejemplo, definamos un color, y luego obtengamos el valor de su tonalidad. Recordemos que la tonalidad de los colores se expresan como grados entre 0¬∞ y 360¬∞.\nlibrary(shades) color \u0026lt;- \u0026#34;#f65b74\u0026#34; swatch(color) hue(color) [1] 350.3226 Obtenemos que, para el color definido, el valor de su tonalidad es 350. Podemos usar esta informaci√≥n para modificar levemente el mismo color y as√≠ obtener una variable del mismo color levemente m√°s anaranjada.\nswatch(c(color, hue(color, 370))) Podemos obtener mismos resultados utilizando el delta de la tonalidad del color; es decir, sum√°ndole rest√°ndole una cantidad de grados a el valor de la tonalidad del color mismo:\nswatch(c(color, hue(color, delta(50)))) Al usar la funci√≥n delta(), lo que hacemos es pedirle que cambie la tonalidad del color en 50¬∞, volvi√©ndose en un tono amarillo.\nPodemos obtener un resultado similar usando col_shift() del paquete {scales}:\nlibrary(scales) show_col(c(color, col_shift(color, 20))) El brillo (brighness) va de cero a uno, mientras que la claridad (lightness) va de cero a 100.\ncolor |\u0026gt; brightness(0.7) |\u0026gt; swatch() color |\u0026gt; lightness(delta(20)) |\u0026gt; swatch() Con {scales}, la funci√≥n col_lighter() realiza el mismo prop√≥sito:\ncol_lighter(color, 20) |\u0026gt; show_col() Por su parte, la saturaci√≥n aumenta la intensidad del color.\ncolor |\u0026gt; saturation(delta(30)) |\u0026gt; swatch() Podemos utilizar la funci√≥n delta() para crear una sencilla paleta de colores a partir de un mismo color, aumentando y disminuyendo su intensidad (chroma):\nswatch( c(color |\u0026gt; chroma(delta(30)), color, color |\u0026gt; chroma(delta(-30))) ) En {scales}, la funci√≥n es col_saturate():\ncol_saturate(color, -50) |\u0026gt; show_col() Podemos combinar estas t√©cnicas para crear una paleta de colores m√°s compleja, construida toda a partir de un solo color al cual se le va aumentando o disminuyendo sus valores de claridad e intensidad. El beneficio de hacerlo de esta manera es que luego basta con cambiar el color principal para obtener una paleta de iguales caracter√≠sticas, pero basada en una tonalidad distinta.\ncolor_principal = \u0026#34;#4D4484\u0026#34; color_fondo = color_principal |\u0026gt; lightness(13) |\u0026gt; chroma(20) color_detalle = color_principal |\u0026gt; lightness(20) |\u0026gt; chroma(40) color_destacado = color_principal |\u0026gt; lightness(50) |\u0026gt; chroma(65) color_texto = color_principal |\u0026gt; lightness(80) swatch(c(color_principal, color_fondo, color_detalle, color_destacado, color_texto)) color_principal = \u0026#34;#3170ac\u0026#34; color_fondo = color_principal |\u0026gt; lightness(13) |\u0026gt; chroma(20) color_detalle = color_principal |\u0026gt; lightness(20) |\u0026gt; chroma(40) color_destacado = color_principal |\u0026gt; lightness(50) |\u0026gt; chroma(65) color_texto = color_principal |\u0026gt; lightness(80) swatch(c(color_principal, color_fondo, color_detalle, color_destacado, color_texto)) Notar que el c√≥digo es igual, y s√≥lo se cambi√≥ el valor del color_principal. Esta estrategia es muy √∫til si se est√°n produciendo visualizaciones o aplicaciones que ocupan una paleta de colores monocroma.\nMezclar colores Las funciones submix() y addmix() del paquete {shades} facilitan el mezclado de colores sustraje ctivo y aditivo, respectivamente. A partir de dos colores, entrega la mezcla de ellos, abriendo muchas posibilidades para la experimentaci√≥n y creaci√≥n de nuevos colores:\nswatch(c(\u0026#34;#70f1d5\u0026#34;, submix(\u0026#34;#70f1d5\u0026#34;, \u0026#34;#fae55f\u0026#34;), \u0026#34;#fae55f\u0026#34;)) swatch(c(\u0026#34;#3377f7\u0026#34;, addmix(\u0026#34;#3377f7\u0026#34;, \u0026#34;#ec4e3c\u0026#34;), \u0026#34;#ec4e3c\u0026#34;)) swatch(c(\u0026#34;#f9ce45\u0026#34;, submix(\u0026#34;#f9ce45\u0026#34;, \u0026#34;#77d671\u0026#34;, amount = 0.5), \u0026#34;#77d671\u0026#34;)) El paquete {scales} tambi√©n provee una funci√≥n para mezclar colores. Se puede usar esta funci√≥n para tomar una paleta de colores y volverla m√°s coherente al aplicarle una peque√±a fracci√≥n de otro color, en este caso naranja:\ncol_mix(a = c(\u0026#34;#77d671\u0026#34;, \u0026#34;#70f1d5\u0026#34;, \u0026#34;#fae55f\u0026#34;, \u0026#34;#ff479c\u0026#34;), b = \u0026#34;orange2\u0026#34;, amount = 0.2) |\u0026gt; show_col() Usar paletas de colores en {ggplot2} Muchas de estos paquetes incorporan funciones de escalas de colores (scale_color_x(), scale_fill_x()) para aplicar una paleta de color f√°cilmente a un gr√°fico creado {ggplot2}.\nlibrary(ggplot2) library(dplyr) iris |\u0026gt; ggplot() + geom_bar(aes(Petal.Width, fill = Species)) + colorspace::scale_fill_discrete_qualitative(palette = \u0026#34;Dark 3\u0026#34;) + scale_y_continuous(expand = expansion(c(0, 0.1))) + theme_classic() iris |\u0026gt; ggplot() + geom_point(aes(Sepal.Width, Sepal.Length, color = Petal.Width, size = Petal.Length), alpha = .8) + colorspace::scale_color_continuous_sequential(palette = \u0026#34;Sunset\u0026#34;, na.value = \u0026#34;white\u0026#34;) + theme_classic() + guides(size = guide_legend(override.aes = list(color = \u0026#34;#784FA1\u0026#34;)), color = guide_colorsteps()) + theme(legend.title = element_blank(), axis.title = element_blank()) iris |\u0026gt; ggplot() + geom_point(aes(Petal.Length, Sepal.Width, color = Petal.Width, size = Sepal.Length), alpha = .8) + viridis::scale_colour_viridis(\u0026#34;viridis\u0026#34;, na.value = \u0026#34;white\u0026#34;) + theme_classic() + guides(size = guide_legend(override.aes = list(color = \u0026#34;#88D181\u0026#34;)), color = guide_colorsteps()) + theme(legend.title = element_blank(), axis.title = element_blank()) Algunas de las funciones para aplicar paletas de colores tienen funcionalidades extras. Por ejemplo, las funciones de {colorspace} permiten modificar sus paletas en t√©rminos de la saturaci√≥n (chroma) y el brillo del color (luminance), entreg√°ndote m√°s libertad al momento de definir una apariencia espec√≠fica:\ngrafico \u0026lt;- iris |\u0026gt; ggplot() + geom_point(aes(Sepal.Width, Sepal.Length, color = Petal.Width), size = 3, alpha = .8) + theme_classic() + guides(color = guide_colorsteps()) + theme(legend.title = element_blank(), axis.title = element_blank()) grafico + colorspace::scale_color_continuous_sequential( palette = \u0026#34;TealGrn\u0026#34;, c1 = 50, # intensidad del color l1 = 60) # brillo del color grafico + colorspace::scale_color_continuous_sequential( palette = \u0026#34;TealGrn\u0026#34;, c1 = 20, # intensidad del color l1 = 30) # brillo del color Si quieres aprender visualizaci√≥n de datos con {ggplot2}, puedes revisar este tutorial sobre visualizaci√≥n de datos desde cero! Avanzado {colorspace} incluye funciones para poder visualizar secuencias de colores en proyecciones del espacio de color HCL (hue, chroma, luminance), lo que nos permite contextualizar las paletas en un espacio perceptual del color basado en estos tres par√°metros.\ncolorspace::hclplot(sequential_hcl(7, h = 260, c = 80, l = c(35, 95), power = 1.5)) colorspace::hclplot(sequential_hcl(7, h = c(260, 220), c = c(50, 75, 0), l = c(30, 95), power = 1)) Fuentes y recursos https://github.com/EmilHvitfeldt/r-color-palettes https://r-graph-gallery.com/ggplot2-color.html https://www.datanovia.com/en/blog/top-r-color-palettes-to-know-for-great-data-visualization/ https://jbengler.github.io/tidyplots/articles/Color-schemes.html ","date":"2025-03-06T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/colores/","tags":"visualizaci√≥n de datos ; gr√°ficos ; ggplot2","title":"Creaci√≥n y personalizaci√≥n de colores y paletas en R"},{"content":"Visualizar un mapa de Chile puede ser complicado debido a su largo. Muchas veces cuesta ubicar correctamente el mapa por el espacio vertical que requiere. Pero en ciertos casos puede ser conveniente visualizar a Chile de lado, para aprovechar el espacio horizontal. En esta gu√≠a veremos c√≥mo rotar un mapa de Chile 90¬∞ hacia la izquierda en R para que quede acostado.\nPrimero cargamos los paquetes necesarios:\nlibrary(sf) # manejo de datos espaciales Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE library(chilemapas) # mapas de Chile La documentacion del paquete y ejemplos de uso se encuentran en https://pacha.dev/chilemapas/. Visita https://buymeacoffee.com/pacha/ si deseas donar para contribuir al desarrollo de este software. library(ggplot2) # visualizaci√≥n de datos library(dplyr) # manejo de datos tabulares Attaching package: 'dplyr' The following objects are masked from 'package:stats': filter, lag The following objects are masked from 'package:base': intersect, setdiff, setequal, union library(readr) # cargar datos Obtenemos un mapa de Chile gracias al paquete {chilemapas}; en este caso un mapa del pa√≠s por regiones:\n# obtener mapa mapa_region \u0026lt;- chilemapas::generar_regiones() mapa_region Simple feature collection with 16 features and 1 field Geometry type: GEOMETRY Dimension: XY Bounding box: xmin: -109.4499 ymin: -56.52511 xmax: -66.41617 ymax: -17.49778 Geodetic CRS: SIRGAS 2000 # A tibble: 16 √ó 2 codigo_region geometry * \u0026lt;chr\u0026gt; \u0026lt;GEOMETRY [¬∞]\u0026gt; 1 01 POLYGON ((-68.86081 -21.28512, -68.7581 -21.21752, -68.65677 -‚Ä¶ 2 02 MULTIPOLYGON (((-68.98863 -25.38016, -68.98522 -25.37566, -68.‚Ä¶ 3 03 MULTIPOLYGON (((-70.68641 -26.15053, -70.68923 -26.15726, -70.‚Ä¶ 4 04 MULTIPOLYGON (((-71.66962 -30.34526, -71.67234 -30.34574, -71.‚Ä¶ 5 05 MULTIPOLYGON (((-71.67929 -33.44583, -71.68012 -33.448, -71.67‚Ä¶ 6 06 POLYGON ((-71.1344 -34.78711, -71.12134 -34.80128, -71.09905 -‚Ä¶ 7 07 POLYGON ((-72.1032 -36.12348, -72.09964 -36.12574, -72.09894 -‚Ä¶ 8 08 MULTIPOLYGON (((-71.41259 -38.10669, -71.3922 -38.098, -71.383‚Ä¶ 9 09 MULTIPOLYGON (((-73.35579 -38.73982, -73.35306 -38.73343, -73.‚Ä¶ 10 10 MULTIPOLYGON (((-73.6175 -41.8142, -73.61389 -41.80392, -73.61‚Ä¶ 11 11 MULTIPOLYGON (((-74.34857 -45.02053, -74.34886 -45.02632, -74.‚Ä¶ 12 12 MULTIPOLYGON (((-71.18405 -52.8089, -71.17569 -52.80759, -71.1‚Ä¶ 13 13 POLYGON ((-70.47405 -33.8624, -70.47327 -33.86269, -70.46068 -‚Ä¶ 14 14 MULTIPOLYGON (((-71.65597 -40.35386, -71.65874 -40.34691, -71.‚Ä¶ 15 15 POLYGON ((-70.35079 -18.8362, -70.34707 -18.83939, -70.34351 -‚Ä¶ 16 16 POLYGON ((-72.38553 -36.91169, -72.37685 -36.91617, -72.37034 ‚Ä¶ # visualizar mapa_region |\u0026gt; ggplot(aes()) + geom_sf() + # recortar coordenadas horizontales coord_sf(xlim = c(-80, -62)) Cargamos algunos datos regionales para ponerle al mapa:\n# obtener datos datos \u0026lt;- read_csv2(\u0026#34;https://github.com/bastianolea/economia_chile/raw/main/app/datos/pib_regional.csv\u0026#34;) ‚Ñπ Using \u0026quot;','\u0026quot; as decimal and \u0026quot;'.'\u0026quot; as grouping mark. Use `read_delim()` for more control. New names: Rows: 893 Columns: 8 ‚îÄ‚îÄ Column specification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Delimiter: \u0026quot;;\u0026quot; chr (2): serie, fecha dbl (5): ...1, valor, a√±o, trimestre, mes date (1): fecha_scraping ‚Ñπ Use `spec()` to retrieve the full column specification for this data. ‚Ñπ Specify the column types or set `show_col_types = FALSE` to quiet this message. ‚Ä¢ `` -\u0026gt; `...1` # limpiar datos datos_2 \u0026lt;- datos |\u0026gt; group_by(serie) |\u0026gt; slice_max(a√±o) |\u0026gt; slice_max(mes) |\u0026gt; select(nombre_region = serie, valor, a√±o, trimestre, mes) # crear tabla de regiones regiones \u0026lt;- tribble(~codigo_region, ~nombre_region, \u0026#34;01\u0026#34;, \u0026#34;Regi√≥n de Arica y Parinacota\u0026#34;, \u0026#34;02\u0026#34;, \u0026#34;Regi√≥n de Tarapac√°\u0026#34;, \u0026#34;03\u0026#34;, \u0026#34;Regi√≥n de Antofagasta\u0026#34;, \u0026#34;04\u0026#34;, \u0026#34;Regi√≥n de Atacama\u0026#34;, \u0026#34;05\u0026#34;, \u0026#34;Regi√≥n de Coquimbo\u0026#34;, \u0026#34;06\u0026#34;, \u0026#34;Regi√≥n de Valpara√≠so\u0026#34;, \u0026#34;07\u0026#34;, \u0026#34;Regi√≥n Metropolitana de Santiago\u0026#34;, \u0026#34;08\u0026#34;, \u0026#34;Regi√≥n del Libertador General Bernardo OHiggins\u0026#34;, \u0026#34;09\u0026#34;, \u0026#34;Regi√≥n del Maule\u0026#34;, \u0026#34;10\u0026#34;, \u0026#34;Regi√≥n de √ëuble\u0026#34;, \u0026#34;11\u0026#34;, \u0026#34;Regi√≥n del Biob√≠o\u0026#34;, \u0026#34;12\u0026#34;, \u0026#34;Regi√≥n de La Araucan√≠a\u0026#34;, \u0026#34;13\u0026#34;, \u0026#34;Regi√≥n de Los R√≠os\u0026#34;, \u0026#34;14\u0026#34;, \u0026#34;Regi√≥n de Los Lagos\u0026#34;, \u0026#34;15\u0026#34;, \u0026#34;Regi√≥n de Ays√©n del General Carlos Ib√°√±ez del Campo\u0026#34;, \u0026#34;16\u0026#34;, \u0026#34;Regi√≥n de Magallanes y de la Ant√°rtica Chilena\u0026#34;) # agregar regiones y datos al mapa mapa_datos \u0026lt;- mapa_region |\u0026gt; left_join(regiones) |\u0026gt; left_join(datos_2, by = join_by(nombre_region)) Joining with `by = join_by(codigo_region)` # visualizar mapa con datos mapa_datos |\u0026gt; ggplot() + aes(fill = valor) + geom_sf(linewidth = 0) + coord_sf(xlim = c(-80, -62)) + scale_fill_distiller(type = \u0026#34;seq\u0026#34;, palette = 12, labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;)) + theme_classic() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank()) Warning in prettyNum(.Internal(format(x, trim, digits, nsmall, width, 3L, : 'big.mark' and 'decimal.mark' are both '.', which could be confusing Ahora que tenemos un mapa de Chile con datos regionales, procedemos a rotar el mapa. Para esto, necesitamos una matriz de rotaci√≥n, respecto de la cual no hay mucho que entender, salvo que nos permitir√° multiplicar la geometr√≠a del mapa para obtener como resultado la misma geometr√≠a, pero rotada. El √∫nico detalle que hay que considerar es que es necesario cambiar la proyecci√≥n del mapa para que la zona sur del pa√≠s no se vea deformada.\n# reprojectar a CRS EPSG:5361 para evitar deformaci√≥n mapa_proyectado \u0026lt;- st_transform(mapa_datos, 5361) # matriz de rotaci√≥n 90¬∞ izquierda rotacion \u0026lt;- matrix(c(0, -1, 1, 0), 2, 2) # aplicar rotaci√≥n al mapa proyectado mapa_rotado \u0026lt;- mapa_proyectado |\u0026gt; mutate(geometry = geometry * rotacion) Finalmente, visualizamos el mapa reproyectado y rotado:\nmapa_rotado |\u0026gt; ggplot() + aes(fill = valor) + geom_sf(linewidth = 0) + scale_y_continuous(labels = scales::label_number()) + coord_sf(ylim = c(800000, -100000)) + labs(title = \u0026#34;Mapa de Chile horizontal\u0026#34;, subtitle = \u0026#34;A mimir\u0026#34;) + scale_fill_distiller(type = \u0026#34;seq\u0026#34;, palette = 12, labels = scales::label_comma(big.mark = \u0026#34;.\u0026#34;)) + guides(fill = guide_legend(position = \u0026#34;bottom\u0026#34;)) + theme_classic() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank()) Warning in prettyNum(.Internal(format(x, trim, digits, nsmall, width, 3L, : 'big.mark' and 'decimal.mark' are both '.', which could be confusing Fuentes DeepSeek DeepThink (R1) https://gist.github.com/ryanpeek/99c6935ae51429761f5f73cf3b027da2 https://r-spatial.github.io/sf/articles/sf3.html#affine-transformations https://en.wikipedia.org/wiki/Rotation_matrix ","date":"2025-03-04T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/mapa_chile_horizontal/","tags":"mapas ; visualizaci√≥n de datos ; Chile","title":"Rotar un mapa de Chile en R para que quede horizontal"},{"content":"Un problema com√∫n al visualizar datos georeferenciados o mapas coropl√©ticos (con colores en las zonas geogr√°ficas que se corresponden con los datos) yace en que usamos mapas que tienen geometr√≠as o caracter√≠sticas geogr√°ficas mucho m√°s detalladas de lo que necesitamos. Este exceso de detalle puede jugarle en contra a la visualizaci√≥n que estamos intentando crear, ya sea porque dificulta la interpretaci√≥n, o complejiza visualmente el gr√°fico.\nOtro problema de trabajar con mapas muy detallados es que la velocidad con la que se generan se ve impactada debido al detalle, lo que resulta inconveniente dado que al visualizar datos usualmente nos encontramos iterando decenas de veces una misma visualizaci√≥n hasta que se vea como queremos.\nEsto puede ocurrir cuando mapas desde Shapes u otras fuentes cuyo objetivo es representar fidedignamente los territorios; pero al visualizar datos generalmente necesitamos visualizaciones que no requieren exactitud milim√©trica en sus pol√≠gonos.\nGeneremos un mapa de regiones de Chile, usando las geometr√≠as del paquete {chilemapas}:\nlibrary(dplyr) library(sf) library(ggplot2) library(chilemapas) # generar mapa de regiones mapa_regiones \u0026lt;- chilemapas::mapa_comunas |\u0026gt; st_set_geometry(chilemapas::mapa_comunas$geometry) |\u0026gt; select(codigo_comuna, codigo_region, geometry) |\u0026gt; summarize(geometry = st_union(geometry), .by = codigo_region) mapa_regiones Simple feature collection with 16 features and 1 field Geometry type: GEOMETRY Dimension: XY Bounding box: xmin: -109.4499 ymin: -56.52511 xmax: -66.41617 ymax: -17.49778 Geodetic CRS: SIRGAS 2000 # A tibble: 16 √ó 2 codigo_region geometry \u0026lt;chr\u0026gt; \u0026lt;GEOMETRY [¬∞]\u0026gt; 1 01 POLYGON ((-69.93023 -21.4246, -69.92376 -21.42622, -69.91932 -‚Ä¶ 2 02 MULTIPOLYGON (((-68.0676 -24.32856, -67.91698 -24.26902, -67.8‚Ä¶ 3 03 MULTIPOLYGON (((-71.58497 -29.02456, -71.58844 -29.02838, -71.‚Ä¶ 4 04 MULTIPOLYGON (((-70.54551 -31.30742, -70.53877 -31.30074, -70.‚Ä¶ 5 05 MULTIPOLYGON (((-71.33832 -33.45237, -71.33763 -33.44836, -71.‚Ä¶ 6 06 POLYGON ((-71.5477 -34.87458, -71.54211 -34.87581, -71.53566 -‚Ä¶ 7 07 POLYGON ((-70.41724 -35.63022, -70.41108 -35.6302, -70.40146 -‚Ä¶ 8 08 MULTIPOLYGON (((-73.53466 -36.97378, -73.53245 -36.97829, -73.‚Ä¶ 9 09 MULTIPOLYGON (((-73.35306 -38.73343, -73.35396 -38.72799, -73.‚Ä¶ 10 10 MULTIPOLYGON (((-73.1691 -41.87755, -73.16135 -41.87781, -73.1‚Ä¶ 11 11 MULTIPOLYGON (((-75.41754 -48.73857, -75.43249 -48.74372, -75.‚Ä¶ 12 12 MULTIPOLYGON (((-70.35563 -52.94478, -70.34688 -52.93971, -70.‚Ä¶ 13 13 POLYGON ((-70.47405 -33.8624, -70.47327 -33.86269, -70.46068 -‚Ä¶ 14 14 MULTIPOLYGON (((-73.39503 -39.88698, -73.39672 -39.89339, -73.‚Ä¶ 15 15 POLYGON ((-69.07223 -19.02723, -69.06394 -19.02607, -69.04748 ‚Ä¶ 16 16 POLYGON ((-72.38553 -36.91169, -72.37685 -36.91617, -72.37034 ‚Ä¶ mapa_regiones |\u0026gt; ggplot() + aes() + geom_sf() Vemos que en la zona sur del pa√≠s, el detalle del mapa es tal, que los cientos de islas se vuelven en manchas grises debido a sus bordes demasiado detallados.\nmapa_regiones |\u0026gt; ggplot() + aes() + geom_sf() + coord_sf(xlim = c(-80, -65), ylim = c(-42, -56)) Podemos usar el paquete {rmapshaper} para simplificar las geometr√≠as del mapa, bajando as√≠ el nivel de detalle de la visualizaci√≥n resultante:\nmapa_regiones_simple \u0026lt;- mapa_regiones |\u0026gt; # simplificar geometr√≠as mutate(geometry = rmapshaper::ms_simplify(geometry, keep = 0.05)) mapa_regiones_simple |\u0026gt; ggplot() + aes() + geom_sf() mapa_regiones_simple |\u0026gt; ggplot() + aes() + geom_sf() + coord_sf(xlim = c(-80, -65), ylim = c(-42, -56)) En la funci√≥n ms_simplify(), el valor del argumento keep define la calidad resultante del mapa. Si el valor es menor, el mapa tendr√° menos detalle.\nmapa_regiones |\u0026gt; mutate(geometry = rmapshaper::ms_simplify(geometry, keep = 0.01)) |\u0026gt; ggplot() + aes() + geom_sf() + coord_sf(xlim = c(-80, -65), ylim = c(-42, -56)) En la funci√≥n ms_simplify(), el valor del argumento keep define la calidad resultante del mapa. Si el valor es menor, el mapa tendr√° menos detalle.\nEn estos tres mapas comparamos las diferencias entre el mapa original, con detalle al 0.1, y con detalle al 0.05:\nnormal \u0026lt;- mapa_regiones |\u0026gt; # mutate(geometry = rmapshaper::ms_simplify(geometry, keep = 0.1)) |\u0026gt; ggplot() + aes() + geom_sf() + coord_sf(xlim = c(-80, -65), ylim = c(-42, -56)) medio \u0026lt;- mapa_regiones |\u0026gt; mutate(geometry = rmapshaper::ms_simplify(geometry, keep = 0.1)) |\u0026gt; ggplot() + aes() + geom_sf() + coord_sf(xlim = c(-80, -65), ylim = c(-42, -56)) bajo \u0026lt;- mapa_regiones |\u0026gt; mutate(geometry = rmapshaper::ms_simplify(geometry, keep = 0.05)) |\u0026gt; ggplot() + aes() + geom_sf() + coord_sf(xlim = c(-80, -65), ylim = c(-42, -56)) library(patchwork) normal + medio + bajo Con respecto a la velocidad de generaci√≥n de los mapas, realizamos una prueba de rendimiento que compare la velocidad de guardado de dos mapas, uno normal y uno simplificado:\nbench::mark(iterations = 20, check = FALSE, normal = ggsave(plot = mapa_regiones |\u0026gt; ggplot() + geom_sf(), filename = \u0026#34;a.jpg\u0026#34;), simple = ggsave(plot = mapa_regiones_simple |\u0026gt; ggplot() + geom_sf(), filename = \u0026#34;b.jpg\u0026#34;) ) # A tibble: 2 √ó 6 expression min median `itr/sec` mem_alloc `gc/sec` \u0026lt;bch:expr\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;bch:byt\u0026gt; \u0026lt;dbl\u0026gt; 1 normal 143.7ms 150.1ms 6.47 29.31MB 10.4 2 simple 75.2ms 78.8ms 12.6 2.46MB 11.4 Seg√∫n la prueba, el mapa simplificado se genera aproximadamente el doble de r√°pido.\nTambi√©n podemos compara el uso de memoria de ambos objetos:\nobject.size(mapa_regiones) |\u0026gt; print(units = \u0026#34;auto\u0026#34;) 2.1 Mb object.size(mapa_regiones_simple) |\u0026gt; print(units = \u0026#34;auto\u0026#34;) 178.2 Kb El mapa simplificado consume un 10% de memoria con respecto al mapa original.\nSi te interesa el tema de los mapas, en otros tutoriales hemos visto c√≥mo hacer mapas de Chile con R, tanto comunales como regionales, as√≠ como tambi√©n de la zona urbana de la Regi√≥n Metropolitana. Adem√°s aprendimos c√≥mo agregar caracter√≠sticas espaciales como calles y autopistas obtenidas desde Open Street Map.\n","date":"2025-02-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/simplificar_mapas/","tags":"mapas ; visualizaci√≥n de datos","title":"Simplificar la geometr√≠a de los pol√≠gonos de un mapa en R"},{"content":" Hace poco conoc√≠ el paquete {mall}, que facilita mucho el uso de un un modelo de lenguaje (LLM) local como una herramienta cotidiana para el an√°lisis y procesamiento de datos.\nEl paquete incluye varias funciones para usar un modelo LLM local en las columnas de un dataframe. {mall} te puede ayudar a :\nclasificar el contenido de una variable resumir textos extraer sentimiento a partir del texto extraer informaci√≥n desde el texto confirmar si algo es verdadero o falso a partir de un texto y tambi√©n a aplicar cualquier prompt a una variable. Recientemente lo us√© para un caso real, donde ten√≠a una columna de casi 2.000 nombres, y necesitaba asignarle un g√©nero a cada una de estas personas, solamente a partir de sus nombres y apellidos.\nlibrary(dplyr) # manipulaci√≥n de datos library(readr) # cargar datos library(tictoc) # medici√≥n de tiempo library(mall) # aplicar modelos de lenguaje en dataframe Los datos provienen del servicio electoral de Chile, y los nombres corresponden a 1.576 candidatos y candidatas a alcald√≠as.\nCon el siguiente c√≥digo puedes descargar los datos listos para su uso:\narchivo_remoto \u0026lt;- \u0026#34;https://raw.githubusercontent.com/bastianolea/servel_scraping_votaciones/refs/heads/main/datos/resultados_alcaldes_2024.csv\u0026#34; candidatos \u0026lt;- readr::read_csv2(archivo_remoto) |\u0026gt; select(nombres = candidato, partido, sector) |\u0026gt; filter(nombres != \u0026#34;Nulo/Blanco\u0026#34;) candidatos # A tibble: 1,576 √ó 3 nombres partido sector \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Marco Antonio Gonzalez Candia RN Derecha 2 Veronica Maricel Cueto Cueto IND Independiente 3 Marcela Maritza Mansilla Potocnjak IND Independiente 4 Alejandro Felipe Ricotti Sepulveda IND Independiente 5 Carlos Orlando Tapia Aviles IND Independiente 6 Maria Luisa Hamilton Velasco IND Independiente 7 Gaston Dubournais Riveros IND Independiente 8 Marcela Chamorro Macias IND Izquierda 9 Jose Andres Arellano Blanco IND Independiente 10 Andrea Elizabeth Galvez Sepulveda REP Derecha # ‚Ñπ 1,566 more rows En esta instancia, tengo configurado {ollamar} para que use el modelo local y de c√≥digo abierto Llama 3.2, de 3 billones de par√°metros. Podemos instalar este modelo, o uno distinto, con estas instrucciones:\nlibrary(ollamar) ollamar::pull(\u0026#34;llama3.2\u0026#34;) # descargar e instalar un modelo mall::llm_use(\u0026#34;ollama\u0026#34;, \u0026#34;llama3.2\u0026#34;) # elegir un modelo instalado En una primera prueba, le entregamos al modelo de lenguaje la columna nombres (que contiene nombre, segundo nombre, apellido, y segundo apellido), y le pedimos al modelo que clasifique cada observaci√≥n como masculino o femenino.\ntic() resultados_1 \u0026lt;- candidatos |\u0026gt; llm_classify(nombres, labels = c(\u0026#34;masculino\u0026#34;, \u0026#34;femenino\u0026#34;), pred_name = \u0026#34;genero\u0026#34;) Ollama local server running ‚îÄ‚îÄ mall session object Backend: Ollama LLM session: model:llama3.2:latest R session: cache_folder:/var/folders/z8/61w5pwts4h5fsvhfqs1wpvk40000gn/T//RtmpntMvSc/_mall_cache127421f0326aa toc() 421.687 sec elapsed El proceso tarda aproximadamente 7 minutos en clasificar los casi 1.576 nombres, un ritmo de 0.26 segundos por cada predicci√≥n.\nresultados_1 |\u0026gt; select(genero, nombres) |\u0026gt; slice_sample(n = 15) # A tibble: 15 √ó 2 genero nombres \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 masculino Andres Parra Sandoval 2 femenino Leontina Del Carmen Gutierrez Rivas 3 masculino Mario Ortiz Cabezas 4 masculino Jose Esteban Alarcon Vargas 5 femenino Nancy Milena Alfaro Jurjevic 6 masculino Osvaldo Herrera Valdes 7 femenino Ninoska Villegas Lamas 8 masculino Juan Carlos Diaz Avenda√±o 9 masculino German Pino Maturana 10 masculino Gonzalo Rubio Fuenzalida 11 femenino Laura Correa Fuentes 12 masculino Alex Fernando Castillo Blas 13 masculino Jonathan Velasquez Ramirez 14 masculino Jorge Espinoza Cuevas 15 femenino Elizabeth Marican Rivas Para la segunda prueba, intentamos entregarle al modelo solamente los nombres, excluyendo segundos nombres y apellidos, bajo el supuesto de que el primer nombre es el mejor predictor del g√©nero, mientras que los apellidos no son un predictor del g√©nero.\nProbamos el c√≥digo con una expresi√≥n regular (regex) para extraer la primera palabra de una secuencia de texto:\ncandidatos |\u0026gt; mutate(nombre = stringr::str_extract(nombres, \u0026#34;\\\\w+\u0026#34;)) |\u0026gt; select(nombre, nombres) |\u0026gt; slice_sample(n = 5) # A tibble: 5 √ó 2 nombre nombres \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Paola Paola Romero Valdivia 2 Alejandra Alejandra Villegas Huichaman 3 Yuliana Yuliana Ema Bustos Zapata 4 Elizabeth Elizabeth Salinas Valle 5 Freddy Freddy Antonio Ramirez Villalobos Realizamos la segunda prueba de clasificaci√≥n, esta vez solamente con el primer nombre:\ntic() resultados_2 \u0026lt;- candidatos |\u0026gt; mutate(nombre = stringr::str_extract(nombres, \u0026#34;\\\\w+\u0026#34;)) |\u0026gt; # extraer nombres llm_classify(nombre, labels = c(\u0026#34;masculino\u0026#34;, \u0026#34;femenino\u0026#34;), pred_name = \u0026#34;genero\u0026#34;) toc() 139.47 sec elapsed Esta vez el proceso tarda aproximadamente 2 minutos, ¬°casi 4 veces m√°s r√°pido! El modelo clasifica los textos m√°s r√°pido mientras menos texto tenga que analizar. Es importante mencionar que la velocidad va a depender mucho de tu computador, espec√≠ficamente su GPU.\nresultados_2 |\u0026gt; select(genero, nombre) |\u0026gt; slice_sample(n = 10) # A tibble: 10 √ó 2 genero nombre \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 masculino Pablo 2 masculino Luis 3 femenino Sandra 4 masculino Johnny 5 masculino Miguel 6 masculino Oscar 7 masculino Luis 8 masculino Gonzalo 9 masculino Juan 10 masculino Mauricio Revisemos los resultados, obteniendo una muestra al azar de 30 nombres:\nresultados_2 |\u0026gt; filter(nombres != \u0026#34;Nulo/Blanco\u0026#34;) |\u0026gt; relocate(genero, nombre, .before = nombres) |\u0026gt; slice_sample(n = 30) |\u0026gt; print(n = Inf) # A tibble: 30 √ó 5 genero nombre nombres partido sector \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 masculino Christian Christian Arturo Cardenas Silva IND Independien‚Ä¶ 2 masculino Osvaldo Osvaldo Cartagena Garcia IND Independien‚Ä¶ 3 masculino Romelio Romelio Borquez Hidalgo IND Derecha 4 masculino Patricio Patricio Marchant Ulloa IND Centro 5 masculino Claudio Claudio Miranda Iba√±ez IND Independien‚Ä¶ 6 masculino Marcos Marcos Gaete Flores IND Derecha 7 masculino Raul Raul Jaime Espejo Escobar IND Independien‚Ä¶ 8 masculino Camilo Camilo Alejandro Rapu Riroroko IND Centro 9 femenino Clara Clara Lazcano Fern√°ndez IND Derecha 10 masculino Drazen Drazen Andre Markusovic Caceres PDG Derecha 11 femenino Denisse Denisse Tamara Leon Rojas REP Derecha 12 masculino Juan Juan Pablo Gomez Ramirez IND Independien‚Ä¶ 13 masculino Alexis Alexis Mendez Uribe IND Independien‚Ä¶ 14 femenino Juana Juana Sarmiento Acosta IND Independien‚Ä¶ 15 masculino Marco Marco Antonio Gonzalez Candia RN Derecha 16 masculino Miguel Miguel Bruna Silva IND Independien‚Ä¶ 17 masculino Hernaldo Hernaldo Andres Ahumada Chavez IND Independien‚Ä¶ 18 femenino Nivia Nivia Del Carmen Riquelme Gutierrez IGUALDAD Izquierda 19 masculino Cristian Cristian Alejandro Sobarzo Sanhueza IND Independien‚Ä¶ 20 masculino Cristian Cristian Andres Pozo Parraguez PS Izquierda 21 femenino Rosa Rosa Torres Escobedo IND Independien‚Ä¶ 22 masculino Juan Juan Carlos Gonzalez Romo IND Independien‚Ä¶ 23 femenino Paula Paula Rodriguez Valenzuela IND Independien‚Ä¶ 24 masculino Gabriel Gabriel Silva Gonzalez IND Independien‚Ä¶ 25 femenino Daniela Daniela Isabel Munizaga Villegas REP Derecha 26 masculino Ramon Ramon Sandoval Zurita IND Independien‚Ä¶ 27 masculino Ramon Ramon Bahamonde Cea IND Independien‚Ä¶ 28 masculino Claudio Claudio Arellano Cortes IND Independien‚Ä¶ 29 femenino Sigrid Sigrid Ramirez Arias IND Derecha 30 masculino Patricio Patricio Ernesto Gonzalez Nu√±ez IND Independien‚Ä¶ Revisando los nombres, al parecer las predicciones son bastante buenas, pero al hacer m√°s pruebas nos damos cuenta de que no es 100% infalible, ya que se equivoca en algunos nombres como Aracelli, Edita, Elizabeth, o Josselyn. si se requiere aumentar la calidad de la predicci√≥n, podr√≠a instalarse un modelo de lenguaje m√°s grande.\nOtra alternativa para mejorar el desempe√±o de la clasificaci√≥n (es decir, que sea m√°s certer) es agregarle al prompt m√°s contexto sobre lo que se busca obtener, as√≠ como una alternativa para que el modelo clasifique t√©rminos que no sabe d√≥nde clasificar:\nresultados_3 \u0026lt;- candidatos |\u0026gt; mutate(nombre = stringr::str_extract(nombres, \u0026#34;\\\\w+\u0026#34;)) |\u0026gt; # extraer nombres llm_classify(nombre, labels = c(\u0026#34;masculino\u0026#34;, \u0026#34;femenino\u0026#34;, \u0026#34;desconocido\u0026#34;), pred_name = \u0026#34;genero\u0026#34;, additional_prompt = \u0026#34;obtener el g√©nero desde nombres de personas\u0026#34;) En el argumento additional_prompt podemos especifiacr una instrucci√≥n extra para el modelo, lo que a veces es suficiente para que el modelo tenga contexto extra para poder clasificar correctamente. En mi experiencia, esto mejora considerablemente la calidad de las respuestas, y reduce la incertidumbre en algunos casos.\nEn conclusi√≥n, se trata de una herramienta muy f√°cil de implementar, que tambi√©n es capaz de ahorrarnos bastante tiempo, por ejemplo, en el desarrollo de un algoritmo que detecte el nombre a partir de ciertas estructuras en la composici√≥n de cada uno, o bien, en tener que contrastar los nombres con alguna base de datos ya existente de nombres con un g√©nero asignado (si es que existe).\n","date":"2025-02-19T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/genero_nombres_llm/","tags":"procesamiento de datos ; inteligencia artificial ; an√°lisis de texto ; g√©nero","title":"Predecir g√©nero a partir de nombres usando un modelo de lenguaje en R"},{"content":"Si creaste una aplicaci√≥n Shiny y quieres compartirla con otros/as, pero tu app contiene informaci√≥n que no puede ser vista por cualquiera, ¬°entonces sigue estos pasos! En unos minutos tendr√°s una aplicaci√≥n que requiere de usuario y contrase√±a para poder usarla.\n1. Instalar {shinymanager} Instala el paquete {shinymanager}:\ninstall.packages(\u0026#34;shinymanager\u0026#34;) 2. Crear credenciales Dentro del script app.R de tu aplicaci√≥n Shiny, crea un dataframe que contenga una contrase√±a de prueba:\n# credenciales para autenticaci√≥n credentials \u0026lt;- data.frame( user = \u0026#34;usuario\u0026#34;, password = \u0026#34;usuario\u0026#34; ) 3. Aplicar autenticaci√≥n a tu app Ahora, en el apartado server de tu app, agrega el siguiente c√≥digo que evaluar√° las credenciales ingresadas y gestionar√° el acceso para tus usuarios:\n# autenticaci√≥n res_auth \u0026lt;- secure_server(check_credentials = check_credentials(credentials)) Finalmente, antes de la l√≠nea de tu script app.R que ejecuta tu aplicaci√≥n (usualmente shinyApp(ui, server)), modifica el objeto que contiene la interfaz de tu aplicaci√≥n, para protegerla con la autenticaci√≥n de {shinymanager}:\n# autenticaci√≥n ui \u0026lt;- secure_app(ui) ¬°Listo! Tu aplicaci√≥n ahora solicitar√° una contrase√±a antes de ejecutarse.\nEjemplo Veamos un ejemplo con una aplicaci√≥n Shiny real:\nApp sin autenticaci√≥n library(shiny) library(bslib) ui \u0026lt;- page_fluid( page_fillable( card( h1(\u0026#34;Aplicaci√≥n\u0026#34;), sliderInput(\u0026#34;numeros\u0026#34;, \u0026#34;Prueba\u0026#34;, 1, 10, 5) ) ) ) server \u0026lt;- function(input, output, session) { } shinyApp(ui, server) Para agregarle autenticaci√≥n a esta app, debemos seguir los pasos anteriores para dejarla as√≠:\nApp con autenticaci√≥n library(shiny) library(bslib) library(shinymanager) # credenciales para autenticaci√≥n credentials \u0026lt;- data.frame( user = \u0026#34;usuario\u0026#34;, password = \u0026#34;usuario\u0026#34; ) ui \u0026lt;- page_fluid( page_fillable( card( h1(\u0026#34;Aplicaci√≥n\u0026#34;), sliderInput(\u0026#34;numeros\u0026#34;, \u0026#34;Prueba\u0026#34;, 1, 10, 5) ) ) ) server \u0026lt;- function(input, output, session) { # autenticaci√≥n res_auth \u0026lt;- secure_server(check_credentials = check_credentials(credentials)) } # autenticaci√≥n ui \u0026lt;- secure_app(ui) shinyApp(ui, server) La pantalla de autenticaci√≥n se ver√≠a as√≠:\nPersonalizar Si queremos modificar la pantalla de autenticaci√≥n, podemos agregar un tema, y cambiar las etiquetas usando la funci√≥n set_labels():\n# definir un tema ui \u0026lt;- secure_app(theme = shinythemes::shinytheme(\u0026#34;flatly\u0026#34;), ui) # cambiar textos de autenticaci√≥n set_labels(language = \u0026#34;en\u0026#34;, \u0026#34;Please authenticate\u0026#34; = \u0026#34;Acceder\u0026#34;, \u0026#34;Username:\u0026#34; = \u0026#34;Usuario:\u0026#34;, \u0026#34;Password:\u0026#34; = \u0026#34;Contrase√±a:\u0026#34;, \u0026#34;Login\u0026#34; = \u0026#34;Acceder\u0026#34; ) La aplicaci√≥n y todos sus contenidos han quedado protegidos tras la contrase√±a de usuario. El siguiente paso es guardar las contrase√±as en un archivo (no en el c√≥digo) que no se suba a GitHub (agregar a .gitignore), y que ojal√° est√© encriptado. Por ejemplo, {shinymanager} ofrece formas de guardar las credenciales en una base de datos SQlite, con encripci√≥n y hashing de las contrase√±as.\nPara m√°s informaci√≥n sobre el uso de {shinymanager}, consulta su documentaci√≥n.\n","date":"2025-02-17T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_shinymanager/","tags":"shiny ; aplicaciones","title":"Protege el acceso a tus aplicaciones Shiny con contrase√±a"},{"content":"¬øTe ha pasado que tienes una tabla con datos perdidos, y otra tabla con una columna que coincide con la primera tabla, que adem√°s cuenta con datos que quieres usar para rellenar las observaciones perdidas? Antes pensaba que esto se resolv√≠a con left_join() y alg√∫n ajuste para reemplazar los perdidos con los datos anexados. Pero ayer conoc√≠ una funci√≥n que resuelve este problema de inmediato: rows_update()!\nlibrary(dplyr) |\u0026gt; suppressPackageStartupMessages() tabla_1 \u0026lt;- tibble(ciudad = c(\u0026#34;Santiago\u0026#34;, \u0026#34;Concepci√≥n\u0026#34;, \u0026#34;Valpara√≠so\u0026#34;, \u0026#34;Arica\u0026#34;), poblacion = c(7123891, 1036142, 1054253, 221364), temperatura = c(NA, 17.6, NA, 19.2)) tabla_1 # A tibble: 4 √ó 3 ciudad poblacion temperatura \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Santiago 7123891 NA 2 Concepci√≥n 1036142 17.6 3 Valpara√≠so 1054253 NA 4 Arica 221364 19.2 tabla_2 \u0026lt;- tibble(ciudad = c(\u0026#34;Santiago\u0026#34;, \u0026#34;Rancagua\u0026#34;, \u0026#34;Concepci√≥n\u0026#34;, \u0026#34;Arica\u0026#34;, \u0026#34;Valpara√≠so\u0026#34;), temperatura = c(22.8, 14.0, 17.6, 19.2, 17.5)) tabla_2 # A tibble: 5 √ó 2 ciudad temperatura \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Santiago 22.8 2 Rancagua 14 3 Concepci√≥n 17.6 4 Arica 19.2 5 Valpara√≠so 17.5 En este ejemplo, tenemos dos tablas: la primera tiene una columna con datos perdidos o faltantes, y la segunda tabla, de datos similares, contiene las observaciones que en la primera tabla est√°n faltando.\nUna soluci√≥n ser√≠a unir ambas tablas con left_join(), lo cual resultar√≠a en dos columnas con el mismo nombre a las que se les agregan las letras x e y para distinguirlas. Luego habr√≠a que usar la funci√≥n if_else() para rellenar las filas que tienen casos perdidos con el posible valor de la segunda columna:\ntablas_unidas \u0026lt;- left_join(tabla_1, tabla_2, by = \u0026#34;ciudad\u0026#34;) tablas_unidas # A tibble: 4 √ó 4 ciudad poblacion temperatura.x temperatura.y \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Santiago 7123891 NA 22.8 2 Concepci√≥n 1036142 17.6 17.6 3 Valpara√≠so 1054253 NA 17.5 4 Arica 221364 19.2 19.2 # rellenar usando ifelse() tablas_unidas |\u0026gt; mutate(temperatura.rellenada = if_else(is.na(temperatura.x), temperatura.y, temperatura.x)) # A tibble: 4 √ó 5 ciudad poblacion temperatura.x temperatura.y temperatura.rellenada \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Santiago 7123891 NA 22.8 22.8 2 Concepci√≥n 1036142 17.6 17.6 17.6 3 Valpara√≠so 1054253 NA 17.5 17.5 4 Arica 221364 19.2 19.2 19.2 Una segunda soluci√≥n se lograr√≠a usando la funci√≥n de {dplyr} especializada para estos casos: coalesce(), a la cual le entregas dos o m√°s columnas, y utiliza el primer dato no perdido entre ellas para generar la nueva columna. En otras palabras, te permite unir varias columnas en una sola, cuando estas columnas pueden tener un mismo dato pero no tiene certeza en cu√°l de las columnas se encuentra.\n# rellenar usando coalesce() tablas_unidas |\u0026gt; mutate(temperatura2 = coalesce(temperatura.x, temperatura.y)) # A tibble: 4 √ó 5 ciudad poblacion temperatura.x temperatura.y temperatura2 \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Santiago 7123891 NA 22.8 22.8 2 Concepci√≥n 1036142 17.6 17.6 17.6 3 Valpara√≠so 1054253 NA 17.5 17.5 4 Arica 221364 19.2 19.2 19.2 La tercera forma me resulta la m√°s conveniente. La funci√≥n rows_update() funciona casi igual que left_join(), pero la uni√≥n entre ambas tablas se realiza encima de la primera tabla, dado que se asume que ambas tablas comparten una o varias columnas con datos, y que solamente queremos rellenar la primera tabla con los datos de la segunda tabla cuando estos est√©n ausentes en la primera.\ntabla_1 |\u0026gt; rows_update(tabla_2, by = \u0026#34;ciudad\u0026#34;, unmatched = \u0026#34;ignore\u0026#34;) # A tibble: 4 √ó 3 ciudad poblacion temperatura \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Santiago 7123891 22.8 2 Concepci√≥n 1036142 17.6 3 Valpara√≠so 1054253 17.5 4 Arica 221364 19.2 Usando esta alternativa, nos ahorramos el paso de tener las columnas duplicadas y tenerte resolver la duplicidad manualmente, dado que rows_update() se encarga de esto.\nLa conveniencia es que de esta forma puedes rellenar m√∫ltiples columnas al mismo tiempo si es que tu segunda tabla tambi√©n posee m√∫ltiples columnas con datos de reemplazo para la primera tabla. El √∫nico inconveniente es que a la segunda tabla no le deben sobrar columnas que no est√©n presentes en la primera tabla, dado que rows_update() est√° enfocada en el reemplazo de datos sobre una primera tabla, no agregar nuevas columnas, como ser√≠a en left_join().\n","date":"2025-02-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-02-14/","tags":"dplyr ; limpieza de datos ; datos perdidos","title":"Rellenar datos perdidos usando datos de otra tabla"},{"content":"Los archivos csv (comma-separated values, valores separados por comas) suelen ser el formato m√°s b√°sico para guardar datos. Los beneficios que tienen los csv con respecto a compatibilidad y accesibilidad son a su vez la causa de sus desventajas: son m√°s pesados porque sus datos no se guardan comprimidos, y suelen ser m√°s lentos de cargar, porque los datos no vienen codificados de una forma optimizada.\nSin embargo, usualmente grandes bases de datos son guardadas en archivos csv, con varios millones de filas, lo que puede hacer que la carga de un archivo dure entre varios segundos a minutos.\nHagamos una comparaci√≥n cargando un archivo csv de 2,5 GB1, con m√°s de 16 millones de filas y 12 columnas, por medio de 3 funciones: read.csv() de R base, read_csv de {readr}, y read_csv_arrow de {arrow}.\nlibrary(readr) library(arrow) library(tictoc) # para medir el tiempo que tardan archivo \u0026lt;- \u0026#34;~/Downloads/Beneficiarios Fonasa 2023.csv\u0026#34; # ruta de la base 1. read.csv() Esta funci√≥n viene por defecto en R, y es la que peor desempe√±o tiene, adem√°s de cargar los datos en un dataframe tradicional en lugar de un tibble:\ntic() datos \u0026lt;- read.csv(archivo, encoding = \u0026#34;latin1\u0026#34;) toc() 48.875 sec elapsed La carga del archivo demora casi un minuto con este m√©todo por defecto.\n2. readr::read_csv() El paquete {readr} es muy vers√°til para leer y escribir datos con un desempe√±o aceptable y una sintaxis consistente:\ntic() datos \u0026lt;- readr::read_csv(archivo, locale = locale(encoding = \u0026#34;latin1\u0026#34;), show_col_types = F) toc() 25.183 sec elapsed Usando este m√©todo de carga, obtenemos resultados casi tres veces m√°s r√°pido que con el m√©todo de R por defecto! Adem√°s, obtenemos los datos en un c√≥modo y moderno tibble. Pero todav√≠a puede ser m√°s r√°pido\u0026hellip;\n3. arrow::read_csv_arrow() Los desarrolladores de la tecnolog√≠a Arrow, principalmente conocida por el excelente formato de datos columnares .parquet (que supera a cualquier otro en velocidad de lectura y eficiencia de almacenamiento), ofrecen una funci√≥n optimizada para la lectura de archivos csv:\ntic() datos \u0026lt;- arrow::read_csv_arrow(archivo, read_options = csv_read_options(encoding = \u0026#34;latin1\u0026#34;)) toc() 8.094 sec elapsed ¬°S√≥lo 7 segundos! Confirmamos que el paquete {arrow} ofrece un lector optimizado de archivos csv que supera en velocidad a cualquier otro que podamos usar en R.\nConclusiones Realicemos un benchmark para contar con los datos claros sobre el veredicto final:\nresultado \u0026lt;- bench::mark(check = FALSE, iterations = 1, base = read.csv(archivo, encoding = \u0026#34;latin1\u0026#34;), readr = readr::read_csv(archivo, locale = locale(encoding = \u0026#34;latin1\u0026#34;), show_col_types = F), arrow = arrow::read_csv_arrow(archivo, read_options = csv_read_options(encoding = \u0026#34;latin1\u0026#34;)), ) resultado # A tibble: 3 √ó 6 expression min median `itr/sec` mem_alloc `gc/sec` \u0026lt;bch:expr\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;bch:byt\u0026gt; \u0026lt;dbl\u0026gt; 1 base 47s 47s 0.0213 5.71GB 0.170 2 readr 32.1s 32.1s 0.0311 1.45GB 0 3 arrow 12.6s 12.6s 0.0791 123.83MB 0 En el resultado final de este experimento, cargar un archivo csv con arrow::read_csv_arrow() resulta casi el doble de r√°pido que cargarlo con readr::read_csv(), y m√°s de cinco veces m√°s r√°pido que cargarlo con el t√≠pico read.csv()!\nSi revisamos la columna mem_alloc, tambi√©n podemos confirmar que, adem√°s de ser m√°s r√°pido, ocupa much√≠sima menos memoria para llevar a cabo la carga: mientras R base consume casi 6 GB de memoria, Arrow lo logra con ~120 MB!\nEn el an√°lisis de datos, si bien la conveniencia es un factor primordial (c√≥digo m√°s sencillo, legible y f√°cil de escribir nos permite generar resultados mucho m√°s r√°pido), siempre es posible replantearnos la forma en que trabajamos para pensar alternativas m√°s optimizadas y veloces, si es que el volumen de datos con los que trabajamos lo amerita.\nSe trata de una base de datos de beneficiarios del Fondo Nacional de Salud de Chile (Fonasa), disponible en su sitio web de datos abiertos. Una versi√≥n agregada de los datos est√° disponible en mi GitHub.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-02-12T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-02-12/","tags":"consejos ; datos ; optimizaci√≥n","title":"Cargar archivos csv m√°s r√°pido en R con Arrow"},{"content":"Acabo de publicar una nueva p√°gina donde voy a estar recopilando todos los conjuntos de datos sociales con los que trabajo o he trabajado.\nLa idea de esta p√°gina es poder compartir f√°cilmente datos sociales sobre Chile que vienen limpios y procesados, para facilitar el trabajo de otras personas, y tambi√©n ayudarles a aprender an√°lisis de datos.\nSe trata de una tabla que se genera autom√°ticamente, la cual contiene una lista de repositorios enfocados en datos sociales, con clasificaci√≥n seg√∫n la tem√°tica del dato, y varias columnas que indican las caracter√≠sticas del conjunto de datos, como si es que el dato contiene variables de g√©nero, si est√° desagregado a nivel comunal, si existe una aplicaci√≥n de visualizaci√≥n de datos asociada, la temporalidad (anual/mensual/semanal) de las observaciones, y m√°s.\nEn cada repositorio se encuentran tambi√©n scripts con el c√≥digo que se utiliza para obtener los datos, procesarlos, limpiarlos, y tambi√©n para generar nuevos productos a partir de estos datos, tales como gr√°ficos, tablas, y aplicaciones.\nLa tabla se genera mediante un web scraping de mi cuenta de GitHub. Un script de web scraping en R navega por todos los repositorios de mi cuenta, y va obteniendo toda la informaci√≥n de cada uno de ellos. Los contenidos de la tabla se adaptan en base a las etiquetas que tiene cada repositorio, la descripci√≥n viene de la descripci√≥n de cada repo, y el t√≠tulo viene del readme. Las columnas con iconos tambi√©n se hacen autom√°ticamente a partir de las etiquetas. La tabla se genera con el paquete {gt}. La p√°gina se genera con Quarto y se publica autom√°ticamente con GitHub Pages.\nLa conveniencia de este flujo de trabajo es que, por mi parte, solamente tengo que seguir subiendo repositorio, y solamente componerles las etiquetas y descripciones en GitHub, √©ste mini sitio se va a actualizar y reflejar la nueva informaci√≥n sin tener que hacer nada de trabajo extra.\nSi quieres crear t√∫ tambi√©n un mini sitio basado en R y Quarto, puedes seguir este tutorial de Quarto que hice, donde ense√±o lo simple que es combinar las herramientas y librer√≠as de R para personalizar y dar contenido a los documentos creados con Quarto, incluyendo reportes en HTML, sitios web y blogs.\n","date":"2025-02-09T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/datos_sociales/","tags":"blog ; datos ; tablas ; quarto ; Chile","title":"Repositorio de datos sociales"},{"content":"Los modelos de lenguaje (LLM) son herramientas muy √∫tiles para analizar texto, y usarlos en tus an√°lisis de datos con R es sencillo. Previamente en este blog ya he explicado c√≥mo usar LLMs para an√°lisis de sentimiento y otros usos. En este tutorial, te ense√±o a utilizar modelos de lenguaje locales, instalados en tu propio computador, para obtener res√∫menes de textos. Esto puede servir por si est√°s analizando una base de datos de texto que contenga textos de extensi√≥n larga, para los cuales ser√≠a conveniente tener una versi√≥n m√°s breve. Por ejemplo, al analizar resultados de web scraping, conjuntos de datos period√≠sticos o de noticias, datos de entrevistas, respuestas abiertas en encuestas, etc.\nPrimero, obtendremos un corpus de textos de noticias chilenas publicadas el a√±o 2024, en forma de un dataframe con columnas con el t√≠tulo, cuerpo, fuente y fecha de las noticias. Los datos son obtenidos de este repositorio de obtenci√≥n automatizada de textos de noticias de prensa escrita chilena.\nlibrary(dplyr) library(readr) library(stringr) url_datos \u0026lt;- \u0026#34;https://raw.githubusercontent.com/bastianolea/prensa_chile/refs/heads/main/datos/prensa_datos_muestra.csv\u0026#34; noticias \u0026lt;- read_csv2(url_datos) Exploremos r√°pidamente los datos:\nset.seed(1234) noticias_muestra \u0026lt;- noticias |\u0026gt; slice_sample(n = 20) head(noticias_muestra) # A tibble: 6 √ó 4 titulo cuerpo fuente fecha \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; 1 ‚ÄúCicl√≥n extratropical‚Äù: los registros de su paso por‚Ä¶ \u0026quot;En l‚Ä¶ The C‚Ä¶ 2024-06-02 2 Actividades con Boric, Vallejo y Bachelet: Los gesto‚Ä¶ \u0026quot;ATON‚Ä¶ Emol 2024-08-10 3 Choque mortal entre bus y auto en Los R√≠os: Un condu‚Ä¶ \u0026quot;Un m‚Ä¶ Megan‚Ä¶ 2024-04-07 4 Capturan a asaltante solitaria que rob√≥ m√°s de $4 mi‚Ä¶ \u0026quot;En m‚Ä¶ Emol 2024-06-13 5 Debido a la extracci√≥n de litio: Investigaci√≥n revel‚Ä¶ \u0026quot;Univ‚Ä¶ Emol 2024-08-23 6 C√°mara acoge renuncia de Ricardo Cifuentes (DC), qui‚Ä¶ \u0026quot;El 2‚Ä¶ D. Fi‚Ä¶ 2024-04-08 Confirmemos c√≥mo llega el texto de las noticias:\nnoticias_muestra |\u0026gt; slice(1) |\u0026gt; # extraer una fila pull(cuerpo) |\u0026gt; # extraer variable como vector str_trunc(800) |\u0026gt; # recortar textos muy largos str_wrap(70) |\u0026gt; # insertar saltos de l√≠nea cada x caracteres cat() # imprimir En las √∫ltimas semanas se ha mencionado repetidamente el concepto de ‚Äúcicl√≥n extratropical‚Äù para referirse al evento meteorol√≥gico que afectar√° a Chile. El nombre por s√≠ solo suena a un fen√≥meno clim√°tico poderoso y fuera de lo com√∫n, pero seg√∫n especialistas, el pa√≠s ya ha enfrentado este tipo de eventos anteriormente. El concepto de cicl√≥n extratropical hace referencia a un sistema frontal con baja presi√≥n, y es esta baja presi√≥n la que le da el nombre de cicl√≥n. El evento marcar√° la primera semana de junio y el sistema ya est√° ubicado en aguas abiertas del Pac√≠fico Sur. Seg√∫n reporta el sitio especializado MeteoRed, el cicl√≥n extratropical destaca por su extraordinaria extensi√≥n seg√∫n las im√°genes satelitales. A√∫n es incierta la proyecci√≥n de lluvias para la Regi√≥n Metropolitana esta... Revisemos el promedio de palabras de cada noticia:\nnoticias_muestra |\u0026gt; # calcular cantidad de palabras mutate(palabras = str_split(cuerpo, pattern = \u0026#34; \u0026#34;) |\u0026gt; lengths()) |\u0026gt; # calcular cantidad de caracteres mutate(caracteres = nchar(cuerpo)) |\u0026gt; summarize(palabras = mean(palabras), caracteres = mean(caracteres)) # A tibble: 1 √ó 2 palabras caracteres \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 368. 2283. C√≥mo podemos ver, cada noticia tiene en promedio cerca de 400 palabras o m√°s de 2000 caracteres. Usaremos un modelo de lenguaje para crear una nueva variable que contenga una versi√≥n resumida del texto de las noticias, para agilizar su comprensi√≥n.\nPero primero, tenemos que elegir e instalar un modelo de lenguaje local.\nConfiguraci√≥n del modelo de lenguaje local Para poder usar modelos LLM localmente con R, tenemos que instalar Ollama en nuestro equipo, que es la aplicaci√≥n que nos permite obtener y usar modelos de lenguaje locales. Ollama tiene que estar abierto para poder proveer del modelo de lenguaje a nuestra sesi√≥n de R.\nLuego, ya sea desde Ollama o desde R, tenemos que instalar un modelo de lenguaje.\nPara instalar un modelo de lenguaje desde R, es tan simple como ejecutar: ollamar::pull(\u0026quot;llama3.2:3b\u0026quot;), definiendo entre comillas el modelo que hayamos elegido para instalar. Al elegir un modelo, debes considerar las capacidades de tu computador para ejecutar los modelos, y que el tama√±o del modelo es directamente proporcional con la calidad de sus respuestas1.\nPara instalar un modelo desde ollama, en la l√≠nea de comandos o Terminal de tu equipo, ejecuta ollama pull llama3.2:3b y el modelo se descargar√° en tu equipo.\nUna vez que tengas Ollama abierto en tu computador, y un modelo previamente instalado, puedes proceder a usarlo en R en el siguiente paso.\nGenerar res√∫menes de texto El primer paso para trabajar con modelos de lenguaje extensos con datos tabulares R es cargar el paquete {mall}, y especificar qu√© modelo queremos usar:\nlibrary(mall) # paquete para usar LLM en dataframes de R llm_use(\u0026#34;ollama\u0026#34;, \u0026#34;llama3.2:3b\u0026#34;) # indicar qu√© modelo usaremos ‚îÄ‚îÄ mall session object Backend: ollama LLM session: model:llama3.2:3b R session: cache_folder:/var/folders/z8/61w5pwts4h5fsvhfqs1wpvk40000gn/T//RtmpI1xMRn/_mall_cache8da8ff9738f Posteriormente, podemos utilizar todas las funciones que empiezan con llm_ para aplicar funciones que utilizan los modelos de lenguaje sobre cada observaci√≥n de la columna que especifiquemos. En este caso, para producir res√∫menes de texto, usamos la funci√≥n llm_summarize(), la cual contiene un prompt dise√±ado para resumir textos hacia la cantidad de palabras que solicitemos.\n# crear columna de resumen de los textos noticias_muestra_resumen \u0026lt;- noticias_muestra |\u0026gt; llm_summarize(cuerpo, # columna con el texto original max_words = 20, # cantidad de palabras del resumen pred_name = \u0026#34;resumen\u0026#34;, # nombre de la columna resultante additional_prompt = \u0026#34;en espa√±ol\u0026#34; ) El proceso puede tardar unos minutos, dado que el modelo tiene que consumir el texto, realizar las relaciones entre todas las palabras, y generar la inferencia que produce el texto de salida. En mi computador, el procesamiento de 20 noticias se demor√≥ un poco menos de 1 minuto, pero este tiempo puede variar en base al equipo que tengas y la cantidad de texto de cada elemento.\nSi los textos son demasiado largos, se puede usar una funci√≥n como str_trunc(texto, side = \u0026quot;center\u0026quot;, width = 3000) para truncar textos demasiado largos cortando el texto sobrante desde el medio del texto.\nExploremos los resultados obtenidos:\nnoticias_muestra_resumen |\u0026gt; select(resumen) |\u0026gt; # calcular cantidad de palabras mutate(palabras = str_split(resumen, pattern = \u0026#34; \u0026#34;) |\u0026gt; lengths()) |\u0026gt; # calcular cantidad de caracteres mutate(caracteres = nchar(resumen)) |\u0026gt; summarize(palabras_prom = mean(palabras), palabras_min = min(palabras), palabras_max = max(palabras), caracteres_prom = mean(caracteres)) # A tibble: 1 √ó 4 palabras_prom palabras_min palabras_max caracteres_prom \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; 1 18.4 16 23 114. noticias_muestra_resumen |\u0026gt; slice(1) |\u0026gt; pull(resumen) [1] \u0026quot;el cicl√≥n extratropical llega a chile en la primera semana de junio con lluvias intenses en algunas regiones\u0026quot; noticias_muestra_resumen |\u0026gt; slice(4) |\u0026gt; pull(resumen) [1] \u0026quot;la mujer detenida es sospechosa de un robo en una sucursal bancaria de la zona sur de antofagasta con m√°s de $4 millones.\u0026quot; noticias_muestra_resumen |\u0026gt; slice(3) |\u0026gt; pull(resumen) [1] \u0026quot;un bus y un autom√≥vil chocaron, dejando un fallecido y 15 personas heridas en la ruta t-202.\u0026quot; Podemos ver que los nuevos textos mantienen coherencia con los textos originales, y en promedio consiste de res√∫menes de 17 palabras, con un m√°ximo de 21 palabras. Considerando que le pedimos al modelo que el m√°ximo de palabra fueran 20, esto no hace recordar que los modelos de lenguaje no son deterministas, por lo tanto las instrucciones que les demos no reflejar√°n en un 100% los resultados que esperamos, y los resultados obtenidos nunca ser√°n en un 100% consistentes, siempre habiendo un posible factor de azar y alucinaci√≥n.\nSi los res√∫menes aparecen incorrectos, o salen en ingl√©s, se puede usar el argumento additional_prompt de llm_summarize() para indicarle al modelo expl√≠citamente que quieres resultados en espa√±ol, o siguiendo alguna otra instrucci√≥n.\nSi tu computador es muy b√°sico (tiene poca memoria RAM), recomiendo instalar Llama 3.2 1B. Si tiene al menos 8GB de memoria, recomiendo Llama 3.2 3B. Si tienes suficiente memoria (m√°s de 8GB), recomiendo Llama 3.1 8B.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2025-02-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/resumir_texto_llm/","tags":"an√°lisis de texto ; inteligencia artificial","title":"Resumir textos usando modelos de lenguaje (LLM) locales en R"},{"content":"Exposici√≥n en la Universidad Internacional de la Municipalidad de Rancagua, instancia organizada por el Programa de Gobierno Local Abierto (GOBLA) de la Municipalidad de Rancagua.\nEn esta presentaci√≥n doy a conocer el visualizador de datos de Corrupci√≥n, explicando c√≥mo fue el proceso de inspirarme a hacerlo, los desaf√≠os que tuve durante su desarrollo, y la experiencia de colaboraci√≥n y discusi√≥n en torno a un proyecto de datos que pueden ser pol√©micos.\nPuedes explorar la aplicaci√≥n siguiendo √©ste enlace. Las Clases Magistrales de la UNIM promueven la participaci√≥n activa de las y los ciudadanos en la creaci√≥n y difusi√≥n del conocimiento, por medio de clases interdisciplinarias de diversos/as representantes del √°mbito acad√©mico y del sector p√∫blico, tanto locales, nacionales como internacionales.\nDiapositivas ","date":"2025-01-24T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/unim/presentacion_visualizador_datos_corrupcion/","tags":"shiny ; Chile ; visualizaci√≥n de datos ; aplicaciones ; videos","title":"Video: Presentaci√≥n de Visualizador de datos de Corrupci√≥n en Chile"},{"content":"Tuve el privilegio de exponer en la Universidad Internacional de la Municipalidad de Rancagua, un espacio de di√°logo, aprendizaje y colaboraci√≥n, organizado por el Programa de Gobierno Local Abierto (GOBLA) de la Municipalidad de Rancagua.\nPresent√© un taller dirigido a funcionarios y funcionarias municipales sobre Aplicaci√≥n de la ciencia de datos en la Gesti√≥n Municipal, donde comuniqu√© la importancia de manejar herramientas de progamaci√≥n para le an√°lisis de datos, favoreciendo el desarrollo de herramientas reutilizables, reproducibles, transparentes y abiertas.\nFue una instancia muy interesante, con mucha participaci√≥n e inter√©s de personas dentro y fuera del sector p√∫blico, donde espero haber comunicado la importancia de las iniciativas de c√≥digo y datos abiertos! Y que mucha m√°s gente y funcionarios municipales sigan creando iniciativas de an√°lisis de datos para el beneficio de todas y todos üíú\nLas Jornadas de Buenas Pr√°cticas de la UNIM son un espacio de formaci√≥n donde se promueve la colaboraci√≥n e intercambio de experiencias exitosas en el sector p√∫blico nacional e internacional. Generando una oportunidad para potenciar las competencias t√©cnicas, el conocimiento y la capacidad de innovar.\nDiapositivas Estudio de caso 1 An√°lisis de datos obtenidos desde Transparencia, mostrando la capacidad de reutilizar c√≥digo, y de automatizar la descarga de los datos manejando un navegador usando c√≥digo.\nAn√°lisis de datos # fuente de los datos: # https://www.portaltransparencia.cl/PortalPdT/directorio-de-organismos-regulados/?org=MU260# # para descargar, entrar a \u0026#34;04. Personal y remuneraciones\u0026#34;, luego \u0026#34;Personal a Contrata\u0026#34; # cargar librer√≠as library(tidyverse) # cargar datos descargados datos \u0026lt;- read_csv2(\u0026#34;caso_1_personal_contrata/TransparenciaActiva.csv\u0026#34;, locale = locale(encoding = \u0026#34;latin1\u0026#34;)) |\u0026gt; # limpiar nombres de columnas janitor::clean_names() # en este bloque de c√≥digo, si cambiamos la ruta del archivo cargado, podemos re-aplicar todo el procedimiento a cualquier archivo que tengamos, permitiendo reutilizar el script completo para cada archivo de datos de la plataforma de Transparencia # conteo r√°pido de una variable datos |\u0026gt; count(estamento) # revisi√≥n r√°pida de los datos datos |\u0026gt; glimpse() # ejemplo 1a: limpiar una columna de remuneraciones datos |\u0026gt; select(starts_with(\u0026#34;remunera\u0026#34;)) |\u0026gt; mutate(remuneracion_bruta_mensualizada = parse_number(remuneracion_bruta_mensualizada, locale = locale(grouping_mark = \u0026#34;.\u0026#34;))) # ejemplo 1b: reutilizar el c√≥digo anterior para limpiar todas las columnas de remuneraciones al mismo tiempo datos2 \u0026lt;- datos |\u0026gt; # select(starts_with(\u0026#34;remunera\u0026#34;)) |\u0026gt; mutate(across(starts_with(\u0026#34;remunera\u0026#34;), \\(var) parse_number(var, locale = locale(grouping_mark = \u0026#34;.\u0026#34;)))) |\u0026gt; print() # ejemplo 2a: obtener estad√≠sticos descriptivos de una de las variables de remuneraciones datos2 |\u0026gt; group_by(estamento) |\u0026gt; summarize(mean = mean(remuneracion_liquida_mensualizada), mediana = median(remuneracion_liquida_mensualizada), min = min(remuneracion_liquida_mensualizada), max = max(remuneracion_liquida_mensualizada), x25 = quantile(remuneracion_liquida_mensualizada, .25)) # ejemplo 2b: reutilizar el c√≥digo anterior para obtener estad√≠sticos descriptivos de otra variable, agrupada por una variable distinta datos2 |\u0026gt; group_by(grado_eus_o_jornada) |\u0026gt; summarize(mean = mean(remuneracion_liquida_mensualizada), mediana = median(remuneracion_liquida_mensualizada), min = min(remuneracion_liquida_mensualizada), max = max(remuneracion_liquida_mensualizada), x25 = quantile(remuneracion_liquida_mensualizada, .25), n = n()) |\u0026gt; arrange(desc(mediana)) Obtenci√≥n automatizada de los datos de Transparencia con Selenium # descarga automatizada de datos usando web scraping para controlar un navegador # cargar paquete para web scraping interactivo library(RSelenium) # crear un navegador controlable mediante c√≥digo driver \u0026lt;- rsDriver(port = 4567L, browser = \u0026#34;firefox\u0026#34;, chromever = NULL) navegador \u0026lt;- driver[[\u0026#34;client\u0026#34;]] # navegar a la p√°gina navegador$navigate(\u0026#34;https://www.portaltransparencia.cl/PortalPdT/directorio-de-organismos-regulados/?org=MU260#pills-1\u0026#34;) for (i in 1:11) { # entrar a personal de contrata navegador$findElement(\u0026#39;xpath\u0026#39;, \u0026#39;//*[@id=\u0026#34;A6428:formInfo:j_idt39:0:datalist:3:j_idt43:0:j_idt47\u0026#34;]\u0026#39;)$ clickElement() Sys.sleep(1) # presionar 2024 navegador$findElement(\u0026#39;css selector\u0026#39;, \u0026#39;li.ui-datalist-item:nth-child(1)\u0026#39;)$ # cambiar a√±o clickElement() Sys.sleep(1) # elegir un mes navegador$findElement(\u0026#39;css selector\u0026#39;, paste0(\u0026#39;#A6428\\\\:formInfo\\\\:j_idt94_list \u0026gt; li:nth-child(\u0026#39;, i, \u0026#39;)\u0026#39;))$ clickElement() # van del 1 al 11 en 2024 Sys.sleep(1) # descargar archivo navegador$findElement(\u0026#39;css selector\u0026#39;, \u0026#39;.fa-file-csv\u0026#39;)$ clickElement() Sys.sleep(1) # volver al inicio navegador$findElement(\u0026#39;xpath\u0026#39;, \u0026#39;//*[@id=\u0026#34;A6428:formInfo:j_idt64\u0026#34;]\u0026#39;)$ clickElement() Sys.sleep(1) } Estudio de caso 2 Automatizaci√≥n de la descarga de todos los archivos mensuales, y transformaci√≥n de los archivos PDF a tablas de datos en formato CSV.\nDescarga de datos # descargar libro diario siguiendo la secuencia de los nombres de archivo # fuente de los datos: # https://www.portaltransparencia.cl/PortalPdT/directorio-de-organismos-regulados/?org=MU260# # para descargar, entrar a \u0026#34;11. Informaci√≥n Presupuestaria\u0026#34;, luego \u0026#34;Libro diario municipal\u0026#34; # https://transparencia.rancagua.cl/documentos/daf/2024-11-ILD.pdf # descargar un solo archivo directamente download.file(\u0026#34;https://transparencia.rancagua.cl/documentos/daf/2024-11-ILD.pdf\u0026#34;, \u0026#34;caso_2_libro_diario/2024-11-ILD.pdf\u0026#34;) # podemos cambiar el enlace para obtener un archivo correspondiente a otro mes, dado que los archivos vienen por meses y el mes est√° definido en el enlace mismo # siguiendo esta misma idea, podemos automatizar el proceso de desacrgar todos los archivos del a√±o # cargar paquetes library(stringr) # crear secuencia de n√∫meros con los meses que necesitamos numeros \u0026lt;- 1:11 # agregar ceros a los n√∫meros si es necesario meses \u0026lt;- ifelse(numeros \u0026lt; 10, paste0(\u0026#34;0\u0026#34;, numeros), numeros) # crear los nombres de los archivos en base a la secuencia de meses archivos \u0026lt;- paste(\u0026#34;2024-\u0026#34;, meses, \u0026#34;-ILD.pdf\u0026#34;, sep = \u0026#34;\u0026#34;) # crear los enlaces en base a los nombres de archivos enlaces \u0026lt;- paste(\u0026#34;https://transparencia.rancagua.cl/documentos/daf/\u0026#34;, archivos, sep = \u0026#34;\u0026#34;) # crear las rutas donde guardaremos los archivos descargados en base a los nombres de archivos rutas \u0026lt;- paste(\u0026#34;caso_2_libro_diario/\u0026#34;, archivos, sep = \u0026#34;\u0026#34;) # descargar todos los archivos autom√°ticamente for (mes in 1:11) { download.file(enlaces[mes], rutas[mes]) Sys.sleep(1) } Extraer datos desde un PDF # Transparencia Activa # 11. Informaci√≥n Presupuestaria: # Libro diario municipal # 2024 \u0026gt; NOVIEMBRE # cargar paquetes library(tidyverse) library(tabulapdf) documento \u0026lt;- \u0026#34;caso_2_libro_diario/2024-10-ILD.pdf\u0026#34; # prueba 1: # intentar extraer los datos, pero vemos que llegan muy desordenados tabulapdf::extract_tables(documento, pages = 1:3) # prueba 2: # usar este comando las veces que sea necesario para obtener las coordenadas horizontales de documento que indican el inicio y final de cada columna tabulapdf::locate_areas(documento, 3) # crear lista con coordenadas columnas \u0026lt;- list(c(35.85436, 100.69957, 143.79596, 187.50326, 240.25774, 310.74166, 491.55613, 554.61603, 608.18382)) # extraer datos especificando los cortes de cada columna tablas_0 \u0026lt;- tabulapdf::extract_tables(documento, pages = 1:3, guess = FALSE, columns = columnas ) # revisar c√≥mo va quedando tablas_0 |\u0026gt; list_rbind() |\u0026gt; print(n=100) # limpieza inicial de las columnas tablas_1 \u0026lt;- tablas_0 |\u0026gt; list_rbind() |\u0026gt; rename(comprobante = 2, fecha = 3, documento = 4, analisis = 5, cuenta = 6, denominacion = 7, debe = 8, haber = 9) |\u0026gt; select(-1) tablas_1 # mantener s√≥lo filas con fecha tablas_2 \u0026lt;- tablas_1 |\u0026gt; # filter(!is.na(fecha)) |\u0026gt; filter(str_detect(fecha, \u0026#34;\\\\d{4}\u0026#34;) | str_detect(fecha, \u0026#34;\\\\w+\u0026#34;)) |\u0026gt; print() # extraer la l√≠nea horizontal de texto que atravieza todas las columnas y guardarla en su propia columna tablas_3 \u0026lt;- tablas_2 |\u0026gt; mutate(titular = ifelse(str_detect(fecha, \u0026#34;\\\\w+\u0026#34;), paste(fecha, documento, analisis, cuenta, denominacion, debe) |\u0026gt; str_remove_all(\u0026#34;NA\u0026#34;), NA)) |\u0026gt; print() # rellenar hacia abajo variables que solo aparecen en una fila para cada observaci√≥n tablas_4 \u0026lt;- tablas_3 |\u0026gt; tidyr::fill(titular, comprobante, .direction = \u0026#34;down\u0026#34;) |\u0026gt; filter(str_detect(fecha, \u0026#34;\\\\d{2}/\\\\d{4}\u0026#34;)) |\u0026gt; print() # limpiar columnas num√©ricas tablas_5 \u0026lt;- tablas_4 |\u0026gt; mutate(debe = parse_number(debe, locale = locale(grouping_mark = \u0026#34;.\u0026#34;)), haber = parse_number(haber, locale = locale(grouping_mark = \u0026#34;.\u0026#34;))) |\u0026gt; print() # revisar tablas_5 |\u0026gt; print(n=100) # obtener un resumen de los datos obtenidos tablas_5 |\u0026gt; group_by(fecha) |\u0026gt; summarize(sum(debe), sum(haber)) # luego podemos guardar los datos como csv readr::write_csv2(tablas_5, \u0026#34;caso_2_libro_diario/libro_diario.csv\u0026#34;) ","date":"2025-01-24T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/unim/taller_ciencia_de_datos_gestion_municipal/","tags":"dplyr ; web scraping ; datos ; procesamiento de datos ; limpieza de datos ; Chile ; videos","title":"Video: Taller Aplicaci√≥n de la Ciencia de Datos en la Gesti√≥n Municipal"},{"content":" Actualizaci√≥n de app an√°lisis de prensa üóûÔ∏è Nuevo: gr√°fico de an√°lisis de sentimiento: elige un tema y revisa si las noticias recientes fueron mayormente positivas o negativas. Compara c√≥mo distintos medios abordan las tem√°ticas. ¬°Pronto m√°s detalle!\nVisita la aplicaci√≥n siguiendo √©ste enlace\nPara agregar esta funcionalidad a la app tuve que desarrollar un proceso automatizado de an√°lisis de datos usando modelos extensos de lenguaje (LLM). Luego de que se obtienen las noticias por web scraping, se deja ejecutando el modelo de lenguaje sobre las noticias recientes para analizar el sentimiento del texto, clasificar la noticia en tem√°ticas, y producir un resumen de su contenido.\nTuve que procesar cientos de miles de datos hacia atr√°s, lo que hago de manera local corriendo el modelo Llama 3.1 8B en mi computador, por lo que tom√≥ bastantes horas. Semanalmente son aprox. 3000 las noticias nuevas, las cuales se procesan en unas 8 horas aprox., por lo que ser√° factible dejar el computador todos los domingos por la noche analizando las noticias de la semana.\nPronto voy a poder agregar nuevas visualizaciones, como por ejemplo seleccionar un concepto (como Boric, delincuencia, Bachelet, miner√≠a, etc.) o varios conceptos a la vez, y visualizar si las noticias con esa/esas palabra/s han sido positivas o negativas, y c√≥mo esto var√≠a en cada medio.\n","date":"2025-01-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-01-14/","tags":"web scraping ; inteligencia artificial ; visualizaci√≥n de datos ; shiny","title":"Actualizaci√≥n de app An√°lisis de prensa: visualizaci√≥n de an√°lisis de sentimiento de noticias recientes"},{"content":" En la eterna batalla entre usuarios de tema oscuro y tema claro, yo lamentablemente soy del bando correcto: tema oscuro durante la noche, y tema claro durante el d√≠a.\nLa idea de usar un tema oscuro en una pantalla no es que se vea m√°s bonito y profesional todo de negro, sino ayudarte a reducir el contraste de la pantalla con respecto al espacio en el que est√°s trabajando. En este sentido, si est√°s en un espacio bien iluminado, deber√≠as usar un tema claro, para no forzar a vista a tener que adaptarse entre un entorno brillante y una pantalla oscura. Si est√°s en un espacio oscuro, o de iluminaci√≥n baja, deber√≠as usar un tema oscuro para adecuarte a la iluminaci√≥n a tu alrededor, junto con ajustar el brillo de tu pantalla.\nLa mayor√≠a de los sistemas operativos modernos cambian autom√°ticamente entre el tema claro u oscuro dependiendo de la hora del d√≠a, asumiendo que durante la noche tendremos menor iluminaci√≥n. Adem√°s, la mayor√≠a de las pantallas adaptan su brillo autom√°ticamente a la iluminaci√≥n ambiente, reduci√©ndola en espacios oscuros. Un paso extra de cuidado de la vista e higiene del sue√±o es el cambio de los colores de la pantalla a un tinte c√°lido durante la noche, activado por defecto en sistemas operativos macOS y iOS.\nPero RStudio no se adapta solito al tema de tu computador, principalmente porque los temas son configurados por el/la usuario/a. Para resolver esto, se necesitan dos paquetes y una peque√±a configuraci√≥n:\nInstala {usethis}, un paquete que facilita varias operaciones convenientes en R y asociadas al desarrollo con R, Instala {rsthemes}, un paquete que contiene temas para RStudio y varias utilidades relacionadas a los temas, como la habilidad de cambiarlos por medio de funciones, usar temas aleatorios, y m√°s. En tu consola de R, ejecuta usethis::edit_r_profile(), lo que har√° que se abra tu archivo .Rprofile. Este script es un archivo especial, que se ejecuta autom√°ticamente cada vez que inicies una sesi√≥n en R, por lo que puedes incluir en √©l ciertas configuraciones que siempre tengas que ejecutar, como la que incluiremos a continuaci√≥n. Incluye el siguiente c√≥digo en tu .Rprofile: # especificar temas para modo claro y oscuro if (interactive() \u0026amp;\u0026amp; requireNamespace(\u0026#34;rsthemes\u0026#34;, quietly = TRUE)) { rsthemes::set_theme_light(\u0026#34;Basti Purple Light\u0026#34;) # tema claro rsthemes::set_theme_dark(\u0026#34;Basti Purple Dark\u0026#34;) # tema oscuro # cambiar al tema dependiendo de la hora al iniciar una sesi√≥n en RStudio setHook(\u0026#34;rstudio.sessionInit\u0026#34;, function(isNewSession) { rsthemes::use_theme_auto(dark_start = \u0026#34;21:00\u0026#34;, # hora del tema oscuro dark_end = \u0026#34;6:00\u0026#34;) #hora del tema claro }, action = \u0026#34;append\u0026#34;) } Dentro de este bloque de c√≥digo, tienes que configurar cuatro cosas: el nombre del tema claro que quieres usar durante el d√≠a, y el nombre del tema oscuro que quieres usar durante la noche, junto con la hora del d√≠a a la que quieres que se active autom√°ticamente el modo oscuro, y la hora del d√≠a a la que quieres que se active el modo claro. En mi caso, estoy usando dos temas de RStudio morados que cre√© yo, basados en una paleta de colores morada y rosada. En este post explico c√≥mo descargarlos e instalarlos en tu RStudio.\nAhora, cada vez que abras una nueva sesi√≥n de RStudio (o reinicies tu sesi√≥n), el tema de RStudio se ajustar√° autom√°ticamente al tema que elegiste para el d√≠a o la noche!\nRecuerda cuidar tus ojos mientras programas mirando a la distancia con regularidad y configurando el brillo de tu pantalla para que sea similar al brillo de tu habitaci√≥n!\n","date":"2025-01-12T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-01-12/","tags":"consejos ; temas","title":"Configura RStudio para que cambie al modo oscuro o claro autom√°ticamente seg√∫n la hora del d√≠a"},{"content":"El paquete de R {camcorder} te permite ir registrando todos los gr√°ficos que hagas durante una sesi√≥n, y al final te entrega una animaci√≥n que contiene el paso a paso de tu proceso de visualizaci√≥n de datos, desde el gr√°fico de {ggplot2} inicial hasta el producto final.\nSolo tienes que instalarlo y activarlo para que todos los gr√°ficos que generes vayan siendo registrados autom√°ticamente:\n# instalar install.packages(\u0026#34;camcorder\u0026#34;) library(camcorder) # empeazr grabar gr√°ficos gg_record( dir = \u0026#34;gr√°ficos/grabacion\u0026#34;, device = \u0026#34;jpeg\u0026#34;, 1200, 1800, scale = 1.2, units = \u0026#34;px\u0026#34;, dpi = 300 ) Al iniciar la grabaci√≥n, hay que especificar las dimensiones del gr√°fico. Todos los gr√°ficos que generes desde ese momento tendr√°n esas dimensiones, independiente de el tama√±o de tu panel de gr√°ficos en RStudio. Esto es muy √∫til, porque al especificar las dimensiones de tu gr√°fico de antemano, te permite adecuar el dise√±o de tus visualizaciones a su tama√±o y escala desde el primer momento, en vez de tener que ajustar todos los tama√±os en el momento final de exportar el gr√°fico (esto tambi√©n es posible de hacer con el paquete {ggview}!).\nLos gr√°ficos van a ir guard√°ndose como imagen en la carpeta que especificaste, con un nombre de archivo secuencial.\nSi en alg√∫n momento necesitas cambiar las dimensiones de tu gr√°fico, puedes usar la funci√≥n gg_resize_film(), por ejemplo, si la forma que est√° tomando tu gr√°fico se beneficia m√°s de un lienzo m√°s largo o ancho. Tambi√©n, si necesitas pausar la grabaci√≥n, puedes usar gg_stop_recording() para que los gr√°ficos dejen de guardarse, y luego resumirla de la misma forma en que la iniciaste.\nCuando termines de hacer tu visualizaci√≥n, usa la funci√≥n gg_playback() para convertir todas las im√°genes en una animaci√≥n!\n# crear video gg_playback( last_as_first = FALSE, first_image_duration = 1, background = \u0026#34;white\u0026#34;, image_resize = 1280, playback = FALSE ) Los resultados son muy entretenidos! Me gust√≥ poder plasmar estos procesos detallistas en una animaci√≥n que expresa parte de las dificultades (y lo entretenido) de hacer gr√°ficos.\nGracias a Nicola Rennie por el post que me hizo conocer este interesante paquete ü•∞\nBonus Al generarse las animaciones en formato gif, quise convertirlas a un formato m√°s moderno (y eficiente) como .webp, as√≠ que us√© ffmpeg. Pero tambi√©n me di cuenta que ten√≠a que recortar algunos videos (porque el gr√°fico final quedaba con bordes en blanco, debido a la proporci√≥n de aspecto de los primeros gr√°ficos era m√°s alta o ancha que el del final), y achicar otros para que fueran mas livianos, as√≠ que dejo los comandos que us√© para convertir gif a webp recortando y achicando:\n# achicar video ffmpeg -f gif -i \u0026#34;2025_01_11_01_24_41.gif\u0026#34; -c libwebp -vf scale=800:-1 -loop 0 camcorder1.webp # recortar video ffmpeg -f gif -i \u0026#34;2025_01_11_01_21_05.gif\u0026#34; -c libwebp -vf crop=850:1280 -loop 0 camcorder3.webp ffmpeg -f gif -i \u0026#34;2025_01_11_01_22_24.gif\u0026#34; -c libwebp -vf crop=1280:1134 -loop 0 camcorder2.webp # recortar y luego achicar: ffmpeg -f gif -i \u0026#34;2025_01_11_01_22_24.gif\u0026#34; -c libwebp -vf \u0026#34;crop=1280:1134,scale=800:-1\u0026#34; -loop 0 camcorder2b.webp ","date":"2025-01-11T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/camcorder/","tags":"curiosidades ; visualizaci√≥n de datos ; ggplot2","title":"Graba el proceso de tus visualizaciones de datos con {camcorder}"},{"content":" Visualizador de datos que busca reflejar el horror de la guerra y el exterminio que se est√°n llevando a cabo en el territorio de Palestina por obra del estado de Israel y sus aliados. Los datos provienen de Palestine Datasets y de Armed Conflict Location \u0026amp; Event Data, organizaciones que est√°n documentando datos sobre identificaci√≥n de v√≠ctimas y registro de sucesos de relevancia pol√≠tica en la regi√≥n.\nAccede al visualizador de datos por este enlace.\nDesarroll√© un nuevo visualizador de datos sobre un tema que puede ser pol√©mico para algunas personas. S√© que compartir este tipo de cosas me hace a√∫n menos empleable, y me puede hacer perder oportunidades laborales. Pero fue un ejercicio de contemplaci√≥n y respeto a las v√≠ctimas de un conflicto de caracter√≠sticas colonialistas y genocidas.\nSe trata de un trabajo sencillo de visualizaci√≥n de datos a partir de dos fuentes de informaci√≥n, desarrollado completamente en el lenguaje R.\nEl desarrollo tuvo un foco en la personalizaci√≥n de la apariencia de la aplicaci√≥n usando CSS mediante funciones de R, para darle esa apariencia de interfaz gr√°fica militar vintage. De hecho, desarroll√© primero la interfaz completa, con uno de cada uno de los elementos de prueba, para darles un estilo homog√©neo, y solo despu√©s fui creando la aplicaci√≥n real con esos bloques de la interfaz estilizada. Nunca hab√≠a empezado a desarrollar algo por lo visual, antes de tener los datos procesados, y aprend√≠ que se puede.\nOtro detalle que me gust√≥ implementar, y que me gustar√≠a hacer en su propia secci√≥n o app, es la de los nombres de v√≠ctimas que aparecen secuencialmente (es tan s√≥lo un loop donde cada nombre tiene un retardo mayor que el anterior para su animaci√≥n de entrada). En general no me gusta el uso de animaciones, porque implementar una animaci√≥n te va llevando a tener que implementar animaciones en todo, pero en este caso daba un ritmo solemne a datos sensibles.\nTrabajar con datos sensibles siempre tiene un peso, en mi experiencia. Me cuesta digerir lo que veo, y me pesa el coraz√≥n. Varias veces tan s√≥lo dictar los textos de la app me hizo nudos en la garganta. Pero creo que es importante intentar visibilizar estos temas, en memoria de las v√≠ctimas, y como un granito de arena.\nFuentes Palestine Datasets: https://data.techforpalestine.org/docs/killed-in-gaza/ Armed Conflict Location \u0026amp; Event Data (ACLED): https://acleddata.com/israel-palestine/ ","date":"2025-01-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_palestina/","tags":"apps","title":"App: Genocidio en Palestina"},{"content":"Portafolio de una selecci√≥n de las aplicaciones p√∫blicas de visualizaci√≥n de datos que he desarrollado. Se trata de peque√±as aplicaciones web dise√±adas para hacer m√°s accesibles y comprensibles ciertos conjuntos de datos sobre tem√°ticas sociales, pol√≠ticas y socioecon√≥micas. Todas estas aplicaciones web fueron desarrolladas con R, y tanto el c√≥digo de fuente como sus datos est√°n disponibles de manera p√∫blica y abierta.\nOtra versi√≥n m√°s detallada de este portafolio est√° disponible en este enlace: https://bastianolea.github.io/shiny_apps/\nGenocidio en Palestina Visualizador de datos que busca reflejar el horror de la guerra y el exterminio que se est√°n llevando a cabo en el territorio palestino por obra de Israel y sus aliados. Los datos provienen de Palestine Datasets y de Armed Conflict Location \u0026amp; Event Data, organizaciones que est√°n documentando datos sobre identificaci√≥n de v√≠ctimas y registro de sucesos de relevancia pol√≠tica en la regi√≥n.\nTemperaturas extremas en Chile Consulta datos hist√≥ricos de temperaturas extremas en el pa√≠s, desde 1970 hasta 2024, y visualiza los cambios hist√≥ricos en las temperaturas producto de la crisis clim√°tica.\nAn√°lisis de prensa chilena Aplicaci√≥n de an√°lisis de texto de prensa escrita chilena. Contiene varios gr√°ficos que cuantifican el contenido de las noticias de Chile, semana por semana. Los gr√°ficos permiten identificar qu√© palabras son las m√°s usadas a trav√©s del tiempo, lo cual a su vez revela c√≥mo va variando el acontecer nacional. Los datos de esta aplicaci√≥n son obtenidos mediante web scraping de forma diaria, pero la app se actualiza semanalmente. La base de datos comprende m√°s de 600 mil noticias, que suman m√°s de 100 millones de palabras, abarcando m√°s de 21 fuentes period√≠sticas distintas.\nEstad√≠sticas de delincuencia en Chile Visualizaci√≥n de estad√≠sticas oficiales de delincuencia, separadas por comuna y delito, para darle contexto y seriedad a un tema pa√≠s a partir de datos objetivos. Selecciona una comuna y luego uno o varios delitos para obtener un gr√°fico de l√≠neas que muestra una serie de tiempo de la cantidad de delitos, desde 2010 hasta 2023. Adem√°s, puedes visualizar la cantidad de delitos por a√±o en la comuna seleccionada, el promedio de delitos en los gobiernos recientes, y una visualizaci√≥n de los tres delitos m√°s frecuentes en cada comuna.\nProyecciones de poblaci√≥n del Censo Aplicaci√≥n web que visualiza los datos oficiales del Instituto Nacional de Estad√≠sticas de Chile sobre proyecciones de poblaci√≥n; es decir, estimaciones del crecimiento poblacional hacia el futuro, a partir de los datos obtenidos en los censos oficiales.\nComparador de mapas comunales de Chile Aplicaci√≥n que re√∫ne m√°s de 170 variables urban√≠sticas, sociales y econ√≥micas, de nivel comunal, para todas las comunas del pa√≠s, que permite al usuario elegir dos variables simult√°neamente para compararlas visualmente por medio de dos mapas regionales. El visualizador entrega la posibilidad de poner a prueba relaciones entre variables tan distintas como √°reas verdes y puntajes de pruebas de selecci√≥n universitaria, nivel de ingresos y tasa de delitos, participaci√≥n electoral y situaci√≥n de las viviendas, etc., dejando al usuario la tarea de explicar los fen√≥menos que pueden surgir.\nIndicadores econ√≥micos de Chile Tablero que presenta +8 indicadores econ√≥micos del Banco Central de Chile, cuya presentaci√≥n resumida permite analizar la situaci√≥n econ√≥mica del pa√≠s. Los datos de esta aplicaci√≥n son obtenidos de forma autom√°tica dos veces al d√≠a, garantizando que se encuentren actualizados. Adem√°s, la arquitectura de esta app facilita el proceso de a√±adir nuevos indicadores.\nCorrupci√≥n en Chile Cat√°logo y visualizador de los casos de corrupci√≥n m√°s trascendentes del √∫ltimo tiempo en Chile, para poner en perspectiva los montos, responsables, y sectores pol√≠ticos asociados. Los datos son recopilados manualmente para producir una tabla con la mayor informaci√≥n posible sobre casos de corrupci√≥n, incluyendo responsables, delitos espec√≠ficos, afiliaci√≥n a partidos pol√≠ticos, fundaciones involucradas y m√°s, para alientar visualizaciones interactivas que permitan a la cuidadan√≠a comprender de d√≥nde viene la corrupci√≥n y c√≥mo nos afecta como pa√≠s.\nMillonarios de Chile Con este visualizador puedes poner en perspectiva las fortunas individuales m√°s grandes del pa√≠s, para as√≠ dimensionar un aspecto clave de la desigualdad en Chile y el mundo. Diversas fuentes de datos permiten recopilar un listado de los empresarios m√°s ricos de Chile. Distintas t√©cnicas estad√≠sticas y de visualizaci√≥n permiten dimensionar las enormes fortunas de estas personas, por ejemplo, comparando con los propios ingresos del usuario, o con los ingresos de toda la poblaci√≥n del pa√≠s.\nFemicidios en Chile Sitio con gr√°ficos y tablas que expresan en cifras los datos de femicidios cometidos en Chile. Estos datos, mantenidos por la Red Chilena contra la Violencia hacia las Mujeres, expresan la brutalidad manifestada de una sociedad patriarcal donde la violencia es una realidad transversal, llevada a su extremo en la agresi√≥n y asesinato de mujeres por razones de g√©nero.\nBrechas de g√©nero Casen Visualizador que detalla brechas de g√©nero en temas sociales, de vivienda e ingresos, para analizar variables en las que las mujeres experimentan peores condiciones de vida, a nivel regional Selecciona una de las variables disponibles para generar un gr√°fico con todas las regiones del pa√≠s, donde se detalla el porcentaje de la poblaci√≥n femenina y masculina afectada por la variable seleccionada, o si eliges variables de vivienda o familia, el porcentaje de hogares con jefatura femenina o masculina correspondientes. Los puntos del gr√°fico adem√°s se detallan con las brechas o diferencias entre g√©neros existentes, volviendo expl√≠citas las desigualdades o ausencia de las mismas.\nComparador de ingresos Casen Visualizador que compara distribuciones y promedios de ingresos entre las comunas de Chile, para observar las diferencias en las realidades socioecon√≥micas del pa√≠s. Selecciona un grupo de comunas, y elige una variable de ingresos, como ingresos individuales, ingresos por hogar, ingresos per c√°pita o montos de pensiones/jubilaci√≥n, para obtener un gr√°fico de densidad que describe y compara las poblaciones de las comunas, y un gr√°fico de dispersi√≥n que ubica los ingresos de las comunas seleccionadas en comparaci√≥n a todas las dem√°s comunas del pa√≠s.\nRelacionador Casen Visualizador que permite relacionar hasta 3 variables socioecon√≥micas en un gr√°fico de dispersi√≥n por comunas, para analizar la relaci√≥n entre ellas. Este visualizador permite experimentar correlaciones con numerosas variables de temas como ingresos, educaci√≥n, condiciones de vida, condiciones laborales, y m√°s, dado que permite utilizar libremente cualquiera de ellas como los ejes del gr√°fico, creando as√≠ visualizaciones personalizadas. Por ejemplo, se puede explorar si las comunas con bajo nivel educacional promedio son tambi√©n las de menores ingresos, si es que las comunas con viviendas de menor calidad y menores ingresos se correlacionan con mayor hacinamiento o no, si las comunas de altos ingresos tienen menores afiliados a Fonasa, y m√°s.\nGraficador encuesta CEP Aplicaci√≥n web que permite visualizar gr√°ficos de los resultados de las encuestas del Centro de Estudios P√∫blicos. Adem√°s, permite desagregar resultados en base a categor√≠as sociodemogr√°ficas, filtrar grupos, configurar los gr√°ficos y descargar los datos.\n","date":"2025-01-06T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/portafolio_apps/","tags":"shiny ; visualizaci√≥n de datos","title":"Portafolio de aplicaciones en R"},{"content":"Estoy muy feliz porque la organizaci√≥n SocialTIC junto a infoactivismo.org me mencionaron como una de las iniciativas de infoactivismo m√°s destacada del a√±o 2024! ü•≥üíï\nLo mejor del Infoactivismo 2024 es un recuento anual de iniciativas y proyectos dedicados a la justicia y el cambio social apoyadas en tecnolog√≠as, datos e informaci√≥n en Latinoam√©rica.\nAgradezco mucho la menci√≥n! Es un honor estar entre otras iniciativas tan destacadas. Para mi, el a√±o 2024 fue un a√±o en el que me di cuenta que pod√≠a combinar mis habilidades t√©cnicas con mis intereses sociales y pol√≠ticos para crear herramientas de visualizaci√≥n de datos que resulten √∫tiles e interesantes para los dem√°s. Espero que este 2025 se venga con m√°s datos!\nEn este enlace les dejo la lista completa de iniciativas, todas ellas muy interesantes para informarse de iniciativas en la regi√≥n que utilizan tecnolog√≠as y datos para visibilizar y combatir problem√°ticas sociales.\nMi menci√≥n la incluyeron en la secci√≥n Datos abiertos generados por organizaciones, y la comparto a continuaci√≥n:\nBasti√°n Olea. Desde Chile, reconocemos la labor ciudadana de Basti√°n quien ha visualizado datos sociales sobre Chile de manera atractiva y comprensible a trav√©s de R. En su blog facilita datos abiertos del sector p√∫blico y comparte el c√≥digo para que otras personas puedan aprender y contribuir.\nLes dejo el texto de introducci√≥n a la lista, como contexto y para que se animen a revisar el resto de iniciativas:\nComo cada fin de a√±o, nos alegra compartir una edici√≥n m√°s de Lo mejor del Infoactivismo 2024, un recuento de acciones por la justicia y el cambio social apoyadas en tecnolog√≠as, datos e informaci√≥n en Latinoam√©rica.\nEl contexto actual de esta edici√≥n aborda desaf√≠os como la desinformaci√≥n y la polarizaci√≥n, la criminalizaci√≥n y ataques hacia activistas, periodistas y personas defensoras de derechos humanos, la emergencia clim√°tica, la crisis de desapariciones, los conflictos armados, el avance de grupos antiderechos, el abuso de tecnolog√≠as, la vulneraci√≥n de los derechos humanos y la manipulaci√≥n de la informaci√≥n por parte de gobiernos y grupos de poder.\nLos proyectos e iniciativas que compartimos a continuaci√≥n son un reflejo de las problem√°ticas que impactan a nivel local y regional y de la b√∫squeda de soluciones a los retos que enfrentamos como sociedad.\nEsta recopilaci√≥n re√∫ne m√°s de 50 esfuerzos agrupados en 12 categor√≠as, que por su estrategia, experimentaci√≥n y creatividad en el uso de las tecnolog√≠as y la informaci√≥n, consideramos inspiradores para generar cambios en aspectos sociales, ambientales, pol√≠ticos y culturales.\n","date":"2025-01-01T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2025-01-01/","tags":"blog","title":"Menci√≥n en Infoactivismo en Latinoam√©rica 2024"},{"content":"A largo de todo el a√±o 2024 he estado realizando web scraping de distintas fuentes de noticias digitales de Chile. Casi todos los d√≠as ejecuto un script que a su vez se ejecuta decenas de otros scripts, que realizan el scraping diario de noticias. El resultado de estos procesos, d√≠a tras d√≠a, va aumentando la cantidad total de noticias que he ido recolectando. De vez en cuando, alg√∫n sitio cambia, o algo falla, y tengo que corregir manualmente los scripts. Cada cierto tiempo ejecuto versiones alternativas de los scripts para hacer una extracci√≥n de datos desde fechas anteriores, aumentando la cantidad total de noticias de fechas pasadas, lo que me permite rellenar vac√≠os en las obtenciones anteriores de noticias diarias, como tambi√©n aumentar la cantidad total de noticias con datos desde a√±os antes de que empezara este proyecto.\nEl proceso de limpieza y procesamiento del texto de estas noticias es bastante entretenido y complejo. Me gustar√≠a poder escribir sobre √©l en el futuro. Pero la gracia es que yo simplemente aprieto ejecutar, y el proceso se ejecuta de principio a fin sin intervenci√≥n, generando versiones actualizadas de todas las bases de datos de noticias. En total se demora unos 6 minutos en cargar y limpiar las 800 mil noticias (la extracci√≥n de la fecha ser√≠a lo m√°s intenso en este paso), y luego hay varios scripts que tokenizan y analizan el texto, dando un total aproximado de 20 minutos de procesamiento. El proceso completo est√° resumido con cierto nivel de detalle en el repositorio.\nEl resultado de todo este proceso es que, a la fecha, mantengo una base de datos de m√°s de 800.000 noticias de Chile, con su texto completo, fecha, y fuente, entre otras variables. Esta base de datos se usa para alimentar mi aplicaci√≥n de an√°lisis de prensa semanal. si en la base de datos no es de acceso p√∫blico, puedes acceder a una muestra de 3.000 noticias del a√±o 2024 seleccionadas al azar, para poder realizar an√°lisis de texto o jugar con los datos.\nLa siguiente animaci√≥n muestra la evoluci√≥n del proceso de obtenci√≥n de los datos (se pone buena cuando llega al 2024). Cada paso de la animaci√≥n representa un mes, y las barras del gr√°fico representan la cantidad de datos que ten√≠a recolectados hasta ese momento. A trav√©s de la animaci√≥n, se puede ir viendo c√≥mo van obteni√©ndose nuevos datos mes a mes, as√≠ como tambi√©n en algunos momentos del tiempo se obtienen datos de meses anteriores, incluso a√±os anteriores, a trav√©s de estos pasos de obtenci√≥n de datos retroactivos.\nLa animaci√≥n fue hecha en R con {ggplot2} y {gganimate}, y fue posible gracias a que en alg√∫n momento se me ocurri√≥ que cada noticia extra√≠da tambi√©n registrara la fecha exacta en la que se obtuvo. Por eso, la animaci√≥n puede avanzar a partir de la fecha de obtenci√≥n de la noticia, de forma independiente a la fecha de publicaci√≥n de la noticia.\nActualmente, y como he escrito en el blog, estoy realizando un procesamiento retroactivo de estos datos de noticias, para poder obtener informaci√≥n extra acerca de las noticias almacenadas. Estoy usando un modelo de lenguaje (LLM) para procesar cada una de las noticias, desde la m√°s reciente hacia atr√°s, para agregar a cada noticia informaci√≥n de su sentimiento (positivo/negativo), su clasificaci√≥n o t√≥pico (pol√≠tica/econom√≠a/policial, etc.), y un resumen de m√°ximo 40 palabras del texto de cada noticia. Ya llegu√© a un momento de equilibrio, en el cual he obtenido estas variables para varias decenas de miles de noticias de varios meses atr√°s hasta el presente, y ahora solamente restar√≠a ir procesando estas variables para las noticias nuevas que se obtengan semana a semana, que son aproximadamente unas 3.000 noticias nuevas por semana.\nCon estos nuevos datos planeo agregar nuevas visualizaciones para la aplicaci√≥n de an√°lisis de prensa. As√≠ que est√©n atentos para las novedades que se vienen.\n","date":"2024-12-31T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2024-12-31/","tags":"blog ; ggplot2 ; web scraping ; animaciones","title":"Web scraping de noticias: avances de fin de a√±o"},{"content":"Se denomina web scraping a un conjunto de t√©cnicas usadas para obtener datos desde p√°ginas web. Esto significa poder transformar la informaci√≥n que vemos en distintos sitios de internet en datos que podamos utilizar.\nSe usa el web scraping cuando un sitio web presenta informaci√≥n, cifras, datos, n√∫meros, o cualquier otro elemento que nos pueda servir, pero sin facilitar acceso a los datos, como ser√≠a un enlace de descarga, una API para obtener los datos, o alguna forma de exportar la informaci√≥n. En estos casos tenemos que recurrir al scraping para transformar lo que vemos en la web en datos analizables.\nEn este tutorial aprenderemos a hacer web scraping en R para extraer cualquier informaci√≥n que veamos en un sitio web, y traerla a nuestro entorno de R para poder procesarla como deseemos.\nWeb scraping con {rvest} La primera opci√≥n a la hora de hacer web scraping de sitios web con R es el paquete {rvest} (harvest, o cosechar en espa√±ol). Este paquete, parte del Tidyverse, suele ser la opci√≥n m√°s sencilla, m√°s popular y mejor documentada para extraer datos desde sitios web est√°ticos en R.\n# install.packages(\u0026#34;rvest\u0026#34;) library(rvest) Existen otros paquetes para el web scraping, como {RSelenium}, que se caracteriza por permitirnos obtener datos desde sitios web din√°micos, pero a su vez es menos intuitivo y m√°s dif√≠cil de configurar, lo que hace que sea necesario explicarlo en un tutorial aparte.\nExtraer tablas desde un sitio web Como primer paso, extraeremos los datos de una tabla alojada en internet. Cuando las tablas est√°n formateadas apropiadamente, como las tablas que podemos encontrar en Wikipedia, extraerlas resulta muy sencillo.\nEl primer paso es definir la direcci√≥n del sitio que queremos scrapear, y luego usamos dos funciones para obtener el c√≥digo de fuente de este sitio: la funci√≥n session(), que nos permite conectarnos al sitio web creando una sesi√≥n, y luego la funci√≥n read_html(), que descargar√° el c√≥digo del sitio y nos permitir√° extraer informaci√≥n desde el mismo.\nurl \u0026lt;- \u0026#34;https://es.wikipedia.org/wiki/Chile\u0026#34; sitio_chile \u0026lt;- session(url) |\u0026gt; read_html() sitio_chile {html_document} \u0026lt;html class=\u0026quot;client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-sticky-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-1 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-toc-available\u0026quot; lang=\u0026quot;es\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt; [1] \u0026lt;head\u0026gt;\\n\u0026lt;meta http-equiv=\u0026quot;Content-Type\u0026quot; content=\u0026quot;text/html; charset=UTF-8 ... [2] \u0026lt;body class=\u0026quot;skin--responsive skin-vector skin-vector-search-vue mediawik ... El objeto resultante es un documento HTML del cual podremos extraer los elementos del sitio que nos interesen.\nIntentemos extraer la tabla del sitio que posee datos sobre poblaci√≥n ind√≠gena en el pa√≠s:\nPara extraer las tablas de este sitio, usamos la funci√≥n html_table(). Las funciones que extraen elementos de los sitios empiezan con html.\ntablas \u0026lt;- sitio_chile |\u0026gt; html_table() El resultado de esta extracci√≥n va a ser una lista. En R, una lista es un tipo de objeto que dentro de s√≠ puede contener m√∫ltiples elementos de distinto tipo, forma, o tama√±o. En este caso, esta lista contiene todas las tablas que hab√≠an en la p√°gina. Entonces, tenemos que elegir la tabla que nos interesa analizar.\nEn este caso, nos interesa la octava tabla, que contiene informaci√≥n sobre pueblos ind√≠genas en Chile, por lo que la extraemos de la lista:\n# extraer tabla de la lista tabla_1 \u0026lt;- tablas[[8]] tabla_1 # A tibble: 12 √ó 3 Pueblos ind√≠genas de Chile (2‚Ä¶¬π Pueblos ind√≠genas de‚Ä¶¬≤ Pueblos ind√≠genas de‚Ä¶¬≥ \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Etnia Poblaci√≥n % 2 Mapuche 1¬†745¬†147 79,8 3 Aimara 156¬†754 7,2 4 Diaguita 88¬†474 4,1 5 Quechua 33¬†868 1,6 6 Lican Antai 30¬†369 1,4 7 Colla 20¬†744 0,9 8 Rapanui 9399 0,4 9 Kaw√©sqar 3448 0,1 10 Yag√°n 1600 0,1 11 Otro o ignorado 95¬†989 4,4 12 Total 2¬†185¬†792 100,0 # ‚Ñπ abbreviated names: ¬π‚Äã`Pueblos ind√≠genas de Chile (2017)[8]‚Äã`, # ¬≤‚Äã`Pueblos ind√≠genas de Chile (2017)[8]‚Äã`, # ¬≥‚Äã`Pueblos ind√≠genas de Chile (2017)[8]‚Äã` # limpiar datos de la tabla library(dplyr) Attaching package: 'dplyr' The following objects are masked from 'package:stats': filter, lag The following objects are masked from 'package:base': intersect, setdiff, setequal, union # renombrar columnas tabla_1a \u0026lt;- tabla_1 |\u0026gt; janitor::row_to_names(1) |\u0026gt; janitor::clean_names() # convertir variables a num√©ricas tabla_1b \u0026lt;- tabla_1a |\u0026gt; # remover espacios mutate(poblacion = stringr::str_remove_all(poblacion, \u0026#34;\\\\s+\u0026#34;)) |\u0026gt; # reemplazar comas por puntos mutate(percent = stringr::str_replace(percent, \u0026#34;,\u0026#34;, \u0026#34;.\u0026#34;)) |\u0026gt; # convertir a num√©ricas mutate(across(c(poblacion, percent), as.numeric)) tabla_1b # A tibble: 11 √ó 3 etnia poblacion percent \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Mapuche 1745147 79.8 2 Aimara 156754 7.2 3 Diaguita 88474 4.1 4 Quechua 33868 1.6 5 Lican Antai 30369 1.4 6 Colla 20744 0.9 7 Rapanui 9399 0.4 8 Kaw√©sqar 3448 0.1 9 Yag√°n 1600 0.1 10 Otro o ignorado 95989 4.4 11 Total 2185792 100 ¬°Listo! Extrajimos datos desde una tabla de Wikipedia, y ahora podemos usarlos para lo que necesitemos.\nExtraer datos de un sitio usando etiquetas Para scrapear elementos puntuales de un sitio, necesitamos identificarlos, y as√≠ extraer solamente lo que nos interesa. Cada elemento en un sitio web, ya sea texto, tablas o im√°genes, se crea a partir de etiquetas HTML. Si identificamos las etiquetas HTML de los datos que necesitamos, podemos usarlas para extraerlos.\nProbemos con otra p√°gina de Wikipedia:\nurl \u0026lt;- \u0026#34;https://es.wikipedia.org/wiki/Mapache\u0026#34; sitio_mapache \u0026lt;- session(url) |\u0026gt; read_html() Para extraer elementos de un sitio, usamos la funci√≥n html_elements(), cuyo argumento ser√° el identificador del elemento que queremos extraer. Para extraer el t√≠tulo de la p√°gina, usualmente podemos usar la etiqueta HTML h1, que se usa para t√≠tulos de mayor jerarqu√≠a (existen etiquetas de t√≠tulos h1, h2\u0026hellip; hasta h6).\nsitio_mapache |\u0026gt; html_elements(\u0026#34;h1\u0026#34;) {xml_nodeset (1)} [1] \u0026lt;h1 id=\u0026quot;firstHeading\u0026quot; class=\u0026quot;firstHeading mw-first-heading\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot; ... Obtenemos un elemento que empieza con \u0026lt;h1..., lo que significa que extrajimos un elemento en el sitio con dicha etiqueta h1. Para convertir este elemento a texto, usamos la funci√≥n html_text():\nsitio_mapache |\u0026gt; html_elements(\u0026#34;h1\u0026#34;) |\u0026gt; html_text() [1] \u0026quot;Procyon\u0026quot; Del mismo modo, podemos extraer otros elementos del sitio, tales como los subt√≠tulos de etiqueta h2:\nsitio_mapache |\u0026gt; html_elements(\u0026#34;h2\u0026#34;) |\u0026gt; html_text() [1] \u0026quot;Contenidos\u0026quot; \u0026quot;Descripci√≥n\u0026quot; [3] \u0026quot;H√°bitat y comportamiento\u0026quot; \u0026quot;Nombre\u0026quot; [5] \u0026quot;Especies\u0026quot; \u0026quot;Especies relacionadas y similares\u0026quot; [7] \u0026quot;V√©ase tambi√©n\u0026quot; \u0026quot;Referencias\u0026quot; [9] \u0026quot;Enlaces externos\u0026quot; Si deseamos extraer todo el texto del sitio, apuntamos a la etiqueta de p√°rrafo, que es p:\ntexto \u0026lt;- sitio_mapache |\u0026gt; html_elements(\u0026#34;p\u0026#34;) |\u0026gt; html_text() texto[3:5] [1] \u0026quot;Tiene un tama√±o mediano y puede llegar a medir entre 40¬†cm y 55¬†cm de alto. Es un poco mayor y m√°s grueso que un gato, de pelo medianamente largo y de color gris plateado (m√°s oscuro en el centro del lomo), el pelo de las extremidades casi blanco, cola larga y anillada (gris plateado con blanco o casi blanco) y una caracter√≠stica mancha de pelo negro que va desde cada mejilla a cada ojo, lo que lo hace muy reconocible, pues parece que lleva un antifaz. En ocasiones se sienta sobre sus cuartos traseros (muslos y gl√∫teos), como hacen los osos, y, como ellos, es de patas traseras plant√≠gradas. En sus extremidades posee cinco dedos largos y √°giles (el tacto es su sentido predominante). Puede pesar hasta 15¬†kg. \\n\u0026quot; [2] \u0026quot;Las manos de los mapaches tienen ciertas similitudes con las de los primates, producto de la convergencia evolutiva, ya que no est√°n estrechamente relacionados entre s√≠. Su distribuci√≥n de los dedos es ideal para que sea capaz de apretar y manipular objetos, aunque no presentan un pulgar oponible \\n\u0026quot; [3] \u0026quot;Es un animal de bosque, especialmente cerca de r√≠os, aunque ha aprendido a vivir tambi√©n en √°reas habitadas. En su h√°bitat natural come de todo, desde ranas hasta frutos, pero en las ciudades y suburbios echa mano de los contenedores de basura para comerse los restos de alimentos arrojados en ellos. Los mapaches son nocturnos, tienen un agudo sentido del olfato y son buenos trepadores.\\n\u0026quot; El objeto resultante es un vector de texto, separado en p√°rrafos.\nExtraer datos de un sitio usando clases Hagamos otro ejemplo sobre un sitio menos estructurado que Wikipedia: queremos obtener una lista de animales end√©micos de Chile desde el sitio web animalia.bio.\nEn este sitio, cada t√≠tuar de los p√°rrafos contiene el nombre de un animal end√©mico. Por alguna raz√≥n, este sitio impide que le hagamos scraping si nos conectamos con la funci√≥n session()1, pero tambi√©n es posible extraer el c√≥digo directamente del sitio, sin crear una sesi√≥n. Cu√°ndo se hace web scraping es posible encontrarse con problemas de este tipo, como sitios que evitan entregar su informaci√≥n, o que lo hacen un poco m√°s complicado de lo normal.\nurl \u0026lt;- \u0026#34;https://animalia.bio/es/endemic-lists/country/endemic-animals-of-chile\u0026#34; # extraer c√≥digo de fuente del sitio sin abrir una sesi√≥n sitio_animales \u0026lt;- read_html(url) sitio_animales {html_document} \u0026lt;html lang=\u0026quot;es\u0026quot;\u0026gt; [1] \u0026lt;head\u0026gt;\\n\u0026lt;meta http-equiv=\u0026quot;Content-Type\u0026quot; content=\u0026quot;text/html; charset=UTF-8 ... [2] \u0026lt;style\u0026gt;\\n @media only screen and (max-width: 992px) {\\n .mob_banner {\\n ... [3] \u0026lt;body class=\u0026quot;page-collection \u0026quot; bucket_url=\u0026quot;https://s3.animalia.bio\u0026quot;\u0026gt;\\n ... Con este sitio web no nos resulta extraer la etiqueta h2, h3 o h4 que se usan usualmente para los titulares en sus distintos niveles, sencillamente porque este sitio web no usa esas etiquetas para crear sus titulares.\nsitio_animales |\u0026gt; html_elements(\u0026#34;h2\u0026#34;) {xml_nodeset (0)} En estos casos, tenemos que entrar al sitio web e identificar manualmente c√≥mo se distinguen entre el resto del c√≥digo los elementos que queremos extraer.\nAccedemos al sitio web con un navegador web cualquiera, y entramos al inspector web de nuestro navegador. Podemos hacer clic derecho en alg√∫n elemento del sitio, y elegir la opci√≥n Inspeccionar para abrir el inspector:\nSe abrir√° un inspector web donde veremos el c√≥digo de fuente del sitio al lado del sitio mismo. Si movemos nuestro cursor sobre las l√≠neas del c√≥digo, se destacar√°n los elementos del sitio web que corresponden a cada l√≠nea, o viceversa. De esta forma, podemos encontrar exactamente cu√°l l√≠nea de c√≥digo se corresponde con el elemento que queremos extraer.\nEn este caso, la l√≠nea de c√≥digo de los titulares de cada animal es a una etiqueta span, que corresponde a un contenedor de texto. Por s√≠ sola, esta etiqueta no identifica de manera √∫nica a los datos que queremos extraer, por lo tanto, tenemos que encontrar otro identificador dentro de esta etiqueta que nos sirva.\nEn la mayor√≠a de los casos, los elementos de un sitio web que comparten un mismo estilo gr√°fico (tipograf√≠a, tama√±o de texto, color, etc.) comparten tambi√©n una clase CSS. Una clase CSS es una forma de definir la apariencia de una parte de un sitio web, como un titular, un p√°rrafo de texto, o un bot√≥n, definiendo su apariencia en una hoja de estilos CSS a partir del nombre de la clase, para luego aplicar esta misma clase a m√∫ltiples elementos del sitio. Por lo tanto, identificar la clase de un elemento web usualmente nos permite extraer m√∫ltiples elementos de un sitio que comparten una misma jerarqu√≠a o apariencia.\nEn la siguiente imagen se destacan con l√≠neas de colores los elementos del sitio que comparten un estilo y jerarqu√≠a, y por ende podemos asumir que comparten una clase en com√∫n entre ellos:\nEn el caso de este sitio, y como vemos en el c√≥digo del inspector web de nuestro navegador, todos los t√≠tulos de los animales del sitio poseen la clase collection-animal-title. Entonces, podemos usar esa clase para extraer los elementos usando la funci√≥n html_elements(). Pero hay que tener en consideraci√≥n que las clases CSS se escriben anteponi√©ndoles un punto, por lo que usamos \u0026quot;.collection-animal-title\u0026quot;:\nanimales \u0026lt;- sitio_animales |\u0026gt; html_elements(\u0026#34;.collection-animal-title\u0026#34;) |\u0026gt; html_text() animales[1:10] [1] \u0026quot;Deg√∫\u0026quot; \u0026quot;Chinchilla de cola corta\u0026quot; [3] \u0026quot;Chinchilla de cola larga\u0026quot; \u0026quot;Zorro chilote\u0026quot; [5] \u0026quot;Delf√≠n chileno\u0026quot; \u0026quot;Rana chilena\u0026quot; [7] \u0026quot;Remolinera costera chilena\u0026quot; \u0026quot;Cachudito de juan fern√°ndez\u0026quot; [9] \u0026quot;Turca\u0026quot; \u0026quot;Chiricoca\u0026quot; Al extraer los elementos que comparten una misma clase, {rvest} nos entrega un vector que contiene todos elementos del sitio que usan en esa clase; en este caso, los t√≠tulos de los animales.\nSi seguimos viendo el c√≥digo de fuente del sitio, notamos que tambi√©n hay otras clases que describen los elementos asociados a cada animal: la clase collection-desc que se aplica a los p√°rrafos, y la clase animal-link que contiene el enlace a cada animal.\nPara extraer los textos, apuntamos a la clase .collection-desc, y usamos html_text2(), que adem√°s de convertir a texto, tambi√©n ayuda removiendo caracteres en blanco como espacios o saltos de l√≠nea:\ntextos \u0026lt;- sitio_animales |\u0026gt; html_elements(\u0026#34;.collection-desc\u0026#34;) |\u0026gt; html_text2() textos[1:5] [1] \u0026quot;El deg√∫ (\u0026lt; mapudungun dew√º, rata, rat√≥n) (Octodon degus) es una especie de roedor histricomorfo de la familia Octodontidae. Es conocido tambi√©n por multitud de otros nombres, como deg√∫/rat√≥n cola de pincel, deg√∫/rat√≥n de las pircas, ardilla chilena o, incluso, rat√≥n cola de trompeta. Sin embargo, este peque√±o caviomorfo end√©mico de Chile es usualmente denominado deg√∫ com√∫n, para distinguirlo de los otros miembros del g√©nero Octodon. El t√©rmino deg√∫ ...por s√≠ solo, no obstante, puede usarse para referirse al g√©nero Octodon o, de forma com√∫n, a Octodon degus. Otros caviomorfos con los que los deg√∫s est√°n estrechamente relacionados son las chinchillas y los conejillos de Indias (ver infraorden Caviomorpha). Menos\u0026quot; [2] \u0026quot;La chinchilla de cola corta (Chinchilla chinchilla), tambi√©n llamada chinchilla Peruana, chinchilla del altiplano, chinchilla cordillerana y chinchilla real, es una especie de roedor de la familia Chinchillidae. Habita el altiplano andino, desde el sur del Per√∫ y el oeste de Bolivia, hasta el noreste de Chile y el norte de Argentina. Por ser su piel altamente demandada, su caza indiscriminada produjo que la poblaci√≥n se reduzca dr ...am√°ticamente. La UICN estim√≥ una reducci√≥n del 90% de la poblaci√≥n en s√≥lo 3 generaciones (15 a√±os), coloc√°ndola entre las especies amenazadas.En Per√∫ y Bolivia no existen colectas de individuos desde hace 50 a√±os; sin embargo reportes recientes, basados en entrevistas con gente local y observaciones de guardaparques, en la Reserva nacional Eduardo Abaroa en el Departamento de Potos√≠, en la regi√≥n del sudoeste boliviano fronteriza con la Regi√≥n de Antofagasta de Chile, parecen indicar poblaciones extensas. En Bolivia, es poco probable que la especie se encuentre en otros sitios de su rango distribucional hist√≥rico. Actualmente existen registros de poblaciones en Argentina y Chile; se encuentra extinta en Per√∫, y su presencia en Bolivia es incierta. Menos\u0026quot; [3] \u0026quot;La chinchilla de cola larga (Chinchilla lanigera), tambi√©n conocida como chinchilla chilena, costera o menor, es una especie de roedor de la familia Chinchillidae. Es una de las dos especies del g√©nero Chinchilla, la otra es Chinchilla chinchilla. Menos\u0026quot; [4] \u0026quot;El zorro chilote o zorro de Darwin (Lycalopex fulvipes) es un c√°nido end√©mico del sur de Chile. Fue descrito por primera vez en 1834 por Charles Darwin, quien lo clasific√≥ err√≥neamente como una subespecie del zorro chilla (L. griseus). Se considera la especie de c√°nido en mayor riesgo de extinci√≥n en el mundo. No tiene subespecies. Menos\u0026quot; [5] \u0026quot;El delf√≠n chileno (Cephalorhynchus eutropia), tambi√©n conocido como delf√≠n negro y tonina es una especie de cet√°ceo odontoceto de la familia Delphinidae que se encuentra mayoritariamente en las costas de Chile y muy escasamente tambi√©n en la Patagonia argentina. Menos\u0026quot; Para extraer los enlaces, el proceso es levemente distinto, porque si extraemos el texto de los enlaces desde la clase .animal-link, solamente obtendremos el texto, no el enlace en s√≠ mismo:\nsitio_animales |\u0026gt; html_elements(\u0026#34;.animal-link\u0026#34;) |\u0026gt; html_text() [1] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [5] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [9] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [13] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [17] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [21] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [25] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [29] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [33] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [37] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; [41] \u0026quot;Descubrir m√°s \u0026quot; \u0026quot;Descubrir m√°s \u0026quot; Notamos que la etiqueta HTML que se usa para crear los enlaces es la etiqueta a, y dentro de esta etiqueta, adem√°s de la clase tenemos otros atributos, tales como el atributo href (hypertext reference), que contiene la direcci√≥n a la que apunta el enlace:\nsitio_animales |\u0026gt; html_elements(\u0026#34;.animal-link\u0026#34;) {xml_nodeset (42)} [1] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/degu?endemic=35\u0026quot;\u0026gt;De ... [2] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/short-tailed-chinch ... [3] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/long-tailed-chinchi ... [4] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/darwins-fox?endemic ... [5] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/chilean-dolphin?end ... [6] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/calyptocephalella?e ... [7] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/chilean-seaside-cin ... [8] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/juan-fernndez-tit-t ... [9] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/moustached-turca?en ... [10] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/crag-chilia?endemic ... [11] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/juan-fernndez-firec ... [12] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/slender-billed-para ... [13] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/chilean-tinamou?end ... [14] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/chilean-woodstar?en ... [15] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/masafuera-rayadito? ... [16] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/de-filippis-petrel? ... [17] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/white-throated-tapa ... [18] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/telmatobufo-bullock ... [19] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/telmatobufo-venustu ... [20] \u0026lt;a class=\u0026quot;animal-link\u0026quot; href=\u0026quot;https://animalia.bio/es/rhinella-atacamensi ... ... Para extraer este atributo de los elementos de etiqueta a, usamos la funci√≥n html_attr(), especificando el atributo que queremos extraer:\nenlaces \u0026lt;- sitio_animales |\u0026gt; html_elements(\u0026#34;.animal-link\u0026#34;) |\u0026gt; html_attr(\u0026#34;href\u0026#34;) enlaces[1:10] [1] \u0026quot;https://animalia.bio/es/degu?endemic=35\u0026quot; [2] \u0026quot;https://animalia.bio/es/short-tailed-chinchilla?endemic=35\u0026quot; [3] \u0026quot;https://animalia.bio/es/long-tailed-chinchilla?endemic=35\u0026quot; [4] \u0026quot;https://animalia.bio/es/darwins-fox?endemic=35\u0026quot; [5] \u0026quot;https://animalia.bio/es/chilean-dolphin?endemic=35\u0026quot; [6] \u0026quot;https://animalia.bio/es/calyptocephalella?endemic=35\u0026quot; [7] \u0026quot;https://animalia.bio/es/chilean-seaside-cinclodes?endemic=35\u0026quot; [8] \u0026quot;https://animalia.bio/es/juan-fernndez-tit-tyrant?endemic=35\u0026quot; [9] \u0026quot;https://animalia.bio/es/moustached-turca?endemic=35\u0026quot; [10] \u0026quot;https://animalia.bio/es/crag-chilia?endemic=35\u0026quot; Una vez que hayamos extra√≠do los elementos del sitio que necesitamos, y considerando que los elementos extra√≠dos tienen todos el mismo largo (dado que cada animal del sitio ten√≠a exactamente un t√≠tulo, un p√°rrafo y un enlace), podemos unir todos los resultados en una tabla para construir un dataframe a partir de los datos scrapeados.\ntabla_animales \u0026lt;- tibble(animales, textos, enlaces) tabla_animales # A tibble: 42 √ó 3 animales textos enlaces \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Deg√∫ El deg√∫ (\u0026lt; mapudungun dew√º, rata, rat√≥n)‚Ä¶ https:‚Ä¶ 2 Chinchilla de cola corta La chinchilla de cola corta (Chinchilla ‚Ä¶ https:‚Ä¶ 3 Chinchilla de cola larga La chinchilla de cola larga (Chinchilla ‚Ä¶ https:‚Ä¶ 4 Zorro chilote El zorro chilote o zorro de Darwin (Lyca‚Ä¶ https:‚Ä¶ 5 Delf√≠n chileno El delf√≠n chileno (Cephalorhynchus eutro‚Ä¶ https:‚Ä¶ 6 Rana chilena La rana chilena (Calyptocephalella gayi)‚Ä¶ https:‚Ä¶ 7 Remolinera costera chilena La remolinera costera chilena (Cinclodes‚Ä¶ https:‚Ä¶ 8 Cachudito de juan fern√°ndez El cachudito de Juan Fern√°ndez (Anairete‚Ä¶ https:‚Ä¶ 9 Turca La turca o huet-huet turca (Pteroptochos‚Ä¶ https:‚Ä¶ 10 Chiricoca La chiricoca (Ochetorhynchus melanurus),‚Ä¶ https:‚Ä¶ # ‚Ñπ 32 more rows Creamos una tabla con los resultados de los tres datos que scrapeamos!\nEn general, √©sta es la l√≥gica b√°sica del web scraping. Se debe identificar el sitio web que necesitas, luego explorar el c√≥digo de fuente del sitio para entender cu√°les son las clases de los elementos que quieres extraer, para finalmente extraerlos y procesarlos, de ser necesario. En muchos casos, lo que se hace es obtener una cierta cantidad de enlaces que contienen informaci√≥n que est√° estructurada de una manera homog√©nea, y luego se ejecuta el proceso de scraping a cada uno de los enlaces a trav√©s de un loop o iteraci√≥n, por ejemplo con la funci√≥n purrr::map().\nEl web scraping es una herramienta muy √∫til para acelerar tus procesos y automatizar obtenciones y actualizaciones de datos, y es algo que resulta muy atractivo para personas interesadas en los datos. Pero ojo, que he visto mucha gente que quiere entrar al an√°lisis de datos empezando por aprender web scraping. En mi experiencia, si bien el web scraping de por si no es algo complejo, s√≠ es una herramienta que requiere de un dominio de estructuras de datos complejas, as√≠ como de habilidades avanzadas de limpieza de datos. Ello debido a que los datos que obtenemos por web scraping pueden venir literalmente en cualquier formato, con infinidad de problemas inesperados, y ser√° tarea de el/la analista resolver esos desaf√≠os de interpretaci√≥n y limpieza de datos de forma creativa, de manera que los resultados salgan correctos tanto para 1 como para 100 p√°ginas de un mismo sitio web.\nSi te sirvi√≥ este tutorial, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\nLo m√°s probable sea que este sitio identifique que estamos conect√°ndonos desde un paquete de R que hace web scraping, y por lo tanto cancela la conexi√≥n entregando un error 403 (prohibido). Esto se debe a que cualquier interfaz que se conecte una p√°gina web entrega un user agent que los identifica, y muchos sitios usan esta informaci√≥n para prohibir el acceso o mostrar distintos elementos dependiendo del navegador que uses.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-12-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_scraping_rvest/","tags":"web scraping ; datos","title":"Tutorial: web scraping en R usando {rvest}"},{"content":"Me encuentro en la tarea de tener que procesar cientos de miles de datos, lo cual demorar√° varios cientos de horas, por lo que necesito que dejar mi computador trabajando durante las noches, por varios d√≠as. La idea es que, cada noche, el computador procese de la mayor cantidad de datos posibles, los resultados se guarden, y a la siguiente noche el proceso se repita con datos nuevos, hasta que en algunos d√≠as logre procesar todos los cientos de miles de datos que necesito.\nEl proceso en s√≠ mismo consiste en utilizar modelos de lenguaje (LLM) para extraer sentimiento, clasificaci√≥n y resumen de cada unidad de los datos, que corresponden a textos de entre 100 a 5000 caracteres. Este procesamiento utiliza el 100% de mi tarjeta de video, por lo que el computador alcanzar altas temperaturas, as√≠ que prefiero hacer este c√°lculo mientras no estoy us√°ndolo para otras cosas.\nComo cada unidad de datos tiene una identificaci√≥n √∫nica, cada noche lo que hago es extraer una muestra aleatoria del conjunto total de datos, excluyendo los datos cuyo id √∫nico ya fue procesado anteriormente. De esa manera no se repite el procesamiento de datos que ya fueron procesados.\nLas primeras noches, lo que hice fue darle al loop una muestra aleatoria de un tama√±o espec√≠fico. El tama√±o de esta muestra depend√≠a del tiempo promedio de ejecuci√≥n de cada paso del loop, multiplicado por x, para que el tiempo total de ejecuci√≥n durara un poco menos de ocho horas, de modo que cuando amaneciera, el proceso ya haya terminado y yo pudiera usar mi computador normalmente.\nPero luego vino la navidad üéÑ y yo iba a salir de mi casa sin saber en cu√°ntas horas iba a volver. As√≠ que no sab√≠a cu√°ntos datos darle al loop. Si le daba muy pocos, el computador pod√≠a terminar antes de que yo volviera, y hubieran sido muchas horas de procesamiento perdido, pero si le daba muchos datos, yo pod√≠a llegar a la casa y encontrarme con mi computador inutilizable por estar trabajando al 100% en un proceso que a√∫n no terminaba.\nLo ideal ser√≠a poder iniciar el proceso, que el computador se ponga a calcular, y que eventualmente yo pueda detener el proceso y obtener los resultados que se alcanzaron a calcular durante ese tiempo. Pero si detienes un proceso en R, el proceso termina sin asignar su resultado. Entonces no puedo llegar y tener el proceso.\nEsto podr√≠a evitarse si, en vez de que el proceso con purrr::map() asigne sus resultados finales a un objeto de R, se use purrr::walk() para que cada paso del proceso guarde su resultado individual como un archivo por separado, y luego en otro momento se unan todos los resultados individuales. Esto lo he hecho antes con buenos resultados, pero esta vez simplemente no quer√≠a hacerlo as√≠.\nLa soluci√≥n ser√≠a ser que el proceso termine desde adentro; es decir, que algo dentro del proceso haga que √©ste termine cuando yo se lo pida. En un loop normal, esto se har√≠a con el uso de un if con un stop() dentro, lo cual detendr√≠a las siguientes iteraciones. Pero el problema seguir√≠a siendo el c√≥mo hacerle saber al loop, desde afuera, que tiene que terminarse. Por otro lado, los loops del paquete {purrr} no tienen un equivalente a stop(), dado que no tendr√≠a sentido bajo la l√≥gica de la programaci√≥n funcional. Pero lo que s√≠ puedan hacer los loops de {purrr} es retornar NULL con antelaci√≥n, como una forma de saltarse el paso. Por lo tanto, la forma de hacer que el loop \u0026ldquo;termine\u0026rdquo; ser√≠a haci√©ndole que retorne nulo para todos los siguientes pasos. El loop en s√≠ no terminar√≠a, pero las iteraciones que retornen nulo ocupar√≠an un tiempo de procesamiento negligible, haciendo que las miles de operaciones restantes terminen en fracci√≥n de segundo. Entonces faltar√≠a la forma de hacer que, desde fuera, el loop supiera que tiene que empezar a saltarse todas las operaciones y retornar nulo.\nLa soluci√≥n que encontr√© fue crear un archivo de texto que tuviera cualquier texto, pero cuando eventualmente el texto dijera algo como \u0026ldquo;stop\u0026rdquo;, el loop retornara nulo. La forma de que el loop supiera lo que contiene archivo de texto ser√≠a simplemente agregar un paso al principio de del loop que lea el archivo de texto. En la lectura del archivo, habr√≠a que confirmar si dice o no la palabra m√°gica, y si la dice, retornar NULL.\nif (read.delim(\u0026#34;stop.txt\u0026#34;, header = FALSE)[[1]] == \u0026#34;stop\u0026#34;) return(NULL) No encontr√© una forma m√°s elegante de leer un texto y obtener su resultado como un vector limpio, porque las funciones de lectura que prob√© asumen que esperas un dataframe y no solamente un texto, pero es suficientemente conciso.\nEntonces, si el loop est√° ejecut√°ndose, pero yo llego y edito el archivo de texto para que diga la palabra m√°gica, el loop empezar√° a retornar nulo, y terminar√° a la brevedad.\nUna medici√≥n de rendimiento sencilla me indica que la lectura del archivo de texto se tarda tan solo 61 millon√©simas de segundo y apenas 16KB de memoria, por lo que la lectura del archivo de texto en cada paso no afectar√≠a virtualmente en nada al rendimiento del proceso:\nbench::mark( read.delim(\u0026#34;stop.txt\u0026#34;, header = FALSE)[[1]] ) # expression min median `itr/sec` mem_alloc `gc/sec` n_itr n_gc total_time result memory time gc # \u0026lt;bch:expr\u0026gt; \u0026lt;bch:\u0026gt; \u0026lt;bch:\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;bch:byt\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; \u0026lt;list\u0026gt; # 1 \u0026#34;read.delim(\\\u0026#34;stop.‚Ä¶ 58.1¬µs 61.7¬µs 15342. 16KB 44.7 6868 20 448ms \u0026lt;chr\u0026gt; \u0026lt;Rprofmem\u0026gt; \u0026lt;bench_tm\u0026gt; \u0026lt;tibble\u0026gt; Esta t√©cnica dio resultado, porque ahora puedo dejar el proceso andando con una cantidad muy alta de de casos seleccionados al azar, y cuando cambio el archivo de texto para se√±alar que ya quiero que se termine el loop, todos los miles de pasos restantes que a√∫n no eran procesados simplemente retornan nulo y terminan de forma instant√°nea, permitiendo que el loop termine correctamente y sus resultados se guarden. De esta forma no tengo que estar estimando cu√°ntos datos voy a calcular, sino que simplemente dejo calculando y hago terminar el proceso cuando yo lo necesite.\nAs√≠ que, durante las 24 horas que estuve fuera de casa por la navidad, el proceso alcanz√≥ a calcular 15 mil textos, luego detuve el proceso, trabaj√©, y la noche siguiente a la navidad volv√≠ a dejarlo calculando y alcanz√≥ a procesar 8 mil textos m√°s ü•∞\n","date":"2024-12-26T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2024-12-26/","tags":"consejos ; curiosidades ; blog ; purrr ; optimizaci√≥n","title":"Haciendo que un loop muy largo termine sin cancelarlo"},{"content":"El an√°lisis de sentimientos es una t√©cnica de an√°lisis de texto donde se aplican distintos algoritmos para poder clasificar textos de distinta longitud y complejidad en un conjunto preestablecido de categor√≠as relacionadas al sentimiento de dichos textos. Con el sentimiento de los textos nos referimos a la informaci√≥n subjetiva que entregan estos textos, as√≠ como los afectos que producen. Por ejemplo, \u0026ldquo;odio a mi gato\u0026rdquo; versus \u0026ldquo;mi gatita es tan tierna\u0026rdquo; son dos textos que expresan distintos niveles de negatividad/positividad, agresividad, ternura, etc√©tera. Las categor√≠as del an√°lisis del sentimiento suelen ser positivo, neutro y negativo, u otras m√°s complejas, como agrado (agradable/desagradable), activaci√≥n (activo/pasivo), entre otros.\nEn otras palabras, la aplicaci√≥n de un an√°lisis de sentimiento a un conjunto de textos nos permitir√≠a clasificar estos textos en categor√≠as como positivo, neutro y negativo, en base a la forma en que describen el tema del que tratan, o bien, cualidades de las palabras que se usen dentro del texto.\nEl an√°lisis de sentimiento usualmente es un medio para poder contar con nueva informaci√≥n que nos permita desarrollar nuevos an√°lisis. En este sentido, la nueva variable de sentimiento resulta √∫til de ser cruzada con otras variables acerca del texto, tales como variables que identifiquen la autor√≠a del texto, su fuente, quien enuncia el texto, de qu√© trata el texto, etc.\nAlgunos usos del an√°lisis de sentimiento son:\nEvaluar si los textos dentro de un conjunto de textos o corpus son positivos o negativos, Correlacionar si los textos de distintos autores difieren en sus sentimientos, Analizar si textos sobre determinadas tem√°ticas se correlacionan con sentimientos espec√≠ficos, Estudiar si ciertos temas son tratados de una forma espec√≠fica por ciertos autores, y de una forma distinta por otros Comparar si textos sobre un mismo tema son expuestos de forma distinta por distintos autores o fuentes Pensemos en el ejemplo de un conjunto de art√≠culos de prensa o noticias, cada uno con fecha y el medio de comunicaci√≥n del que proviene. Si hacemos una selecci√≥n de noticias sobre un tema espec√≠fico, podr√≠amos analizar c√≥mo cambia el sentimiento dominante con el que se plantea la tem√°tica en distintos momentos del tiempo, o si dos medios de comunicaci√≥n representan una misma tem√°tica bajo distinto sentimiento.\nlibrary(dplyr) library(readr) Probemos haciendo un an√°lisis de sentimiento a partir de un corpus de textos de noticias chilenas publicadas el a√±o 2024. Los datos son obtenidos de este repositorio de obtenci√≥n automatizada de textos de noticias de prensa escrita chilena.\n# direcci√≥n web donde se encuentran los datos url_datos \u0026lt;- \u0026#34;https://raw.githubusercontent.com/bastianolea/prensa_chile/refs/heads/main/datos/prensa_datos_muestra.csv\u0026#34; # lectura de los datos ubicados en internet noticias \u0026lt;- read_csv2(url_datos) # extracci√≥n de una marcha aleatoria de 20 noticias noticias_muestra \u0026lt;- noticias |\u0026gt; slice_sample(n = 20) En el c√≥digo anterior, identificamos la ubicaci√≥n de los datos que usaremos de prueba, que corresponden a un conjunto de 3000 noticias p√∫blicas del a√±o 2024, y cargamos los datos directamente desde internet. Como se trata de una prueba, reduciremos la cantidad de noticias a tan s√≥lo 20:\nnoticias_muestra # A tibble: 20 √ó 4 titulo cuerpo fuente fecha \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; 1 \u0026quot;Sismo de 7,3 de magnitud con epicentro en San Pedr‚Ä¶ \u0026quot;El m‚Ä¶ La Na‚Ä¶ 2024-07-18 2 \u0026quot;Mirar, inclinar y tocar: Las recomendaciones del B‚Ä¶ \u0026quot;Aton‚Ä¶ Emol 2024-09-13 3 \u0026quot;Fr√≠o y lluvia en la zona central: El pron√≥stico de‚Ä¶ \u0026quot;El p‚Ä¶ Megan‚Ä¶ 2024-04-26 4 \u0026quot;Comisi√≥n de Miner√≠a y Energ√≠a de la C√°mara aprueba‚Ä¶ \u0026quot;De m‚Ä¶ D. Fi‚Ä¶ 2024-11-06 5 \u0026quot;Nuevo l√≠der de Salesforce Chile entrega detalles d‚Ä¶ \u0026quot;En f‚Ä¶ D. Fi‚Ä¶ 2024-09-30 6 \u0026quot;Carabineros incauta 84 m√°quinas de azar y detiene ‚Ä¶ \u0026quot;Los ‚Ä¶ La Na‚Ä¶ 2024-04-05 7 \u0026quot;Este martes se estrena la nueva temporada de Indec‚Ä¶ \u0026quot;Este‚Ä¶ Megan‚Ä¶ 2024-08-13 8 \u0026quot;Trabajo activa subsidio al empleo en zonas afectad‚Ä¶ \u0026quot;El s‚Ä¶ D. Fi‚Ä¶ 2024-02-20 9 \u0026quot;Jos√© Pi√±era aparece en misa f√∫nebre de su hermano ‚Ä¶ \u0026quot;El e‚Ä¶ Megan‚Ä¶ 2024-02-09 10 \u0026quot;Hombre de 41 a√±os es asesinado en Vi√±a: fue atacad‚Ä¶ \u0026quot;El p‚Ä¶ La Na‚Ä¶ 2024-09-17 11 \u0026quot;Canto de ballenas jorobadas enviada al espacio ins‚Ä¶ \u0026quot;Desd‚Ä¶ El De‚Ä¶ 2024-05-06 12 \u0026quot;Juan Pablo Hermosilla adelanta que entregar√° chats‚Ä¶ \u0026quot;Juan‚Ä¶ El D√≠‚Ä¶ 2024-10-23 13 \u0026quot;Eclipse Solar 2024: revisa la fecha y ciudades de ‚Ä¶ \u0026quot;El m‚Ä¶ El Mo‚Ä¶ 2024-10-01 14 \u0026quot;Lluvia en Santiago: ¬øHasta cu√°ndo precipitar√° inte‚Ä¶ \u0026quot;En l‚Ä¶ Megan‚Ä¶ 2024-06-21 15 \u0026quot;OLCA y alza de la luz: ‚ÄúEl sistema energ√©tico est√°‚Ä¶ \u0026quot;En u‚Ä¶ El Ci‚Ä¶ 2024-07-06 16 \u0026quot;Caso P√≠o Nono: fiscal√≠a busca evitar ir a juicio t‚Ä¶ \u0026quot;Qu√© ‚Ä¶ Ex-An‚Ä¶ 2024-01-24 17 \u0026quot;‚ÄúLe minti√≥ a Chile‚Äù: Diputado Guzm√°n present√≥ ante‚Ä¶ \u0026quot;El d‚Ä¶ CNN C‚Ä¶ 2024-11-18 18 \u0026quot;PDI confirma detenci√≥n de \\\u0026quot;Perro Elvis\\\u0026quot; por pres‚Ä¶ \u0026quot;Dura‚Ä¶ 24 Ho‚Ä¶ 2024-08-31 19 \u0026quot;Otra de Maduro: El controvertido mandatario boliva‚Ä¶ \u0026quot;Vene‚Ä¶ Publi‚Ä¶ 2024-08-09 20 \u0026quot;‚ÄúHa sido un d√≠a dif√≠cil‚Äù: ministra Toh√° confirma q‚Ä¶ \u0026quot;‚ÄúHa ‚Ä¶ Publi‚Ä¶ 2024-10-17 Los datos tienen una columna con el t√≠tulo, otra con el cuerpo de la noticia, y finalmente la fuente de la noticia y su fecha de publicaci√≥n.\nConfiguraci√≥n del modelo de lenguaje local Para poder usar modelos LLM localmente con R, tenemos que instalar Ollama en nuestro equipo, que es la aplicaci√≥n que nos permite obtener y usar modelos de lenguaje locales, y ejecutar la aplicaci√≥n en nuestro computador. Ollama tiene que estar abierto para poder proveer del modelo a nuestra sesi√≥n de R.\nLuego, ya sea desde Ollama o desde R, tenemos que instalar un modelo de lenguaje. Desde R, es tan simple como ejecutar: ollamar::pull(\u0026quot;llama3.2:1b\u0026quot;), definiendo el modelo que queremos instalar. Al elegir un modelo, debes considerar las capacidades de tu computador para ejecutar los modelos, y que el tama√±o del modelo es directamente proporcional con la calidad de sus respuestas1.\nUna vez tengas Ollama abierto en tu computador, y un modelo previamente instalado, puedes proceder a usarlo en R en el siguiente paso.\nExtracci√≥n de sentimiento a partir del texto Para realizar el an√°lisis de sentimiento, utilizaremos la ayuda de un modelo de lenguaje de gran tama√±o (LLM), los cuales est√°n entrenados para este tipo de tareas. Cargamos el paquete {mall} para uso de LLMs en R, y {beepr} para anunciar con una campanita cuando se termine el procesamiento, porque puede tardar unos minutos.\nlibrary(mall) library(beepr) # ollamar::pull(\u0026#34;llama3.1:8b\u0026#34;) # instalar modelo llm_use(\u0026#34;ollama\u0026#34;, \u0026#34;llama3.1:8b\u0026#34;) # cargar modelo La funci√≥n llm_sentiment() del paquete {mall} facilita la extracci√≥n del sentimiento a partir del texto. Tan s√≥lo es necesario indicar la columna que contiene el texto, y las categor√≠as de sentimiento que deseamos obtener. Por medio del siguiente c√≥digo, se alimenta al modelo de lenguaje con cada uno de los textos, y se le pide obtener como respuesta si el texto es positivo, neutro o negativo.\nnoticias_sentimiento \u0026lt;- noticias_muestra |\u0026gt; llm_sentiment(cuerpo, pred_name = \u0026#34;sentimiento\u0026#34;, options = c(\u0026#34;positivo\u0026#34;, \u0026#34;neutro\u0026#34;, \u0026#34;negativo\u0026#34;)) beep() En mi computador personal, este proceso en total tom√≥ 88 segundos, lo que significa que tarda aproximadamente cuatro segundos por cada texto que el modelo analiza y clasifica. Esto depende de las capacidades gr√°ficas de tu computador, y del largo del texto. Las noticias suelen tener como m√≠nimo varios cientos de palabras, lo que hace que el proceso sean un poco m√°s lento.\nA continuaci√≥n, vemos los resultados del an√°lisis de sentimiento:\nnoticias_sentimiento |\u0026gt; select(sentimiento, titulo) # A tibble: 20 √ó 2 sentimiento titulo \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 neutro \u0026quot;Sismo de 7,3 de magnitud con epicentro en San Pedro de Atacama ‚Ä¶ 2 positivo \u0026quot;Mirar, inclinar y tocar: Las recomendaciones del Banco Central ‚Ä¶ 3 negativo \u0026quot;Fr√≠o y lluvia en la zona central: El pron√≥stico de Alejandro Se‚Ä¶ 4 positivo \u0026quot;Comisi√≥n de Miner√≠a y Energ√≠a de la C√°mara aprueba en particula‚Ä¶ 5 positivo \u0026quot;Nuevo l√≠der de Salesforce Chile entrega detalles de los s√∫per a‚Ä¶ 6 negativo \u0026quot;Carabineros incauta 84 m√°quinas de azar y detiene a 3 personas ‚Ä¶ 7 positivo \u0026quot;Este martes se estrena la nueva temporada de Indecisos: Candida‚Ä¶ 8 positivo \u0026quot;Trabajo activa subsidio al empleo en zonas afectadas por los in‚Ä¶ 9 negativo \u0026quot;Jos√© Pi√±era aparece en misa f√∫nebre de su hermano Sebasti√°n: Le‚Ä¶ 10 negativo \u0026quot;Hombre de 41 a√±os es asesinado en Vi√±a: fue atacado con ‚Äúun obj‚Ä¶ 11 positivo \u0026quot;Canto de ballenas jorobadas enviada al espacio inspira obra de ‚Ä¶ 12 positivo \u0026quot;Juan Pablo Hermosilla adelanta que entregar√° chats de su herman‚Ä¶ 13 positivo \u0026quot;Eclipse Solar 2024: revisa la fecha y ciudades de Chile en las ‚Ä¶ 14 negativo \u0026quot;Lluvia en Santiago: ¬øHasta cu√°ndo precipitar√° intensamente en l‚Ä¶ 15 negativo \u0026quot;OLCA y alza de la luz: ‚ÄúEl sistema energ√©tico est√° centrado en ‚Ä¶ 16 negativo \u0026quot;Caso P√≠o Nono: fiscal√≠a busca evitar ir a juicio tras rev√©s par‚Ä¶ 17 negativo \u0026quot;‚ÄúLe minti√≥ a Chile‚Äù: Diputado Guzm√°n present√≥ antecedentes a Co‚Ä¶ 18 negativo \u0026quot;PDI confirma detenci√≥n de \\\u0026quot;Perro Elvis\\\u0026quot; por presunta responsa‚Ä¶ 19 negativo \u0026quot;Otra de Maduro: El controvertido mandatario bolivariano ordena ‚Ä¶ 20 negativo \u0026quot;‚ÄúHa sido un d√≠a dif√≠cil‚Äù: ministra Toh√° confirma que Presidente‚Ä¶ noticias_sentimiento |\u0026gt; select(sentimiento) |\u0026gt; table() sentimiento negativo neutro positivo 11 1 8 Conclusi√≥n Revisando los resultados a la r√°pida, vemos que una noticia sobre un sismo es aparentemente neutra, probablemente por la forma en que est√© redactada. Noticias sobre la aprobaci√≥n de un proyecto de ley, la presentaci√≥n de nuevas tecnolog√≠as, o beneficios para personas afectadas por incendios, son interpretadas como positivas. Por √∫ltimo, noticias sobre frentes de mal tiempo, operaciones policiales, funerales, cr√≠menes y asesinatos son interpretadas como negativas. Tambi√©n, vemos que una noticia donde una ministra interpreta una jornada como dif√≠cil tambi√©n es negativa, y otra donde se critica al mandatario de un pa√≠s por sus actos tambi√©n.\nEn este sentido, el desempe√±o de aplicar el modelo de lenguaje para obtener el sentimiento de los textos parece satisfactorio. De forma automatizada, y sin intervenci√≥n ni supervisi√≥n humana, hemos obtenido valiosa informaci√≥n que resume un aspecto del significado codificado en los textos.\nA partir de esta nueva variable, podemos proceder, por ejemplo, a detectar noticias que contienen ciertos conceptos, y analizar si dicha tem√°tica se trata mayormente de forma positiva o negativa. O si est√° positividad o negatividad var√≠a a trav√©s de las distintas fuentes de informaci√≥n, momentos en el tiempo, u otras particularidades del texto.\nConsideraciones Los resultados siempre van a depender de la calidad de los datos que alimentes al modelo. Tambi√©n es necesario considerar que, debido a que los modelos de lenguaje no son deterministas, los resultados siempre pueden variar. En otras palabras, si analiza el sentimiento de un mismo texto m√∫ltiples veces, puede que los resultados sean levemente distintos. Teniendo esto en consideraci√≥n, es importante ser cr√≠ticos al momento de recibir resultados de un modelo de lenguaje o de cualquier otra herramienta de inteligencia artificial, y tambi√©n considerar estos resultados como convenientes intentos de aproximaci√≥n a la realidad: por un lado, los modelos de lenguaje facilitan muchas tareas, pero por otro, nunca podemos fiarnos 100% de sus resultados, sobre todo cuando estamos tratando con tem√°ticas complejas como son el significado expresado por textos que reflejan facetas complejas de la realidad social y pol√≠tica.\nSi este tutorial te sirvi√≥, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\nSi tu computador es muy b√°sico (tiene poca memoria RAM), recomiendo instalar Llama 3.2 1B. Si tiene al menos 8GB de memoria, recomiendo Llama 3.2 3B. Si tienes suficiente memoria (m√°s de 8GB), recomiendo Llama 3.1 8B.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-12-22T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/analisis_sentimiento_llm/","tags":"an√°lisis de texto ; inteligencia artificial","title":"An√°lisis de sentimiento usando modelos de lenguaje (LLM) locales en R"},{"content":"Resumen de las actualizaciones recientes de mis trabajos. Recientemente lanc√© un visualizador de temperaturas extremas de Chile, que permite ver gr√°ficamente los efectos del calentamiento global medidas por las estaciones meteorol√≥gicas del pa√≠s. Adem√°s, actualic√© los datos del visualizador de delincuencia, que ahora tiene datos hasta septiembre de 2024, y tambi√©n del visualizador de femicidios, que tambi√©n ahora tiene datos hasta la fecha.\nEn paralelo, otra aplicaci√≥n que se actualiza frecuentemente es la de an√°lisis de prensa, que se actualiza todos los lunes o martes de la semana con las noticias hasta el domingo anterior; es decir, muestra los datos de la √∫ltima semana completa hacia atr√°s (esto porque el visualizador es de datos semanales, no diarios, entonces tienen que estar terminadas las semanas para poder incluirlas en el an√°lisis, de lo contrario las semanas aparecer√≠an con menos datos).\nActualizaci√≥n: visualizador de delitos, ahora con datos hasta septiembre de 2024 üìà Explora la evoluci√≥n de la delincuencia en cualquier comuna o regi√≥n de Chile, y analiza el fen√≥meno de la inseguridad desde datos oficiales.\nRecuerda que todas las apps que hago son de c√≥digo abierto, y en sus repositorios incluyo los datos para que puedas reusarlos en tus propios an√°lisis!\nNuevo: Visualizador de temperaturas extremas en Chile üå§Ô∏èüî•\nConsulta datos hist√≥ricos de temperaturas extremas en el pa√≠s, desde 1970 hasta 2024, y visualiza los cambios hist√≥ricos en las temperaturas producto de la crisis clim√°tica üòû\nEste proyecto parte por dos razones: porque quer√≠a reutilizar los datos publicados en la plataforma de Datos Abiertos del Estado (muy recomendable, pero tambi√©n requiere de muchas mejoras), y porque genuinamente ten√≠a curiosidad sobre la evoluci√≥n en las temperaturas que estamos viviendo.\nMe tard√© solamente la tarde del domingo en hacer el scraping de datos, y parte del domingo y la ma√±ana del lunes en hacer el dashboard. Desarrollar este tipo de proyectos con R es realmente r√°pido!\nLo otro que quer√≠a hacer eran estos gr√°ficos radiales que muestran m√∫ltiples a√±os en un anillo de meses. Nunca los hab√≠a hecho! Quedan muy lindos y son muy f√°ciles de hacer con {ggplot2}.\nNunca hab√≠a explorado ni visualizado datos de clima, as√≠ que acepto cualquier cr√≠tica ‚ò∫Ô∏è\nEn el repositorio del proyecto dej√© los conjuntos de datos limpios y en un solo archivo, para quienes deseen explorar!\n","date":"2024-12-21T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2024-12-21/","tags":"blog","title":"Novedades: app de temperaturas extremas, actualizaciones de otras apps"},{"content":"Anoche dej√© el computador procesando 5000 noticias por 8 horas usando un modelo de lenguaje (LLM) local en R para obtener clasificaci√≥n, resumen y sentimiento de cada texto.\nEsto porque tengo una base de datos de m√°s de 600 mil noticias chilenas, con su texto completo, y quiero empezar a sacarle m√°s provecho. Por ejemplo, saber si noticias que hablan de ciertos temas son positivas o negativas (sentimiento), o simplemente clasificar de manera automatizada las noticias para separar las de pol√≠tica y econom√≠a de las de deportes y far√°ndula.\nPara la inferencia us√© el modelo Llama 3.1 de 8B, a trav√©s de Ollama y el paquete de R {mall}. Hice un script para cada tipo de inferencia, y est√°n estructurados para cargar los resultados existentes de su mismo proceso, excluir los textos que ya fueron procesados, y empezar a procesar una muestra aleatoria de una cierta cantidad de nuevos textos. La cantidad aleatoria est√° definida por el tiempo estimado que va a tomar en procesarlas. Se demora aproximadamente una hora en procesar 1000 noticias, pero esto depende de qu√© tanto texto tenga la noticia, y del tipo de inferencia que se est√° realizando; por ejemplo, los res√∫menes de texto tardan m√°s que el an√°lisis de sentimiento.\nEl proceso en s√≠ mismo se ve m√°s o menos as√≠:\nsentimientos \u0026lt;- map(datos_limpios_split, \\(dato) { inicio \u0026lt;- now() message(paste(\u0026#34;procesando\u0026#34;, dato$id)) # obtener sentimiento sentimiento \u0026lt;- dato$texto |\u0026gt; llm_vec_sentiment(options = c(\u0026#34;positivo\u0026#34;, \u0026#34;neutral\u0026#34;, \u0026#34;negativo\u0026#34;)) # reintentar 1 vez if (is.na(sentimiento)) { sentimiento \u0026lt;- dato$texto |\u0026gt; llm_vec_sentiment(options = c(\u0026#34;positivo\u0026#34;, \u0026#34;neutral\u0026#34;, \u0026#34;negativo\u0026#34;)) } final \u0026lt;- now() if (is.na(sentimiento)) return(NULL) # resultado resultado \u0026lt;- tibble(id = dato$id, sentimiento, tiempo = final - inicio, n_palabras = dato$n_palabras ) return(resultado) }); beep() Se trata de un loop a partir de una lista de dataframes de una fila, cada elemento de la lista conteniendo los datos de cada noticia. Dentro de la alteraci√≥n se extrae el sentimiento, se clasifica o se genera un resumen con una funci√≥n del paquete {mall}. Luego, en caso de que la inferencia haya fallado (los modelos de lenguaje no son deterministas, por lo que pueden falla la tarea o entregar resultados inesperados de vez en cuando), se reintenta una vez, y al final se entregan los resultados con una variable que representa el tiempo que tard√≥ el procesamiento.\nTambi√©n hice gr√°ficos para monitorear el avance, y si bien no es r√°pido (4 segundos promedio por noticia), confirm√© que el computador no se sobrecalienta (tuvo un desempe√±o parejo luego de 8 horas). Tambi√©n se nota c√≥mo los textos m√°s largos tardan m√°s en obtener resultados.\nDigo que el computador no se sobrecalienta, porque tengo un MacBook Air M3, que si bien tiene un GPU poderoso, no tiene ventiladores üò∞ as√≠ que tuve miedo de que el desempe√±o bajara por la temperatura. Mi soluci√≥n: dejarlo frente a un ventilador üòÇ\nVoy a dejarlo unas noches m√°s procesando, y con estos nuevos datos voy a poder actualizar mi aplicaci√≥n de an√°lisis de prensa para ponerle cosas m√°s interesantes ü•∞\n","date":"2024-12-20T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/2024-12-20/","tags":"inteligencia artificial ; blog","title":"Procesando datos de texto en masa usando modelos de lenguaje (LLM)"},{"content":" Visualizador de datos de temperaturas extremas en el pa√≠s. Permite consultar r√°pidamente datos hist√≥ricos para obtener gr√°ficos que revelan los cambios en temperaturas a trav√©s del tiempo en nuestro pa√≠s. El objetivo es visibilizar los efectos del cambio clim√°tico por medio de los datos.\nEn esta plataforma puedes visualizar datos hist√≥ricos sobre temperaturas extremas del pa√≠s, cuyo objetivo es visibilizar los efectos del cambio clim√°tico por medio de los datos.\nLos datos se obtienen desde el Portal de Datos Abiertos del Estado de Chile mediante web scrapping. El proyecto unifica todas las fuentes de datos separadas en una sola base de datos de temperaturas, los cuales son utilizados en la plataforma de visualizaci√≥n interactiva.\nLos datos son obtenidos desde fuentes oficiales, y abarcan aproximadamente desde 1970 a 2024.\nEste repositorio obtiene datos desde el Portal de Datos Abiertos del Estado de Chile mediante web scrapping, unifica todas las fuentes de datos separadas en una sola base de datos de temperaturas, y produce visualizaciones y una plataforma de visualizaci√≥n interactiva.\nAccede al visualizador de datos por este enlace.\nEl producto principal de este c√≥digo es una base de datos de temperaturas extremas en Chile, por estaci√≥n meteorol√≥gica y por d√≠a, desde 1970 a 2024 disponible convenientemente en un solo archivo .csv (tambi√©n disponible en .rds y en formato .parquet)\nEste proyecto parte por dos razones: porque quer√≠a reutilizar los datos publicados en la plataforma de Datos Abiertos del Estado (muy recomendable, pero tambi√©n requiere de muchas mejoras), y porque genuinamente ten√≠a curiosidad sobre la evoluci√≥n en las temperaturas que estamos viviendo.\nMe tard√© solamente la tarde del domingo en hacer el scraping de datos, y parte del domingo y la ma√±ana del lunes en hacer el dashboard. Desarrollar este tipo de proyectos con R es realmente r√°pido!\nLo otro que quer√≠a hacer eran estos gr√°ficos radiales que muestran m√∫ltiples a√±os en un anillo de meses. Nunca los hab√≠a hecho! Quedan muy lindos y son muy f√°ciles de hacer con {ggplot2}.\nNunca hab√≠a explorado ni visualizado datos de clima, as√≠ que acepto cualquier cr√≠ticaÔ∏è! ü•∞\nObtenci√≥n de los datos Los datos son obtenidos de forma semi-autom√°tica usando t√©cnicas de web scrapping con el paquete {RSelenium}. Esto debido a que el portal de datos abiertos no tiene una buena interfaz de usuario (no permite abrir resultados en nuevas pesta√±as, no permite copiar los enlaces de las fuentes de datos, y hay que actualizar las p√°ginas entre 1 a 8 veces para que muestren los resultados). El script obtener_temperaturas.R simplifica tres tareas para obtener los datos: realizar una b√∫squeda y ampliar la cantidad de resultados mostrados en la p√°gina, entrar a cada uno de los enlaces del resultado de la b√∫squeda, y dentro de los conjuntos de datos, descargar todos los archivos con un solo comando. Esta ahorra much√≠simo tiempo, considerando que los datos de temperatura vienen separados por semestre y a√±o, lo que significa que hay que entrar a aproximadamente 16 conjuntos de datos distintos, y dentro de estos conjuntos de datos hay que descargar aproximadamente 6 archivos separados, mientras la plataforma dificulta abrir estos resultados por pesta√±as.\nFuentes Datos de la Direcci√≥n General de Aeron√°utica Civil subidos a la plataforma de Datos Abiertos del Estado Direcci√≥n Meteorol√≥gica de Chile ","date":"2024-12-16T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_temperaturas_chile/","tags":"apps ; Chile","title":"App: Temperaturas extremas en Chile"},{"content":" ‚ö†Ô∏è este post est√° desactualizado, ya que es preferible usar el asistente {gander} El paquete {pal} te permite crear asistentes para programar en R, potenciados por modelos de lenguaje (LLM). La utilidad de estos asistentes es que pueden ayudarte a realizar tareas r√°pidamente a partir de tu c√≥digo de R, o incluso a partir de un texto que describa lo que quieres hacer.\nEn este post te ense√±o a crear y usar asistentes de {pal} para dos tareas que realizo frecuentemente: describir lo que hace un c√≥digo de R, y traducir una instrucci√≥n a c√≥digo de {dplyr}.\nLa idea principal es que puedes seleccionar tu c√≥digo o texto en R, y presionar una combinaci√≥n de teclas para elegir tu asistente. Dependiendo del tipo de asistente, se agregar√° c√≥digo arriba o abajo de lo que seleccionaste, o bien, se va a reemplazar lo que seleccionaste por lo que haga el asistente.\nInstalar un modelo de lenguaje local desde R Como este paquete depende de el uso de un modelo de lenguaje para funcionar, necesitas tener instalado un modelo de lenguaje en tu equipo, o tener una suscripci√≥n a un modelo de lenguaje en la nube. Personalmente prefiero usar un modelo de lenguaje local: Llama 3.1 con 8 billones de par√°metros. Para instalar un modelo localmente en tu equipo desde R, primero tienes que instalar Ollama en tu equipo, abrir la aplicaci√≥n, y luego instalar el paquete de R {ollamar} para descargar un modelo de lenguaje local desde R.1\nSi no tienes un modelo instalado, usa este comando para descargar e instalar un modelo desde R:\nlibrary(ollamar) pull(\u0026#34;llama3.1:8b\u0026#34;) Es necesario tener la aplicaci√≥n Ollama abierta en tu computadora, dado que √©sta aplicaci√≥n es la que le entrega el modelo de lenguaje a R.\nCrear asistentes de IA locales El primer paso para crear los asistentes de programaci√≥n es instalar el paquete [{pal}]:\n# install.packages(\u0026#34;pak\u0026#34;) pak::pak(\u0026#34;simonpcouch/pal\u0026#34;) Una vez que tengamos nuestro modelo LLM instalado, debemos indicarle a {pal} que queremos usarlo. Si tienes una suscripci√≥n a un modelo de lenguaje en la nube como Claude o ChatGPT, puedes configurarlo en este paso. Como tenemos un modelo local, le indicamos que usaremos Ollama y el nombre de nuestro modelo instalado:\noptions( .pal_fn = \u0026#34;chat_ollama\u0026#34;, .pal_args = list(model = \u0026#34;llama3.1:8b\u0026#34;) ) Ahora viene lo entretenido. Los asistentes tienen un rol, una interfaz y un contenido. Para crear nuestro asistente, en la funci√≥n prompt_new() tenemos que darle un rol (que ser√≠a como el nombre de asistente), y especificar la interfaz; es decir, c√≥mo queremos que intervenga el c√≥digo que le entreguemos. Esto puede ser agregando su intervenci√≥n antes del c√≥digo seleccionado (prefix), despu√©s del c√≥digo seleccionado (suffix), o reemplazando el c√≥digo seleccionado por su aporte (replace).\nlibrary(pal) prompt_new(role = \u0026#34;nombre_de_asistente\u0026#34;, interface = \u0026#34;prefix\u0026#34;) Cuando ejecutas esta funci√≥n se crear√° tu asistente y se abrir√° un nuevo archivo .md, que contiene las instrucciones que usar√° tu asistente para ayudarte. √âste ser√° el contenido de tu asistente. El archivo contiene unas instrucciones por defecto que puedes modificar, o puedes escribir tus propias instrucciones. Lo importante es que estas instrucciones sean claras, breves, y que ojal√° incluyan un ejemplo de qu√© es lo que esperas como respuesta.\nLuego de modificar este archivo, tienes que ejecutar la funci√≥n directory_load() para que {pal} actualice tus asistentes. Para volver a editar tu asistente puedes usar la funci√≥n prompt_edit(\u0026quot;nombre_de_tu_asistente\u0026quot;), pero luego de editarlo debes volver a ejecutar directory_load().\nCrear un asistente de explicaci√≥n de c√≥digo de R Primero voy a crear un asistente que me ayude a explicar c√≥digo de R. La utilidad de esta asistente para m√≠ ser√≠a que me ayude a agregar comentarios a los scripts que entrego a mis estudiantes de R, de manera que les sea m√°s f√°cil entender lo que hace cada parte de los scripts.\nDefino el nombre de mi asistente y su interacci√≥n con el c√≥digo seleccionado:\nprompt_new(role = \u0026#34;explicar\u0026#34;, interface = \u0026#34;prefix\u0026#34;) Luego se abre el archivo para definir el contenido del asistente. Luego de un par de pruebas, ingres√© las siguientes instrucciones o prompts:\nEres un asistente experto en ciencia de datos, dise√±ado para ayudar a usuarios de R a entender lo que hace un c√≥digo de R. El c√≥digo que debes explicar proviene principalmente de paquetes de R del Tidyverse, como dplyr, tidyr, stringr y otros. Tu tarea es explicar el c√≥digo de forma breve y clara, explicando lo que hace cada funci√≥n, pero sin extenderte demasiado. Responde s√≥lo en espa√±ol y en min√∫sculas, anteponiendo un signo # a tu respuesta, para que tu respuesta sea un p√°rrafo de comentario de R. Inserta un salto de l√≠nea cada 64 caracteres. Responde s√≥lo con la explicaci√≥n del c√≥digo, sin saltos de l√≠nea al rededor de la respuesta. Por ejemplo, si recibes el siguiente c√≥digo de R: iris |\u0026gt; group_by(Species) |\u0026gt; summarize(n = mean(Sepal.Length)) |\u0026gt; arrange(desc(n)) Responde con una explicaci√≥n breve, como la siguiente: # agrupa los datos del dataframe iris seg√∫n la variable Species usando la funci√≥n group_by(), luego calcula # el promedio de la variable Sepal.Length usando la funci√≥n mean() dentro de summarize(), y # finalmente ordena las filas resultantes de mayor menor usando la funci√≥n arrange() y desc() C√≥mo puedes ver, se trata de unas pocas instrucciones breves que definen claramente lo que espero de la asistente, junto a un ejemplo muy esquem√°tico del resultado esperado.\nEl √∫ltimo paso para integrar a los asistentes a tu flujo de trabajo es especificar un atajo de teclado para invocar a tu asistente. En RStudio, si entras al men√∫ Tools y eliges la opci√≥n Modify Keyboard Shortcuts, puede buscar Pal para especificar un atajo de teclado. En mi caso us√© comando + shift + P. Si no quieres un atajo de teclado, en el men√∫ Addins de RStudio puedes invocar Pal.\nEn el siguiente video vemos la funcionalidad en acci√≥n:\nSelecciona el c√≥digo que necesites Presiona el atajo de teclado Elige el asistente que quieras usar y presiona Enter Espera a que el modelo de lenguaje inserte el texto Vemos c√≥mo el asistente escribe una explicaci√≥n del c√≥digo que le entregu√© ü•≥\nA continuaci√≥n (¬°y para que vean que funciona bien!) les muestro tres ejemplos donde seleccion√© c√≥digo de R y us√© el asistente para que escriba una explicaci√≥n del c√≥digo:\nEjemplo 1:\n# lee una hoja de excel llamada \u0026#34;Datos Histograma\u0026#34; desde la ruta indicada usando read_excel() de readxl, # lo convierte a min√∫sculas con clean_names(), crea un nuevo campo \u0026#34;tmax\u0026#34; que reemplaza los valores nulos # por 17.8 y finalmente selecciona solo las columnas que no son tmax, eliminando tmedia datos_1 \u0026lt;- readxl::read_excel(\u0026#34;Datos Histograma.xlsx\u0026#34;) |\u0026gt; janitor::clean_names() |\u0026gt; mutate(tmax = replace_na(tmax, 17.8)) |\u0026gt; select(-tmedia) Ejemplo 2:\n# crea un nuevo dataframe llamado kms_a√±o con variables a√±o y kms a trav√©s de tribble(), luego # crea un modelo lineal usando la funci√≥n lm() que relacionar√° kms con a√±o, finalmente guarda las predicciones # del modelo en una nueva columna del mismo dataframe llamada pred1 utilizando predict() # el modelo busca la relaci√≥n entre los a√±os y el kilometraje kms_a√±o \u0026lt;- tribble(~a√±o, ~kms, 2021, 530, 2022, 930, 2023, 1260) # crear modelo lineal model \u0026lt;- lm(kms ~ a√±o, data = kms_a√±o) # crear predicci√≥n kms_a√±o$pred1 \u0026lt;- predict(model) Ejemplo 3:\n# selecciona las columnas titulo e id del dataframe metadatos usando la funci√≥n select() , # luego filtra los datos para incluir solo aquellas filas en las que se encuentre la cadena \u0026#34;microemprend\u0026#34; # en la variable titulo seg√∫n la detecci√≥n de expresi√≥n regular definida por str_detect(), # repite el proceso de filtro pero buscando ahora esta vez la cadena \u0026#34;sexo\u0026#34;, # por √∫ltimo extrae la columna id del dataframe resultante usando la funci√≥n pull() metadatos |\u0026gt; select(titulo, id) |\u0026gt; filter(str_detect(titulo, \u0026#34;microemprend\u0026#34;)) |\u0026gt; filter(str_detect(titulo, \u0026#34;sexo\u0026#34;)) pull(id) C√≥mo se ven los ejemplos, el asistente entrega explicaciones bastante buenas, que con m√≠nimos retoques resultar√≠an √∫tiles para orientar a usuarios principiantes de R. Tambi√©n podr√≠a servir para otros usuarios de R que reciban c√≥digo y no lo entiendan.\nSi quieres instalar este asistente en tu equipo, ejecuta el siguiente c√≥digo en tu consola de R:\npal::prompt_new(\u0026#34;explicar\u0026#34;, \u0026#34;prefix\u0026#34;, contents = \u0026#34;https://gist.github.com/bastianolea/b190b3be7477c1c48a5b06cbe7e8d441\u0026#34;) Crear un asistente de programaci√≥n en {dplyr} El segundo asistente de programaci√≥n que voy a crear va a ser uno que traduzca una descripci√≥n de c√≥digo escrita en lenguaje natural a c√≥digo de {dplyr}. Es decir, un asistente que haga lo contrario al asistente anterior: le voy a dar una explicaci√≥n de un c√≥digo, y el asistente va a generar el c√≥digo necesario.\nPara poner a prueba la utilidad de esta herramienta y su facilidad de uso, la instrucci√≥n que le voy a dar al asistente para que funcione va a ser simplemente la misma instrucci√≥n que le di a la asistente de explicaci√≥n de c√≥digo, pero al rev√©s; es decir, le voy a pedir que sea un asistente que programe en R con {dplyr}, y el ejemplo que le voy a dar de su funcionamiento va a ser el mismo ejemplo que le di al asistente anterior, pero primero la explicaci√≥n del c√≥digo, y despu√©s el c√≥digo.\nLa instrucci√≥n quedar√≠a as√≠:\nEres un asistente experto en ciencia de datos, dise√±ado para ayudar a programar en R usando principalmente el paquete dplyr. El c√≥digo que debes escribir proviene principalmente de paquetes de R del Tidyverse, como dplyr, tidyr, stringr y otros. Tu tarea es convertir la instrucci√≥n escrita en c√≥digo de R usando dplyr. Responde s√≥lo con el c√≥digo de dplyr necesario para cumplir con la instrucci√≥n, sin comentarios ni explicaciones. Por ejemplo, si recibes la siguiente instrucci√≥n: agrupa los datos del dataframe iris seg√∫n la variable Species, luego calcula el promedio de la variable Sepal.Length, y finalmente ordena las filas resultantes de mayor menor Responde con el siguiente c√≥digo de R y dplyr: iris |\u0026gt; group_by(Species) |\u0026gt; summarize(n = mean(Sepal.Length)) |\u0026gt; arrange(desc(n)) El siguiente video retrata el funcionamiento de este nuevo asistente, y vemos que sus resultados son correctos y √∫tiles:\nC√≥mo podemos ver, el asistente escribe r√°pidamente c√≥digo de {dplyr} a partir de la descripci√≥n que le dimos. Esto podr√≠a ser muy √∫til para usuarios principiantes que tengan una idea de lo que quieren hacer pero no sepan exactamente c√≥mo hacerlo, o para usuarios avanzados que est√°n cansados de escribir y quieren que una pobre m√°quina trabaje por ellos.\nSi quieres instalar este asistente en tu equipo, ejecuta el siguiente c√≥digo en tu consola de R:\npal::prompt_new(\u0026#34;dplyr\u0026#34;, \u0026#34;suffix\u0026#34;, contents = \u0026#34;https://gist.github.com/bastianolea/a0be6c6b4471cf8e69bc1b7f30d8101a\u0026#34;) √âstos son s√≥lo dos usos b√°sicos que se le podr√≠a dar a este paquete para ayudarnos a desarrollar en R. Se podr√≠an crear muchos m√°s, como asistentes que expliquen los resultados de t√©cnicas estad√≠sticas, asistentes que produzcan visualizaciones de datos, y muchas otras aplicaciones de modelos de lenguaje a la programaci√≥n.\nSi se te ocurren m√°s ideas o ya probaste este paquete, ¬°d√©jame un comentario!\nSi tu computador no es muy poderoso, te recomiendo instalar llama3.2:1b (m√°s liviano) o llama3.2:3b (un poco mejor), pero si tienes suficiente memoria y tarjeta de video, puedes instalar llama3.1:8b.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-12-10T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/pal_asistentes_llm/","tags":"consejos ; inteligencia artificial","title":"Crea tu propio asistente de programaci√≥n en R con inteligencia artificial usando el paquete {pal}"},{"content":"No soy una persona muy cercana a la estad√≠stica, pero el d√≠a de hoy por primera vez se me ocurri√≥ aplicar una regresi√≥n lineal para responder una pregunta de mi vida cotidiana.\nResulta que un compa√±ero del ultraciclismo, el destacado ciclista Andr√©s Arias, pregunt√≥ en su Instagram si alguien pod√≠a predecir cu√°ntos kil√≥metros va a recorrer este 2024 durante el desaf√≠o Rapha Festive 500, un desaf√≠o del que participamos muchos ciclistas, que consiste en recorrer 500 km en bicicleta entre el 24 y el 31 de diciembre1.\nLa pregunta la hizo Andr√©s luego de comentar cu√°nto hab√≠a recorrido para el desaf√≠o en los a√±os anteriores: 530 kil√≥metros en 2021, 930 kms en 2022, y 1.260 en 2023. Naturalmente not√© que exist√≠a una cierta progresi√≥n lineal entre estas cifras, as√≠ que me levant√© del sill√≥n y abr√≠ R para hacer una prueba ü§î\nLo primero fue anotar estas cifras en una tabla de datos:\nlibrary(dplyr) kms_a√±o \u0026lt;- tribble(~a√±o, ~kms, 2021, 530, 2022, 930, 2023, 1260) Luego visualizar los datos:\nlibrary(ggplot2) grafico_1 \u0026lt;- kms_a√±o |\u0026gt; ggplot() + aes(x = a√±o, y = kms) + geom_line(linewidth = 1, alpha = .4) + geom_point(size = 4, alpha = .7) + scale_x_continuous(breaks = kms_a√±o$a√±o) + theme_classic() + theme(panel.grid.major.x = element_line()) grafico_1 Efectivamente, la cantidad de kil√≥metros recorridos para este desaf√≠o en cada a√±o ha aumentado de una manera casi lineal.\nMi idea fue crear un modelo de regresi√≥n lineal para ajustar estos datos a una recta que, al extenderla, nos permita predecir cu√°ntos kil√≥metros ser√≠an recorridos en los siguientes a√±os, si la tendencia se mantiene.\nAjustamos un modelo de regresi√≥n lineal, por medio del cual queremos predecir los kil√≥metros a partir de los a√±os, dado que intuimos que un aumento en los a√±os conlleva tambi√©n un aumento en los kil√≥metros.\n# crear modelo lineal modelo \u0026lt;- with(kms_a√±o, lm(kms ~ a√±o)) # crear predicci√≥n prediccion \u0026lt;- predict(modelo) prediccion 1 2 3 541.6667 906.6667 1271.6667 # visualizar modelo grafico_1 + geom_line(aes(y = prediccion), color = \u0026#34;purple3\u0026#34;, linewidth = 1.4, linetype = \u0026#34;dashed\u0026#34;, alpha = .4) + geom_point(aes(y = prediccion), color = \u0026#34;purple3\u0026#34;, size = 4, alpha = .7) + theme(panel.grid.major.x = element_line()) La primera predicci√≥n que obtenemos es una predicci√≥n de los datos que ya conocemos, pero a partir de la recta ajusta por el modelo. Es decir, son los valores que corresponden a cada punto en el tiempo de acuerdo a la l√≠nea de regresi√≥n proyectada. Estos valores se asemejan mucho a los valores reales, pero al ser un modelo, no son exactamente iguales, ya que corresponden a una simplificaci√≥n de la realidad.\nEn t√©rminos simples, un modelo de regresi√≥n lineal crea o ajusta una recta que busca cruzar todos los puntos de los datos de la manera m√°s cercana a ellos posible. Por lo tanto, el gr√°fico anterior compara los datos reales con los datos representados por el modelo, que en el fondo son resumidos por una sola recta.\nA partir de esta recta, podemos predecir los valores que corresponder√≠an a observaciones futuras (en este caso, los kil√≥metros recorridos en los a√±os siguientes) asumiendo que los valores futuros seguir√°n ubic√°ndose dentro de esta misma recta que predijo bastante bien los valores reales.\nLo que haremos ser√° crear nuevos datos, en este caso nuevos a√±os, que no est√©n contemplados dentro de los datos originales, que llegaban solamente hasta 2023.\n# crear nuevas observaciones para predecir predecir \u0026lt;- tibble(a√±o = 2021:2026) Luego usamos el modelo para predecir los valores que tendr√≠an estos nuevos datos (al extender a recta hacia los nuevos a√±os).\n# predecir las nuevas observaciones en base al modelo ajustado prediccion \u0026lt;- predict(modelo, newdata = predecir) prediccion 1 2 3 4 5 6 541.6667 906.6667 1271.6667 1636.6667 2001.6667 2366.6667 Finalmente reunimos estos resultados en una nueva tabla de datos que contiene los a√±os y los kil√≥metros predichos.\npredicho \u0026lt;- bind_cols(predecir, kms_pred = prediccion) predicho # A tibble: 6 √ó 2 a√±o kms_pred \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; 1 2021 542. 2 2022 907. 3 2023 1272. 4 2024 1637. 5 2025 2002. 6 2026 2367. Teniendo estas predicciones, el √∫ltimo paso es unir las predicciones con los datos reales, y ponernos a analizar los resultados:\n# unir datos predichos (que tienen m√°s a√±os) con los datos reales kms_a√±o_pred \u0026lt;- left_join(predicho, kms_a√±o, by = join_by(a√±o)) kms_a√±o_pred # A tibble: 6 √ó 3 a√±o kms_pred kms \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 2021 542. 530 2 2022 907. 930 3 2023 1272. 1260 4 2024 1637. NA 5 2025 2002. NA 6 2026 2367. NA Para visualizar los resultados, transformamos los datos a formato largo, para que en vez de tener dos columnas (los kil√≥metros reales y predichos) tengamos una sola columna con todos los valores, y una segunda columna que distinga los valores entre kil√≥metros reales y kil√≥metros predichos. Adem√°s, creamos una columna con los datos formateados de una manera m√°s legible.\nlibrary(tidyr) kms_a√±o_pred_2 \u0026lt;- kms_a√±o_pred |\u0026gt; # transformar a largo o a tidy pivot_longer(c(kms, kms_pred), values_to = \u0026#34;valor\u0026#34;, names_to = \u0026#34;tipo\u0026#34;) |\u0026gt; # recodificar categor√≠as mutate(tipo = recode(tipo, \u0026#34;kms\u0026#34; = \u0026#34;kms reales\u0026#34;, \u0026#34;kms_pred\u0026#34; = \u0026#34;predicci√≥n\u0026#34;)) |\u0026gt; arrange(tipo) |\u0026gt; # crear etiquetas mutate(etiqueta = round(valor, 0), etiqueta = format(etiqueta, big.mark = \u0026#34;.\u0026#34;, trim = TRUE), etiqueta = paste(etiqueta, \u0026#34;kms\u0026#34;)) kms_a√±o_pred_2 # A tibble: 12 √ó 4 a√±o tipo valor etiqueta \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 2021 kms reales 530 530 kms 2 2022 kms reales 930 930 kms 3 2023 kms reales 1260 1.260 kms 4 2024 kms reales NA NA kms 5 2025 kms reales NA NA kms 6 2026 kms reales NA NA kms 7 2021 predicci√≥n 542. 542 kms 8 2022 predicci√≥n 907. 907 kms 9 2023 predicci√≥n 1272. 1.272 kms 10 2024 predicci√≥n 1637. 1.637 kms 11 2025 predicci√≥n 2002. 2.002 kms 12 2026 predicci√≥n 2367. 2.367 kms Creamos un gr√°fico para analizar visualmente los resultados de nuestra predicci√≥n:\nkms_a√±o_pred_2 |\u0026gt; ggplot() + aes(x = a√±o, y = valor, color = tipo, linetype = tipo) + geom_line(linewidth = 1, alpha = 0.7) + geom_point(size = 3, alpha = 0.8) + geom_point(data = ~filter(.x, a√±o == 2024), size = 3*4, alpha = 0.1, show.legend = F) + geom_text(data = ~filter(.x, tipo == \u0026#34;predicci√≥n\u0026#34;, a√±o \u0026gt; 2023), aes(label = etiqueta), hjust = 0, nudge_x = 0.1, nudge_y = -50, size = 3, show.legend = F) + geom_text(data = ~filter(.x, tipo != \u0026#34;predicci√≥n\u0026#34;, a√±o \u0026lt;= 2023), aes(label = etiqueta), hjust = 0, nudge_x = 0.1, nudge_y = -50, size = 3, show.legend = F) + theme_classic() + scale_color_manual(values = c(\u0026#34;kms reales\u0026#34; = \u0026#34;black\u0026#34;, \u0026#34;predicci√≥n\u0026#34; = \u0026#34;red2\u0026#34;)) + scale_y_continuous(labels = ~paste(format(.x, big.mark = \u0026#34;.\u0026#34;), \u0026#34;kms\u0026#34;)) + scale_x_continuous(expand = expansion(c(0.05, 0.1))) + guides(color = guide_legend(position = \u0026#34;inside\u0026#34;)) + labs(y = \u0026#34;kms\u0026#34;, color = NULL, linetype = NULL) + theme(panel.grid.major.x = element_line(), legend.position.inside = c(.9, .2)) Considerando los tres a√±os de datos que tenemos de los recorridos en bicicleta de Andr√©s Arias durante el desaf√≠o Rapha Festive 500, podr√≠amos predecir que este a√±o Andr√©s va a recorrer 1.637 kil√≥metros entre el 24 y el 31 de diciembre, bajo el supuesto de que cada a√±o Andr√©s ha aumentado sus kil√≥metros de forma lineal.\nAhora, esto choca un poco con la realidad, porque el hecho de algo aumente peri√≥dicamente no significa que en el siguiente periodo el aumento vaya a ser necesariamente el mismo que antes. Mucho menos cuando estamos hablando de datos que tienen que ver con procesos humanos. Pero de todas maneras fue un ejercicio entretenido üòä\nS√≠, es enfermizo, y s√≠, nuestras familias nos odian.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-12-03T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/regresion_ciclismo/","tags":"estad√≠stica ; ggplot2","title":"Aplicando una regresi√≥n lineal en la vida diaria: predecir kil√≥metros por recorrer en bicicleta"},{"content":"En esta p√°gina mantengo muestras de algunos proyectos que he realizado como analista de datos y desarrollador de R, y que consisten principalmente en aplicaciones web para la visualizaci√≥n y exploraci√≥n de datos usando el lenguaje de programaci√≥n R, la suite de paquetes para ciencia de datos Tidyverse, y el paquete de desarrollo de aplicaciones web Shiny.\nTodo lo descrito ha sido programado √≠ntegramente por mi, como parte de distintos equipos de trabajo.\nVisualizador de resultados de encuesta de opini√≥n sobre China N√∫cleo Milenio sobre los Impactos de China en Am√©rica Latina\nDesarrollo de una aplicaci√≥n web que visualiza los resultados de la Encuesta de opini√≥n p√∫blica: ¬øQu√© piensan los chilenos sobre China?, para el N√∫cleo Milenio sobre los Impactos de China en Am√©rica Latina (ICLAC).\nLa aplicaci√≥n entrega m√°s de 20 gr√°ficos con distintos elementos de interactividad para presentar los resultados principales de la encuesta, y en la parte inferior de la p√°gina se encuentra un visualizador personalizado donde las y los usuarios pueden elegir cualquier pregunta de la encuesta y aplicarle filtros, desagregaci√≥n, cruces de variables, visualizaci√≥n hist√≥rica, y m√°s.\nEl sistema est√° dise√±ado para recibir nuevas encuestas que se agregan al visualizador existente sin problemas, mediante un proceso de limpieza y procesamiento de los datos automatizado.\nNota: en la imagen se ve el visualizador en dos columnas, dado que es muy largo\nPuedes acceder al visualizador de la encuesta aqu√≠.\n√çndice de Saturaci√≥n de Destinos Tur√≠sticos Pontificia Universidad Cat√≥lica de Chile\nReporte automatizado en R y Quarto con gr√°ficos ggplot2.\nProgramaci√≥n de sistemas automatizados de obtenci√≥n y procesamiento de datos, motor de c√°lculo estad√≠stico para todas las comunas y destinos tur√≠sticos del pa√≠s, visualizaciones interactivas de datos, reportes automatizados, coordinaci√≥n de dise√±o y programaci√≥n de plataforma web.\nProyecto FONDEF √çndice de Saturaci√≥n de Destinos Tur√≠sticos. Programaci√≥n de sistemas automatizados de obtenci√≥n y procesamiento de datos, motor de c√°lculo estad√≠stico para todas las comunas y destinos tur√≠sticos del pa√≠s, visualizaciones interactivas de datos, reportes automatizados, coordinaci√≥n de dise√±o y programaci√≥n de plataforma web.\n√çndice de movilidad Google Chile DataUC (Facultad de Matem√°ticas PUC), Pontificia Universidad Cat√≥lica de Chile\nDesarrollo de una plataforma de visualizaci√≥n de datos que acced√≠a a los datos peri√≥dicamente actualizados de movilidad de Google, para visualizar la informaci√≥n aplicada a Chile, por regi√≥n y provincia. Adem√°s, relacionaba estos datos con los datos en tiempo real de coronavirus en Chile, junto a la informaci√≥n sobre el estado de cuarentena de las comunas correspondientes.\nAplicaciones web desarrolladas con R y Shiny con gr√°ficos ggplot2\nRadar Legislativo Consultora Desplegar\nAn√°lisis de datos, desarrollo de √≠ndices e indicadores, automatizaci√≥n de web scraping, desarrollo de aplicaciones web de visualizaci√≥n de datos para la toma de decisiones empresariales. Estas aplicaciones web se alimentan por un conjunto de sistemas automatizados de obtenci√≥n y procesamiento de datos, que adem√°s de entregar datos en tiempo real, permite enriquecerlos por medio de aplicaciones de uso interno.\nAplicaci√≥n web desarrollada con R y Shiny, en base a web scraping en R usando rvest, procesamientos automatizados de datos, y algoritmos de predicci√≥n, y una API en plumber\nAplicaci√≥n web desarrollada con R y Shiny con gr√°ficos ggplot2\n√çndice de movilidad Transbank DataUC (Facultad de Matem√°ticas PUC), Pontificia Universidad Cat√≥lica de Chile\nAplicaciones web desarrolladas con R y Shiny con gr√°ficos ggplot2\nPlataforma de visualizaci√≥n de datos que produc√≠a un √≠ndice de movilidad a partir del procesamiento algor√≠tmico de cientos de millones de observaciones correspondientes a las transacciones de tarjetas de d√©bito y cr√©dito Transbank. Los datos de transacciones eran preprocesados con algoritmos de anonimizaci√≥n de datos.\nGraficador Centro de Estudios P√∫blicos (CEP) Centro de Estudios P√∫blicos\nDesarrollo de un sistema de procesamiento de encuestas con muestreo complejo en R, adem√°s de una plataforma de visualizaci√≥n interactiva de datos hist√≥ricos de las encuestas del Centro de Estudios P√∫blicos (Graficador CEP), utilizando R para el procesamiento de datos, y R+Shiny para la aplicaci√≥n web.\nAplicaci√≥n web desarrollada con R y Shiny con gr√°ficos ggplot2, alimentada por datos de encuestas procesados en R usando tidyverse y el paquete survey\nTarapac√° intelligence DataUC (Facultad de Matem√°ticas PUC), Pontificia Universidad Cat√≥lica de Chile Recopilaci√≥n, limpieza y an√°lisis de datos estad√≠sticos de relevancia social.\nVisualizaciones de datos en R usando ggplot2, a partir de datos sociales procesados con R\n√çndice de Perfilamiento Social Consultora Desplegar\nAplicaci√≥n web desarrollada con R y Shiny a partir del c√°lculo de un √≠ndice estad√≠stico a nivel comunal\nVisualizador Covid 19 Chile DataUC (Facultad de Matem√°ticas PUC), Pontificia Universidad Cat√≥lica de Chile\nAn√°lisis y visualizaci√≥n de datos utilizando el lenguaje de programaci√≥n estad√≠stica R. Obtenci√≥n automatizada de datos web (web scraping). Desarrollo de plataformas web interactivas de visualizaci√≥n de datos con R Shiny.\nAplicaci√≥n web desarrollada con R y Shiny con gr√°ficos ggplot2, adem√°s de una API en plumber\nDataEmprende DataUC (Facultad de Matem√°ticas PUC), Pontificia Universidad Cat√≥lica de Chile\nAplicaci√≥n web desarrollada con R y Shiny con gr√°ficos ggplot2\n","date":"2024-11-26T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/portafolio_trabajos_r/","tags":"aplicaciones ; gr√°ficos ; shiny ; tablas ; mapas ; quarto","title":"Portafolio de trabajos previos en R"},{"content":" √çndice Mapa de Chile por comunas Mapa regional de Chile Visualizar datos en el mapa Datos comunales Obtener datos por web scraping Agregar datos a los mapas Visualizar datos comunales Mapa de una sola regi√≥n, por comunas Datos regionales Obtener datos por web scraping Crear columna de c√≥digos regionales Unir datos con mapa Visualizar datos regionales Visualizar datos geogr√°ficamente es una herramienta de comunicaci√≥n y an√°lisis de datos muy potente. En este tutorial te explico c√≥mo obtener mapas comunales y regionales de Chile en R, y c√≥mo crear un gr√°ficos que visualizan variables num√©ricas en las comunas y regiones del pa√≠s. En pocos pasos puedes transformar tus datos territoriales en visualizaciones mucho m√°s densas e informativas.\nPara crear mapas sencillos, donde una variable num√©rica se visualice en cada unidad territorial por medio de una escala de colores, solamente se necesitan dos cosas: la informaci√≥n geogr√°fica que te permite visualizar el mapa en s√≠ mismo, y los datos que podamos corresponder con las unidades territoriales del mapa.\nEn este breve tutorial veremos c√≥mo obtener los mapas, como unir los datos al mapa, y c√≥mo generar visualizaciones de estos mapas en R.\nlibrary(chilemapas) # mapas de chile library(dplyr) # manipulaci√≥n de datos library(ggplot2) # visualizaci√≥n de datos library(scales) # utilidad para visualizaci√≥n de datos library(sf) # manipulaci√≥n de datos geogr√°ficos Mapa de Chile por comunas El paquete {chilemapas}, desarrollado por Mauricio Vargas, ofrece una colecci√≥n de mapas terrestres de Chile con topolog√≠a simplificada. Simplemente llamando el objeto mapa_comunas obtenemos un dataframe con la informaci√≥n geogr√°fica de cada comuna del pa√≠s.\nmapa_comunas \u0026lt;- chilemapas::mapa_comunas mapa_comunas # A tibble: 345 √ó 4 codigo_comuna codigo_provincia codigo_region geometry \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; 1 01401 014 01 (((-68.86081 -21.28512, -68.921‚Ä¶ 2 01403 014 01 (((-68.65113 -19.77188, -68.811‚Ä¶ 3 01405 014 01 (((-68.65113 -19.77188, -68.635‚Ä¶ 4 01402 014 01 (((-69.31789 -19.13651, -69.271‚Ä¶ 5 01404 014 01 (((-69.39615 -19.06125, -69.400‚Ä¶ 6 01107 011 01 (((-70.1095 -20.35131, -70.1243‚Ä¶ 7 01101 011 01 (((-70.09894 -20.08504, -70.102‚Ä¶ 8 02104 021 02 (((-68.98863 -25.38016, -68.987‚Ä¶ 9 02101 021 02 (((-70.60654 -23.43054, -70.601‚Ä¶ 10 02201 022 02 (((-67.94302 -22.38175, -67.955‚Ä¶ # ‚Ñπ 335 more rows En este dataframe, la columna geometry representa los pol√≠gonos de cada comuna. Esta informaci√≥n ya es suficiente para visualizar el mapa con R usando {ggplot2} y {sf}, un paquete para trabajar con datos espaciales.\nPara visualizar el mapa, primero usamos sf::st_set_geometry() para asignar la geometr√≠a al dataframe. De este modo, le indicamos a R que estos datos deben graficarse en un mapa con determinadas coordenadas e informaci√≥n sobre proyecci√≥n.\ngrafico_comunas \u0026lt;- mapa_comunas |\u0026gt; st_set_geometry(mapa_comunas$geometry) |\u0026gt; # asignar geometr√≠a ggplot() + # gr√°fico geom_sf() # capa geom√©trica grafico_comunas + theme_classic() Dado que Chile tiene islas muy alejadas del territorio continental, como Rapa Nui o Juan Fern√°ndez, el mapa queda con mucho espacio en blanco. Podemos recortar las coordenadas de la longitud del mapa (el eje x del gr√°fico) para que el mapa solamente abarque Chile continental:\ngrafico_comunas + coord_sf(xlim = c(-77, -65)) + theme_classic() Mapa regional de Chile Para generar un mapa de regiones, debemos crear las regiones. Esto no es complicado si pensamos que, en el fondo, las regiones son simplemente la uni√≥n de las comunas que las componen. El paquete {sf} simplifica much√≠simo el trabajo con datos geogr√°ficos, en este caso la uni√≥n de distintos pol√≠gonos en uno solo.\nAgrupamos las filas del dataframe por la variable codigo_region, para que todas las comunas que pertenecen a la misma regi√≥n est√©n agrupadas, y usamos summarize() junto a la funci√≥n sf::st_union() para que los pol√≠gonos de las comunas dentro de cada regi√≥n se combinen, obteniendo pol√≠gonos regionales:\nmapa_regiones \u0026lt;- mapa_comunas |\u0026gt; group_by(codigo_region) |\u0026gt; summarize(geometry = st_union(geometry)) # resumir los datos agrupados uni√©ndolos mapa_regiones # A tibble: 16 √ó 2 codigo_region geometry \u0026lt;chr\u0026gt; \u0026lt;GEOMETRY [¬∞]\u0026gt; 1 01 POLYGON ((-69.93023 -21.4246, -69.92376 -21.42622, -69.91932 -‚Ä¶ 2 02 MULTIPOLYGON (((-68.0676 -24.32856, -67.91698 -24.26902, -67.8‚Ä¶ 3 03 MULTIPOLYGON (((-71.58497 -29.02456, -71.58844 -29.02838, -71.‚Ä¶ 4 04 MULTIPOLYGON (((-70.54551 -31.30742, -70.53877 -31.30074, -70.‚Ä¶ 5 05 MULTIPOLYGON (((-71.33832 -33.45237, -71.33763 -33.44836, -71.‚Ä¶ 6 06 POLYGON ((-71.5477 -34.87458, -71.54211 -34.87581, -71.53566 -‚Ä¶ 7 07 POLYGON ((-70.41724 -35.63022, -70.41108 -35.6302, -70.40146 -‚Ä¶ 8 08 MULTIPOLYGON (((-73.53466 -36.97378, -73.53245 -36.97829, -73.‚Ä¶ 9 09 MULTIPOLYGON (((-73.35306 -38.73343, -73.35396 -38.72799, -73.‚Ä¶ 10 10 MULTIPOLYGON (((-73.1691 -41.87755, -73.16135 -41.87781, -73.1‚Ä¶ 11 11 MULTIPOLYGON (((-75.41754 -48.73857, -75.43249 -48.74372, -75.‚Ä¶ 12 12 MULTIPOLYGON (((-70.35563 -52.94478, -70.34688 -52.93971, -70.‚Ä¶ 13 13 POLYGON ((-70.47405 -33.8624, -70.47327 -33.86269, -70.46068 -‚Ä¶ 14 14 MULTIPOLYGON (((-73.39503 -39.88698, -73.39672 -39.89339, -73.‚Ä¶ 15 15 POLYGON ((-69.07223 -19.02723, -69.06394 -19.02607, -69.04748 ‚Ä¶ 16 16 POLYGON ((-72.38553 -36.91169, -72.37685 -36.91617, -72.37034 ‚Ä¶ Obtenemos un dataframe con una fila por regi√≥n, dado que las comunas fueron unidas en pol√≠gonos regionales. La columna geometry ahora contiene la uni√≥n de las comunas que hicimos con la funci√≥n st_union(). Podemos visualizar este nuevo dataframe regional usando {ggplot2} y {sf}, igual que en el paso anterior:\ngrafico_regiones \u0026lt;- mapa_regiones |\u0026gt; st_set_geometry(mapa_regiones$geometry) |\u0026gt; # especificar la geometr√≠a del mapa ggplot() + # graficar geom_sf() + # capa geogr√°fica coord_sf(xlim = c(-77, -65)) # recortar coordenadas grafico_regiones + theme_classic() Ahora que tenemos nuestros mapas por comunas y por regiones, la idea es poder utilizarlos para visualizar datos en ellos.\nVisualizar datos en el mapa Para visualizar los datos en un mapa, aplicaremos colores a los distintos pol√≠gonos de nuestro mapa, ya sean comunas o regiones. La intensidad del color, o su posici√≥n dentro de la escala de color elegida, representar√° el valor de la variable num√©rica que queremos visualizar.\nLa idea de fondo para entender la visualizaci√≥n de datos geogr√°ficos por pol√≠gonos es entender que los mapas que obtuvimos contienen en cada fila un pol√≠gono (la informaci√≥n geogr√°fica para dibujar la comuna o regi√≥n), y adem√°s, en cada fila contienen informaci√≥n que identifica al pol√≠gono correspondiente. En nuestro caso, la informaci√≥n de los pol√≠gonos corresponde al c√≥digo √∫nico territorial de las comunas, y el c√≥digo de regiones en el caso de las regiones. √âstos son c√≥digos num√©ricos que identifican cada unidad territorial del pa√≠s.\nLa idea es poder agregarle datos a nuestro mapa, de manera que las filas que representan unidades territoriales tengan tambi√©n columnas con datos sobre dichas unidades territoriales.\nEntonces, deber√≠amos tener nuestro dataframe con el mapa, y otro dataframe donde tengamos los datos que queremos adjuntar al mapa. Si tenemos un mapa de comunas, tenemos que tener los datos por comuna que queremos agregarle al mapa.\nDatos comunales Obtener datos por web scraping Para visualizar un mapa de datos comunales, primero obtendremos datos comunales desde Wikipedia. Usamos el paquete para hacer un web scraping y obtener una tabla de datos de las comunas del pa√≠s.\nlibrary(rvest) # direcci√≥n de wikipedia con tabla de comunas de Chile url \u0026lt;- \u0026#34;https://es.wikipedia.org/wiki/Anexo:Comunas_de_Chile\u0026#34; # obtener tabla con datos de comunas con web scraping tabla \u0026lt;- session(url) |\u0026gt; read_html() |\u0026gt; html_table(convert = FALSE) tabla[[1]] # A tibble: 346 √ó 12 CUT (C√≥digo √önico Territori‚Ä¶¬π Nombre `` Provincia Regi√≥n `Superficie(km¬≤)` \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 15101 Arica \u0026quot;\u0026quot; Arica Arica‚Ä¶ 4.799,4 2 15102 Camar‚Ä¶ \u0026quot;\u0026quot; Arica Arica‚Ä¶ 3.927 3 15201 Putre \u0026quot;\u0026quot; Parinaco‚Ä¶ Arica‚Ä¶ 5.902,5 4 15202 Gener‚Ä¶ \u0026quot;\u0026quot; Parinaco‚Ä¶ Arica‚Ä¶ 2.244,4 5 01101 Iquiq‚Ä¶ \u0026quot;\u0026quot; Iquique Tarap‚Ä¶ 2.242,1 6 01107 Alto ‚Ä¶ \u0026quot;\u0026quot; Iquique Tarap‚Ä¶ 572.9 7 01401 Pozo ‚Ä¶ \u0026quot;\u0026quot; Tamarugal Tarap‚Ä¶ 13.765,8 8 01402 Cami√±a \u0026quot;\u0026quot; Tamarugal Tarap‚Ä¶ 2.200,2 9 01403 Colch‚Ä¶ \u0026quot;\u0026quot; Tamarugal Tarap‚Ä¶ 4.015,6 10 01404 Huara \u0026quot;\u0026quot; Tamarugal Tarap‚Ä¶ 10.474,6 # ‚Ñπ 336 more rows # ‚Ñπ abbreviated name: ¬π‚Äã`CUT (C√≥digo √önico Territorial)` # ‚Ñπ 6 more variables: Poblaci√≥n2020 \u0026lt;chr\u0026gt;, `Densidad(hab./km¬≤)` \u0026lt;chr\u0026gt;, # `IDH 2005` \u0026lt;chr\u0026gt;, `IDH 2005` \u0026lt;chr\u0026gt;, Latitud \u0026lt;chr\u0026gt;, Longitud \u0026lt;chr\u0026gt; Luego obtener los datos, realizamos una peque√±a limpieza. Limpiamos los nombres de las variables, seleccionamos las variables que nos interesan, y luego las convertimos apropiadamente a valores num√©ricos, donde tenemos que eliminar los separadores de miles, y transformar los separadores de decimales a puntos.\nlibrary(janitor) library(stringr) # limpiar datos datos_comunas \u0026lt;- tabla[[1]] |\u0026gt; clean_names() |\u0026gt; # seleccionar y renombrar columnas select(codigo_comuna = cut_codigo_unico_territorial, nombre, region, superficie_km2, poblacion = poblacion2020) |\u0026gt; # eliminar espacios de la columna de poblaci√≥n mutate(poblacion = str_remove_all(poblacion, \u0026#34; \u0026#34;), poblacion = as.numeric(poblacion)) |\u0026gt; # eliminar los separadores de miles mutate(superficie_km2 = str_remove_all(superficie_km2, \u0026#34;\\\\.\u0026#34;), # convertir comas a puntos superficie_km2 = str_replace(superficie_km2, \u0026#34;,\u0026#34;, \u0026#34;.\u0026#34;), superficie_km2 = as.numeric(superficie_km2)) datos_comunas # A tibble: 346 √ó 5 codigo_comuna nombre region superficie_km2 poblacion \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 15101 Arica Arica y Parinacota 4799. 247552 2 15102 Camarones Arica y Parinacota 3927 1233 3 15201 Putre Arica y Parinacota 5902. 2515 4 15202 General Lagos Arica y Parinacota 2244. 810 5 01101 Iquique Tarapac√° 2242. 223463 6 01107 Alto Hospicio Tarapac√° 5729 129999 7 01401 Pozo Almonte Tarapac√° 13766. 17395 8 01402 Cami√±a Tarapac√° 2200. 1375 9 01403 Colchane Tarapac√° 4016. 1583 10 01404 Huara Tarapac√° 10475. 3000 # ‚Ñπ 336 more rows Ahora que tenemos una tabla de datos que contiene la columna codigo_comuna con el c√≥digo √∫nico territorial de las comunas, podemos unirla al mapa de comunas.\nAgregar datos a los mapas Esta operaci√≥n de unir dos tablas de datos diferentes, pero que coinciden en una columna en com√∫n, se realiza con la funci√≥n left_join(). El principio de left_join() es que tenemos dos tablas de datos, y ambas tablas de datos tienen una misma columna, que poseen los mismos valores (en nuestro caso, una columna con las comunas o los c√≥digos √∫nicos territoriales de las comunas). Entonces, ambas tablas se van a unir seg√∫n la correspondencias de estas columnas en com√∫n.\nEjemplo:\ntabla_a \u0026lt;- tribble(~animal, ~favorito, \u0026#34;gato\u0026#34;, \u0026#34;pescado\u0026#34;, \u0026#34;mapache\u0026#34;, \u0026#34;basura\u0026#34;, \u0026#34;perro\u0026#34;, \u0026#34;carne\u0026#34;) tabla_b \u0026lt;- tribble(~animal, ~belleza, ~inteligencia, ~carisma, \u0026#34;gato\u0026#34;, 8, 6, 5, \u0026#34;perro\u0026#34;, 5, 2, 8, \u0026#34;mapache\u0026#34;, 10, 7, 2) left_join(tabla_a, tabla_b, by = \u0026#34;animal\u0026#34;) # A tibble: 3 √ó 5 animal favorito belleza inteligencia carisma \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 gato pescado 8 6 5 2 mapache basura 10 7 2 3 perro carne 5 2 8 En el ejemplo, tenemos dos tablas, donde las dos tienen una misma columna con los mismos datos, y otras columnas con datos distintos. Usando left_join() podemos unir ambas tablas de datos a partir de la columna que tienen en com√∫n. Como resultado obtenemos una nueva tabla que tiene todas las columnas.\nProcedemos a unir los datos con el mapa usando left_join(), especificando en el argumento by que la uni√≥n sea a partir de la columna codigo_comuna.\nmapa_comunas_2 \u0026lt;- mapa_comunas |\u0026gt; # adjuntar datos al mapa, coincidiendo por columna de c√≥digo de comunas left_join(datos_comunas, by = join_by(codigo_comuna)) |\u0026gt; relocate(geometry, .after = 0) # tirar geometr√≠a al final mapa_comunas_2 # A tibble: 345 √ó 8 codigo_comuna codigo_provincia codigo_region nombre region superficie_km2 \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 01401 014 01 Pozo Almo‚Ä¶ Tarap‚Ä¶ 13766. 2 01403 014 01 Colchane Tarap‚Ä¶ 4016. 3 01405 014 01 Pica Tarap‚Ä¶ 8934. 4 01402 014 01 Cami√±a Tarap‚Ä¶ 2200. 5 01404 014 01 Huara Tarap‚Ä¶ 10475. 6 01107 011 01 Alto Hosp‚Ä¶ Tarap‚Ä¶ 5729 7 01101 011 01 Iquique Tarap‚Ä¶ 2242. 8 02104 021 02 Taltal Antof‚Ä¶ 20405. 9 02101 021 02 Antofagas‚Ä¶ Antof‚Ä¶ 30718. 10 02201 022 02 Calama Antof‚Ä¶ 15597. # ‚Ñπ 335 more rows # ‚Ñπ 2 more variables: poblacion \u0026lt;dbl\u0026gt;, geometry \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; Como resultado, tenemos un nuevo dataframe que adem√°s de tener los datos geogr√°ficos de las comunas, tambi√©n tiene nuevas columnas con datos que podemos visualizar.\nVisualizar datos comunales Para visualizar datos comunales en un mapa, especificamos la columna de geometr√≠a que contiene la informaci√≥n geogr√°fica, y creamos un gr√°fico de {ggplot2}. En este gr√°fico, especificamos que el relleno de los pol√≠gonos (fill) se haga a partir de una de las variables num√©ricas.\nUsamos la funci√≥n geom_sf() para agregar una capa de geometr√≠a a nuestro gr√°fico que contenga los pol√≠gonos territoriales de las comunas. Luego, definimos un tema, una paleta de colores, y corregimos la escala del eje horizontal.\nmapa_comunas_2 |\u0026gt; st_set_geometry(mapa_comunas_2$geometry) |\u0026gt; # asignar geometr√≠a ggplot() + # gr√°fico aes(fill = poblacion) + geom_sf(linewidth = 0) + # capa geom√©trica theme_classic() + scale_fill_distiller(type = \u0026#34;seq\u0026#34;, palette = 12, labels = label_comma(big.mark = \u0026#34;.\u0026#34;)) + # colores scale_x_continuous(breaks = seq(-76, -65, length.out = 3) |\u0026gt; floor()) + # escala x coord_sf(xlim = c(-77, -65)) + # recortar coordenadas theme(legend.key.width = unit(3, \u0026#34;mm\u0026#34;)) Como resultado obtenemos un mapa coropl√©tico, o mapa de coropletas, que es un mapa donde cada regi√≥n o pol√≠gono est√° relleno de un color que representa un valor en una escala de una variable.\nAc√° hacemos otro mapa, usando el mismo c√≥digo y simplemente cambiando la variable de relleno de los pol√≠gonos territoriales:\nmapa_comunas_2 |\u0026gt; st_set_geometry(mapa_comunas_2$geometry) |\u0026gt; ggplot() + aes(fill = superficie_km2) + # variable de relleno geom_sf(linewidth = 0) + theme_classic() + scale_fill_distiller(type = \u0026#34;seq\u0026#34;, palette = 11, labels = label_comma(big.mark = \u0026#34;.\u0026#34;)) + scale_x_continuous(breaks = seq(-76, -65, length.out = 3) |\u0026gt; floor()) + coord_sf(xlim = c(-77, -65)) + theme(legend.key.width = unit(3, \u0026#34;mm\u0026#34;)) Mapa de una sola regi√≥n, por comunas Si queremos visualizar una sola regi√≥n del pa√≠s, subdividida por comunas, tan sencillo como agregar un filtro a los datos que filtre las filas que pertenecen a la regi√≥n que nos interesa. En este caso, vamos a visualizar la poblaci√≥n por comunas de la regi√≥n del Libertador General Bernardo O\u0026rsquo;Higgins:\n# filtrar datos mapa_comunas_filtro \u0026lt;- mapa_comunas_2 |\u0026gt; filter(codigo_region == \u0026#34;06\u0026#34;) # mapa mapa_comunas_filtro |\u0026gt; st_set_geometry(mapa_comunas_filtro$geometry) |\u0026gt; ggplot() + aes(fill = poblacion) + geom_sf(linewidth = 0.12, color = \u0026#34;white\u0026#34;) + geom_sf_text(aes(label = comma(poblacion, big.mark = \u0026#34;.\u0026#34;)), size = 2, color = \u0026#34;white\u0026#34;, check_overlap = T) + theme_classic() + scale_fill_distiller(type = \u0026#34;seq\u0026#34;, palette = 12, labels = label_comma(big.mark = \u0026#34;.\u0026#34;)) + theme(legend.key.width = unit(3, \u0026#34;mm\u0026#34;)) + theme(axis.title = element_blank()) En este caso, agregamos tambi√©n la funci√≥n geom_sf_text() para agregar una capa nuestro gr√°fico que contiene las cifras para cada comuna. Hay que tener en consideraci√≥n que poner n√∫meros o textos sobre mapas suele ser complejo, porque el mapa ya es denso visualmente, y agregarle texto puede hacer que se vuelva ilegible. Hay que tener especial cuidado en resolver situaciones como textos que pasan por encima de bordes en el mapa, que se ubican incorrectamente dentro de los pol√≠gonos, o que se sobreponen uno sobre otros debido a que los pol√≠gonos se ven muy peque√±os dentro del mapa.\nDatos regionales Obtener datos por web scraping Para hacer el ejemplo de visualizar datos a nivel regional, nuevamente obtendremos datos a esta escala usando web scraping. Obtendremos una tabla del Producto Interno Bruto regional desde el sitio web de el Banco Central de Chile.\nlibrary(rvest) # direcci√≥n del sitio del banco central url \u0026lt;- \u0026#34;https://si3.bcentral.cl/Siete/ES/Siete/Cuadro/CAP_CCNN/MN_CCNN76/CCNN2018_PIB_REGIONAL_N/637899740344107786\u0026#34; # obtener tabla con datos de comunas con web scraping tabla_pib \u0026lt;- session(url) |\u0026gt; read_html() |\u0026gt; html_table(convert = FALSE) Limpiamos los datos seleccionando las columnas que necesitamos, transformando la columna a tipo num√©rico, y filtrando las filas para quedar solamente con las que corresponden a las regiones de Chile:\ndatos_regiones \u0026lt;- tabla_pib [[1]] |\u0026gt; janitor::clean_names() |\u0026gt; select(region = serie, pib = x2023) |\u0026gt; mutate(pib = str_remove_all(pib, \u0026#34;\\\\.\u0026#34;), pib = as.numeric(pib)) |\u0026gt; filter(str_detect(region, \u0026#34;Regi√≥n\u0026#34;)) datos_regiones # A tibble: 16 √ó 2 region pib \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 Regi√≥n de Arica y Parinacota 2169 2 Regi√≥n de Tarapac√° 7892 3 Regi√≥n de Antofagasta 31290 4 Regi√≥n de Atacama 6004 5 Regi√≥n de Coquimbo 9174 6 Regi√≥n de Valpara√≠so 20275 7 Regi√≥n Metropolitana de Santiago 109143 8 Regi√≥n del Libertador General Bernardo OHiggins 11910 9 Regi√≥n del Maule 10348 10 Regi√≥n de √ëuble 4106 11 Regi√≥n del Biob√≠o 16731 12 Regi√≥n de La Araucan√≠a 7743 13 Regi√≥n de Los R√≠os 3561 14 Regi√≥n de Los Lagos 9432 15 Regi√≥n de Ays√©n del General Carlos Ib√°√±ez del Campo 1573 16 Regi√≥n de Magallanes y de la Ant√°rtica Chilena 2490 Crear columna de c√≥digos regionales Los datos que obtuvimos no contienen una variable con el c√≥digo √∫nico territorial de las regiones, dado que es un dato que est√° en desuso desde la promulgaci√≥n de una ley en 2018 que proh√≠be el uso de los n√∫meros en comunicaciones p√∫blicas. Sin embargo, en muchas base de datos oficiales se sigue usando la numeraci√≥n de las regiones, principalmente para evitar problemas de diferencias en los nombres de las regiones, por ejemplo, si contienen o no las palabras Regi√≥n de o Regi√≥n del para cada regi√≥n, si contienen tildes o no, si contienen abreviaciones o no, si contienen s√≠mbolos como e√±es o ap√≥strofes, etc. Todos estos problemas son resueltos por el uso de identificador num√©rico de las regiones.\nComo el mapa que obtuvimos con el paquete {chilemapas} utiliza el c√≥digo regional, en el dato frente de nuestros datos crearemos una columna con los mismos c√≥digos regionales, asignados a cada regi√≥n a partir de la coincidencia con los textos. Por ejemplo, si el texto del nombre de la regi√≥n contiene la palabra Arica, se le asigna el c√≥digo 15. Esta forma de asignar los c√≥digos regionales puede ser inexacta, pero es muy sencillo confirmar si es que la asignaci√≥n de c√≥digos funciona correctamente, y tambi√©n siempre es posible utilizar expresiones regulares en {stringr} para hacer coincidencias m√°s flexibles, como por ejemplo, coincidir una palabra con un c√≥digo sin importar si la palabra tiene o no tilde, o est√° mal escrita.\ndatos_regiones_2 \u0026lt;- datos_regiones |\u0026gt; mutate(codigo_region = case_when( str_detect(region, \u0026#34;Arica\u0026#34;) ~ 15, str_detect(region, \u0026#34;Tarapac√°\u0026#34;) ~ 1, str_detect(region, \u0026#34;Antofagasta\u0026#34;) ~ 2, str_detect(region, \u0026#34;Atacama\u0026#34;) ~ 3, str_detect(region, \u0026#34;Coquimbo\u0026#34;) ~ 4, str_detect(region, \u0026#34;Valpara√≠so\u0026#34;) ~ 5, str_detect(region, \u0026#34;Metropolitana\u0026#34;) ~ 13, str_detect(region, \u0026#34;Libertador General\u0026#34;) ~ 6, str_detect(region, \u0026#34;Maule\u0026#34;) ~ 7, str_detect(region, \u0026#34;√ëuble\u0026#34;) ~ 16, str_detect(region, \u0026#34;Biob√≠o\u0026#34;) ~ 8, str_detect(region, \u0026#34;Araucan√≠a\u0026#34;) ~ 9, str_detect(region, \u0026#34;Los R√≠os\u0026#34;) ~ 14, str_detect(region, \u0026#34;Los Lagos\u0026#34;) ~ 10, str_detect(region, \u0026#34;Ays√©n\u0026#34;) ~ 11, str_detect(region, \u0026#34;Magallanes\u0026#34;) ~ 12 )) |\u0026gt; rename(nombre_region = region) Unir datos con mapa Luego de crear la variable de c√≥digos regionales, podemos hacer la uni√≥n entre ambas tablas de datos, mapas y datos regionales, usando left_join():\nmapa_regiones_2 \u0026lt;- mapa_regiones |\u0026gt; mutate(codigo_region = as.numeric(codigo_region)) |\u0026gt; left_join(datos_regiones_2, by = join_by(codigo_region)) |\u0026gt; relocate(geometry, .after = 0) # tirar columna al final mapa_regiones_2 # A tibble: 16 √ó 4 codigo_region nombre_region pib geometry \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;GEOMETRY [¬∞]\u0026gt; 1 1 Regi√≥n de Tarapac√° 7892 POLYGON ((-69.93023 -21.‚Ä¶ 2 2 Regi√≥n de Antofagasta 31290 MULTIPOLYGON (((-68.0676‚Ä¶ 3 3 Regi√≥n de Atacama 6004 MULTIPOLYGON (((-71.5849‚Ä¶ 4 4 Regi√≥n de Coquimbo 9174 MULTIPOLYGON (((-70.5455‚Ä¶ 5 5 Regi√≥n de Valpara√≠so 20275 MULTIPOLYGON (((-71.3383‚Ä¶ 6 6 Regi√≥n del Libertador General‚Ä¶ 11910 POLYGON ((-71.5477 -34.8‚Ä¶ 7 7 Regi√≥n del Maule 10348 POLYGON ((-70.41724 -35.‚Ä¶ 8 8 Regi√≥n del Biob√≠o 16731 MULTIPOLYGON (((-73.5346‚Ä¶ 9 9 Regi√≥n de La Araucan√≠a 7743 MULTIPOLYGON (((-73.3530‚Ä¶ 10 10 Regi√≥n de Los Lagos 9432 MULTIPOLYGON (((-73.1691‚Ä¶ 11 11 Regi√≥n de Ays√©n del General C‚Ä¶ 1573 MULTIPOLYGON (((-75.4175‚Ä¶ 12 12 Regi√≥n de Magallanes y de la ‚Ä¶ 2490 MULTIPOLYGON (((-70.3556‚Ä¶ 13 13 Regi√≥n Metropolitana de Santi‚Ä¶ 109143 POLYGON ((-70.47405 -33.‚Ä¶ 14 14 Regi√≥n de Los R√≠os 3561 MULTIPOLYGON (((-73.3950‚Ä¶ 15 15 Regi√≥n de Arica y Parinacota 2169 POLYGON ((-69.07223 -19.‚Ä¶ 16 16 Regi√≥n de √ëuble 4106 POLYGON ((-72.38553 -36.‚Ä¶ Visualizar datos regionales Finalmente, visualizamos los datos en un mapa regional de la misma forma que lo hicimos con los mapas comunales. Esta vez, el mapa y los datos vienen en una fila por regi√≥n, con la variable geometry que conteniendo la geometr√≠a del pol√≠gono regional. Por tanto, el c√≥digo es exactamente el mismo, y solamente cambia el dataframe que usamos para generar el gr√°fico:\nmapa_regiones_2 |\u0026gt; st_set_geometry(mapa_regiones_2$geometry) |\u0026gt; # asignar geometr√≠a ggplot() + # gr√°fico aes(fill = pib) + geom_sf(linewidth = 0.12, color = \u0026#34;white\u0026#34;) + # capa geom√©trica theme_classic() + scale_fill_distiller(type = \u0026#34;seq\u0026#34;, palette = 18, labels = label_comma(big.mark = \u0026#34;.\u0026#34;)) + scale_x_continuous(breaks = seq(-76, -65, length.out = 3) |\u0026gt; floor()) + coord_sf(expand = F, xlim = c(-77, -65)) + # recortar coordenadas theme(legend.key.width = unit(3, \u0026#34;mm\u0026#34;)) Visualizar datos geogr√°ficamente es una herramienta de comunicaci√≥n y an√°lisis de datos muy potente. Personalmente, encuentro que el potencial de la visualizaci√≥n de datos en mapas radica mucho m√°s all√° de simplemente mapear una variable a un territorio, sino a incentivar que el p√∫blico analice el mapa en relaci√≥n a todo el conjunto de conocimientos que tenemos sobre del espacio que habitamos, sus caracter√≠sticas sociales, y las desigualdades distribuidas en el territorio.\nSi este tutorial te sirvi√≥, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\n","date":"2024-11-25T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_mapa_chile/","tags":"mapas ; gr√°ficos ; ciencias sociales ; Chile","title":"Crea un mapa de Chile y visualiza datos comunales y regionales con mapas en R"},{"content":" ‚ö†Ô∏è Este tutorial est√° desactualizado! {surveydown} cambi√≥ y ahora funciona distinto. Todav√≠a no he tenido tiempo de actualizarlo para ajustaste al nuevo funcionamiento. Perd√≥n üòî Con el paquete {surveydown} es muy f√°cil crear una encuesta con R, creando tus propias preguntas personalizadas, y almacenando todas las respuestas de tus encuestados/as en una base de datos.\nLa gracia de crear tu propia encuesta es que puedes personalizarla seg√∫n tus necesidades, pero tambi√©n es que no necesitas depender de un servicio para generar la encuesta, ni tampoco tener que pagar para poder crearla o publicarla. Por el contrario, podemos utilizar tecnolog√≠as gratuitas y de c√≥digo abierto para crear nuestras encuestas, almacenar sus resultados y analizarlos.\nEl paquete {surveydown} combina el uso de Quarto y Shiny para crear encuestas f√°ciles de dise√±ar, y con altas capacidades de personalizaci√≥n. Aqu√≠ te dejo una encuesta de prueba para que veas c√≥mo son!\nEl dise√±o de la encuesta, con todas sus preguntas, t√≠tulos, textos, p√°ginas y botones, se hace por medio de un documento Quarto, donde literalmente vas poniendo todo el contenido que quieres que tenga tu encuesta, especificando los saltos de p√°gina de la encuesta, y listo.\nEl funcionamiento interno de la encuesta es resuelto por {surveydown}, y no tenemos que realizar nada de configuraci√≥n ni programaci√≥n por nuestro lado. Todo funciona de forma inmediata (la encuesta, la interacci√≥n del usuario y la base de datos) por medio de una aplicaci√≥n Shiny. Lo √∫nico que tenemos que proveer es la conexi√≥n a la base de datos donde se van a ir guardando las respuestas, y de la cual tambi√©n vamos a poder obtener los resultados cuando queramos.\nAqu√≠ les dejo una encuesta de prueba, hecha siguiendo este tutorial, para ver qui√©n gana: ¬øgatos üêà o perros üêï? Responde aqu√≠\nCrear una encuesta Para crear nuestra encuesta, podemos usar la funci√≥n surveydown::sd_create_survey(\u0026quot;ruta/de/la/encuesta/\u0026quot;) para que el paquete {surveydown} cree un nuevo proyecto de R con una plantilla de encuesta lista para editar.\nOtra alternativa es clonar1 una encuesta de demostraci√≥n disponible la p√°gina de {surveydown}. El beneficio de esta alternativa es que puedes probar la encuesta antes, para ver c√≥mo quedar√≠a, y si te sirve, la clonas en tu equipo para poder editarla.\nCuando creamos nuestra primera encuesta, obtenemos un proyecto de R con dos archivos principales:\nsurvey.qmd: la encuesta, en un documento Quarto, donde dise√±as todo el contenido de la encuesta, desde subt√≠tulos, textos de introducci√≥n, t√≠tulos para las preguntas, las preguntas en s√≠ misma, y otros textos que quieras agregar entremedio de la encuesta. app.R: la aplicaci√≥n Shiny donde va a aparecer tu encuesta, y que posibilita que las respuestas vayan guard√°ndose en una base de datos. En esta aplicaci√≥n de Shiny no hay mucho que hacer, porque todo el contenido visible y usable de la encuesta est√° en el documento Quarto survey.qmd. El rol de la aplicaci√≥n Shiny es hacer la gesti√≥n de que la encuesta funcione y sea interactiva, y que las respuestas que ingresamos quedan registradas en la base de datos. Pero tambi√©n, al ser una aplicaci√≥n Shiny, podemos hacer cosas avanzadas con nuestra encuesta, como por ejemplo ir mostrando resultados en tiempo real, visualizaciones de nuestros resultados que se actualizan autom√°ticamente, y m√°s. Dise√±ar la encuesta Estando en el proyecto de R de nuestra nueva encuesta, abrimos el documento Quarto survey.qmd, y en √©l encontraremos una encuesta que viene por defecto.\nMirando este documento vemos que las p√°ginas de la encuesta van delimitadas por cercos :::, y que dentro de estos cercos va todo el contenido que queramos poner en cada p√°gina, como t√≠tulos, textos y preguntas.\n::: {#bienvenida .sd-page} # Encuesta Texto de _introducci√≥n_ ::: Crear preguntas Dentro de los cercos que delimitan cada p√°gina, cada pregunta dela encuesta va en el documento como un bloque de c√≥digo R, que en su interior contiene la funci√≥n sd_question(). Con esta funci√≥n se crean las preguntas de nuestra encuesta, y en sus argumentos tenemos todas las opciones para personalizarlas.\nEn el sitio de {surveydown} existe una documentaci√≥n con todos los tipos de preguntas, para que veas c√≥mo se ven y c√≥mo se crean. Tambi√©n existe una aplicaci√≥n de prueba que te muestra todos los tipos de preguntas en una encuesta real.\nAqu√≠ te dejo algunos ejemplos de preguntas b√°sicas que puedes incluir en tu encuesta:\nPreguntas de selecci√≥n m√∫ltiple sd_question( type = \u0026#39;mc_buttons\u0026#39;, id = \u0026#39;animal\u0026#39;, label = \u0026#34;¬øCu√°l es tu animal favorito?\u0026#34;, option = c( \u0026#34;Perro\u0026#34;, \u0026#34;Gato\u0026#34;, \u0026#34;Mapache\u0026#34; ) ) Pregunta de ingreso de n√∫meros sd_question( type = \u0026#39;numeric\u0026#39;, id = \u0026#39;edad\u0026#39;, label = \u0026#34;¬øCu√°l es tu edad?\u0026#34; ) Pregunta de ingreso de texto sd_question( type = \u0026#34;text\u0026#34;, id = \u0026#34;temas\u0026#34;, label = \u0026#34;Escribe tus comentarios aqu√≠\u0026#34;, placeholder = \u0026#34;(opcional)\u0026#34; ) Pregunta de selecci√≥n m√∫ltiple con selecci√≥n de m√°s de una respuesta sd_question( type = \u0026#39;mc_multiple_buttons\u0026#39;, id = \u0026#39;genero\u0026#39;, label = \u0026#34;¬øCon qu√© g√©nero te identificas?\u0026#34;, option = c( \u0026#34;Femenino\u0026#34;, \u0026#34;No binario/Otros\u0026#34;, \u0026#34;Masculino\u0026#34;, \u0026#34;Prefiero no responder\u0026#34; ) ) Al finalizar cada p√°gina de tu encuesta, tienes que agregar el bot√≥n de siguiente, para que los usuarios/as puedan avanzar a la siguiente p√°gina:\nsd_next(label = \u0026#34;Siguiente\u0026#34;) En la p√°gina final de tu encuesta puedes poner un texto de agradecimiento y m√°s informaci√≥n, y especificar el bot√≥n para terminar la encuesta:\nsd_close(label = \u0026#34;Terminar\u0026#34;) Si quieres probar c√≥mo va quedando tu encuesta, puedes ejecutar la aplicaci√≥n Shiny desde el archivo app.R, presionando el bot√≥n Run.\nEn este repositorio te dejo el c√≥digo de una encuesta b√°sica, de tres preguntas, con gr√°ficos que visualizan las respuestas de la encuesta al terminar de responderla. Puedes usarla como gu√≠a al momento de dise√±ar tu propia encuesta.\nSin embargo, para que tu encuesta funcione, tienes que configurar la base de datos primero. Veremos eso a continuaci√≥n, pero si de todas maneras quieres probar tu encuesta antes de configurar la base de datos, en la aplicaci√≥n Shiny debes configurar la conexi√≥n a la base de datos del siguiente modo:\ndb \u0026lt;- sd_database( ignore = TRUE ) De esta forma, la aplicaci√≥n funcionar√° sin una base de datos, almacenando los datos localmente en tu proyecto (en un archivo .csv) para que puedas probarla.\nConfigurar la base de datos Para que las preguntas que respondan tus usuarios/as queden registradas, es necesario especificar un m√©todo de recolecci√≥n de los datos que guarde las respuestas en una base de datos centralizada. Pero una de las limitaciones de las aplicaciones Shiny, particularmente las publicadas en shinyapps.io, es que no pueden almacenar datos persistentes, sino que los datos creados durante el uso de las apps son eliminados al terminar la sesi√≥n. Por lo tanto, hay que crear una base de datos remota donde las respuestas de cada persona sean registradas en cada interacci√≥n con la encuesta, y que luego podamos consultar para obtener los resultados.\nEsto no es tan dif√≠cil de hacer como suena. En la documentaci√≥n de {surveydown} hay instrucciones detalladas para crear una base de datos para tu encuesta, pero ac√° de te dejo un resumen:\nPaso 1: crea una cuenta en Supabase Lo primero es averiguar d√≥nde podemos crear una base de datos remota y gratuita. En la documentaci√≥n de {surveydown} recomiendan usar Supabase. Supabase es un proveedor abierto y gratuito de bases de datos Postgres. Crea una cuenta ah√≠, y sigue las instrucciones para tener tu primer proyecto, el cual cuenta con una base de datos. En tu base de datos podr√°s tener tablas donde se almacenar√°n las respuestas de tu encuesta. En una misma base de datos pueden haber m√∫ltiples tablas, una tabla para cada encuesta distinta que crees.\nPaso dos: crear la base de datos Al crear tu cuenta, se te pedir√° crear un proyecto. En este proyecto habr√° una base de datos donde se almacenar√°n los datos de respuesta de tu encuesta, en una tabla espec√≠fica. Aqu√≠ lo importante es que tienes que definir una contrase√±a segura, que ser√° la contrase√±a que uses para que tu encuesta pueda escribir sus resultados en la base, y tambi√©n para que t√∫ puedas obtener los resultados desde la base.\nPaso tres: obtener par√°metros de la base de datos Luego de crear la base, necesitas obtener ciertos datos de tu base para poder hacer la conexi√≥n entre tu encuesta y la base. En Supabase, ve a Project Settings (abajo a la izquierda), luego en el men√∫ Configuration elige Database. En esta secci√≥n aparecer√°n los par√°metros de conexi√≥n en Connection parameters.\nPaso cuatro: configurar la base de datos en tu proyecto de R Para que tu encuesta se conecte a la base de datos, debes proveer a tu encuesta con los par√°metros de conexi√≥n. Los par√°metros de configuraci√≥n de tu base de datos se ingresan en el archivo de tu aplicaci√≥n Shiny de la encuesta. Abre app.R, y en la funci√≥n sd_database() que est√° al principio del script, pega la informaci√≥n que tienes en Supabase:\ndb \u0026lt;- sd_database( host = \u0026#34;\u0026#34;, dbname = \u0026#34;\u0026#34;, port = \u0026#34;\u0026#34;, user = \u0026#34;\u0026#34;, table = \u0026#34;nombre_de_tu_tabla\u0026#34; ) El nombre de la tabla puede ser cualquiera, y dependiendo del nombre que pongas es la tabla donde sea almacenar la respuesta. Si luego creas una nueva encuesta, y pones un nombre de tabla distinto, las respuestas de esta nueva encuesta aparecer√° en una tabla separada. Basta con especificar el nombre de una tabla nueva para que la tabla nueva se cree, no es necesario crearla antes en otro lugar.\nPaso cinco: autenticar la base de datos en tu proyecto de R El paso final es darle el permiso a tu proyecto de R para poder leer y escribir la base de datos. Esto se hace autenticando la contrase√±a de tu base de datos en tu proyecto de R.\nSi bien en el paso anterior entregamos los dem√°s par√°metros de configuraci√≥n de tu base de datos, la contrase√±a no se puede escribir en el script, porque eso har√≠a que la contrase√±a sea visible para cualquier persona que pueda ver el c√≥digo de tu encuesta (por ejemplo, si alguien usa tu computador, si subes tu encuesta a GitHub, o si compartes el c√≥digo con alguien).\nPara garantizar la seguridad de tu base de datos, la contrase√±a se entrega por medio de la consola de R, y queda registrada en un archivo invisible dentro de tu proyecto (.Renviron), que no se subir√° a GitHub (si es que decides subir tu encuesta a GitHub).\nEn la consola de tu sesi√≥n de R, ejecuta la siguiente funci√≥n con tu contrase√±a adentro para autenticar tu encuesta con la base de datos:\nsd_set_password(\u0026#34;contrase√±a\u0026#34;) ¬°Y listo! Ahora cada respuesta que se marque en tu encuesta quedar√° registrada autom√°ticamente en la base de datos.\nProbar la encuesta Para ejecutar tu encuesta, tienes que abrir el script de la aplicaci√≥n Shiny, app.R, y ejecutar la app con el bot√≥n Run. Tu encuesta se abrir√° una nueva ventana y podr√°s ponerla a prueba, o responderla.\nTodas las respuestas que ingreses quedar√°n registradas en la base de datos de Supabase, incluso cuando la ejecutes localmenet. En el sitio web de Supabase, dentro de tu proyecto de la encuesta, puedes acceder a Table editor para revisar la tabla que contiene las respuestas, y revisar las respuestas en una planilla interactiva.\nSubir tu encuesta y compartirla El √∫ltimo paso es publicar tu encuesta y compartirla con otras personas para que la respondan. La forma m√°s sencilla de hacer esto es publicar la aplicaci√≥n en shinyapps.io. En este post te doy todas las instrucciones para que puedas publicar tu aplicaci√≥n gratuitamente a shinyapps.io. Para publicar la encuesta como una aplicaci√≥n en shinyapps.io, abre el script app.R y presiona el bot√≥n azul de Publicar (en la esquina superior derecha del panel de script), y publ√≠cala a como si de cualquier otra aplicaci√≥n se tratase. Una vez publicada, tendr√°s un enlace que puedes compartir con otras personas.\nTodas las respuestas quedar√°n registradas en tu base de datos, incluso desde la aplicaci√≥n publicada, porque la app contiene la autenticaci√≥n que hiciste a la base de datos, as√≠ que tiene permiso para escribir en la tabla remota.\nObtener resultados de la encuesta Para obtener los resultados de tu encuesta, simplemente en un nuevo script ingresas la configuraci√≥n de tu base de datos para conectarte a ella, igual como lo hiciste antes en la encuesta misma, y luego usa la funci√≥n sd_get_data() para obtener los datos.\ndb \u0026lt;- sd_database( host = \u0026#34;my_host\u0026#34;, dbname = \u0026#34;my_dbname\u0026#34;, port = \u0026#34;my_port\u0026#34;, user = \u0026#34;my_user\u0026#34;, table = \u0026#34;my_table\u0026#34; ) data \u0026lt;- sd_get_data(db) Vale decir que la obtenci√≥n de los datos remotos tienes que hacerla desde el mismo proyecto de R donde creaste y configuraste la contrase√±a de tu base de datos. De lo contrario, vas a tener que volver a registrar la contrase√±a de tu base de datos con sd_set_password() en el proyecto que quieras conectar a tu base de datos.\nUna vez establecida la conexi√≥n con la base de datos, si vuelves a ejecutar la funci√≥n sd_get_data() obtendr√°s los datos actualizados.\nConclusi√≥n Siguiendo esta instrucciones, en unos minutos podr√°s tener una encuesta sencilla, personalizable, y totalmente gratis, que puedes publicar online y enviarla para empezar a recolectar datos. En el proceso, tambi√©n habr√°s aprendido a crear y conectarte a una base de datos SQL, una herramienta crucial y que abre muchas posibilidades en el mundo del an√°lisis de datos y el desarrollo de aplicaciones Shiny.\nPersonalmente, cre√© una encuesta de evaluaci√≥n an√≥nima para las alumnas y alumnos de mis cursos de R, y otra encuesta de bienvenida a nuevos alumnxs de mis cursos, donde rellenaron sus datos de caracterizaci√≥n, respondieron sobre sus conocimientos previos de R y sus expectativas del curso, y al final de la encuesta los resultados se visualizaban en tiempo real, actualiz√°ndose cada cinco segundos, y as√≠ todas y todos pod√≠amos ver gr√°ficos que describ√≠an a los participantes del curso a medida que respond√≠an! üòç\nGr√°ficos al final de la encuesta, actualizados en tiempo real\nEn este repositorio te dejo el c√≥digo de una encuesta que tambi√©n muestra gr√°ficos en tiempo real con las respuestas al finalizar, y en este enlace puedes ver la misma encuesta en funcionamiento y responderla.\nSi este tutorial te sirvi√≥, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\nPara clonar un repositorio de GitHub, entras al repositorio, presionas el bot√≥n verde que dice Code, copias el enlace que te entrega, y en RStudio creas un nuevo proyecto a partir de control de versiones, pegas ah√≠ el enlace del repositorio GitHub, y espec√≠ficas donde quieres guardar tu proyecto clonado.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-11-21T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/surveydown_encuestas/","tags":"quarto ; shiny ; ciencias sociales ; datos","title":"Crea encuestas en R usando {surveydown}"},{"content":" El paquete de R {gt} (llamado as√≠ por generar great tables) permite producir tablas atractivas con R para presentar tus datos. Sus cualidades principales son que produce resultados atractivos con muy pocas l√≠neas de c√≥digo, pero al mismo tiempo ofrece una alta capacidad de personalizaci√≥n, teniendo opciones para personalizar pr√°cticamente todos los aspectos de la tabla.\nOtro beneficio de usar este paquete es que contiene funciones que hacen muy f√°cil darle el formato correcto a las variables num√©ricas, como porcentajes, n√∫meros grandes, cifras en dinero, etc., Y adem√°s, ofrece funciones para darle estilos personalizados a las columnas o celdas de tu tabla de forma program√°tica. Esto permite generar ciertas reglas para que las celdas cambien de colores dependiendo de su valor, ciertas cifras cambian su tipo de letra bajo determinadas circunstancias, y mucho m√°s.\nEn este art√≠culo te mostrar√© tres ejemplos de creaci√≥n de distintas tablas basadas en datos reales:\nTabla de estimaci√≥n de pobreza comunal, con estilo condicional de celdas y columnas con colorizaci√≥n en base a datos Tabla de resultados electorales, con colorizaci√≥n de celdas de variables categ√≥ricas en base a una segunda variable categ√≥rica Tabla de Producto Interno Bruto regional, con colorizaci√≥n de m√∫ltiples columnas num√©ricas de forma simult√°nea, y estilo de celdas condicional Tabla de estimaci√≥n de pobreza por comunas El primer ejemplo de tabla se basar√° en los datos de estimaciones de pobreza comunal del a√±o 2022, producidos por el Ministerio de Desarrollo Social de Chile.\nEl primer paso ser√° obtener los datos oficiales. Por conveniencia, tengo la tabla con los datos originales pre-procesada en un repositorio sobre datos de pobreza en Chile, por lo que es posible importar los datos limpios en una sola l√≠nea de c√≥digo:\npobreza \u0026lt;- readr::read_csv2(\u0026#34;https://raw.githubusercontent.com/bastianolea/pobreza_chile/refs/heads/main/pobreza_comunal/datos_procesados/pobreza_comunal.csv\u0026#34;) pobreza # A tibble: 345 √ó 8 codigo region nombre_comuna poblacion pobreza_n pobreza_p limite_inferior \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 1101 Tarapac√° Iquique 229674 41967. 0.183 0.162 2 1107 Tarapac√° Alto Hospicio 138527 45162. 0.326 0.295 3 1401 Tarapac√° Pozo Almonte 18290 4563. 0.250 0.199 4 1402 Tarapac√° Cami√±a 1380 308. 0.223 0.138 5 1403 Tarapac√° Colchane 1575 473. 0.300 0.187 6 1404 Tarapac√° Huara 3072 1185. 0.386 0.319 7 1405 Tarapac√° Pica 6184 1040. 0.168 0.119 8 2101 Antofagas‚Ä¶ Antofagasta 438942 73103. 0.167 0.141 9 2102 Antofagas‚Ä¶ Mejillones 15502 3078. 0.199 0.127 10 2103 Antofagas‚Ä¶ Sierra Gorda 1790 295. 0.165 0.0743 # ‚Ñπ 335 more rows # ‚Ñπ 1 more variable: limite_superior \u0026lt;dbl\u0026gt; Podemos ver que los datos corresponden a 345 filas con informaci√≥n de las comunas, su poblaci√≥n, y las cifras de pobreza en n√∫meros absolutos y porcentaje.\nPara el ejemplo, primero obtendremos 7 filas al azar y seleccionaremos solamente las columnas que nos interesan. Teniendo cualquier tabla de datos en R, si le agregamos la funci√≥n gt() crearemos una tabla {gt} con las configuraciones por defecto:\nlibrary(dplyr) library(gt) set.seed(1917) tabla_pobreza_1 \u0026lt;- pobreza |\u0026gt; slice_sample(n = 7) |\u0026gt; select(region, contains(\u0026#34;comuna\u0026#34;), poblacion, starts_with(\u0026#34;pobreza\u0026#34;)) |\u0026gt; gt() Esta es la tabla b√°sica que entrega {gt}, la cual viene con l√≠neas horizontales elegantes y un espaciado de celdas agradable. Tiene una apariencia bastante mejor que haber pegado a los datos en una planilla de Excel ü§´\nFormato de variables num√©ricas El primer paso para mejorar esta tabla es darle un formato de texto correcto a las variables num√©ricas. Esto logramos con las funciones de {gt} que empiezan con fmt_ (por formato), de las cuales usaremos fmt_number() para remover decimales de los n√∫meros enteros y aplicar separadores de miles, y fmt_percent() para especificar el n√∫mero de decimales y usar la coma como separador de decimales.\ntabla_pobreza_2 \u0026lt;- tabla_pobreza_1 |\u0026gt; # dar formato a n√∫meros enteros fmt_number(columns = c(poblacion, pobreza_n), decimals = 0, sep_mark = \u0026#34;.\u0026#34;) |\u0026gt; # dar formato a porcentajes fmt_percent(columns = pobreza_p, decimals = 1, drop_trailing_zeros = TRUE, dec_mark = \u0026#34;,\u0026#34;) Apariencia de columnas El segundo paso va a ser cambiar el formato del texto de algunas columnas. En este caso, queremos aplicar letras negrita a la columna nombre_comuna, Y vamos a alinear la columna region hacia la derecha, para que se pegue al nombre de las comunas. Esto se lleva a cabo con la funci√≥n tab_style(), cuyo primer argumento es el estilo que vamos a darle a las celdas, y el segundo es las columnas o filas que vamos a afectar. C√≥mo vamos a cambiar el texto de las celdas, en el argumento style se usa la funci√≥n cell_text(), que contiene todos los atributos que podemos cambiar de las letras de las celdas, como color, tama√±o, estilo, peso, etc.\nLa alineaci√≥n del texto tambi√©n podr√≠amos haberla hecho con la funci√≥n tab_style(), especificando en cell_text() que queremos que el texto sea alienado a la derecha, pero {gt} nos facilita un poco √©sto con la funci√≥n cols_align().\ntabla_pobreza_3 \u0026lt;- tabla_pobreza_2 |\u0026gt; # cambiar estilo de texto de una columna tab_style(style = cell_text(weight = \u0026#34;bold\u0026#34;), locations = cells_body(nombre_comuna)) |\u0026gt; # alineaci√≥n de texto de una columna cols_align(align = \u0026#34;right\u0026#34;, columns = region) Para terminar de cambiar las configuraciones b√°sicas de nuestra tabla, tenemos que mejorar los nombres de las columnas y agregar informaci√≥n de contexto a la tabla. Reemplazaremos los nombres de las columnas por nombres correctamente redactados, usando la funci√≥n cols_label(), a la cual hay que darle los nombres de las columnas con el texto que queremos que tenga cada uno. Luego, utilizaremos la funci√≥n tab_header() para agregar t√≠tulo y subt√≠tulo, y la funci√≥n tab_source_note() para agregar un texto de fuente debajo de la tabla.\ntabla_pobreza_4 \u0026lt;- tabla_pobreza_3 |\u0026gt; # nombres de columnas cols_label(region = \u0026#34;Regi√≥n\u0026#34;, nombre_comuna = \u0026#34;Comuna\u0026#34;, poblacion = \u0026#34;Poblaci√≥n\u0026#34;, pobreza_n = \u0026#34;Cantidad\u0026#34;, pobreza_p = \u0026#34;Porcentaje\u0026#34;) |\u0026gt; # t√≠tulo y subt√≠tulo tab_header(title = \u0026#34;Pobreza comunal\u0026#34;, subtitle = \u0026#34;Cantidad y porcentaje de personas en situaci√≥n de pobreza\u0026#34;) |\u0026gt; # texto fuente tab_source_note(\u0026#34;Fuente: Estimaciones de pobreza comunal 2022,\u0026#34;) |\u0026gt; tab_source_note(\u0026#34;Ministerio de Desarrollo Social\u0026#34;) En este punto ya tenemos una tabla presentable, ordenada y elegante. Podemos guardar la tabla como una imagen con el comando gtsave(), incluirla en un reporte Quarto/RMarkdown o en una app Shiny.\nEstilo condicional de celdas Podemos seguir mejorando en la tabla agregando cambios condicionales en el estilo de celdas que cumplan con una condici√≥n puntual. Por ejemplo, queremos destacar celdas de la variable poobreza_n que superen cierto valor, debido a que nos parece relevante distinguir comunas donde exista una cierta cantidad de personas en condici√≥n de pobreza.\nPara agregar estilos condicionales a las celdas de una o varias columnas, usamos la misma funci√≥n tab_style() que usamos para darle un estilo a las columnas completas, pero esta vez, en el argumento de location que usamos para especificar la columna que queremos modificar, especificamos tanto una columna como un criterio para las filas. De esta forma, se indica que queremos cambiar el estilo de una columna, pero s√≥lo si sus filas cumplen una condici√≥n determinada:\ntabla_pobreza_5 \u0026lt;- tabla_pobreza_4 |\u0026gt; tab_style(style = cell_fill(color = \u0026#34;red\u0026#34;, alpha = 0.2), locations = cells_body(columns = pobreza_n, rows = pobreza_n \u0026gt; 6000) ) Colorear columnas seg√∫n su valor Podemos hacer que una columna de una variable num√©rica exprese su valor a trav√©s de una escala de colores. As√≠ resulta mucho m√°s f√°cil guiar la atenci√≥n a las diferencias en los valores de las observaciones, ya que podemos identificar valores bajos y altos de la misma variable siguiendo el degradado de colores.\nLa funci√≥n data_color() aplica colorizaci√≥n de celdas en base a los valores de la variable indicada en el argumento column. Si las variables num√©rica, especificamos que el m√©todo sea numeric, y luego tenemos varios argumentos que podemos especificar para modificar la colorizaci√≥n. Los principales son domain, donde se especifica el rango de la escala de colores (es decir, el valor que corresponde con el color m√≠nimo y el valor del color m√°ximo), y la paleta en palette, qu√© puede hacer un vector de colores que van desde el valor m√°s bajo el valor m√°s alto; es decir, el color asignado a los valores m√°s bajos de la variable, y los colores siguientes en el degradado. En este caso, queremos que las cifras bajas sean de color blanco (igual que el fondo del gr√°fico), y a medida que el valor sea m√°s alto sean de un rojo intenso y luego un rojo oscuro. El color m√°s alto (rojo oscuro) corresponde al valor 0.3 o 30%, dado que en el contexto de medici√≥n de pobreza consideramos que eso ya es una cifra suficientemente alarmante. Los valores que queden fuera de este rango de cero a 30% van a adquirir el color de los datos perdidos (na_color), de modo que todos los valores iguales o mayores a 0.3 van a ser del color m√°s alto.\ntabla_pobreza_6 \u0026lt;- tabla_pobreza_5 |\u0026gt; data_color(columns = pobreza_p, method = \u0026#34;numeric\u0026#34;, domain = c(0, 0.3), na_color = \u0026#34;red4\u0026#34;, palette = c(\u0026#34;white\u0026#34;, \u0026#34;red1\u0026#34;, \u0026#34;red4\u0026#34;)) Gracias al degradado de colores a las celdas tenemos una tabla que comunica mucho m√°s que la versi√≥n anterior, dado que gu√≠a la interpretaci√≥n de los datos a una variable puntual.\nEstilo avanzado de tablas Para finalizar con esta tabla, podemos personalizar con mayor detalle de todos los aspectos de la misma. En el bloque de c√≥digo que viene a continuaci√≥n, vamos a especificar m√∫ltiples modificaciones a la tabla:\nCambiar el tama√±o del texto de las celdas Usar una tipograf√≠a o tipo de letra distinto para la tabla, usando tipograf√≠as de Google, con las funciones opt_table_font() y google_font() Poner el subt√≠tulo de la tabla en it√°lica con tab_style() Cambiar el color del texto de algunas columnas, ya que queremos que pasen a segundo plano, usando tab_style() Alinear los textos de t√≠tulo y subt√≠tulo hacia el lado izquierdo, usando tab_style() Cambiar el color de fondo de los nombres de columnas, para crear una jerarqu√≠a en la tabla, usando tab_style() Eliminar las l√≠neas de borde de la tabla con opt_table_lines(\u0026quot;none\u0026quot;), para luego personalizar las l√≠neas horizontales en tab_options(), poni√©ndolas de color blanco y ensanch√°ndolas para que creen una separaci√≥n entre filas Crear un espaciado entre el subt√≠tulo con el resto de la tabla, al ensanchar la l√≠nea divisoria entre ambas, usando tab_options() Agregar un color de fondo alternante de las filas, para guiar la lectura, usando opt_row_striping() Cambiar el texto de la fuente en la parte de abajo de la tabla, y creamos un espaciado entre la fuente y la tabla ensanchando la l√≠nea divisoria entre ambas, usando tab_style() y tab_options() tabla_pobreza_7 \u0026lt;- tabla_pobreza_6 |\u0026gt; # texto de tabla m√°s chico tab_style(style = cell_text(size = \u0026#34;small\u0026#34;), locations = list(cells_body(), cells_column_labels())) |\u0026gt; # tipograf√≠a opt_table_font(font = google_font(name = \u0026#34;Host Grotesk\u0026#34;)) |\u0026gt; # subt√≠tulo en it√°licas tab_style(style = cell_text(style = \u0026#34;italic\u0026#34;), locations = cells_title(\u0026#34;subtitle\u0026#34;)) |\u0026gt; # texto de columna tab_style(style = cell_text(\u0026#34;grey60\u0026#34;), locations = cells_body(columns = c(region, poblacion))) |\u0026gt; # alineaci√≥n de texto de titulares tab_style(style = cell_text(align = \u0026#34;left\u0026#34;), locations = cells_title()) |\u0026gt; # color de fondo de t√≠tulos de columnas tab_style(style = cell_fill(\u0026#34;grey92\u0026#34;), locations = cells_column_labels()) |\u0026gt; # eliminar l√≠neas por defecto opt_table_lines(\u0026#34;none\u0026#34;) |\u0026gt; # espaciado entre filas tab_options(table_body.hlines.style = \u0026#34;solid\u0026#34;, table_body.hlines.width = 2, table_body.hlines.color = \u0026#34;white\u0026#34;) |\u0026gt; # espaciado entre subt√≠tulo y tabla tab_options(heading.border.bottom.style = \u0026#34;solid\u0026#34;, heading.border.bottom.color = \u0026#34;white\u0026#34;, heading.border.bottom.width = 12, heading.padding = 0) |\u0026gt; # filas con fondo alternante opt_row_striping() |\u0026gt; # texto fuente tab_options(source_notes.font.size = \u0026#34;small\u0026#34;, source_notes.padding = 0) |\u0026gt; tab_style(style = cell_text(align = \u0026#34;right\u0026#34;), locations = cells_source_notes()) |\u0026gt; # espaciado tabla y fuente tab_options(table_body.border.bottom.style = \u0026#34;solid\u0026#34;, table_body.border.bottom.color = \u0026#34;white\u0026#34;, table_body.border.bottom.width = 12) La tabla terminada tiene una apariencia mucho m√°s personalizada y atractiva ü•∞\nTabla de resultados electorales En el segundo ejemplo, haremos una peque√±a tabla que resuma resultados electorales. En esta tabla, el sector pol√≠tico al que pertenezcan los candidatos o candidatas tendr√° un color espec√≠fico, pero este color se aplicar√° a una columna distinta al sector pol√≠tico.\nLos datos fueron obtenidos desde el sitio web del Servel por medio de web scraping. El procesamiento de los datos y los datos originales se encuentran en este repositorio, pero para este ejemplo, cargaremos directamente el archivo que contiene todos los resultados oficiales, procesados y limpios.\nlibrary(dplyr) library(tidyr) library(forcats) library(glue) library(lubridate) library(stringr) # cargar datos remotamente desde el repositorio datos_elecciones \u0026lt;- readr::read_csv2(\u0026#34;https://raw.githubusercontent.com/bastianolea/servel_scraping_votaciones/refs/heads/main/datos/resultados_alcaldes_2024.csv\u0026#34;) datos_elecciones # A tibble: 1,922 √ó 11 comuna candidato partido lista sector votos porcentaje total_votos \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 ALGARROBO Marco Antonio Go‚Ä¶ RN Z - ‚Ä¶ Derec‚Ä¶ 4250 0.276 15405 2 ALGARROBO Veronica Maricel‚Ä¶ IND CAND‚Ä¶ Indep‚Ä¶ 2905 0.189 15405 3 ALGARROBO Marcela Maritza ‚Ä¶ IND CAND‚Ä¶ Indep‚Ä¶ 2677 0.174 15405 4 ALGARROBO Alejandro Felipe‚Ä¶ IND CAND‚Ä¶ Indep‚Ä¶ 2425 0.157 15405 5 ALGARROBO Carlos Orlando T‚Ä¶ IND CAND‚Ä¶ Indep‚Ä¶ 1089 0.0707 15405 6 ALGARROBO Maria Luisa Hami‚Ä¶ IND CAND‚Ä¶ Indep‚Ä¶ 365 0.0237 15405 7 ALGARROBO Gaston Dubournai‚Ä¶ IND F - ‚Ä¶ Indep‚Ä¶ 332 0.0216 15405 8 ALGARROBO Nulo/Blanco \u0026lt;NA\u0026gt; \u0026lt;NA\u0026gt; Otros 1362 0.0884 15405 9 ALHUE Marcela Chamorro‚Ä¶ IND H - ‚Ä¶ Izqui‚Ä¶ 3490 0.598 5841 10 ALHUE Jose Andres Arel‚Ä¶ IND CAND‚Ä¶ Indep‚Ä¶ 1828 0.313 5841 # ‚Ñπ 1,912 more rows # ‚Ñπ 3 more variables: mesas_escrutadas \u0026lt;dbl\u0026gt;, mesas_totales \u0026lt;dbl\u0026gt;, # mesas_porcentaje \u0026lt;dbl\u0026gt; Habiendo cargado los datos, filtramos por una comuna que nos interese, y ordenamos las columnas:\nConvertimos el sector pol√≠tico (variable sector) en un factor ordenado. Luego hacemos que la columna candidato tambi√©n sea un factor cuyo orden depende del porcentaje obtenido. Llevamos los votos nulos a la √∫ltima posici√≥n del factor de candidatos para que aparezcan al final. Ordenamos la tabla por el factor ordenado candidato. comuna_elegida = \u0026#34;PE√ëALOLEN\u0026#34; tabla_elecciones_1 \u0026lt;- datos_elecciones |\u0026gt; filter(comuna == comuna_elegida) |\u0026gt; # ordenar sector pol√≠tico mutate(sector = as.factor(sector), sector = fct_relevel(sector, \u0026#34;Izquierda\u0026#34;, \u0026#34;Derecha\u0026#34;, \u0026#34;Independiente\u0026#34;, \u0026#34;Otros\u0026#34;)) |\u0026gt; # nulos al final de la tabla mutate(candidato = fct_reorder(candidato, porcentaje), candidato = fct_relevel(candidato, \u0026#34;Nulo/Blanco\u0026#34;,after = 0)) |\u0026gt; arrange(desc(candidato)) |\u0026gt; select(candidato, partido, votos, porcentaje, sector) tabla_elecciones_1 # A tibble: 5 √ó 5 candidato partido votos porcentaje sector \u0026lt;fct\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;fct\u0026gt; 1 Miguel Andres Concha Manso FA 52293 0.317 Izquierda 2 Claudia Mora Vega RN 52170 0.316 Derecha 3 Carlos Alarcon Castro IND 31217 0.189 Independiente 4 Eduardo Giesen Amtmann IND 9321 0.0565 Independiente 5 Nulo/Blanco \u0026lt;NA\u0026gt; 19928 0.121 Otros Procedemos a crear la tabla b√°sica con {gt}, incluyendo un subt√≠tulo en formato markdown que contiene dentro de s√≠ el nombre de la comuna elegida a partir del objeto que usamos para filtrar los datos en el paso anterior. El texto markdown permite darle estilo enriquecido al texto de forma sencilla usando s√≠mbolos, lo cual resulta conveniente para casos como √©ste.\nlibrary(gt) tabla_elecciones_2 \u0026lt;- tabla_elecciones_1 |\u0026gt; gt() |\u0026gt; # titulares tab_header(title = md(\u0026#34;_Resultados parciales:_ Elecciones Municipales 2024\u0026#34;), subtitle = md(glue(\u0026#34;**{str_to_title(comuna_elegida)}**\u0026#34;))) Aplicamos el formato de porcentaje a la columna de porcentaje, y el formato num√©rico a la columna num√©rica. Luego definimos algunos aspectos del estilo de la tabla, como fondos de color para algunas columnas, una tipograf√≠a personalizada desde Google Fonts, alineaciones de textos, y estilos de textos distintos en los distintos elementos de la tabla.\ntabla_elecciones_3 \u0026lt;- tabla_elecciones_2 |\u0026gt; # formato de n√∫meros fmt_percent(porcentaje, decimals = 1) |\u0026gt; fmt_number(votos, decimals = 0, sep_mark = \u0026#34;.\u0026#34;, dec_mark = \u0026#34;,\u0026#34;) |\u0026gt; # estilo fondos de todas las celdas excepto partido tab_style(locations = cells_body(column = c(candidato, votos, porcentaje)), style = cell_fill(color = \u0026#34;grey96\u0026#34;)) |\u0026gt; # tipograf√≠a opt_table_font(font = google_font(\u0026#34;Open Sans\u0026#34;)) |\u0026gt; # alineaci√≥n de textos cols_align(columns = c(candidato, partido, porcentaje), align = \u0026#34;left\u0026#34;) |\u0026gt; cols_align(columns = c(partido), align = \u0026#34;center\u0026#34;) |\u0026gt; cols_hide(sector) |\u0026gt; opt_table_lines(\u0026#34;none\u0026#34;) |\u0026gt; opt_align_table_header(align = \u0026#34;left\u0026#34;) |\u0026gt; # estilo de textos tab_style(locations = cells_body(column = c(candidato, partido, porcentaje)), style = cell_text(weight = \u0026#34;bold\u0026#34;)) |\u0026gt; tab_style(locations = cells_column_labels(), style = cell_text(style = \u0026#34;italic\u0026#34;)) |\u0026gt; tab_style(locations = cells_body(rows = candidato == \u0026#34;Nulo/Blanco\u0026#34;), style = cell_text(weight = \u0026#34;normal\u0026#34;)) |\u0026gt; # etiquetas de columnas cols_label(candidato = \u0026#34;Candidato/a\u0026#34;, partido = \u0026#34;Partido\u0026#34;, votos = \u0026#34;Votos\u0026#34;, porcentaje = \u0026#34;%\u0026#34;) Colorear celdas seg√∫n una variable categ√≥rica o factor Ahora viene lo entretenido. La tabla tiene una columna con una variable de partido pol√≠tico (partido), pero los datos contienen tambi√©n una columna de sector pol√≠tico, que engloba a los partidos pol√≠ticos. Vamos a asignar un color a las celdas del partido pol√≠tico dependiendo del sector pol√≠tico al que pertenecen; es decir, usar el contenido de una columna de la tabla para cambiar el estilo de otra columna distinta de la tabla.\nCreamos una lista con los colores que queremos usar para la variable categ√≥rica sector, que representa el sector del espectro pol√≠tico al cual pueden pertenecer los partidos pol√≠ticos.\ncolor \u0026lt;- list(\u0026#34;izquierda\u0026#34; = \u0026#34;#DB231D\u0026#34;, \u0026#34;derecha\u0026#34; = \u0026#34;#1D76DB\u0026#34;, \u0026#34;centro\u0026#34; = \u0026#34;#B16AD2\u0026#34;, \u0026#34;independiente\u0026#34; = \u0026#34;#38B51D\u0026#34;, \u0026#34;otros\u0026#34; = \u0026#34;grey50\u0026#34;) levels(tabla_elecciones_1$sector) [1] \u0026quot;Izquierda\u0026quot; \u0026quot;Derecha\u0026quot; \u0026quot;Independiente\u0026quot; \u0026quot;Otros\u0026quot; La funci√≥n data_color(), que usamos anteriormente para dar color a variables num√©ricas en base a sus valores, tambi√©n permite asignar colores a las variables en base a sus niveles, para el caso de variables categ√≥ricas o factores que contienen niveles o categor√≠as de respuesta nominales u ordinales.\nPara que esto funcione correctamente, es necesario que la variable est√© en formato factor, lo cual hicimos en el primer paso de ordenar las columnas. La variable sector posee un determinado orden de sus niveles, que revisamos con la funci√≥n levels(tabla_elecciones_1$sector), Y en base al orden de estos niveles, especificamos los colores en la paleta, en el argumento palette de data_color(). Es en esta funci√≥n donde especificamos que la informaci√≥n sale de la columna sector, pero afecta a la columna partido, y el efecto del color se aplica al texto, no al fondo (apply_to = \u0026quot;text\u0026quot;).\nUna vez especificando esto, podemos repetir la misma operaci√≥n pero aplicando el efecto al fondo (apply_to = \u0026quot;fill\u0026quot;) y d√°ndole una transparencia de 20% (alpha = 0.2).\ntabla_elecciones_4 \u0026lt;- tabla_elecciones_3 |\u0026gt; # color texto partidos data_color(columns = sector, target_columns = partido, method = \u0026#34;factor\u0026#34;, palette = c(color$izquierda, color$derecha, color$independiente, color$otros), apply_to = \u0026#34;text\u0026#34;) |\u0026gt; # color fondo partidos data_color(columns = sector, rows = candidato != \u0026#34;Nulo/Blanco\u0026#34;, target_columns = partido, method = \u0026#34;factor\u0026#34;, palette = c(color$izquierda, color$derecha, color$independiente, color$otros), alpha = 0.2, apply_to = \u0026#34;fill\u0026#34;, autocolor_text = FALSE) Repetir el efecto de colonizaci√≥n al texto y al fondo por separado nos permite darle un efecto m√°s sofisticado al color de las celdas, donde el fondo de la celda tiene el mismo color que el texto, pero m√°s suave.\nFinalmente, aplicamos otras personalizaciones a la tabla, principalmente para crear un espacio entre las celdas y otros elementos de la tabla, y especificar el color de fondo y de texto de los votos nulos/blancos, que son menos relevantes.\ntabla_elecciones_5 \u0026lt;- tabla_elecciones_4 |\u0026gt; # color fondo nulos data_color(columns = sector, rows = candidato == \u0026#34;Nulo/Blanco\u0026#34;, target_columns = partido, palette = \u0026#34;grey96\u0026#34;, alpha = 1, apply_to = \u0026#34;fill\u0026#34;, autocolor_text = FALSE) |\u0026gt; # estilo fila nulos tab_style(locations = cells_body(rows = candidato == \u0026#34;Nulo/Blanco\u0026#34;), style = cell_text(color = \u0026#34;grey70\u0026#34;)) |\u0026gt; # notas al pie tab_options(table_body.hlines.style = \u0026#34;solid\u0026#34;, table_body.hlines.width = 8, table_body.hlines.color = \u0026#34;white\u0026#34;, table_body.vlines.style = \u0026#34;solid\u0026#34;, table_body.vlines.width = 8, table_body.vlines.color = \u0026#34;white\u0026#34;) |\u0026gt; tab_footnote(footnote = glue(\u0026#34;Fuente: Servel\u0026#34;)) |\u0026gt; tab_style(locations = cells_footnotes(), style = cell_text(align = \u0026#34;right\u0026#34;, size = px(12))) |\u0026gt; tab_options(heading.subtitle.font.size = 19, heading.padding = 1, heading.border.bottom.style = \u0026#34;solid\u0026#34;, heading.border.bottom.width = 16, heading.border.bottom.color = \u0026#34;white\u0026#34;) |\u0026gt; tab_options(table_body.border.bottom.style = \u0026#34;solid\u0026#34;, table_body.border.bottom.width = 5, table_body.border.bottom.color = \u0026#34;white\u0026#34;, footnotes.padding = 1) Obtenemos como resultado una tabla concisa pero a la vez informativa.\nTabla de Producto Interno Bruto regional El tercer y √∫ltimo ejemplo ser√° una tabla con datos regionales para un rango de varios a√±os; es decir, una tabla con una alta cantidad de celdas num√©ricas en cuadr√≠cula.\nLos datos ser√°n obtenidos directamente desde las estad√≠sticas del Banco Central de Chile, utilizando web scraping, siguiendo el trabajo previo que hice con estad√≠sticas econ√≥micas para un visualizador interactivo de indicadores econ√≥micos.\nCargamos el paquete {rvest}, especificamos la direcci√≥n web donde est√° ubicada la tabla que nos interesa, y hacemos web scraping de la tabla ubicada en esa p√°gina:\nlibrary(dplyr) library(rvest) # url con la tabla url \u0026lt;- \u0026#34;https://si3.bcentral.cl/Siete/ES/Siete/Cuadro/CAP_ESTADIST_REGIONAL/MN_REGIONAL1/CCNN2018_PIB_REGIONAL_T?cbFechaInicio=2018\u0026amp;cbFechaTermino=2024\u0026amp;cbFrecuencia=ANNUAL\u0026amp;cbCalculo=NONE\u0026amp;cbFechaBase=\u0026#34; # abrir sesi√≥n y obtener c√≥digo de fuente del sitio sitio \u0026lt;- session(url) |\u0026gt; read_html() # obtener la tabla del sitio, sin convertir unidades tablas \u0026lt;- sitio |\u0026gt; html_table(convert = FALSE) # limpieza m√≠nima tabla_pib \u0026lt;- tablas[[1]] |\u0026gt; rename(region = 2) |\u0026gt; select(-1) tabla_pib # A tibble: 19 √ó 8 region `2018` `2019` `2020` `2021` `2022` `2023` `2024` \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 Regi√≥n de Arica y Parinacota 1.433 1.419 1.331 1.554 1.665 1.696 1.680 2 Regi√≥n de Tarapac√° 4.355 4.573 4.392 4.791 4.868 5.022 5.225 3 Regi√≥n de Antofagasta 15.986 15.983 15.697 15.560 15.562 16.089 17.257 4 Regi√≥n de Atacama 3.687 3.528 3.540 3.958 3.991 4.036 4.081 5 Regi√≥n de Coquimbo 5.876 5.956 5.658 6.169 6.126 6.311 6.395 6 Regi√≥n de Valpara√≠so 13.989 13.948 13.087 14.406 15.258 15.288 15.551 7 Regi√≥n Metropolitana de San‚Ä¶ 78.215 78.931 72.170 81.945 84.131 84.396 85.941 8 Regi√≥n del Libertador Gener‚Ä¶ 7.930 7.882 7.589 8.310 8.328 8.211 8.686 9 Regi√≥n del Maule 7.186 7.148 7.049 7.651 7.898 8.046 8.464 10 Regi√≥n de √ëuble 2.775 2.786 2.693 3.016 3.121 3.066 3.176 11 Regi√≥n del Biob√≠o 11.337 11.499 10.865 11.864 12.202 12.917 13.241 12 Regi√≥n de La Araucan√≠a 5.241 5.325 5.075 5.708 5.956 6.072 6.255 13 Regi√≥n de Los R√≠os 2.498 2.503 2.403 2.639 2.709 2.706 2.821 14 Regi√≥n de Los Lagos 6.422 6.563 6.225 6.722 6.957 7.047 7.156 15 Regi√≥n de Ays√©n del General‚Ä¶ 1.228 1.243 1.138 1.176 1.198 1.297 1.294 16 Regi√≥n de Magallanes y de l‚Ä¶ 1.843 1.934 1.689 1.813 1.912 1.943 2.052 17 Subtotal regionalizado 170.0‚Ä¶ 171.2‚Ä¶ 160.6‚Ä¶ 176.9‚Ä¶ 181.3‚Ä¶ 183.7‚Ä¶ 189.1‚Ä¶ 18 Extrarregional 19.435 19.415 18.320 22.270 22.219 20.702 20.737 19 Producto Interno Bruto 189.4‚Ä¶ 190.6‚Ä¶ 178.9‚Ä¶ 199.1‚Ä¶ 203.4‚Ä¶ 204.5‚Ä¶ 209.9‚Ä¶ Nos encontramos con una tabla que tiene 19 filas y seis columnas num√©ricas, correspondientes a los valores del Producto Interno Bruto para cada uno de los a√±os. Procedemos a limpiar estos datos, debido a que la tabla usa puntos como divisores de miles, y esto hace que R interprete los n√∫meros como si fueran decimales. Usamos stringr::str_remove() para eliminar todos los puntos en todas las columnas que empiecen con 20 (los a√±os), y luego las convertimos a num√©ricas.\nlibrary(stringr) library(forcats) pib_regional \u0026lt;- tabla_pib |\u0026gt; mutate(across(starts_with(\u0026#34;20\u0026#34;), ~str_remove(.x, \u0026#34;\\\\.\u0026#34;))) |\u0026gt; mutate(across(starts_with(\u0026#34;20\u0026#34;), as.numeric)) |\u0026gt; filter(str_detect(region, \u0026#34;Regi√≥n\u0026#34;)) pib_regional # A tibble: 16 √ó 8 region `2018` `2019` `2020` `2021` `2022` `2023` `2024` \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Regi√≥n de Arica y Parinacota 1433 1419 1331 1554 1665 1696 1680 2 Regi√≥n de Tarapac√° 4355 4573 4392 4791 4868 5022 5225 3 Regi√≥n de Antofagasta 15986 15983 15697 15560 15562 16089 17257 4 Regi√≥n de Atacama 3687 3528 3540 3958 3991 4036 4081 5 Regi√≥n de Coquimbo 5876 5956 5658 6169 6126 6311 6395 6 Regi√≥n de Valpara√≠so 13989 13948 13087 14406 15258 15288 15551 7 Regi√≥n Metropolitana de San‚Ä¶ 78215 78931 72170 81945 84131 84396 85941 8 Regi√≥n del Libertador Gener‚Ä¶ 7930 7882 7589 8310 8328 8211 8686 9 Regi√≥n del Maule 7186 7148 7049 7651 7898 8046 8464 10 Regi√≥n de √ëuble 2775 2786 2693 3016 3121 3066 3176 11 Regi√≥n del Biob√≠o 11337 11499 10865 11864 12202 12917 13241 12 Regi√≥n de La Araucan√≠a 5241 5325 5075 5708 5956 6072 6255 13 Regi√≥n de Los R√≠os 2498 2503 2403 2639 2709 2706 2821 14 Regi√≥n de Los Lagos 6422 6563 6225 6722 6957 7047 7156 15 Regi√≥n de Ays√©n del General‚Ä¶ 1228 1243 1138 1176 1198 1297 1294 16 Regi√≥n de Magallanes y de l‚Ä¶ 1843 1934 1689 1813 1912 1943 2052 Ahora podemos crear nuestra tabla b√°sica con {gt}, especificando el formato apropiado para todas las columnas num√©ricas en una sola instancia fmt_number(). Esto es posible porque podemos usar selectores de {dplyr} en los argumentos de columnas de {gt}, as√≠ que podemos pedirle que aplique un formato, estilo, u otras herramientas de {gt} a una o varias columnas seleccionadas por su nombre parcial o por su tipo de datos. En este caso, aplicamos el formato a todas las columnas num√©ricas usando where(is.numeric):\nlibrary(gt) tabla_pib_regional_1 \u0026lt;- pib_regional |\u0026gt; gt() |\u0026gt; cols_align(\u0026#34;right\u0026#34;, region) |\u0026gt; # formato de columnas num√©ricas fmt_number(columns = where(is.numeric), sep_mark = \u0026#34;.\u0026#34;, decimals = 0) Con una sola l√≠nea formateamos seis columnas. Yey! ü•≥\nC√°lculo de diferencia porcentual entre a√±os Luego producir esta tabla, vamos a realizar una transformaci√≥n en los datos para poder calcular la variaci√≥n anual, entendida como la diferencia porcentual entre un a√±o y el anterior. Para realizar este c√°lculo, lo m√°s conveniente es transformar los datos a formato largo; es decir, una fila por observaci√≥n, y una variable por columna. Usamos pivot_longer() para transformar las seis columnas que ten√≠amos de datos num√©ricos por a√±o, en una sola columna de datos num√©ricos, y otra columna que contengan los a√±os a los que corresponde cada observaci√≥n.\nlibrary(tidyr) pib_regional_long \u0026lt;- pib_regional |\u0026gt; pivot_longer(cols = where(is.numeric), names_to = \u0026#34;a√±o\u0026#34;, values_to = \u0026#34;valor\u0026#34;) Ahora, es muy sencillo calcular la variaci√≥n porcentual entre una observaci√≥n y otra: agrupamos los datos por regi√≥n, y calculamos cada valor dividido por el valor anterior (la celda de arriba, obtenida con lag()):\npib_regional_cambio \u0026lt;- pib_regional_long |\u0026gt; # ordenar observaciones arrange(region, a√±o) |\u0026gt; group_by(region) |\u0026gt; # calcular cambio mutate(cambio = valor/lag(valor), cambio = 1 - cambio) |\u0026gt; ungroup() |\u0026gt; filter(!is.na(cambio)) pib_regional_cambio # A tibble: 96 √ó 4 region a√±o valor cambio \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Regi√≥n Metropolitana de Santiago 2019 78931 -0.00915 2 Regi√≥n Metropolitana de Santiago 2020 72170 0.0857 3 Regi√≥n Metropolitana de Santiago 2021 81945 -0.135 4 Regi√≥n Metropolitana de Santiago 2022 84131 -0.0267 5 Regi√≥n Metropolitana de Santiago 2023 84396 -0.00315 6 Regi√≥n Metropolitana de Santiago 2024 85941 -0.0183 7 Regi√≥n de Antofagasta 2019 15983 0.000188 8 Regi√≥n de Antofagasta 2020 15697 0.0179 9 Regi√≥n de Antofagasta 2021 15560 0.00873 10 Regi√≥n de Antofagasta 2022 15562 -0.000129 # ‚Ñπ 86 more rows Con nuestra nueva variable cambio calculada, ahora volvemos a transformar los datos para que est√©n en el formato ancho; es decir, nuevamente cada celda ubicada en una columna distinta dependiendo del a√±o al cual corresponde. As√≠, volvemos a obtener seis columnas de datos num√©ricos, una para cada a√±o, pero esta vez con la diferencia porcentual de los valores en vez del valor absoluto.\npib_regional_cambio_wide \u0026lt;- pib_regional_cambio |\u0026gt; select(region, a√±o, cambio) |\u0026gt; pivot_wider(names_from = a√±o, values_from = cambio) pib_regional_cambio_wide # A tibble: 16 √ó 7 region `2019` `2020` `2021` `2022` `2023` `2024` \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 Regi√≥n Metropolitana d‚Ä¶ -9.15e-3 0.0857 -0.135 -2.67e-2 -0.00315 -0.0183 2 Regi√≥n de Antofagasta 1.88e-4 0.0179 0.00873 -1.29e-4 -0.0339 -0.0726 3 Regi√≥n de Arica y Pari‚Ä¶ 9.77e-3 0.0620 -0.168 -7.14e-2 -0.0186 0.00943 4 Regi√≥n de Atacama 4.31e-2 -0.00340 -0.118 -8.34e-3 -0.0113 -0.0111 5 Regi√≥n de Ays√©n del Ge‚Ä¶ -1.22e-2 0.0845 -0.0334 -1.87e-2 -0.0826 0.00231 6 Regi√≥n de Coquimbo -1.36e-2 0.0500 -0.0903 6.97e-3 -0.0302 -0.0133 7 Regi√≥n de La Araucan√≠a -1.60e-2 0.0469 -0.125 -4.34e-2 -0.0195 -0.0301 8 Regi√≥n de Los Lagos -2.20e-2 0.0515 -0.0798 -3.50e-2 -0.0129 -0.0155 9 Regi√≥n de Los R√≠os -2.00e-3 0.0400 -0.0982 -2.65e-2 0.00111 -0.0425 10 Regi√≥n de Magallanes y‚Ä¶ -4.94e-2 0.127 -0.0734 -5.46e-2 -0.0162 -0.0561 11 Regi√≥n de Tarapac√° -5.01e-2 0.0396 -0.0908 -1.61e-2 -0.0316 -0.0404 12 Regi√≥n de Valpara√≠so 2.93e-3 0.0617 -0.101 -5.91e-2 -0.00197 -0.0172 13 Regi√≥n de √ëuble -3.96e-3 0.0334 -0.120 -3.48e-2 0.0176 -0.0359 14 Regi√≥n del Biob√≠o -1.43e-2 0.0551 -0.0919 -2.85e-2 -0.0586 -0.0251 15 Regi√≥n del Libertador ‚Ä¶ 6.05e-3 0.0372 -0.0950 -2.17e-3 0.0140 -0.0578 16 Regi√≥n del Maule 5.29e-3 0.0139 -0.0854 -3.23e-2 -0.0187 -0.0520 Generamos una nueva tabla {gt} con las diferencias porcentuales entre a√±os, especificando que estas columnas num√©ricas ahora son porcentajes:\ntabla_pib_regional_2 \u0026lt;- pib_regional_cambio_wide |\u0026gt; gt() |\u0026gt; cols_align(\u0026#34;right\u0026#34;, region) |\u0026gt; fmt_percent(where(is.numeric), decimals = 1, dec_mark = \u0026#34;,\u0026#34;) |\u0026gt; cols_label(region = \u0026#34;Regi√≥n\u0026#34;) Colorear m√∫ltiples columnas simult√°neamente Ahora que tenemos una cuadr√≠cula de valores num√©ricos en nuestra tabla, resulta conveniente aplicar color a cada celda dependiendo de su valor. Esto permite una interpretaci√≥n m√°s r√°pida de una gran cantidad de datos, debido a que segu√≠a la vista hacia los valores an√≥malos o destacables, Y se facilita la interpretaci√≥n de patrones generales en los datos a partir del color.\nUsamos la funci√≥n data_color() para colorizar las columnas, aprovechando las selecci√≥n de columnas con la funci√≥n where(is.numeric) para aplicar el color a todas las columnas num√©ricas de una sola vez. Usaremos la paleta viridis, que facilita la interpretaci√≥n de diferencia en los datos, y adem√°s es inclusiva para personas dalt√≥nicas.\ntabla_pib_regional_3 \u0026lt;- tabla_pib_regional_2 |\u0026gt; data_color(where(is.numeric), method = \u0026#34;numeric\u0026#34;, palette = \u0026#34;viridis\u0026#34;) Otra opci√≥n es especificar que los colores se apliquen solamente al texto, para generar una tabla m√°s liviana a la vista. Especificamos una paleta b√°sica que va de rojo a verde pasando por negro. Usamos el m√©todo bin para segmentar los colores en rangos discretos, en vez de usar un degradado de colores, para facilitar la interpretaci√≥n. Los rangos para cada uno de los colores se establece en el argumento bins, donde definimos que el color rojo se va aplicar a valores hasta -2%, luego negro del -2% al 2%, y de ah√≠ en adelante verde.\ntabla_pib_regional_4 \u0026lt;- tabla_pib_regional_2 |\u0026gt; data_color(where(is.numeric), method = \u0026#34;bin\u0026#34;, apply_to = \u0026#34;text\u0026#34;, palette = c(\u0026#34;#bf2f2f\u0026#34;, \u0026#34;black\u0026#34;, \u0026#34;#279f2b\u0026#34;), bins = c(-Inf, -0.02, 0.02, Inf)) Usamos categor√≠as de colores en vez de degradados para facilitar la interpretaci√≥n, debido a que los degradados tendr√≠an demasiados valores de color en una cuadr√≠cula que ya es suficientemente compleja, dificultando que las personas asocian r√°pidamente diferentes sombras de rojo o de verde a interpretaciones significativas. En lugar de eso, simplificamos la interpretaci√≥n al solamente colorear valores negativos y positivos, y mantener un rango de valores dentro de la normalidad que carecen de un color distintivo (negro).\nFinalmente, aplicamos m√°s personalizaciones de estilo a la tabla para que resulte m√°s atractiva:\nLimitar el ancho de la primera columna con cols_width() Aplicar negritas a los nombres de variables e it√°licas a la primera columna con tab_style() Eliminar las l√≠neas horizontales de arriba y abajo de la tabla Disminuir el espaciado interior de las celdas para aumentar la densidad de informaci√≥n con tab_options(data_row.padding = px(6)) tabla_pib_regional_5 \u0026lt;- tabla_pib_regional_4 |\u0026gt; # ancho m√°ximo de columna regi√≥n cols_width(region ~ px(220)) |\u0026gt; # filas alternas opt_row_striping() |\u0026gt; # estilo de columnas tab_style(style = cell_text(weight = \u0026#34;bold\u0026#34;), locations = cells_column_labels()) |\u0026gt; tab_style(style = cell_text(style = \u0026#34;italic\u0026#34;), locations = cells_body(columns = region)) |\u0026gt; # eliminar l√≠neas horizontales de arriba y abajo tab_options(table.border.top.style = \u0026#34;hidden\u0026#34;, table.border.bottom.style = \u0026#34;hidden\u0026#34;) |\u0026gt; # cambiar el espaciado interno de las celdas tab_options(data_row.padding = px(6)) |\u0026gt; # t√≠tulo y fuentes tab_header(title = \u0026#34;Producto Interno Bruto regional\u0026#34;, subtitle = \u0026#34;Variaci√≥n anual, por regiones\u0026#34;) |\u0026gt; tab_source_note(\u0026#34;Fuente: Banco Central de Chile\u0026#34;) Estilo condicional a trav√©s de varias columnas Ahora nos ubicaremos en un caso de uso m√°s complejo. Queremos destacar los valores m√°s extremos de la tabla a partir de una condicional: si los valores de las celdas son menores a -3%, queremos que el texto est√© en negritas. Como ejemplo, aplicaremos esto a una sola columna, dejando las dem√°s en gris para que se note el cambio:\n# una columna tabla_pib_regional_5a \u0026lt;- tabla_pib_regional_5 |\u0026gt; tab_style(style = cell_text(color = \u0026#34;grey70\u0026#34;), locations = cells_body(columns = `2019`:`2022`)) |\u0026gt; tab_style(style = cell_text(weight = \u0026#34;bold\u0026#34;), locations = cells_body(columns = `2023`, rows = `2023` \u0026lt; -0.03)) Si bien esto funciona, el problema que vamos a tener radica en que cada especificaci√≥n de las columnas a las que va a aplicar el estilo dependen tambi√©n de la evaluaci√≥n de la condicional en la misma columna. En el fondo, que un valor adquiera o no el estilo depende de si est√° en la columna, y si la fila de esa misma columna cumple con la condici√≥n establecida. Entonces, si queremos aplicar lo mismo a otra columna, habr√≠a que modificar tanto la columna como la condici√≥n, porque la condici√≥n depende tambi√©n de la columna.\nEntonces, ¬øqu√© hacer si queremos aplicar lo mismo a m√°s de una columna? Podemos repetir el llamado de tab_style() para cada uno de los a√±os, o bien, podemos hacer un solo llamado a tab_style(), pero especificando m√°s de una combinaci√≥n de columna/fila en locations al mismo tiempo:\n# dos columnas tabla_pib_regional_5b \u0026lt;- tabla_pib_regional_5 |\u0026gt; tab_style(style = cell_text(color = \u0026#34;grey70\u0026#34;), locations = cells_body(columns = `2019`:`2021`)) |\u0026gt; tab_style(style = cell_text(weight = \u0026#34;bold\u0026#34;), locations = list(cells_body(columns = `2022`, rows = `2022` \u0026lt; -0.03), cells_body(columns = `2023`, rows = `2023` \u0026lt; -0.03)) ) Esto funciona porque se puede entregar a locations una lista con m√∫ltiples funciones que especifiquen el lugar en la tabla en que se quiere aplicar el estilo.\nSin embargo, esta soluci√≥n se volver√≠a extremadamente repetitiva si queremos aplicarlo a seis columnas o m√°s. Habr√≠a que escribir manualmente la especificaci√≥n de cells_body() para cada una de las combinaciones de a√±os y filas.\nA continuaci√≥n comparto una soluci√≥n a este problema que involucra una iteraci√≥n sobre los nombres de las columnas usando purrr::map(). La idea es que, si el argumento locations acepta m√∫ltiples columnas por medio de una lista (como hicimos en el paso anterior), podemos usar map() para especificar una sola vez la columna y la condici√≥n, y multiplicarla por todas las columnas que necesitemos.\nLo que estamos haciendo es una lista con m√∫ltiples instancias de cells_body(), una para cada elemento en el vector columnas. Dentro de cells_body() se usa la sintaxis !!sym() para transformar el nombre de una columna escrito como texto a un s√≠mbolo, para poder hacer la comparaci√≥n apropiadamente (porque no se puede hacer \u0026quot;1\u0026quot; \u0026lt; 0, tiene que ser 1 \u0026lt; 0).\n# m√∫ltiples columnas con filas condicionales # obtener nombres de columas a las que queremos aplicar el estilo columnas \u0026lt;- pib_regional_cambio_wide |\u0026gt; select(where(is.numeric)) |\u0026gt; names() tabla_pib_regional_5c \u0026lt;- tabla_pib_regional_5 |\u0026gt; tab_style(style = cell_text(weight = \u0026#34;bold\u0026#34;), # aplicar el estilo a todas las columnas, iterando la funci√≥n cells_body por los nombres de columnas locations = purrr::map(columnas, ~cells_body( columns = .x, rows = !!sym(.x) \u0026lt; -0.03) ) ) De esta forma, usamos un poco de magia de iteraciones con {purrr} y sintaxis avanzada de R con {rlang} para poder aplicar un formato condicional a m√∫ltiples columnas de una tabla.\nOtros recursos para tablas {gt} Documentaci√≥n oficial: https://gt.rstudio.com https://themockup.blog/static/resources/gt-cookbook.html#table-customization https://gt.albert-rapp.de Si este tutorial te sirvi√≥, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\n","date":"2024-11-19T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_gt/","tags":"tablas ; web scraping ; Chile","title":"Tutorial: generar tablas atractivas y personalizables con {gt}"},{"content":"library(dplyr) # manipulaci√≥n de datos library(lubridate) # trabajar con fechas library(RQuantLib) # paquete con calendarios library(bizdays) # paquete para contar d√≠as h√°biles Hoy se me plante√≥ un peque√±o desaf√≠o que no hab√≠a tenido que hacer antes. Ten√≠a que contar la cantidad de d√≠as entre dos fechas.\nEsto no es particularmente complejo, de hecho es demasiado f√°cil:\nContar la cantidad de d√≠as entre dos fechas Primero definimos las dos fechas:\nfecha_hoy \u0026lt;- today() fecha_anterior \u0026lt;- today() - weeks(2) fecha_hoy [1] \u0026quot;2024-11-14\u0026quot; fecha_anterior [1] \u0026quot;2024-10-31\u0026quot; Y luego usamos una sencilla funci√≥n para buscar la diferencia entre ambas fechas:\ndifftime(fecha_hoy, fecha_anterior) Time difference of 14 days Entre el 13 de noviembre y el 30 de octubre de 2024 hay 14 d√≠as. Incluso, lo anterior podr√≠a ser a√∫n m√°s simple:\nfecha_hoy - fecha_anterior Time difference of 14 days En R, tan sencillo como restar dos fechas para obtener la diferencia de tiempo entre ambas.\nContar la cantidad de d√≠as h√°biles entre dos fechas Pero el problema no era que ten√≠a que contar entre dos fechas, sino que ten√≠a que contar s√≥lo los d√≠as h√°biles entre ambas.\nEsto se vuelve m√°s complejo. Primero, porque habr√≠a que definir una forma de saltarse los fines de semana. Pero tambi√©n, los d√≠as h√°biles son aquellos que no son festivos, y esto implica tener una lista de todos los d√≠as festivos o feriados. Pero adem√°s, ¬°los d√≠as festivos son locales! Dependen de cada pa√≠s y son distintos en cada uno, e incluso cambian en el tiempo: se crean nuevos, desaparecen otros, y algunos cambian de fecha entre a√±o y a√±o.\nMenos mal que en R existe un paquete para todo üòå El paquete {RQuantLib} contiene la informaci√≥n de calendarios de much√≠simos pa√≠ses del mundo. A su vez, el paquete {bizdays} te permite tomar esa informaci√≥n de los calendarios y usarlos para el c√°lculo de d√≠as h√°biles entre fechas:\nbizdays::load_quantlib_calendars( \u0026#34;Chile\u0026#34;, from = \u0026#34;2023-01-01\u0026#34;, to = \u0026#34;2025-12-31\u0026#34;) Calendar QuantLib/Chile loaded calendars() # confirmar que el calendario est√° cargado Calendars: actual, Brazil/ANBIMA, Brazil/B3, Brazil/BMF, QuantLib/Chile, weekends Ahora que tenemos un calendario de los d√≠as feriados en Chile cargado en R, usamos la funci√≥n bizdays() del paquete del mismo nombre para calcular la cantidad de d√≠as h√°biles entre ambas fechas, especificando el calendario que queremos usar:\nbizdays(fecha_hoy, fecha_anterior, \u0026#34;QuantLib/Chile\u0026#34;) [1] -8 En este caso, el resultado es 8, porque a los 14 d√≠as que hab√≠an entre ambas fechas le resta dos fines de semana (4 d√≠as), y adem√°s le resta dos d√≠as feriados oficiales en Chile (d√≠a de las Iglesias Evang√©licas el 31 de octubre y el D√≠a de todos los santos el 1 de noviembre).\nRepitamos el mismo ejemplo, pero ahora en una peque√±a tabla de datos ficticios:\ndatos \u0026lt;- tibble::tribble( ~n, ~fecha, ~fecha_hoy, \u0026#34;16831\u0026#34;, \u0026#34;2024-02-19\u0026#34;, \u0026#34;2024-11-13\u0026#34;, \u0026#34;40003\u0026#34;, \u0026#34;2024-01-12\u0026#34;, \u0026#34;2024-11-13\u0026#34;, \u0026#34;90667\u0026#34;, \u0026#34;2024-04-06\u0026#34;, \u0026#34;2024-11-13\u0026#34;, \u0026#34;80205\u0026#34;, \u0026#34;2024-10-07\u0026#34;, \u0026#34;2024-11-13\u0026#34;, \u0026#34;14457\u0026#34;, \u0026#34;2024-08-30\u0026#34;, \u0026#34;2024-11-13\u0026#34; ) En este ejemplo, primero calculamos la diferencia normal entre d√≠as, arreglamos el resultado de la diferencia de tiempo para formar los n√∫meros comunes, y luego calculamos la diferencia entre d√≠as h√°biles, para poder comparar:\ndatos |\u0026gt; mutate(dias_comunes = difftime(fecha, fecha_hoy), dias_comunes = dias_comunes |\u0026gt; as.numeric() |\u0026gt; abs() |\u0026gt; round(0), dias_habiles = bizdays(fecha, fecha_hoy, \u0026#34;QuantLib/Chile\u0026#34;) ) # A tibble: 5 √ó 5 n fecha fecha_hoy dias_comunes dias_habiles \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 16831 2024-02-19 2024-11-13 268 181 2 40003 2024-01-12 2024-11-13 306 207 3 90667 2024-04-06 2024-11-13 221 147 4 80205 2024-10-07 2024-11-13 37 25 5 14457 2024-08-30 2024-11-13 75 48 Contar la cantidad de d√≠as de semana entre dos fechas Naturalmente, existe otra forma de hacer esto, mucho m√°s b√°sica. Consiste en crear una secuencia con todas las fechas que hay entre las dos fechas, e ir evaluando si cada una de esas fechas cae el d√≠a de semana o en fin de semana.\nPrimero creamos la secuencia de fechas:\nsecuencia \u0026lt;- seq.Date(fecha_anterior, fecha_hoy, by = \u0026#34;days\u0026#34;) secuencia [1] \u0026quot;2024-10-31\u0026quot; \u0026quot;2024-11-01\u0026quot; \u0026quot;2024-11-02\u0026quot; \u0026quot;2024-11-03\u0026quot; \u0026quot;2024-11-04\u0026quot; [6] \u0026quot;2024-11-05\u0026quot; \u0026quot;2024-11-06\u0026quot; \u0026quot;2024-11-07\u0026quot; \u0026quot;2024-11-08\u0026quot; \u0026quot;2024-11-09\u0026quot; [11] \u0026quot;2024-11-10\u0026quot; \u0026quot;2024-11-11\u0026quot; \u0026quot;2024-11-12\u0026quot; \u0026quot;2024-11-13\u0026quot; \u0026quot;2024-11-14\u0026quot; Luego utilizamos la funci√≥n wday() para saber en qu√© d√≠a de la semana cae cada una de las fechas, indicando que queremos que el d√≠a lunes sea equivalente a 1, por lo que el fin de semana corresponder√≠a a los n√∫meros 6 y 7:\nsecuencia_dias \u0026lt;- lubridate::wday(secuencia, week_start = 1) secuencia_dias [1] 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 En esta secuencia, cada n√∫mero corresponde a una de las fechas del vector anterior, y el n√∫mero representa el d√≠a de la semana: el n√∫mero 4 es jueves, el n√∫mero 5 es viernes, el n√∫mero 6 es s√°bado, y as√≠ sucesivamente.\nFinalmente, s√≥lo queda evaluar cuales de las fechas son d√≠as a menores o iguales a 5 (es decir, d√≠as de semana y no s√°bado ni domingo)\nsecuencia_dias \u0026lt;= 5 [1] TRUE TRUE FALSE FALSE TRUE TRUE TRUE TRUE TRUE FALSE FALSE TRUE [13] TRUE TRUE TRUE La comparaci√≥n retorna verdadero cuando el n√∫mero es menor igual a cinco, y falso cuando es mayor o igual. O sea, verdadero cuando es d√≠a de semana, y falso cu√°ndo es fin de semana.\nLuego contamos la cantidad de d√≠as que coinciden con la condici√≥n dada, y listo.\nsum(secuencia_dias \u0026lt;= 5) [1] 11 Obtenemos que entre el 13 de noviembre y el 30 de octubre de 2024 hay 11 d√≠as de semana (es decir, d√≠as entre lunes y viernes).\n","date":"2024-11-13T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/contar_dias_habiles/","tags":"limpieza de datos ; procesamiento de datos ; fechas","title":"Contar d√≠as h√°biles entre dos fechas en R"},{"content":"En este post dejo algunos de los paquetes y funciones que uso frecuentemente al momento de limpiar datos en R. Voy a ir actualizando este post por si se me van ocurriendo m√°s.\nlibrary(janitor) library(stringr) library(dplyr) library(lubridate) Limpiar nombres de columnas janitor::clean_names() Como su nombre lo indica, esta funci√≥n cambia los nombres de las variables o columnas para estandarizar la forma en que est√°n escritas: todo en min√∫sculas, sin espacios, sin s√≠mbolos, y las palabras separadas con gui√≥n bajo. Esto facilita mucho el trabajo con datos, ya que minimiza las probabilidades de qu√© te equivoques al escribir el nombre de una columna. Personalmente siempre ocupo esta funci√≥n al momento de cargar datos, sobre todo si estos datos vienen desde Excel. Lo √∫nico malo de clean_names() es que esta funci√≥n tambi√©n cambia las e√±es por enes.\nCorregir tablas sin nombres de columnas janitor::row_to_names() Esta funci√≥n soluciona un problema bastante com√∫n al cargar datos desde Excel, que es que las planillas de datos de Excel suelen venir con filas vac√≠as arriba. Esto porque los usuarios de Excel les gusta darle un espaciado a las tablas, pero al momento de cargar esos datos, las filas vac√≠as producen problemas.\nEliminar filas y columnas vac√≠as janitor::remove_empty() Una funci√≥n muy conveniente para limpiar datos, porque permite eliminar con una sola instrucci√≥n las filas vac√≠as, o las columnas vac√≠as. En Excel es com√∫n separar distintas tablas con filas o columnas vac√≠as, o usar filas vac√≠as o columnas vac√≠as para hacer espacio entre los datos. De este modo, todas las columnas y celdas de nuestra tabla de datos contendr√°n informaci√≥n.\nFiltrar datos seg√∫n un patr√≥n de texto filter(stringr::str_detect()) La combinaci√≥n de estas dos funciones permite filtrar las filas que contengan un texto parcial. Se puede usar para excluir filas que contengan un cierto patr√≥n de texto si se le antepone un signo de exclamaci√≥n\nBuscar y reemplazar texto stringr::str_replace() A esta funci√≥n se le entrega una columna, y dos textos: el texto que queremos detectar, y despu√©s el texto que queremos reemplazar. De esta forma, podemos encontrar ciertos patrones de texto y reemplazarlos por otros, facilitando procesos de limpieza que involucren corregir cosas mal escritas, cambiar ciertos s√≠mbolos por otros, etc.\nCreaci√≥n de variables co m√∫ltiples condicionales case_when() Es una funci√≥n muy poderosa para poder crear nuevas variables en base al contenido de otras variables. Su potencial radica en la facilidad que te entrega para utilizar m√∫ltiples condiciones simult√°neas para especificar las categor√≠as de la nueva variable. Por ejemplo, si una cierta celda contiene un n√∫mero, puedes hacer una operaci√≥n. Pero si no contiene n√∫meros, puedes hacer otra. Pero si el n√∫mero tiene cierto largo puede ser algo distinto, etc.\nCorregir may√∫sculas de un texto stringr::str_to_sentence() El uso de may√∫sculas suele ser un problema al trabajar con datos, pero esta funci√≥n, junto con sus funciones hermanas, facilitan transformar las may√∫sculas de cualquier texto. Con str_to_sentence() se pone solamente la primera letra de una oraci√≥n con may√∫scula y el resto en min√∫sculas. Mientras str_to_upper() y str_to_lower() transforman todo a may√∫sculas o todo a min√∫sculas, respectivamente.\nExtraer un patr√≥n de texto stringr::str_extract() La extracci√≥n de texto resulta muy √∫til cuando la combinas con expresiones regulares (regex). Te permite, por ejemplo, extraer la primera palabra de una cadena de texto, o la √∫ltima palabra. Te permite extraer distintas formas de escribir un mismo concepto. Te permite extraer textos que empiecen con algo y terminen con otro t√©rmino, independiente del texto que haya entre ambos extremos.\nExtraer a√±os desde un texto stringr::str_extract(\u0026#34;\\\\d{4}\u0026#34;) Una tarea com√∫n al limpiar datos es poder extraer el a√±o que puede venir dentro de una columna de una fecha, de una variable de texto, o de un texto distinto que incluye alguna fecha dentro de s√≠. Con esta expresi√≥n de regex podemos extraer una cifra num√©rica de cuatro d√≠gitos, que en la mayor√≠a de los casos corresponde al a√±o que queremos obtener.\nConvertir fechas lubridate::dmy() Una confusi√≥n com√∫n al trabajar con R ocurre cuando intentan nacer una operaci√≥n sobre una columna que no permite ese tipo de operaciones. Como sumar n√∫meros que en realidad son variables de formato texto. Lo mismo pasa con las fechas, que suelen ser expresadas en texto, pero que necesitan ser interpretadas como una fecha para poder realizar operaciones propias de una fecha, como calcular rangos de tiempo, sumar o restar d√≠as, extraer meses o a√±os, saber el d√≠a de la semana, etc. Con esta funci√≥n, es tan sencillo como indicar que la fecha viene expresada en d√≠a mes a√±o, o si viene como a√±o mes d√≠a, usar la variante ymd().\nRenombrar todas las columnas iris |\u0026gt; rename_with(~str_trunc(.x, 7, ellipsis = \u0026#34;\u0026#34;), everything()) ¬øTienes alguna otra funci√≥n o paquete de R que uses regularmente para limpiar datos? Cu√©ntame en los comentarios üòä\n","date":"2024-11-13T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/limpieza_tips/","tags":"consejos ; limpieza de datos ; texto","title":"Tips para limpieza de datos en R"},{"content":"Este post ejemplifica tres formas de cargar y explorar los datos de la encuesta Casen 2022, la Encuesta de caracterizaci√≥n socioecon√≥mica nacional.\nVeremos c√≥mo obtener resultados de la Casen a nivel de pa√≠s, regi√≥n y comuna, usando dos formas de aplicar el factor de expansi√≥n. El factor de expansi√≥n es necesario de aplicar para transformar los resultados de la muestra de la encuesta a cifras que tienen representaci√≥n a los distintos niveles de agrupaci√≥n geogr√°fica.\nPara seguir las instrucciones, primero debes descargar los datos originales de la encuesta desde este enlace (presionar Bases de datos) en formato Stata, junto con la base de datos complementaria de provincia y comuna. Crea un nuevo proyecto de RStudio, y dentro de la carpeta del proyecto ubica ambos archivos.\nLos archivos necesarios son:\nBase de datos Casen 2022 STATA (versi√≥n 18 de marzo 2024) Base de datos provincia y comuna Casen 2022 STATA Primero, cargamos los paquetes que usaremos a trav√©s de este tutorial:\nlibrary(haven) # carga datos formato Stata (.dta) library(dplyr) # manipulaci√≥n de datos library(tidyr) # ordenamiento y limpieza de datos library(srvyr) # an√°lisis de encuestas complejas, entre otros library(scales) # crear porcentajes a partir de proporciones Cargar datos de Casen Cargar base de datos principal de la encuesta Casen, en formato Stata (.dta):\ncasen \u0026lt;- read_dta(\u0026#34;Base de datos Casen 2022 STATA.dta\u0026#34;) Explorar los datos cargados:\ncasen |\u0026gt; select(1:20) |\u0026gt; glimpse() Rows: 202,231 Columns: 20 $ id_vivienda \u0026lt;dbl\u0026gt; 1000901, 1000901, 1000901, 1000902, 1000902, 1000902, 100‚Ä¶ $ folio \u0026lt;dbl\u0026gt; 100090101, 100090101, 100090101, 100090201, 100090201, 10‚Ä¶ $ id_persona \u0026lt;dbl\u0026gt; 1, 2, 3, 1, 2, 3, 4, 1, 2, 3, 1, 2, 1, 1, 2, 3, 4, 1, 2, ‚Ä¶ $ region \u0026lt;dbl+lbl\u0026gt; 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 1‚Ä¶ $ area \u0026lt;dbl+lbl\u0026gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,‚Ä¶ $ cod_upm \u0026lt;dbl\u0026gt; 10009, 10009, 10009, 10009, 10009, 10009, 10009, 10009, 1‚Ä¶ $ nse \u0026lt;dbl+lbl\u0026gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,‚Ä¶ $ estrato \u0026lt;dbl\u0026gt; 1630324, 1630324, 1630324, 1630324, 1630324, 1630324, 163‚Ä¶ $ hogar \u0026lt;dbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶ $ expr \u0026lt;dbl\u0026gt; 43, 43, 44, 51, 51, 52, 51, 42, 42, 42, 38, 38, 33, 56, 5‚Ä¶ $ expr_osig \u0026lt;dbl\u0026gt; 54, NA, 122, NA, 131, NA, 44, 101, 47, NA, 81, 56, 43, 84‚Ä¶ $ varstrat \u0026lt;dbl\u0026gt; 751, 751, 751, 751, 751, 751, 751, 751, 751, 751, 751, 75‚Ä¶ $ varunit \u0026lt;dbl\u0026gt; 12041, 12041, 12041, 12041, 12041, 12041, 12041, 12041, 1‚Ä¶ $ fecha_entrev \u0026lt;date\u0026gt; 2023-01-28, 2023-01-28, 2023-01-28, 2022-12-29, 2022-12-‚Ä¶ $ p1 \u0026lt;dbl+lbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,‚Ä¶ $ p2 \u0026lt;dbl+lbl\u0026gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,‚Ä¶ $ p3 \u0026lt;dbl+lbl\u0026gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,‚Ä¶ $ p4 \u0026lt;dbl+lbl\u0026gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,‚Ä¶ $ p9 \u0026lt;dbl\u0026gt; 3, 3, 3, 4, 4, 4, 4, 3, 3, 3, 2, 2, 1, 4, 4, 4, 4, 2, 2, ‚Ä¶ $ p10 \u0026lt;dbl+lbl\u0026gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, NA, ‚Ä¶ Notamos que las columnas que corresponden a preguntas de la encuesta vienen en formato \u0026lt;bls+lbl\u0026gt;, un formato propio del paquete {haven}, que combina los valores num√©ricos de las variables con las etiquetas de sus categor√≠as de respuesta.\nCargar la base de datos complementaria que contiene columnas de factor de expansi√≥n, comuna y provincia:\ncasen_comunas \u0026lt;- read_dta(\u0026#34;Base de datos provincia y comuna Casen 2022 STATA.dta\u0026#34;) Revisar contenidos del segundo archivo:\ncasen_comunas # A tibble: 202,231 √ó 6 folio id_persona provincia comuna expp expc \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 100090101 1 163 [Punilla] 16303 [√ëiqu√©n] 51 52 2 100090101 2 163 [Punilla] 16303 [√ëiqu√©n] 50 53 3 100090101 3 163 [Punilla] 16303 [√ëiqu√©n] 51 52 4 100090201 1 163 [Punilla] 16303 [√ëiqu√©n] 51 52 5 100090201 2 163 [Punilla] 16303 [√ëiqu√©n] 50 52 6 100090201 3 163 [Punilla] 16303 [√ëiqu√©n] 51 52 7 100090201 4 163 [Punilla] 16303 [√ëiqu√©n] 51 52 8 100090301 1 163 [Punilla] 16303 [√ëiqu√©n] 51 52 9 100090301 2 163 [Punilla] 16303 [√ëiqu√©n] 51 52 10 100090301 3 163 [Punilla] 16303 [√ëiqu√©n] 51 52 # ‚Ñπ 202,221 more rows Ahora que tenemos cargadas la base de datos principal de la encuesta, y la base secundaria que contiene las columnas sobre datos comunales, debemos unir ambas a partir de las variables que identifican las observaciones √∫nicas de la encuesta: folio e id_persona.\ncasen_2 \u0026lt;- left_join(casen, casen_comunas, by = join_by(folio, id_persona)) Obtenemos un nuevo dataframe que contiene las columnas de ambas bases. Debemos confirmar que la uni√≥n se realiz√≥ correctamente, comparando que la cantidad de filas de la base resultante sea igual a la de la base original.\nObtener frecuencias y porcentajes de variables de la Casen A modelo creativo, realizaremos tres formas distintas de obtener conteos de variables a partir de la encuesta. Con esto nos referimos, por ejemplo, a obtener la cantidad de casos bajo cada nivel de pobreza econ√≥mica, calcular la frecuencia de cada nivel educacional, etc.\nConteo sin aplicar factor de expansi√≥n Primero realizaremos un conteo b√°sico de los casos de una variable, sin realizar ninguna consideraci√≥n metodol√≥gica respecto al muestreo de la encuesta. Es decir, solamente contar las filas de la base de datos. Esto lo haremos a pesar de ser incorrecto porque es la forma m√°s b√°sica de realizar la operaci√≥n, y tambi√©n para poder compararlo m√°s adelante a las formas correctas de contar los casos en la encuesta que Casen.\nContar la frecuencia de una variable a nivel nacional, sin factor de expansi√≥n (inexacto):\ncasen_2 |\u0026gt; count(pobreza) |\u0026gt; mutate(p = round(n/sum(n), 2)) |\u0026gt; mutate(porcentaje = percent(p)) # A tibble: 4 √ó 4 pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 4657 0.02 2% 2 2 [Pobreza no extrema] 10616 0.05 5% 3 3 [No pobreza] 186838 0.92 92% 4 NA 120 0 0% Contar la frecuencia de una variable a nivel regional, sin factor de expansi√≥n (inexacto):\ncasen_2 |\u0026gt; group_by(region) |\u0026gt; count(pobreza) |\u0026gt; mutate(p = round(n/sum(n), 2)) |\u0026gt; mutate(porcentaje = percent(p)) # A tibble: 63 √ó 5 # Groups: region [16] region pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Regi√≥n de Tarapac√°] 1 [Pobreza extrema] 300 0.03 3% 2 1 [Regi√≥n de Tarapac√°] 2 [Pobreza no extrema] 589 0.07 7% 3 1 [Regi√≥n de Tarapac√°] 3 [No pobreza] 7798 0.9 90% 4 1 [Regi√≥n de Tarapac√°] NA 4 0 0% 5 2 [Regi√≥n de Antofagasta] 1 [Pobreza extrema] 265 0.03 3% 6 2 [Regi√≥n de Antofagasta] 2 [Pobreza no extrema] 462 0.05 5% 7 2 [Regi√≥n de Antofagasta] 3 [No pobreza] 8300 0.92 92% 8 2 [Regi√≥n de Antofagasta] NA 2 0 0% 9 3 [Regi√≥n de Atacama] 1 [Pobreza extrema] 250 0.03 3% 10 3 [Regi√≥n de Atacama] 2 [Pobreza no extrema] 507 0.06 6% # ‚Ñπ 53 more rows Contar la frecuencia de una variable a nivel comunal, sin factor de expansi√≥n (inexacto):\ncasen_2 |\u0026gt; filter(region == 13) |\u0026gt; select(-region) |\u0026gt; group_by(comuna) |\u0026gt; count(pobreza) |\u0026gt; mutate(p = round(n/sum(n), 2)) |\u0026gt; mutate(porcentaje = percent(p)) # A tibble: 155 √ó 5 # Groups: comuna [52] comuna pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 13101 [Santiago] 1 [Pobreza extrema] 50 0.03 3% 2 13101 [Santiago] 2 [Pobreza no extrema] 58 0.03 3% 3 13101 [Santiago] 3 [No pobreza] 1685 0.94 94% 4 13102 [Cerrillos] 1 [Pobreza extrema] 17 0.04 4% 5 13102 [Cerrillos] 2 [Pobreza no extrema] 8 0.02 2% 6 13102 [Cerrillos] 3 [No pobreza] 376 0.94 94% 7 13103 [Cerro Navia] 1 [Pobreza extrema] 6 0.01 1% 8 13103 [Cerro Navia] 2 [Pobreza no extrema] 7 0.01 1% 9 13103 [Cerro Navia] 3 [No pobreza] 542 0.98 98% 10 13104 [Conchal√≠] 1 [Pobreza extrema] 21 0.04 4% # ‚Ñπ 145 more rows Conteo usando factor de expansi√≥n Para aplicar el factor de expansi√≥n a la base de datos, usamos las columnas expr y expc, que contienen el factor de expansi√≥n regional y comunal, respectivamente. En t√©rminos sencillos, esta cifra indica la cantidad de personas que debiese representar cada observaci√≥n de la encuesta, si se pretende que la encuesta represente a la poblaci√≥n real.\nPrimero seleccionamos las columnas de la base que utilizaremos:\ncasen_3 \u0026lt;- casen_2 |\u0026gt; select(region, comuna, pobreza, starts_with(\u0026#34;exp\u0026#34;)) Aplicaremos el factor de expansi√≥n usando la funci√≥n uncount() del paquete {tidyr}, que b√°sicamente multiplica las filas por el factor de expansi√≥n indicado en una variable. Por ejemplo, si una fila de la base tiene un factor de expansi√≥n 53, entonces al aplicar uncount(), dicha fila se repetir√° 53 veces.\nEsto significa que nuestra base de datos aumentar√° considerablemente su tama√±o, potencialmente alcanzando la cantidad de filas cercana a la poblaci√≥n nacional. Esta puede ser una cantidad de datos demasiado grande para ciertos computadores, por lo que se recomienda primero filtrar por la regi√≥n o comuna que se utilizar√° para el an√°lisis.\ncasen_antofagasta \u0026lt;- casen_3 |\u0026gt; filter(region == 2) Realizar expansi√≥n de las filas de la base filtrada. N√≥tese la cantidad de observaciones que resulta de este procedimiento.\nlibrary(tidyr) casen_antofagasta_exp \u0026lt;- casen_antofagasta |\u0026gt; # aplicar factor de expansi√≥n uncount(expc) casen_antofagasta_exp # A tibble: 710,691 √ó 6 region comuna pobreza expr expr_osig expp \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 2 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 3 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 4 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 5 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 6 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 7 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 8 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 9 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 10 2 [Regi√≥n de Antofagasta] 2201 [Calama] 3 [No pobreza] 67 81 68 # ‚Ñπ 710,681 more rows Obtener frecuencia y porcentaje de una variable de la Casen, a nivel regional, aplicando factor de expansi√≥n:\ncasen_antofagasta_exp |\u0026gt; # contar variable count(pobreza) |\u0026gt; # calcular porcentaje mutate(p = n/sum(n)) |\u0026gt; mutate(porcentaje = percent(p)) # A tibble: 4 √ó 4 pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 19131 0.0269 2.7% 2 2 [Pobreza no extrema] 34907 0.0491 4.9% 3 3 [No pobreza] 656560 0.924 92.4% 4 NA 93 0.000131 0.0% Obtener frecuencia y porcentaje de una variable de la Casen, a nivel comunal, aplicando factor de expansi√≥n:\ncasen_antofagasta_exp |\u0026gt; # agrupar por comuna group_by(region, comuna) |\u0026gt; # contar variable count(pobreza) |\u0026gt; # calcular porcentaje mutate(p = n/sum(n)) |\u0026gt; mutate(porcentaje = percent(p)) # A tibble: 24 √ó 6 # Groups: region, comuna [8] region comuna pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+l\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 2 [Regi√≥n de Antofagasta] 2101 [Antofagast‚Ä¶ 1 [Pob‚Ä¶ 12108 0.0276 2.8% 2 2 [Regi√≥n de Antofagasta] 2101 [Antofagast‚Ä¶ 2 [Pob‚Ä¶ 18767 0.0428 4.3% 3 2 [Regi√≥n de Antofagasta] 2101 [Antofagast‚Ä¶ 3 [No ‚Ä¶ 408071 0.930 93.0% 4 2 [Regi√≥n de Antofagasta] 2102 [Mejillones] 1 [Pob‚Ä¶ 95 0.00613 0.6% 5 2 [Regi√≥n de Antofagasta] 2102 [Mejillones] 2 [Pob‚Ä¶ 449 0.0290 2.9% 6 2 [Regi√≥n de Antofagasta] 2102 [Mejillones] 3 [No ‚Ä¶ 14955 0.965 96.5% 7 2 [Regi√≥n de Antofagasta] 2103 [Sierra Gor‚Ä¶ 1 [Pob‚Ä¶ 39 0.0218 2.2% 8 2 [Regi√≥n de Antofagasta] 2103 [Sierra Gor‚Ä¶ 2 [Pob‚Ä¶ 65 0.0364 3.6% 9 2 [Regi√≥n de Antofagasta] 2103 [Sierra Gor‚Ä¶ 3 [No ‚Ä¶ 1684 0.942 94.2% 10 2 [Regi√≥n de Antofagasta] 2104 [Taltal] 1 [Pob‚Ä¶ 1045 0.0752 7.5% # ‚Ñπ 14 more rows Obtener frecuencia y porcentaje de una variable creada a partir de la Casen, aplicando factor de expansi√≥n. Para este ejemplo, crearemos una nueva variable que unifique los dos niveles de pobreza en uno solo, generando una variable econ√≥mica pobre/no pobre:\ncasen_antofagasta_exp |\u0026gt; # crear variable dicot√≥mica mutate(pobreza_2 = ifelse(pobreza %in% c(1, 2), \u0026#34;pobre\u0026#34;, \u0026#34;no pobre\u0026#34;)) |\u0026gt; # conteo group_by(region, comuna) |\u0026gt; count(pobreza_2) |\u0026gt; # calcular porcentaje group_by(region, comuna) |\u0026gt; mutate(p = n/sum(n)) |\u0026gt; mutate(porcentaje = percent(p)) |\u0026gt; # filtrar filter(pobreza_2 == \u0026#34;pobre\u0026#34;) # A tibble: 7 √ó 6 # Groups: region, comuna [7] region comuna pobreza_2 n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 2 [Regi√≥n de Antofagasta] 2101 [Antofagasta] pobre 30875 0.0703 7% 2 2 [Regi√≥n de Antofagasta] 2102 [Mejillones] pobre 544 0.0351 4% 3 2 [Regi√≥n de Antofagasta] 2103 [Sierra Gord‚Ä¶ pobre 104 0.0582 6% 4 2 [Regi√≥n de Antofagasta] 2104 [Taltal] pobre 2423 0.174 17% 5 2 [Regi√≥n de Antofagasta] 2201 [Calama] pobre 15445 0.0793 8% 6 2 [Regi√≥n de Antofagasta] 2203 [San Pedro d‚Ä¶ pobre 394 0.0363 4% 7 2 [Regi√≥n de Antofagasta] 2301 [Tocopilla] pobre 4253 0.150 15% Conteo de encuestas de muestreo complejo Usando el paquete {srvyr} podemos crear un objeto de dise√±o de encuestas complejas, que utilice variables acerca del dise√±o y muestreo de la Casen para poder calcular correctamente los estad√≠sticos que necesitemos, incluyendo la aplicaci√≥n del factor de expansi√≥n.\nEstablecer el dise√±o de encuestas complejas para la Casen:\nlibrary(srvyr) casen_svy \u0026lt;- casen_2 |\u0026gt; as_survey(weights = expr, strata = estrato, ids = id_persona, nest = TRUE) Luego, podemos utilizar este dise√±o para calcular frecuencias y porcentajes, entre otros, de la forma metodol√≥gicamente correcta.\nCalcular frecuencia y porcentaje de una variable a nivel pa√≠s, usando dise√±o de encuestas complejas, con factor de expansi√≥n:\ncasen_svy |\u0026gt; group_by(pobreza) |\u0026gt; summarize(n = survey_total(), p = survey_mean()) |\u0026gt; # select(pobreza, n, p) |\u0026gt; mutate(porcentaje = percent(p, accuracy = 0.01)) # A tibble: 4 √ó 6 pobreza n n_se p p_se porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 397608 12243. 0.0200 0.000432 2.00% 2 2 [Pobreza no extrema] 894216 22302. 0.0450 0.000870 4.50% 3 3 [No pobreza] 18572834 573457. 0.934 0.00118 93.43% 4 NA 13915 1817. 0.000700 0.0000932 0.07% Notamos que √©ste m√©todo de calcular los estad√≠sticos tambi√©n nos ofrece los errores est√°ndar de los conteos y los porcentajes.\nCalcular frecuencia y porcentaje de una variable a nivel regional, usando dise√±o de encuestas complejas, con factor de expansi√≥n:\ncasen_svy |\u0026gt; filter(region == 2) |\u0026gt; group_by(pobreza) |\u0026gt; summarize(n = survey_total(), p = survey_mean()) |\u0026gt; select(pobreza, n, p) |\u0026gt; mutate(porcentaje = percent(p, accuracy = 0.01)) # A tibble: 4 √ó 4 pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 19618 0.0276 2.76% 2 2 [Pobreza no extrema] 34593 0.0487 4.87% 3 3 [No pobreza] 656641 0.924 92.36% 4 NA 69 0.0000971 0.01% Calcular frecuencia y porcentaje de una variable a nivel comunal, usando dise√±o de encuestas complejas, con factor de expansi√≥n:\ncasen_svy |\u0026gt; filter(region == 13) |\u0026gt; group_by(comuna, pobreza) |\u0026gt; summarize(n = survey_total(), p = survey_mean()) |\u0026gt; select(pobreza, n, p) |\u0026gt; mutate(porcentaje = percent(p, accuracy = 0.01)) |\u0026gt; print(n = 15) Adding missing grouping variables: `comuna` # A tibble: 155 √ó 5 # Groups: comuna [52] comuna pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 13101 [Santiago] 1 [Pobreza extrema] 12501 0.0253 2.53% 2 13101 [Santiago] 2 [Pobreza no extrema] 17213 0.0348 3.48% 3 13101 [Santiago] 3 [No pobreza] 465004 0.940 93.99% 4 13102 [Cerrillos] 1 [Pobreza extrema] 3232 0.0406 4.06% 5 13102 [Cerrillos] 2 [Pobreza no extrema] 1336 0.0168 1.68% 6 13102 [Cerrillos] 3 [No pobreza] 75048 0.943 94.26% 7 13103 [Cerro Navia] 1 [Pobreza extrema] 1227 0.0116 1.16% 8 13103 [Cerro Navia] 2 [Pobreza no extrema] 1442 0.0137 1.37% 9 13103 [Cerro Navia] 3 [No pobreza] 102811 0.975 97.47% 10 13104 [Conchal√≠] 1 [Pobreza extrema] 4409 0.0395 3.95% 11 13104 [Conchal√≠] 2 [Pobreza no extrema] 3544 0.0318 3.18% 12 13104 [Conchal√≠] 3 [No pobreza] 103635 0.929 92.87% 13 13105 [El Bosque] 1 [Pobreza extrema] 3998 0.0225 2.25% 14 13105 [El Bosque] 2 [Pobreza no extrema] 8053 0.0454 4.54% 15 13105 [El Bosque] 3 [No pobreza] 165284 0.932 93.20% # ‚Ñπ 140 more rows Repetimos el ejemplo anterior, pero creando una variable dicot√≥mica de pobreza para agrupar los dos niveles de pobreza:\ncasen_svy |\u0026gt; filter(region == 13) |\u0026gt; # crear variable dicot√≥mica mutate(pobreza_2 = ifelse(pobreza %in% c(1, 2), \u0026#34;pobre\u0026#34;, \u0026#34;no pobre\u0026#34;)) |\u0026gt; # calcular group_by(comuna, pobreza_2) |\u0026gt; summarize(n = survey_total(), p = survey_mean()) |\u0026gt; select(pobreza_2, comuna, n, p) |\u0026gt; mutate(porcentaje = percent(p, accuracy = 0.01)) |\u0026gt; filter(pobreza_2 == \u0026#34;pobre\u0026#34;) |\u0026gt; print(n = 15) # A tibble: 52 √ó 5 # Groups: comuna [52] pobreza_2 comuna n p porcentaje \u0026lt;chr\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 pobre 13101 [Santiago] 29714 0.0601 6.01% 2 pobre 13102 [Cerrillos] 4568 0.0574 5.74% 3 pobre 13103 [Cerro Navia] 2669 0.0253 2.53% 4 pobre 13104 [Conchal√≠] 7953 0.0713 7.13% 5 pobre 13105 [El Bosque] 12051 0.0680 6.80% 6 pobre 13106 [Estaci√≥n Central] 9481 0.0454 4.54% 7 pobre 13107 [Huechuraba] 3510 0.0322 3.22% 8 pobre 13108 [Independencia] 12977 0.0703 7.03% 9 pobre 13109 [La Cisterna] 8309 0.0651 6.51% 10 pobre 13110 [La Florida] 13691 0.0289 2.89% 11 pobre 13111 [La Granja] 9140 0.0793 7.93% 12 pobre 13112 [La Pintana] 32563 0.135 13.46% 13 pobre 13113 [La Reina] 2027 0.0159 1.59% 14 pobre 13114 [Las Condes] 1720 0.00574 0.57% 15 pobre 13115 [Lo Barnechea] 705 0.00738 0.74% # ‚Ñπ 37 more rows Realizar conteos obteniendo intervalos de confianza:\ncasen_svy |\u0026gt; filter(region == 2) |\u0026gt; group_by(region, comuna, pobreza) |\u0026gt; summarize(n = survey_total(), p = survey_mean(vartype = c(\u0026#34;se\u0026#34;, \u0026#34;ci\u0026#34;))) # A tibble: 24 √ó 9 # Groups: region, comuna [8] region comuna pobreza n n_se p p_se p_low p_upp \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+l\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 2 [Regi√≥n d‚Ä¶ 2101 [Ant‚Ä¶ 1 [Pob‚Ä¶ 12195 2.83e3 0.0280 0.00455 0.0190 0.0370 2 2 [Regi√≥n d‚Ä¶ 2101 [Ant‚Ä¶ 2 [Pob‚Ä¶ 18947 5.09e3 0.0435 0.00778 0.0281 0.0589 3 2 [Regi√≥n d‚Ä¶ 2101 [Ant‚Ä¶ 3 [No ‚Ä¶ 404323 1.01e5 0.928 0.0120 0.905 0.952 4 2 [Regi√≥n d‚Ä¶ 2102 [Mej‚Ä¶ 1 [Pob‚Ä¶ 68 1.37e1 0.00485 0.00185 0.00119 0.00851 5 2 [Regi√≥n d‚Ä¶ 2102 [Mej‚Ä¶ 2 [Pob‚Ä¶ 409 1.18e2 0.0292 0.00679 0.0157 0.0426 6 2 [Regi√≥n d‚Ä¶ 2102 [Mej‚Ä¶ 3 [No ‚Ä¶ 13552 4.51e3 0.966 0.00791 0.950 0.982 7 2 [Regi√≥n d‚Ä¶ 2103 [Sie‚Ä¶ 1 [Pob‚Ä¶ 22 1.04e1 0.0173 0.00400 0.00936 0.0252 8 2 [Regi√≥n d‚Ä¶ 2103 [Sie‚Ä¶ 2 [Pob‚Ä¶ 44 1.56e1 0.0346 0.00678 0.0212 0.0480 9 2 [Regi√≥n d‚Ä¶ 2103 [Sie‚Ä¶ 3 [No ‚Ä¶ 1207 4.23e2 0.948 0.00761 0.933 0.963 10 2 [Regi√≥n d‚Ä¶ 2104 [Tal‚Ä¶ 1 [Pob‚Ä¶ 1239 2.45e2 0.0768 0.0169 0.0433 0.110 # ‚Ñπ 14 more rows Repetir el ejemplo, pero utilizando otra variable:\ncasen_svy |\u0026gt; filter(region == 2) |\u0026gt; group_by(region, comuna, v4) |\u0026gt; summarize(n = survey_total(), p = survey_mean(vartype = c(\u0026#34;se\u0026#34;, \u0026#34;ci\u0026#34;))) # A tibble: 43 √ó 9 # Groups: region, comuna [8] region comuna v4 n n_se p p_se p_low p_upp \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl+l\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 2 [Regi√≥n ‚Ä¶ 2101 [Ant‚Ä¶ 1 [1. ‚Ä¶ 80318 22990. 0.184 2.70e-2 1.31e-1 0.238 2 2 [Regi√≥n ‚Ä¶ 2101 [Ant‚Ä¶ 2 [2. ‚Ä¶ 321605 80216. 0.739 2.16e-2 6.96e-1 0.781 3 2 [Regi√≥n ‚Ä¶ 2101 [Ant‚Ä¶ 3 [3. ‚Ä¶ 3208 779. 0.00737 7.58e-4 5.87e-3 0.00887 4 2 [Regi√≥n ‚Ä¶ 2101 [Ant‚Ä¶ 4 [4. ‚Ä¶ 11973 2714. 0.0275 2.89e-3 2.18e-2 0.0332 5 2 [Regi√≥n ‚Ä¶ 2101 [Ant‚Ä¶ 5 [5. ‚Ä¶ 17714 5218. 0.0407 8.21e-3 2.44e-2 0.0569 6 2 [Regi√≥n ‚Ä¶ 2101 [Ant‚Ä¶ 6 [6. ‚Ä¶ 647 212. 0.00149 4.79e-4 5.37e-4 0.00243 7 2 [Regi√≥n ‚Ä¶ 2102 [Mej‚Ä¶ 1 [1. ‚Ä¶ 1160 203. 0.0827 1.61e-2 5.09e-2 0.114 8 2 [Regi√≥n ‚Ä¶ 2102 [Mej‚Ä¶ 2 [2. ‚Ä¶ 12285 4296. 0.876 2.17e-2 8.33e-1 0.919 9 2 [Regi√≥n ‚Ä¶ 2102 [Mej‚Ä¶ 5 [5. ‚Ä¶ 548 140. 0.0391 6.54e-3 2.61e-2 0.0520 10 2 [Regi√≥n ‚Ä¶ 2102 [Mej‚Ä¶ 6 [6. ‚Ä¶ 36 36 0.00257 2.68e-3 -2.73e-3 0.00787 # ‚Ñπ 33 more rows Comparaci√≥n de resultados Luego de haber visto tres m√©todos para calcular frecuencias y porcentajes desde la encuesta que hacen utilizando factor de expansi√≥n, para cerrar compararemos los resultados de los tres m√©todos.\nConteo simple, sin expansi√≥n:\ncasen_2 |\u0026gt; filter(region == 5) |\u0026gt; count(pobreza) |\u0026gt; mutate(p = round(n/sum(n), 4)) |\u0026gt; mutate(porcentaje = percent(p)) # A tibble: 4 √ó 4 pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 386 0.0188 1.9% 2 2 [Pobreza no extrema] 958 0.0466 4.7% 3 3 [No pobreza] 19202 0.934 93.4% 4 NA 6 0.0003 0.0% Conteo y porcentaje con factor de expansi√≥n:\ncasen_2 |\u0026gt; filter(region == 5) |\u0026gt; uncount(expr) |\u0026gt; count(pobreza) |\u0026gt; mutate(p = round(n/sum(n), 4)) |\u0026gt; mutate(porcentaje = percent(p, accuracy = 0.001)) # A tibble: 4 √ó 4 pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;int\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 38850 0.0194 1.940% 2 2 [Pobreza no extrema] 92721 0.0463 4.630% 3 3 [No pobreza] 1869211 0.934 93.400% 4 NA 495 0.0002 0.020% Conteo y porcentaje con factor de expansi√≥n y dise√±o de encuesta compleja:\ncasen_svy |\u0026gt; filter(region == 5) |\u0026gt; group_by(pobreza) |\u0026gt; summarize(n = survey_total(), p = survey_mean()) |\u0026gt; select(pobreza, n, p) |\u0026gt; mutate(porcentaje = percent(p, accuracy = 0.001)) # A tibble: 4 √ó 4 pobreza n p porcentaje \u0026lt;dbl+lbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;chr\u0026gt; 1 1 [Pobreza extrema] 38850 0.0194 1.941% 2 2 [Pobreza no extrema] 92721 0.0463 4.633% 3 3 [No pobreza] 1869211 0.934 93.401% 4 NA 495 0.000247 0.025% Los resultados de los tres m√©todos difieren, especialmente los del primer m√©todo con los del segundo y tercero. El segundo y tercer m√©todo solo difieren en sus decimales, pero a√∫n as√≠ es importante comparar ambos y tomar la decisi√≥n apropiada antes de realizar el an√°lisis:\nEl primer m√©todo no debe usarse nunca, pues no aplica correctamente la metodolog√≠a de la encuesta, y sus resultados difieren de la realidad. El segundo m√©todo, usando tidyr::uncount(), si bien puede parecer m√°s conveniente y r√°pido de aplicar, obtiene resultados tiene un peor desempe√±o al obtener los resultados, y consume una muy alta cantidad de memoria para calcular resultados a nivel nacional, o incluso regiones o comunas de gran poblaci√≥n. En computadores con menos de 24 GB de memoria, probablemente no pueda ser posible calcular estad√≠sticos a nivel nacional sin realizar pasos intermediarios para disminuir el consumo de memoria (como separar el c√°lculo por regiones y luego realizar las sumas entre ellas). Entre los tres m√©todos, el m√°s correcto de utilizar es el tercero, usando el paquete {srvyr}. Adem√°s de entregar los resultados con mayor eficiencia y velocidad, aplica correctamente la metodolog√≠a de muestreo especificada por la encuesta, por lo que tambi√©n es el m√©todo m√°s exacto. Si este tutorial te sirvi√≥, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫\n","date":"2024-11-10T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/casen_introduccion/","tags":"dplyr ; Chile ; estad√≠stica ; ciencias sociales ; datos","title":"Cargar y explorar datos de la encuesta Casen en R, usando factor de expansi√≥n"},{"content":"Cuando trabajo con R, siempre intento dejar comentarios sobre de las cosas que estoy haciendo, tanto antes como despu√©s de cada bloque de c√≥digo. As√≠, le hago un favor a mi yo del futuro, dejando una cierta documentaci√≥n de las cosas que estuve haciendo, los objetivos que ten√≠a, y otras aclaraciones sobre los procesos realizados.\nA esta combinaci√≥n de bloques de c√≥digo y p√°rrafos de textos se le llama programaci√≥n literaria, o literate programming.\nOtra buena forma de poder documentar tu c√≥digo, que no sea dejando comentarios en el script, es programar directamente en un notebook o documento Quarto, que combina p√°rrafos de texto enriquecido y titulares con bloques de c√≥digo.\nSin embargo, yo no acostumbro mucho a empezar mis an√°lisis desde un documento Quarto, sino que desde scripts de R. Entonces, cuando quise transformar mis script de R a documentos Quarto para poder publicarlos en este blog, me encontr√© con el fastidio de tener que convertir todos los comentarios a texto, y tener que introducir todos los bloques de c√≥digo dentro de bloques (chunks).\nEl paquete {convertr} permite convertir scripts R a documentos Quarto, y documentos Quarto a scripts de R:\n# instalaci√≥n devtools::install_github(\u0026#34;martinasladek/convertr\u0026#34;) convertr::r_to_qmd( input_dir = \u0026#34;path/to/some_R_script.R\u0026#34;, output_dir = \u0026#34;path/to/new_converted_qmd_file.qmd\u0026#34; ) Usando la funci√≥n anterior, puedo convertir autom√°ticamente mis scripts de R con comentarios a documentos Quarto, donde los comentarios sean p√°rrafos de texto y cada bloque de c√≥digo se ubica en un chunk individual. ¬°Muy conveniente!\n","date":"2024-11-10T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/convertr/","tags":"consejos ; Quarto","title":"Convertir un script de R con comentarios a un documento Quarto"},{"content":"Probando un poco de arte generativo en {ggplot2}. La idea era generar gr√°ficos que parecieran nubes o humo.\nTom√© el dataframe iris, configur√© algunos elementos aleatorios en el gr√°fico, le agregu√© un efecto de desenfoque a los puntos, y luego hice un loop que genera 9 gr√°ficos con par√°metros aleatorios.\nlibrary(dplyr) library(glue) library(ggplot2) library(ggfx) library(purrr) Partimos con un gr√°fico base usando los datos de iris, donde los puntos crecen en base a una variable, y tambi√©n aumentan su transparencia en la misma medida que aumentan su tama√±o. De esta forma, los puntos m√°s grandes son tambi√©n menos visibles.\niris |\u0026gt; ggplot(aes(x = Sepal.Length, y = Sepal.Width, alpha = Petal.Length, size = Petal.Length, color = Sepal.Width)) + geom_point() + theme_void() + scale_size(range = c(2, 5)) + scale_alpha(range = c(.7, .1)) + scale_color_gradient2(low = \u0026#34;red\u0026#34;, mid = \u0026#34;purple\u0026#34;, high = \u0026#34;blue\u0026#34;, midpoint = mean(iris$Sepal.Width)) + theme(legend.position = \u0026#34;none\u0026#34;) + theme(plot.margin = margin(rep(2, 4))) + # margen interior del gr√°fico coord_cartesian(clip = \u0026#34;off\u0026#34;) + theme(plot.background = element_rect(fill = \u0026#34;#EAD1FA\u0026#34;, linewidth = 0)) Luego que tenemos un gr√°fico base, hacemos una prueba aplicando geom_jitter() a los puntos, que hace que la posici√≥n de los puntos sea siempre aleatoria, y cambiamos los rangos de tama√±o y de transparencia:\niris |\u0026gt; ggplot(aes(x = Sepal.Length, y = Sepal.Width, alpha = Petal.Length, size = Petal.Length, color = Sepal.Width)) + geom_jitter(width = 1, height = 1) + theme_void() + scale_size(range = c(8, 70)) + scale_alpha(range = c(.1, .0)) + scale_color_gradient2(low = \u0026#34;red\u0026#34;, mid = \u0026#34;purple\u0026#34;, high = \u0026#34;blue\u0026#34;, midpoint = mean(iris$Sepal.Width)) + theme(legend.position = \u0026#34;none\u0026#34;) + theme(plot.margin = margin(rep(60, 4))) + # margen interior del gr√°fico coord_cartesian(clip = \u0026#34;off\u0026#34;) + theme(plot.background = element_rect(fill = \u0026#34;#EAD1FA\u0026#34;, linewidth = 0)) Ahora que tenemos un gr√°fico de movimiento aleatorio, agregamos a geom_jitter() la funci√≥n with_blur() del paquete {ggfx}, que desenfoca el elemento al que se la apliquemos. As√≠ creamos el efecto de humo o nube:\niris |\u0026gt; ggplot(aes(x = Sepal.Length, y = Sepal.Width, alpha = Petal.Length, size = Petal.Length, color = Sepal.Width)) + geom_jitter(width = 1, height = 1) |\u0026gt; with_blur(sigma = 7) + theme_void() + scale_size(range = c(8, 70)) + scale_alpha(range = c(.1, .0)) + scale_color_gradient2(low = \u0026#34;red\u0026#34;, mid = \u0026#34;purple\u0026#34;, high = \u0026#34;blue\u0026#34;, midpoint = mean(iris$Sepal.Width)) + theme(legend.position = \u0026#34;none\u0026#34;) + theme(plot.margin = margin(rep(60, 4))) + # margen interior del gr√°fico coord_cartesian(clip = \u0026#34;off\u0026#34;) + theme(plot.background = element_rect(fill = \u0026#34;#EAD1FA\u0026#34;, linewidth = 0)) Una vez que tenemos un gr√°fico interesante, le agregamos m√°s par√°metros aleatorios, y lo metemos dentro de purrr::map() para generar muchos gr√°ficos de una sola vez:\nmap(1:9, ~{ # par√°metros aleatorios jitter_x = sample(seq(0.7, 1.2, 0.1), 1) # 1 jitter_y = sample(seq(0.7, 1.2, 0.1), 1) # 1 tama√±o_max = sample(seq(40, 80, 5), 1) # 60 tama√±o_min = sample(seq(5, 20, 5), 1) # 10 centro_color = sample(iris$Sepal.Width, 1) # generar iris |\u0026gt; ggplot(aes(x = Sepal.Length, y = Sepal.Width, alpha = Petal.Length, size = Petal.Length, color = Sepal.Width)) + geom_jitter(width = jitter_x, height = jitter_y) |\u0026gt; with_blur(sigma = 9) + theme_void() + scale_size(range = c(tama√±o_min, tama√±o_max)) + scale_alpha(range = c(.07, .0)) + scale_color_gradient2(low = \u0026#34;red\u0026#34;, mid = \u0026#34;purple\u0026#34;, high = \u0026#34;blue\u0026#34;, midpoint = centro_color) + theme(legend.position = \u0026#34;none\u0026#34;) + theme(plot.margin = margin(rep(60, 4))) + # margen interior del gr√°fico coord_cartesian(clip = \u0026#34;off\u0026#34;) + theme(plot.background = element_rect(fill = \u0026#34;#EAD1FA\u0026#34;, linewidth = 0)) # guardar # ggsave(glue(\u0026#34;nubes/orbe_{sample(111:999, 1)}.png\u0026#34;), # width = 3, height = 3, scale = 2, dpi = 200) }) [[1]] [[2]] [[3]] [[4]] [[5]] [[6]] [[7]] [[8]] [[9]] Si queremos guardar los resultados a una carpeta, agregamos el siguiente c√≥digo dentro de la iteraci√≥n con map() para guardar los gr√°ficos en una carpeta, d√°ndole a los archivos nombres aleatorios para que no se sobreescriban.\n# guardar ggsave(glue(\u0026#34;nubes_{sample(111:999, 1)}.png\u0026#34;), width = 3, height = 3, scale = 2, dpi = 200) ","date":"2024-11-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/ggplot_nubes/","tags":"ggplot2 ; gr√°ficos ; curiosidades ; arte generativo","title":"¬øArte? Nubes aleatorias en `{ggplot2}`"},{"content":"√âste es un post sobre este mismo blog. Quer√≠a compartir el proceso de creaci√≥n del blog, porque me pareci√≥ interesante y entretenido.\nLo cre√© usando Hugo, un generador de sitios web est√°ticos de c√≥digo abierto y gratuito. Hugo se puede usar a trav√©s de R usando {blogdown} y el tema Hugo Ap√©ro, creado por Alison Hill, y as√≠ puedes crear p√°ginas y publicaciones usando Quarto o RMarkdown. De ese modo resulta muy f√°cil integrar las cosas que hagas con R en tu sitio, compartiendo el c√≥digo en los posts.\nLa gu√≠a para aprender a usar Hugo Ap√©ro y dejar tu blog operacional es muy amigable y sencilla de seguir! Lo recomiendo, solo me tom√≥ una tarde. Tiene amplia documentaci√≥n y recursos en su repositorio. Tambi√©n existe el libro, Create, Publish, and Analyze Personal Websites Using R and RStudio, que detalla todas las instrucciones de crear un sitio web con R y Hugo.\nEl sitio web se genera con {blogdown} dentro de un proyecto de R cada vez que hago un cambio en el c√≥digo del sitio. Luego, cuando subo los cambios del sitio a GitHub, Netlifly detecta los cambios, reconstruye el sitio y lo re-publica en minutos. De esta forma, el proceso es de despliegue continuo: cada cambio local que hago, al ser subido al repositorio remoto, gatilla la reconstrucci√≥n del sitio y su actualizaci√≥n en la versi√≥n p√∫blica del sitio web.\nSi bien Netlify te da un dominio .netlify.app, opt√© por un dominio .rbind.io en la p√°gina de Rbind, una comunidad que engloba sitios y blogs sobre R bajo un mismo dominio. Adem√°s, rbind.io se ve m√°s lindo que netlify.app üòå\nLa gracia de un sitio est√°tico es que su contenido online no cambia, porque es un sitio web normal, y por lo tanto es liviano de cargar y debiese ser muy barato o gratis de hostear (no requiere de un servidor con capacidad computacional, como es el caso con las aplicaciones Shiny).\nLa totalidad del c√≥digo de este sitio web est√° disponible en el repositorio blog-r en mi GitHub.\nSobre Hugo Ap√©ro Las instrucciones de Hugo Ap√©ro me parecieron f√°ciles de seguir, lo suficientemente sencillas para que cualquier persona sin experiencia en sitios web (yo) pueda seguirlas. Adem√°s, te presentan ejemplos hermosos de otros blogs que usan el tema.\nLo bueno:\nMuy simple de usar Resultados agradables y profesionales con nada de c√≥digo Todo es 100% gratuito: el generador del sitio (Hugo), la IDE donde hago el sitio (RStudio), el lenguaje que uso para construir el sitio (R), el hosting (Netlify), y el dominio (Rbind). Lo malo\nPoca flexibilidad No encuentro recursos para personalizar detalles Dif√≠cil de encontrar respuestas en internet Dificultades y soluciones Algunas dificultades que tuve con el blog, y c√≥mo las resolv√≠:\nCrear nuevas secciones El blog viene con secciones por defecto (blog, talks, about, projects), y me cost√≥ un poco entender c√≥mo crear nuevas o cambiarles el nombre a las existentes. Luego entend√≠ que las carpetas dentro de content/ se vuelven en secciones si las llamas desde el archivo de configuraci√≥n config.yoml, y que adquieren una apariencia por defecto, pero puedes camibiarla en el front matter de cada una (el archivo _index.md dentro de content/blog, por ejemplo). Carpeta static Carpeta con los elementos est√°ticos que se copian a public y que van a estar disponibles para el resto del sitio, como algunas im√°genes Carpeta public Al principio no entend√≠a por qu√© ten√≠a todo duplicado, pero luego entend√≠ que public es una carpeta que se genera cada vez que actualizas el sitio, y su objetivo es ser literalmente el sitio al cual van a acceder las personas por su navegador web. Pero a esta carpeta s√≥lo se le agregan cosas, no se eliminan, as√≠ que si subiste algo por error tienes que borrarlo manualmente de public (por ejemplo, yo sub√≠ una carpeta con 30 im√°genes siendo que solo estaba usando una) Es seguro borrar todo el contenido de public, porque al guardar un cambio en tu sitio se re-escribe toda esta carpeta desde cero. As√≠ evitas que queden recursos innecesarios en el sitio. Redirects Las redirecciones sirven para que, luego de que consigas una nueva url para tu sitio *.netlify.app, puedas hacer que la gente que entre a la direcci√≥n *.netlify.app sea redireccionada autom√°ticamente a tu nueva url. En mi caso, resirig√≠ desde bastianoleah.netlify.app a https://bastianolea.rbind.io. El dominio que us√© para este sitio, rbind.io, es un servicio de la comunidad R de \u0026ldquo;unir\u0026rdquo; blogs y sitios webs de usuarios/as de R, y puedes pedir en su repositorio que te cedan un subdominio para que lo uses para tu blog. Es muy f√°cil especificar redirecciones creando un archivo llamado _redirects en static: link original y redirecci√≥n. As√≠ evitas que los usuarios entren sin https a tu sitio, y que si entran a una url interna o antigua se les lleve a la url nueva. Quarto documents para crear posts en tu blog Para crear un post a partir de un documento Quarto, solamente tienes que poner en el yaml del documento quarto format: hugo-md. De este modo, el documento se va a renderizar en formato markdown, y si se llama index.md, va a aparecer como un post. Usar Quarto te permite usar {shiny} para construir HTML para tu sitio (por ejemplo, usando div() y otras funciones de Shiny). En los chunks donde uses Shiny debes ponerles #| output: asis para que su resultado salga como HTML y se vea en el sitio. Cambiar textos del formulario de contacto El formulario de contacto aparece en ingl√©s por defecto, y con texto rellenado en los campos (malo para la usabilidad), pero se puede cambiar directamente, modificando el archivo themes/hugo-apero/layouts/partials/shared/contact-form.html. Traducir elementos del sitio Hay varios elementos de texto del sitio que vienen por defecto en ingl√©s, pero pueden ser traducidos si abres los archivos html y modificas \u0026lt;p\u0026gt;El texto dentro de los tags\u0026lt;/p\u0026gt;. Los archivos est√°n en themes/hugo-apero/layouts/. Cambiar formatos de las fechas Hay que navegar los archivos del tema del sitio, en themes/hugo-apero/layouts/, y buscar los elementos que contienen la fecha as√≠: {{ .PublishDate.Format \u0026quot;January 2, 2006\u0026quot; }}, y cambiarlos por el formato de fecha que prefieras, consideando que el d√≠a, mes y a√±o deben ser los que salen en ese formato (2 de enero de 2006). Yo los dej√© as√≠: {{ .PublishDate.Format \u0026quot;2/1/2006\u0026quot; }} Modificar el css En la carpeta assets/scss/ puedes modificar los archivos .scss para alterar manualmente la apariencia de tu sitio. Personalmente cambi√© el archivo assets/scss/_code.scss para modificar la apariencia de los outputs de consola, para que tuvieran fondo oscuro y color distinto, con el siguiente c√≥digo: .pre { overflow-x: auto; overflow-y: hidden; overflow: scroll; background-color: #232137 !important; color: #8A75A3 !important; border: none !important; border-radius: 6px !important; font-weight: 200 !important; font-size: 90% !important; } Crear un post nuevo Encontraba engorroso eso de crear un nuevo archivo index.md para cada post, porque ten√≠a que copiar y pegar las etiquetas y c√≥digo que van al inicio. Pero luego me di cuenta de que hay una funci√≥n de {blogdown} que te crea posts nuevos: # crear un post blogdown::new_post(title = \u0026#34;Nubes aleatorias en ggplot\u0026#34;, subdir = \u0026#34;blog/\u0026#34;, file = \u0026#34;blog/ggplot_nubes/index.md\u0026#34;, # define el \u0026#34;slug\u0026#34;, la direcci√≥n url del post author = \u0026#34;Basti√°n Olea Herrera\u0026#34;, tags = c(\u0026#34;ggplot2\u0026#34;, \u0026#34;gr√°ficos\u0026#34;, \u0026#34;curiosidades\u0026#34;) ) Hacer que se vean las etiquetas en el titular de cada post Si bien las etiquetas o tags de los posts aparecen al final de cada uno, yo quer√≠a que aparecieran debajo de la fecha, en el titular de cada publicaci√≥n. Siguiendo este tutorial, encontr√© el archivo que hay que editar, y el c√≥digo que era necesario agregar: En el archivo themes/hugo-apero/layouts/_default/single.html, que controla el dise√±o de todos los blog posts, agregar:\n{{ with .Params.tags }} \u0026lt;dl class=\u0026#34;f6 lh-copy\u0026#34;\u0026gt; \u0026lt;em\u0026gt;\u0026lt;dd class=\u0026#34;fw5 ml0\u0026#34;\u0026gt;Tags: {{ range . }} \u0026lt;a href=\u0026#34;{{ \u0026#34;tags/\u0026#34; | absURL }}{{ . | urlize }}\u0026#34;\u0026gt;{{ . }}\u0026lt;/a\u0026gt; {{ end }}\u0026lt;/dd\u0026gt;\u0026lt;/em\u0026gt; \u0026lt;/dl\u0026gt; {{ end }} Le agregu√© it√°licas al texto y la palabra \u0026ldquo;Tags\u0026rdquo;, pero puedes poner lo que quieras.\nAhora lo que quiero es hacer que en la p√°gina de tags, que se crea en themes/hugo-apero/layouts/taxonomy/taxonomy.html aparezca el conteo de posts por etiqueta, y se cambia en themes/hugo-apero/layouts/partials/shared/summary.html, pero no me resulta üòî\nHacer que se vean las etiquetas de cada post en la lista de posts del blog Lo mismo que en el paso anterior, solamente que en el archivo themes/hugo-apero/layouts/partials/shared/summary.html, que es el que controla los \u0026ldquo;res√∫menes\u0026rdquo; de cada post que aparecen en la lista de publicaciones del blog. En este caso le saqu√© la palabra \u0026ldquo;Tags\u0026rdquo;. Ordenar una serie de posts por peso, mientras el resto del blog se ordene por fecha Las publicaciones normales de mi blog se ordenan por fecha, con los m√°s nuevos arriba, que es el orden por defecto. Pero en otras categor√≠as del blog, como la serie de posts introductorios a R, quiero que se ordenen por peso; es decir, por una forma de ordenamiento arbitraria dado que las distintas publicaciones tienen un orden de lectura desde lo m√°s b√°sico a lo m√°s avanzado, independiente de la fecha de publicaci√≥n. Recordemos que una serie de posts no es m√°s que una carpeta en content/blog dentro de la cual hay m√°s posts; en este caso, una carpeta llamada r_introduccion donde est√°n todas las publicaciones dentro de dicha serie, junto a un front matter que hace que todas esas publicaciones sean parte de la serie \u0026ldquo;Introducci√≥n a R\u0026rdquo;. Lo primero es entender c√≥mo se construyen las listas de publicaciones en Hugo. Los archivos dentro de la carpeta themes/hugo-apero/layouts/ son los que definen la construcci√≥n de cada p√°gina del sitio. Entre ellas, en themes/hugo-apero/layouts/blog/, los archivos que empiezan con list define en la construcci√≥n de las listas de publicaciones. Cada lista usa un layout predefinido para construirse. Por ejemplo, y por defecto, en content/blog/_index.md se define que el blog se construye con layout: list-sidebar; es decir, el archivo themes/hugo-apero/layouts/list-sidebar.html construye la lista de publicaciones del blog. Comprendiendo lo anterior, si quiero tener una lista de publicaciones distinta, como la serie de posts introductorios a R ordenados por peso y no por fecha, tengo que crear un nuevo layout y definir el front matter (_index.md) de esa serie de publicaciones para que use el nuevo layout. En este layout, definimos que las publicaciones se ordenen por peso cambiando la siguiente l√≠nea: {{ $paginator := .Paginate (where .RegularPagesRecursive \u0026quot;Type\u0026quot; \u0026quot;blog\u0026quot;).ByWeight }}. Originalmente dec√≠a .ByDate.Reverse; es decir, por fecha con m√°s nuevos arriba. En el front matter de la serie de posts definimos que el layout sea layout: list-sidebar-weight, para que use el ordenamiento distinto. Y listo, ahora tienes dos layouts para construir p√°ginas de listas de posts, una ordenada por fecha y otra por peso, entonces el blog se ordena por fecha, pero la serie de posts que necesites puede ordenarse por peso si especificas que use el layout distinto al por defecto. Separar logos de redes sociales de los √≠tems del menu superior Encontraba que los logos de redes sociales estaban muy pegados a el men√∫ de p√°ginas superior del blog, porque cuando uno pon√≠a el Mouse encima de un √≠tem, el subrayado del √≠tem se pon√≠a encima de los logos de redes sociales. El archivo themes/hugo-apero/layouts/partials/header.html construye el header de todo el sitio, as√≠ que bast√≥ con agregar un poco de css antes de {{ partial \u0026quot;shared/social-links.html\u0026quot; . }} para darle un poco m√°s de espacio al rededor de los iconos y que se viera mejor. Crear shortcodes Los shortcodes son atajos que puedes usar para insertar elementos en las publicaciones de tu blog. Como me gusta que las im√°genes aparezcan con esquinas redondeadas y centradas en la p√°gina, en vez de aplicar este estilo CSS a cada imagen manualmente, cre√© un shortcode que simplemente entrega la etiqueta de imagen HTML con el estilo deseado, sin necesidad de escribir HTML. El c√≥digo en los posts queda as√≠: {{\u0026lt; imagen \u0026quot;imagen.jpeg\u0026quot;\u0026gt;}}, y funciona porque en la carpeta layouts/shortcodes/ tengo un archivo HTML llamado igual que el shortcode (imagen.html), que contiene el siguiente c√≥digo:\n\u0026lt;img src=\u0026#34;{{.Get 0}}\u0026#34; style=\u0026#34;border-radius: 7px; width: 80%; max-width: 700px; display: block; margin: auto; margin-bottom: 8px; margin-top: 8px;\u0026#34;\u0026gt; Donde {{.Get 0}} es el lugar donde se entrega el texto que se pone en el shortcode la ruta de la imagen). Entonces, crear shortcodes te permite reutilizar c√≥digo para construir tu sitio; en este caso, el c√≥digo para dar estilo a las im√°genes, o por ejemplo para poner botones bonitos en el sitio. Lo bueno es que si actualizo el shortcode, en todas las p√°ginas que lo us√© se actualiza tambi√©n.\nColumnas Saqu√© unos shortcodes para hacer columnas en los posts de Hugo desde este ejemplo, y las instrucciones de instalaci√≥n est√°n ac√°, que en realidad consisten en descargar el repo y copiar los archivos html a layouts/shortcodes/.\nConsejos Mantengo un archivo .R en el inicio del blog, donde tengo todos los comandos que uso regularmente para el sitio:\nblogdown::serve_site() # previsualizar sitio blogdown::stop_server() # detener previsualizaci√≥n blogdown::stop_server(); blogdown::serve_site() # reiniciar previsualizaci√≥n # crear un post nuevo blogdown::new_post(title = \u0026#34;Nubes aleatorias en ggplot\u0026#34;, subdir = \u0026#34;blog/\u0026#34;, file = \u0026#34;blog/ggplot_nubes/index.md\u0026#34;, author = \u0026#34;Basti√°n Olea Herrera\u0026#34;, tags = c(\u0026#34;ggplot2\u0026#34;, \u0026#34;gr√°ficos\u0026#34;, \u0026#34;curiosidades\u0026#34;) ) # convertir script a Quarto convertr::r_to_qmd( input_dir = \u0026#34;~/R/servel_votaciones/pruebas/genero_candidatos_LLM.R\u0026#34;, output_dir = \u0026#34;~/R/blog/blog-r/content/blog/genero_nombres_llm/codigo.qmd\u0026#34; ) # ver sitio en github usethis::browse_github() Pendientes Igual me quedaron algunas cosas pendientes que no he sabido resolver üòû\nTraducir los meses, no encontr√© c√≥mo cambiarlo üôÅ Conclusiones Quiz√°s voy a escribir un tutorial m√°s detallado sobre c√≥mo hacer un blog.\nCreo que es importante tener un espacio en la web que sea realmente propio, sobre todo considerando que vivimos una √©poca en que casi la totalidad de nuestra presencia online est√° a merced de grandes empresas (Meta con Instagram y Facebook, Microsoft con LinkedIn, Google con todo lo dem√°s), que adem√°s operan en esquemas de mercantilizaci√≥n de nuestros datos. Un sitio web personal perdurar√° las decisiones o quiebres de las empresas en las que actualmente confiamos, y adem√°s nos permite volver un poco a la antigua web, donde las personas eran las due√±as del contenido, sin tener que conectar todo a trackers y plataformas privadas.\n","date":"2024-11-07T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/hugo_blog_nuevo/","tags":"quarto ; blog","title":"Post sobre mi nuevo blog (este mismo)"},{"content":" ‚ö†Ô∏è Este post est√° en construcci√≥n ‚ö†Ô∏è En este tutorial encuentras instrucciones paso a paso para crear un droplet (servidor privado) en Digital Ocean, en el cual puedes subir aplicaciones Shiny, ejecutar RStudio, dejar automatizados procesos recurrentes de an√°lisis de datos o web scraping, y m√°s.\n√çndice Crear una cuenta Crear un proyecto Crear un droplet Configurar droplet Clonar una aplicaci√≥n Configurar Shiny Server Instalar paquetes para Shiny Crear una cuenta Puedes crearte una cuenta con este enlace para obtener $200 de cr√©dito por 60 d√≠as, y mi me llegan $25 üòä\n(necesita medio de pago)\nCrear un proyecto Crear un droplet Buscar en el Marketplace la imagen RStudio\nElegir la configuraci√≥n del droplet\nConfigurar droplet Crear usuario\nadduser usuario adduser usuarioprueba usermod -aG sudo usuarioprueba Para abrir el RStudio instalado en el Droplet: {IP}:8787\nClonar una aplicaci√≥n En el RStudio del droplet Nuevo proyecto Proyecto desde control de versiones https://github.com/bastianolea/estimador_ingresos_trabajo.git O en la Terminal del droplet: git clone {url}\nConfigurar Shiny Server Enlazar la carpeta de la aplicaci√≥n con la carpeta de shiny-server por medio de un enlace simb√≥lico:\nsudo ln -s ~/miaplicacion /srv/shiny-server/ Instalar paquetes para Shiny Desde la consola de Digital Ocean:\nsudo su - shiny R install.packages(\u0026#34;...\u0026#34;) Editar configuraci√≥n de Shiny\nsudo nano /etc/shiny-server/shiny-server.conf Dentro de este archivo, agregar estas opciones:\npreserve_logs true; sanitize_errors false; Guardar usando control+O, cerrar usando control+W.\n","date":"2024-11-06T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_digitalocean/","tags":"Shiny","title":"Tutorial: publicar una app Shiny en Digital Ocean"},{"content":"Al programar algo, siempre existen varias formas de lograr un mismo objetivo. Un criterio para elegir una forma por sobre otra puede ser el rendimiento: si hay dos formas de hacer algo, elegir la forma que se ejecute m√°s r√°pido.1\nPara comparar el rendimiento de distintas expresiones en R, realizamos un benchmark, al cual le entregamos las expresiones que queremos comparar, y nos entregar√° un detalle de su velocidad de ejecuci√≥n, consumo de memoria, y otros.\nComo ejemplo, crearemos un dataframe de 100 millones de filas, con dos variables.\nlibrary(dplyr) # crear datos datos \u0026lt;- tibble(var1 = runif(n = 1e8), var2 = runif(n = 1e8)) datos # A tibble: 100,000,000 √ó 2 var1 var2 \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 0.0725 0.628 2 0.664 0.358 3 0.169 0.119 4 0.0369 0.879 5 0.708 0.546 6 0.607 0.835 7 0.955 0.839 8 0.198 0.197 9 0.564 0.456 10 0.788 0.960 # ‚Ñπ 99,999,990 more rows Pong√°monos en el caso de que queremos filtrar este dataframe, y en consideraci√≥n de su gran tama√±o, queremos ver la forma m√°s veloz de filtrarlo. Para ello, comparamos la evaluaci√≥n de un filtro con {dplyr}, y otro con {base} (las funciones por defecto de R, que usualmente son m√°s r√°pidas).\nUsamos la funci√≥n bench::mark, a la cual le entregamos las expresiones con un nombre para distinguirlas, y le definimos los argumentos check = FALSE para que ignore diferencias en el resultado e iterations para especificar la cantidad de veces que queremos hacer las comparaciones (con m√°s iteraciones nos aseguramos que el desempe√±o sea normal y no influenciado por factores externos de nuestro computador).\n# comparar ejecuci√≥n bench::mark(check = FALSE, iterations = 5, \u0026#34;dplyr\u0026#34; = datos |\u0026gt; filter(var1 \u0026gt; var2), \u0026#34;base\u0026#34; = datos[datos$var1 \u0026gt; datos$var2, ] ) # A tibble: 2 √ó 6 expression min median `itr/sec` mem_alloc `gc/sec` \u0026lt;bch:expr\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;bch:tm\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;bch:byt\u0026gt; \u0026lt;dbl\u0026gt; 1 dplyr 453ms 467ms 2.13 2.42GB 2.98 2 base 331ms 339ms 2.92 1.3GB 1.17 En la comparaci√≥n vemos que dplyr::filter() es aproximadamente 100 milisegundos m√°s lento que un filtro realizado con {base}, pero adem√°s usa casi 1GB m√°s de memoria. Tambi√©n entrega datos como las iteraciones por segundo, es decir, las veces que se ejecutar√≠a cada operaci√≥n por segundo. Todas estas m√©tricas nos podr√≠an ayudar a decidir una opci√≥n por sobre otra.\nmi opini√≥n personal es que, entre valorar tiempo de ejecuci√≥n (que algo corra m√°s r√°pido) y tiempo de desarrollo (lo que te cuesta escribirlo/entenderlo), el tiempo de desarrollo (es decir, tu tiempo como humano o trabajador) es m√°s valioso que tener a un procesador trabajando por m√°s tiempo. En ese sentido, usualmente considero que es mejor la opci√≥n que sea m√°s f√°cil de programar, y tambi√©n m√°s f√°cil de leer e interpretar. Sin embargo, hay casos donde la velocidad puede primar, como es el caso de aplicaciones interactivas (donde la espera se la traspasas a tus usuarios/as), o en c√°lculos con cantidades grandes de datos, donde cada cent√©sima de segundo de ejecuci√≥n se puede multiplicar por millones.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2024-11-05T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/benchmark_ejemplo/","tags":"consejos ; procesamiento de datos ; optimizaci√≥n","title":"Comparar el rendimiento expresiones en R"},{"content":"El Sistema de Informaci√≥n del Mercado Laboral (SIMEL) es una plataforma virtual desarrollada por las instituciones que componen la Mesa para la Coordinaci√≥n de las Estad√≠sticas del Trabajo 1 con el apoyo t√©cnico de la Organizaci√≥n Internacional del Trabajo (OIT).\nEl SIMEL permite obtener informaci√≥n objetiva y actualizada sobre el mercado del trabajo, la que estar√° disponible para investigadores, tomadores de decisiones y la ciudadan√≠a en general.\nRepositorio que permite descargar los datos estad√≠sticos de SIMEL con un solo script, obteniendo cada conjunto de datos en archivos csv individuales.\nEl script simel_scraping.R ejecuta un controlador de Selenium que utiliza Firefox para navegar por el sitio y obtener los datos. Retorna los datos en csv en la carpeta datos/{categoria}/, y los metadatos en la carpeta metadatos.\nNo usa la API porque no entend√≠ c√≥mo usarla ü•≤\n","date":"2024-11-01T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/simel_scraping/","tags":"web scraping ; datos ; Chile ; ciencias sociales","title":"Scraping de datos del Sistema de Informaci√≥n del Mercado Laboral"},{"content":"\nCon motivo de las elecciones municipales, estuve generando algunas visualizaciones ‚Äùen tiempo real‚Äù de los resultados de las elecciones de alcald√≠as. Los datos de conteo de votos los fui obteniendo minuto a minuto mediante web scraping con {RSelenium}, que permite programar un navegador web para que interact√∫e con un sitio como si fuera humano. Entonces, el navegador robot (marioneta, le llaman) iba apretando todos los botones, sin intervenci√≥n de mi parte, para encontrar y copiar los resultados de cada comuna del pa√≠s.\nLos nuevos resultados llegaban con frecuencia, as√≠ que hab√≠a que echar a correr el proceso bajo presi√≥n, cada 10 minutos aprox. Todo iba bien: presionaba ejecutar, el proceso pasaba por todas las comunas, limpiaba los datos y retornaba visualizaciones. Hasta que, en la mitad del conteo, el sitio del Servel cambi√≥! Por alg√∫n motivo, cambiaron a una versi√≥n similar del sitio, pero que internamente funcionaba distinto, entonces se desconfigur√≥ todo el web scraping. Tuve que luchar contra el tiempo para reestablecerlo (terrible para mi, porque estaba aprendiendo Selenium üò≠). Lo otro que me jug√≥ en contra fue que no se me ocurri√≥ automatizar la redacci√≥n de textos y posteo en redes sociales, que al final fue lo que me quit√≥ m√°s tiempo üòí\nTambi√©n falt√≥ hacer visualizaciones m√°s entretenidas, pero se hizo lo que se pudo para una idea que sali√≥ a la r√°pida. Es gratificante hacer andar un flujo largo de procesamiento de datos solo con un par de comandos, desde la obtenci√≥n de los datos hasta que te arroja decenas o cientos de salidas ‚ú®\nPara los nerds, us√© {RSelenium} para un script que recib√≠a un vector de comunas e iteraba por ellas con {furrr}, y retornaba una lista con la tabla de resultados, el p√°rrafo de las mesas escrutadas, y el nombre de la comuna. Luego, otro script de R cargaba el scraping m√°s reciente y limpiaba los datos, calculaba porcentajes, coincid√≠a partidos con sectores pol√≠ticos, correg√≠a a \u0026ldquo;independientes\u0026rdquo; que en realidad tienen sector pol√≠tico claro, arreglaba nombres (Servel usa e√±es pero no tildes, por alguna raz√≥n), interpretaba el texto de las mesas como cifras individuales, sumaba votos nulos y blancos, entre otras cosas. Despu√©s ten√≠a un script desde el que comandaba todos los dem√°s pasos, que para partir borraba todas las salidas antiguas, y seg√∫n las comunas que le ped√≠a, generaba nuevos gr√°ficos/tablas en una carpeta nueva. Sobre los gr√°ficos y tablas, nada interesante, salvo que el alto de los gr√°ficos depend√≠a de la cantidad de candidatos, para que siempre mantuvieran espaciados correctos y no se deformaran si eran muchos o muy pocos candidatos/as.\nFinalmente, el flujo de procesamientos de datos en R gener√≥ 238 gr√°ficos y 240 tablas, de las cuales les comparto algunas. Esa fue mi experiencia intentando generar reportes en tiempo real sobre datos de elecciones. Para la siguiente votaci√≥n espero tener algo m√°s elaborado!\n","date":"2024-10-30T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/elecciones_municipales_2024/","tags":"procesamiento de datos ; web scraping ; visualizaci√≥n de datos ; gr√°ficos ; tablas ; datos ; Chile","title":"Visualizaci√≥n y scraping de resultados en vivo de las elecciones municipales 2024"},{"content":" Recientemente se lanz√≥ el paquete {mall}, que facilita el uso de un LLM (large language model) o modelo de lenguaje de gran tama√±o para analizar texto con IA en un dataframe. Esto significa que, para cualquier dataframe que tengamos, podemos aplicar un modelo de IA a una de sus columnas y recibir sus resultados en una columna nueva.\nPara poder hacer √©sto, primero necitamos tener un modelo LLM instalado localmente en nuestra computadora. Para eso, tenemos que instalar Ollama, y ejecutar la aplicaci√≥n. Ollama tiene que estar abierto para poder proveer del modelo a nuestra sesi√≥n de R.\nLuego, instalamos el paquete {ollamar} en R,, que es una dependencia de {mall}. Usamos {ollamar} para descargar a nuestro equipo el modelo de lenguaje que usaremos:\nlibrary(ollamar) ollamar::pull(\u0026#34;llama3.2\u0026#34;) Con eso hecho, ya puedes usar modelo directamente desde R con {ollamar}, o en un dataframe usando {mall}.\nlibrary(mall) library(dplyr) Attaching package: 'dplyr' The following objects are masked from 'package:stats': filter, lag The following objects are masked from 'package:base': intersect, setdiff, setequal, union Con el siguiente c√≥digo vamos a descargar un dataframe que contiene texto de noticias de Chile, para usarlo como datos de prueba. Los datos provienen de mi repositorio de web scraping y an√°lisis de prensa de Chile.\n# obtener datos de prensa url \u0026lt;- \u0026#34;https://raw.githubusercontent.com/bastianolea/prensa_chile/refs/heads/main/datos/prensa_datos_muestra.csv\u0026#34; datos_prensa \u0026lt;- readr::read_csv2(url, show_col_types = FALSE) ‚Ñπ Using \u0026quot;','\u0026quot; as decimal and \u0026quot;'.'\u0026quot; as grouping mark. Use `read_delim()` for more control. head(datos_prensa) # A tibble: 6 √ó 3 titulo cuerpo fecha \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;date\u0026gt; 1 D√≥lar cierra sus operaciones con leve tendencia alcista y n‚Ä¶ \u0026quot;Este‚Ä¶ 2023-03-10 2 Caso Convenios: Consejo de Defensa del Estado presenta quer‚Ä¶ \u0026quot;El C‚Ä¶ 2023-08-11 3 Nuevo estudio revela que un caf√© con leche tiene prometedor‚Ä¶ \u0026quot;De a‚Ä¶ 2023-01-30 4 Contralor√≠a oficia a 53 municipalidades del pa√≠s por nivele‚Ä¶ \u0026quot;La C‚Ä¶ 2024-01-24 5 Realizan funerales de los dos trabajadores fallecidos en el‚Ä¶ \u0026quot;Dura‚Ä¶ 2024-06-23 6 Partido Comunista vuelve a la conducci√≥n de la FECH: La min‚Ä¶ \u0026quot;‚ÄúCon‚Ä¶ 2023-08-30 Probemos {mall} con 10 noticias al azar, pidi√©ndole al LLM que detecte el sentimiento de cada texto (si es positivo, neutro o negativo):\n# extraer sentimiento de textos datos_sentimiento \u0026lt;- datos_prensa |\u0026gt; select(titulo) |\u0026gt; slice(60:70) |\u0026gt; llm_sentiment(titulo, pred_name = \u0026#34;sentimiento\u0026#34;) datos_sentimiento |\u0026gt; relocate(sentimiento, .before = titulo) # A tibble: 11 √ó 2 sentimiento titulo \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 negative \u0026quot;Ministerio de Desarrollo Social pone fin anticipado a contrato ‚Ä¶ 2 positive \u0026quot;Xi expuso cu√°l es \\\u0026quot;la llave de oro\\\u0026quot; para solucionar los probl‚Ä¶ 3 negative \u0026quot;Multitudinarias protestas en Israel: Exigen dimisi√≥n de Netanya‚Ä¶ 4 negative \u0026quot;Encuesta Cadem: desaprobaci√≥n del Presidente Boric aument√≥ dos ‚Ä¶ 5 negative \u0026quot;Desaparici√≥n de TENS Rosa Lira: Las contradicciones que acusa e‚Ä¶ 6 negative \u0026quot;Ministro Grau por cierre de Sider√∫rgica Huachipato: ‚ÄúNuestro fo‚Ä¶ 7 negative \u0026quot;Pi√±era confirma que no ir√° a La Moneda para el 11S: ‚ÄúEl clima d‚Ä¶ 8 positive \u0026quot;Subsecretaria defiende migraci√≥n de isapres a Fonasa: \\\u0026quot;Fortale‚Ä¶ 9 negative \u0026quot;Ministra Orellana tras cr√≠ticas por no contactar a denunciante ‚Ä¶ 10 negative \u0026quot;Joven fue acusado de grabar ni√±as en la entrada de un colegio e‚Ä¶ 11 negative \u0026quot;Confirman que Jorge Valdivia se reuni√≥ con generales de Carabin‚Ä¶ Otro uso es pedirle que genere res√∫menes de textos. Para ello, usaremos un prompt manual, donde le pedimos expl√≠citamente \u0026quot;resumir en hasta 5 palabras\u0026quot;. El paquete aplicar√° dicha solicitud a cada una de las observaciones en la columna indicada, y retornar√° los resultados en una nueva columna llamada resumen:\n# resumir textos datos_resumidos \u0026lt;- datos_prensa |\u0026gt; select(titulo, cuerpo) |\u0026gt; slice_sample(n = 10) |\u0026gt; mutate(resumen = llm_vec_custom( cuerpo, \u0026#34;resumir en hasta 7 palabras\u0026#34;)) |\u0026gt; select(resumen, titulo) datos_resumidos # A tibble: 10 √ó 2 resumen titulo \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 \u0026quot;Expo Vi√±as Campesinas en Ch√©pica, 27-28 abril.\u0026quot; \u0026quot;Expo ‚Ä¶ 2 \u0026quot;Inflaci√≥n baja en Estados Unidos.\u0026quot; \u0026quot;La te‚Ä¶ 3 \u0026quot;\\\u0026quot;Operaci√≥n Renta 2024 incluye cobro de impuestos arrendamientos\\\u0026quot;.\u0026quot; \u0026quot;Opera‚Ä¶ 4 \u0026quot;Normas para veh√≠culos de Uber.\u0026quot; \u0026quot;\\\u0026quot;Ley‚Ä¶ 5 \u0026quot;Coca Guazzini defiende a Camila Vallejo.\u0026quot; \u0026quot;Coca ‚Ä¶ 6 \u0026quot;Asesinato de dirigente ind√≠gena en Ecuador.\u0026quot; \u0026quot;Conmo‚Ä¶ 7 \u0026quot;Seremi aborda problemas de higiene en restaurante.\u0026quot; \u0026quot;Inici‚Ä¶ 8 \u0026quot;\\\u0026quot;Las empresas de Inteligencia y Consulting piden liquidaci√≥n.\\\u0026quot;\u0026quot; \u0026quot;Grupo‚Ä¶ 9 \u0026quot;Tiroteo en Puente Alto deja muerto y herido.\u0026quot; \u0026quot;Balac‚Ä¶ 10 \u0026quot;Cuerpos sin vida encontrados en Regi√≥n Metropolitana.\u0026quot; \u0026quot;Dos c‚Ä¶ ","date":"2024-10-29T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/introduccion_llm_mall/","tags":"an√°lisis de texto ; inteligencia artificial","title":"Usar un modelo de lenguaje local (LLM) para analizar texto en R"},{"content":"¬øSab√≠as que R tiene un tipo de datos para n√∫meros romanos? Yo tampoco.\nlibrary(dplyr) regiones \u0026lt;- tibble(region = c(\u0026#34;I Regi√≥n de Tarapac√°\u0026#34;, \u0026#34;II Regi√≥n de Antofagasta\u0026#34;, \u0026#34;III Regi√≥n de Atacama\u0026#34;, \u0026#34;IV Regi√≥n de Coquimbo\u0026#34;, \u0026#34;IX Regi√≥n de La Araucan√≠a\u0026#34;, \u0026#34;V Regi√≥n de Valpara√≠so\u0026#34;, \u0026#34;VI Regi√≥n del Libertador General Bernardo O\u0026#39;Higgins\u0026#34;, \u0026#34;VII Regi√≥n del Maule\u0026#34;, \u0026#34;VIII Regi√≥n del B√≠o B√≠o\u0026#34;, \u0026#34;X Regi√≥n de los Lagos\u0026#34;, \u0026#34;XI Regi√≥n de Ays√©n del General Carlos Iba√±ez del Campo\u0026#34;, \u0026#34;XII Regi√≥n de Magallanes y la Ant√°rtica Chilena\u0026#34;, \u0026#34;XIII Regi√≥n Metropolitana\u0026#34;, \u0026#34;XIV Regi√≥n Los R√≠os\u0026#34;, \u0026#34;XV Regi√≥n Arica y Parinacota\u0026#34;, \u0026#34;XVI √ëuble\u0026#34; )) Si extraemos la primera palabra de la variable region, obtenemos solamente el n√∫mero romano.\nregiones_2 \u0026lt;- regiones |\u0026gt; mutate(romano = stringr::str_extract(region, \u0026#34;\\\\w+\u0026#34;)) regiones_2 # A tibble: 16 √ó 2 region romano \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; 1 I Regi√≥n de Tarapac√° I 2 II Regi√≥n de Antofagasta II 3 III Regi√≥n de Atacama III 4 IV Regi√≥n de Coquimbo IV 5 IX Regi√≥n de La Araucan√≠a IX 6 V Regi√≥n de Valpara√≠so V 7 VI Regi√≥n del Libertador General Bernardo O'Higgins VI 8 VII Regi√≥n del Maule VII 9 VIII Regi√≥n del B√≠o B√≠o VIII 10 X Regi√≥n de los Lagos X 11 XI Regi√≥n de Ays√©n del General Carlos Iba√±ez del Campo XI 12 XII Regi√≥n de Magallanes y la Ant√°rtica Chilena XII 13 XIII Regi√≥n Metropolitana XIII 14 XIV Regi√≥n Los R√≠os XIV 15 XV Regi√≥n Arica y Parinacota XV 16 XVI √ëuble XVI Luego, convertimos le damos al n√∫mero romano la clase apropiada:\nregiones_3 \u0026lt;- regiones_2 |\u0026gt; mutate(romano = as.roman(romano)) |\u0026gt; relocate(romano, .before = 1) regiones_3 # A tibble: 16 √ó 2 romano region \u0026lt;roman\u0026gt; \u0026lt;chr\u0026gt; 1 I I Regi√≥n de Tarapac√° 2 II II Regi√≥n de Antofagasta 3 III III Regi√≥n de Atacama 4 IV IV Regi√≥n de Coquimbo 5 IX IX Regi√≥n de La Araucan√≠a 6 V V Regi√≥n de Valpara√≠so 7 VI VI Regi√≥n del Libertador General Bernardo O'Higgins 8 VII VII Regi√≥n del Maule 9 VIII VIII Regi√≥n del B√≠o B√≠o 10 X X Regi√≥n de los Lagos 11 XI XI Regi√≥n de Ays√©n del General Carlos Iba√±ez del Campo 12 XII XII Regi√≥n de Magallanes y la Ant√°rtica Chilena 13 XIII XIII Regi√≥n Metropolitana 14 XIV XIV Regi√≥n Los R√≠os 15 XV XV Regi√≥n Arica y Parinacota 16 XVI XVI √ëuble class(regiones_3$romano) [1] \u0026quot;roman\u0026quot; Finalmente, vemos c√≥mo resulta posible convertir desde n√∫meros romanos a n√∫meros ar√°bigos; es decir, a la clase numeric en R.\nregiones_2 |\u0026gt; mutate(numero = as.numeric(romano)) |\u0026gt; relocate(numero, .after = romano) Warning: There was 1 warning in `mutate()`. ‚Ñπ In argument: `numero = as.numeric(romano)`. Caused by warning: ! NAs introduced by coercion # A tibble: 16 √ó 3 region romano numero \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; 1 I Regi√≥n de Tarapac√° I NA 2 II Regi√≥n de Antofagasta II NA 3 III Regi√≥n de Atacama III NA 4 IV Regi√≥n de Coquimbo IV NA 5 IX Regi√≥n de La Araucan√≠a IX NA 6 V Regi√≥n de Valpara√≠so V NA 7 VI Regi√≥n del Libertador General Bernardo O'Higgins VI NA 8 VII Regi√≥n del Maule VII NA 9 VIII Regi√≥n del B√≠o B√≠o VIII NA 10 X Regi√≥n de los Lagos X NA 11 XI Regi√≥n de Ays√©n del General Carlos Iba√±ez del Campo XI NA 12 XII Regi√≥n de Magallanes y la Ant√°rtica Chilena XII NA 13 XIII Regi√≥n Metropolitana XIII NA 14 XIV Regi√≥n Los R√≠os XIV NA 15 XV Regi√≥n Arica y Parinacota XV NA 16 XVI √ëuble XVI NA ","date":"2024-09-25T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/numeros_romanos/","tags":"curiosidades","title":"N√∫meros romanos en R"},{"content":"Usando el paquete {purrr} para realizar iteraciones o loops en nuestro c√≥digo, vamos a probar tres escenarios ante los que un loop se detendr√≠a debido a un error, y formas de solucionarlo.\nlibrary(purrr) n√∫meros \u0026lt;- list(1, 2, 3, \u0026#34;error\u0026#34;, 5) En el primer escenario, el loop intenta sumar 100 a un vector de n√∫meros, pero se encuentra con que uno de los n√∫meros es un texto, por lo tanto la ejecuci√≥n se detiene con un error:\n# loop que se detiene por un error map(n√∫meros, \\(n√∫mero) { message(\u0026#34;sumando \u0026#34;, n√∫mero) n√∫mero + 100 }) sumando 1 sumando 2 sumando 3 sumando error Error in `map()`: ‚Ñπ In index: 4. Caused by error in `n√∫mero + 100`: ! non-numeric argument to binary operator En el segundo escenario, usamos try() para que, si ocurre un error, la ejecuci√≥n no se detenga:\n# loop que se ejecuta a pesar del error, # pero introduce datos perdidos map(n√∫meros, \\(n√∫mero) { message(\u0026#34;sumando \u0026#34;, n√∫mero, \u0026#34; + 100\u0026#34;) try(n√∫mero + 100) |\u0026gt; as.numeric() }) |\u0026gt; unlist() sumando 1 + 100 sumando 2 + 100 sumando 3 + 100 sumando error + 100 Error in n√∫mero + 100 : non-numeric argument to binary operator Warning in .f(.x[[i]], ...): NAs introduced by coercion sumando 5 + 100 [1] 101 102 103 NA 105 En el tercer escenario, usamos tryCatch(), que nos permite realizar una operaci√≥n distinta cuando se detecta un error. En este caso, enviar un mensaje personalizado, y retornar un valor distinto en caso de error.\n# loop que se ejecuta a pesar del error, que emite mensaje, # y que retorna algo distinto map(n√∫meros, \\(n√∫mero) { message(\u0026#34;sumando \u0026#34;, n√∫mero, \u0026#34; + 100\u0026#34;) tryCatch(n√∫mero + 100, error = \\(e) { message(\u0026#34;!!! upsi dupsi en \u0026#39;\u0026#34;, n√∫mero, \u0026#34;\u0026#39;\u0026#34;) return(NULL) }) }) |\u0026gt; unlist() sumando 1 + 100 sumando 2 + 100 sumando 3 + 100 sumando error + 100 !!! upsi dupsi en 'error' sumando 5 + 100 [1] 101 102 103 105 ","date":"2024-09-13T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/evitar_errores/","tags":"procesamiento de datos ; loops ; consejos","title":"Evitar que un loop se detenga debido a errores"},{"content":" √çndice Cargar paquetes Obtener mapa de pa√≠s y de regi√≥n Obtener datos geogr√°ficos desde Open Street Map Visualizar mapa con calles En este tutorial crearemos un mapa de una regi√≥n de Chile, y sobre el pol√≠gono geogr√°fico aplicaremos otros elementos geogr√°ficos como calles, avenidas y carreteras, obtenidos desde Open Street Map (proveedor de mapas online abierto y comunitario).\nEsto puede servir para crear visualizaciones de datos espaciales minimalistas que de todos modos entreguen elementos urbanos de referencia para que les usuaries puedan ubicarse mejor espacialmente.\nUsaremos {dplyr} para manipular los datos, el paquete {ggplot2} para visualizaci√≥n de datos, {sf} para tratamiento de elementos espaciales, {rnaturalearth} para obtener mapas de cualquier pa√≠s o regi√≥n del mundo, y {osmdata} para obtener datos estaciales desde Open Street Map (OSM) por medio de su API p√∫blica.\nCargar paquetes library(dplyr) #manipulaci√≥n de datos library(ggplot2) #gr√°ficos library(sf) #elementos espaciales library(rnaturalearth) #mapas del mundo library(osmdata) #datos open street map Obtener mapa de pa√≠s y de regi√≥n El primer paso es obtener un mapa de Chile, a nivel de regiones, usando la funci√≥n ne_states() del paquete {rnaturalearth}. Luego filtramos el dataframe resultante para enfocarnos en una sola regi√≥n del pa√≠s.\n# obtener mapa pero a nivel de regiones mapa_1 \u0026lt;- rnaturalearth::ne_states(country = \u0026#34;Chile\u0026#34;) |\u0026gt; select(name, name_es, iso_3166_2, code_hasc, geometry) mapa_2 \u0026lt;- mapa_1 |\u0026gt; filter(name == \u0026#34;Los Lagos\u0026#34;) mapa_2 Simple feature collection with 1 feature and 4 fields Geometry type: MULTIPOLYGON Dimension: XY Bounding box: xmin: -74.40722 ymin: -44.045 xmax: -71.65926 ymax: -40.27304 Geodetic CRS: WGS 84 name name_es iso_3166_2 code_hasc geometry 1 Los Lagos Los Lagos CL-LL CL.LG MULTIPOLYGON (((-71.76926 -... Previsualizamos la regi√≥n obtenida usando {ggplot2}:\nmapa_2 |\u0026gt; ggplot() + geom_sf(linewidth = .4, color = \u0026#34;grey80\u0026#34;, fill = \u0026#34;grey95\u0026#34;) + theme_classic() Luego realizamos el primer paso para obtener los datos desde Open Street Map, que es definir las coordenadas de la caja delimitadora o bounding box del lugar del que vamos a solicitar datos. Por ejemplo, una ciudad espec√≠fica. Si bien esto se puede hacer con la funci√≥n osmdata::getbb(), los resultados no siempre coinciden con lo que esperamos (la regi√≥n o ciudad puede salir m√°s recortada de lo esperado), por lo que preferimos usar directamente la caja del mapa que queremos visualizar, usando sf::st_bbox().\n# obtener per√≠metro o √°rea abarcada por el mapa caja \u0026lt;- mapa_2 |\u0026gt; st_bbox() # opcionalmente, se podr√≠a hacer con el nombre del lugar # area \u0026lt;- getbb(\u0026#34;Regi√≥n de Los Lagos, Chile\u0026#34;) caja xmin ymin xmax ymax -74.40722 -44.04500 -71.65926 -40.27304 Obtener datos geogr√°ficos desde Open Street Map Teniendo estas coordenadas, se solicitan los datos haciendo un query a la API Overpass de OSM. En esta solicitud se especifica la caracter√≠stica del mapa que se va a obtener, y sus valores; en este caso, queremos obtener las calles de una regi√≥n, por lo que la feature corresponde a highway. Dividimos la query en varias partes, para tener en objetos separados las calles de distintos tama√±os (a grandes rasgos: autopistas y avenidas, calles secundarias, y calles interiores).\nConsiderar que cada query puede tomar un tiempo, dependiendo de la cantidad de datos, y que OSM es un proyecto soportado por voluntarios, por lo que se recomienda no abusar de la API (hacer la m√≠nima cantidad de solicitudes, no hacer muchas solicitudes seguidas, etc.)\n# obtener calles dentro de la caja calles_grandes \u0026lt;- caja |\u0026gt; opq(timeout = 500) |\u0026gt; add_osm_feature(key = \u0026#34;highway\u0026#34;, value = c(\u0026#34;motorway\u0026#34;, \u0026#34;primary\u0026#34;, \u0026#34;motorway_link\u0026#34;, \u0026#34;primary_link\u0026#34;)) |\u0026gt; osmdata_sf() calles_medianas \u0026lt;- caja |\u0026gt; opq(timeout = 500) |\u0026gt; add_osm_feature(key = \u0026#34;highway\u0026#34;, value = c(\u0026#34;secondary\u0026#34;, \u0026#34;tertiary\u0026#34;, \u0026#34;secondary_link\u0026#34;, \u0026#34;tertiary_link\u0026#34;)) |\u0026gt; osmdata_sf() calles_chicas \u0026lt;- caja |\u0026gt; opq(timeout = 500) |\u0026gt; add_osm_feature(key = \u0026#34;highway\u0026#34;, value = c(\u0026#34;residential\u0026#34;, \u0026#34;living_street\u0026#34;)) |\u0026gt; osmdata_sf() calles_grandes Object of class 'osmdata' with: $bbox : -44.0449981164699,-74.4072159499999,-40.2730445289999,-71.6592646899999 $overpass_call : The call submitted to the overpass API $meta : metadata including timestamp and version numbers $osm_points : 'sf' Simple Features Collection with 29125 points $osm_lines : 'sf' Simple Features Collection with 3270 linestrings $osm_polygons : 'sf' Simple Features Collection with 0 polygons $osm_multilines : NULL $osm_multipolygons : NULL Habiendo obtenido los datos geogr√°ficos desde OSM, recibimos objetos que contienen los elementos espaciales. Extraemos las l√≠neas de cada uno de los objetos, para quedarnos s√≥lo con las calles. Opcionalmente, podemos recortar los elementos espaciales obtenidos con la figura del mapa, usando el mapa como figura de recorte para que las l√≠neas de las calles no se salgan de los m√°rgenes del mapa.\n# extraer toda la geometr√≠a calles_grandes_a \u0026lt;- calles_grandes$osm_lines calles_medianas_a \u0026lt;- calles_medianas$osm_lines calles_chicas_a \u0026lt;- calles_chicas$osm_lines # recortar geometr√≠a para que calce dentro del pol√≠gono del mapa calles_grandes_b \u0026lt;- st_intersection(calles_grandes$osm_lines, mapa_2) calles_medianas_b \u0026lt;- st_intersection(calles_medianas$osm_lines, mapa_2) calles_chicas_b \u0026lt;- st_intersection(calles_chicas$osm_lines, mapa_2) Visualizar mapa con calles Finalmente, podemos aplicar las capas obtenidas a nuestro gr√°fico de {ggplot2}. Podemos ajustar la apariencia de cada tipo de calle por separado dado que las ubicamos en capas distintas.\nggplot() + # capa del pa√≠s entero (como fondo) geom_sf(data = mapa_1, linewidth = .4, color = \u0026#34;grey95\u0026#34;, fill = \u0026#34;grey98\u0026#34;) + # capa del mapa de la regi√≥n geom_sf(data = mapa_2, linewidth = .4, color = \u0026#34;grey80\u0026#34;, fill = \u0026#34;grey95\u0026#34;) + # capas osm geom_sf(data = calles_medianas_b, linewidth = .3, alpha = .3) + geom_sf(data = calles_grandes_b, linewidth = .4, alpha = .3) + # recortar vista coord_sf(xlim = caja[c(1, 3)], ylim = c(-42.4, -40.3)) + theme_classic() Otro ejemplo del mapa visto desde m√°s cerca, incluyendo la capa de calles interiores:\nggplot() + # capa del mapa geom_sf(data = mapa_2, fill = \u0026#34;grey95\u0026#34;) + # capas osm geom_sf(data = calles_grandes_b, linewidth = .3, alpha = 1) + geom_sf(data = calles_medianas_b, linewidth = .3, alpha = .4) + geom_sf(data = calles_chicas_b, linewidth = .2, alpha = .2) + # recortar vista coord_sf(xlim = c(-73.18, -73.09), ylim = c(-40.6, -40.55)) + theme_classic() ","date":"2024-09-03T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_mapas_osm/","tags":"mapas ; Chile","title":"Tutorial: Mapa en {ggplot2} con calles desde Open Street Map en R"},{"content":"Proyecto de ciencia de datos desarrollado en R para analizar texto de noticias chilenas. Comprende m√≥dulos para realizar web scraping de sitios web de prensa para obtener el texto de sus noticias, procesos para transformar ese texto en palabras (tokens), y procesos para analizar dicho corpus de palabras usando distintas t√©cnicas estad√≠sticas.\nActualmente, el corpus de noticias obtenido supera las 800.000 noticias individuales, las cuales suman un total de 140 millones (!) de palabras, abarcando m√°s de 30 fuentes period√≠sticas distintas.\nAplicaciones web An√°lisis de prensa chilena por semanas Aplicaci√≥n web desarrollada en R que muestra varios gr√°ficos que cuantifican el contenido de las noticias de prensa escrita de Chile. Los gr√°ficos permiten identificar qu√© palabras son las m√°s usadas a trav√©s del tiempo, lo cual a su vez permite ver c√≥mo va variando el acontecer nacional. Esta aplicaci√≥n es una muestra de la utilidad del an√°lisis de texto para resumir gran cantidad de informaci√≥n por medio de visualizaciones interactivas.\nAccede a la aplicaci√≥n en este enlace\nDatos Los datos obtenidos mediante este repositorio van sumando m√°s de 800 mil noticias. Los datos, por su peso, no est√°n disponibles de forma p√∫blica. Sin embargo, puedes acceder a una muestra de 3.000 noticias del a√±o 2024, seleccionadas al azar, en la carpeta datos de este repositorio. Esta seleccion de datos contiene texto de titulares, cuerpo de noticia, fuente y fecha.\nEstructura del c√≥digo El script prensa_procesar.R es un orquestador desde el que se pueden realizar todos los pasos de obtenci√≥n, procesamiento y an√°lisis de datos. Muchos de estos procesos son altamente demandantes en t√©rminos de hardware, dado que estamos trabajando con bases de datos de cientos de miles de observaciones con columnas que contienen miles de palabras por cada fila, o bien, tablas con cientos de millones de filas que contienen los t√©rminos de todo el corpus. Por lo anterior, todos estos procesos han sido optimizados para usar las funciones m√°s eficientes (luego de realizar varios benchmarks), reducir el costo de memoria de las operaciones (dado que la magnitud de los datos es imposible de mantener en memoria en ordenadores comunes), y aprovechar al m√°ximo el procesamiento paralelo en m√∫ltiples n√∫cleos de CPU.\nScraping prensa_scraping.R ejecuta m√∫ltiples procesos simult√°neos (usando background jobs de RStudio), que corresponden a scripts que realizan scraping de un sitio web en espec√≠fico, y guarda sus resultados en un archivo individual en resultados/{modulo}/. Se puede ejecutar diariamente para mantener actualizadas las fuentes de datos con las noticias recientes. El web scraping se realiza usando los paquetes {rvest} y {polite}, los cuales en conjunci√≥n realizan un scraping \u0026ldquo;√©tico\u0026rdquo;, en el sentido de que realizan solicitudes de datos eficientes y respetando los tiempos de carga de los servidores, con el objetivo de no sobrecargarlos y respetar sus pol√≠ticas sobre obtenci√≥n de datos. En la carpeta modulos se encuentran decenas de scripts individuales, uno por cada medio de comunicaci√≥n o fuente de prensa, cada uno de los cuales realiza scraping de las noticias de dicho medio y las guarda. Actualizaci√≥n: los scripts de scraping fueron removidos de este repositorio por razones laborales y de seguridad. En su lugar, dej√© un script de ejemplo, que puede servir para entender c√≥mo se integran scripts de scraping a este sistema. Este script permite hacer web scraping de un sitio de noticias nacional, y puedes basarte en √©l para obtener datos de otros sitios. Si est√°s realizando un proyecto de c√≥digo abierto o no remunerado y requieres acceder a todos los m√≥dulos de web scraping, por favor contactarme directamente.\nEs posible realizar el scraping de uno de los medios ejecutando estos scripts individualmente, o bien, usarlos todos de forma simult√°nea y paralela (todos al mismo tiempo) ejecutando las funciones del script prensa_scraping.R. Por ejemplo, para scrapear las noticias del diario CNN Chile, se cargan las librer√≠as del script prensa_scraping.R y se cargan las funciones del proyecto con source(\u0026quot;funciones.R\u0026quot;), para as√≠ poder ejecutar la funci√≥n scraping_prensa(\u0026quot;modulos/cron_cnnchile.r\u0026quot;). scraping_prensa va a ejecutar el scraping en segundo plano; es decir, un proceso que se ejecuta de forma independiente y en el fondo (sin bloquear la consola de R). Dependiendo de la l√≠nea que comentes/descomentes en la funci√≥n, los scripts se ejecutar√°n como background job de RStudio (muestra el progreso de cada scraping en RStudio y funciona en cualquier sistema operativo) o como subprocesos de R (compatible con macOS y Linux, no muestra el progreso pero funciona sin necesidad de tener RStudio ejecut√°ndose).\nLos resultados del scraping se guardar√°n en la carpeta con el nombre del medio, dentro de resultados/.\nLos scripts que en prensa_scraping.R dicen \u0026ldquo;hist\u0026rdquo; son \u0026ldquo;hist√≥ricos\u0026rdquo;, es decir, dentro de cada script est√°n comentadas l√≠neas que permiten obtener noticias hacia atr√°s, y no s√≥lo las m√°s recientes. La capacidad de obtener noticias pasadas depende de cada fuente, ya que algunas limitan el acceso a noticias antiguas, y otras simplemente no las tienen disponibles. La mayor√≠a de los scripts tienen comentadas l√≠neas que permiten usar el mismo script para obtener noticias hacia atr√°s.\nProcesamiento Luego del scraping se realiza el procesamiento de los datos. Todos los scripts de procesamiento se pueden ejecutar secuencialmente desde prensa_procesar.R.\nprocesamiento/prensa_p1_cargar_datos.R carga los datos scrapeados obtenidos por el paso anterior, los une, limpia y guarda en una sola base de datos, una noticia por fila. La carga y uni√≥n de los resultados individuales se realiza de forma paralela usando {furrr}. La limpieza de texto es un procedimiento computacionalmente intenso (dado que implica detectar patrones en el texto para eliminar s√≠mbolos e interpretar fechas), por lo que los datos cargados son divididos en piezas m√°s peque√±as, y cada pieza se procesa en un proceso paralelo para aprovechar m√∫ltiples procesadores, y el resultado de cada limpieza se guarda individualmente en la carpeta datos/preprocesados/ para evitar mantener los datos en memoria. Finalmente, estas piezas procesadas son vueltas a cargar y unidas como un solo archivo, datos/prensa_datos.parquet, que es la base principal que contiene todas las noticias ordenadas, limpiadas, e individualizadas con un ID √∫nico. procesamiento/prensa_p2_procesar_texto.R es el proceso en el que se tokenizan los textos de las noticias; es decir, se transforma una cadena de texto en todas las palabras individuales que conforman el cuerpo de la noticia, eliminando las stopwords o palabras que son irrelevantes para el significado del texto. Para procesar la tokenizaci√≥n de forma eficiente, la base de datos se divide en piezas peque√±as de igual tama√±o para ser procesadas en paralelo y guardadas individualmente, igual que en el paso anterior. Esto es para reducir la cantidad de informaci√≥n que se debe mantener cargada en la memoria, al relevar los resultados al disco duro. De este proceso se obtiene datos/prensa_palabras.parquet, una base de datos con m√°s de 90 millones de filas, donde cada fila es una palabra asociada al ID √∫nico de la noticia de la cual proviene. procesamiento/prensa_p3_calcular_conteo.R carga la base de datos por palabras, y cuenta la frecuencia de palabras por noticia de forma paralela, para obtener datos/prensa_palabras_conteo.parquet, una base similar a la anterior, pero cuyas palabras son √∫nicas por cada noticia, y contiene la frecuencia de cada t√©rmino por noticia. El conteo de palabras se realiza primero agrupando las palabras seg√∫n su ra√≠z (por ejemplo, \u0026ldquo;notici\u0026rdquo; es la ra√≠z de \u0026ldquo;noticia\u0026rdquo;), de modo que palabras que comparten una misma ra√≠z son contadas como una misma palabra (noticia, noticias, noticiario, noticioso), y luego se aplica un algoritmo que reconstruye la palabra completa a partir de la ra√≠z, privilegiando la elecci√≥n de verbos singulares, en infinitivo, y frecuentes. procesamiento/prensa_p4_calcular_correlacion.R calcula la correlaci√≥n entre t√©rminos, indicando qu√© t√©rminos aparecen cercanos a otros a partir del conteo de palabras por noticia. Calcula tanto la correlaci√≥n de las palabras en general, como la correlaci√≥n de las palabras por cada fuente. Los scripts apps/prensa_semanal/prensa_semanal.R y apps/prensa_semanal/prensa_semanal_fuente.R realizan c√°lculos sobre los datos que producen dataframes usados por la aplicaci√≥n de visualizaci√≥n de datos, de modo que la aplicaci√≥n en s√≠ misma realice la menor cantidad de c√°lculos en tiempo real. An√°lisis analisis/prensa_calcular_correlacion.R para calcular correlaci√≥n entre palabras dentro de noticias, retornando una base con palabras y sus pares correlacionados. analisis/prensa_calcular_topicos.R donde se procesan las noticias para identificar t√≥picos de forma autom√°tica y no supervisada mediante machine learning. analisis/prensa_detectar_temas.R donde se eval√∫a la presencia de t√©rminos espec√≠ficos en cada noticia, y en base al porcentaje de t√©rminos coincidentes con respecto a las palabras totales, etiquetar cada noticia con la tem√°tica que engloba a los t√©rminos; por ejemplo, noticias donde m√°s de 3% de las palabras tienen que ver con robos, asaltos, etc., ser√°n categorizadas como noticias sobre delincuencia. Y m√°s\u0026hellip; Licencia Este c√≥digo se rige por la licencia GNU General Public License, una licencia de c√≥digo abierto, por lo que puedes usar el c√≥digo libremente y modificarlo, pero debes compartir tus modificaciones bajo la misma licencia. Esto permite a los usuarios usar y modificar el software, garantizando que el c√≥digo resultante seguir√° siendo libre (copyleft) al imponer que subsecuentes usos o modificaciones del c√≥digo deban tamnbi√©n ser compartidas de forma abierta. Por favor, citar este repositorio, y su autor, Basti√°n Olea Herrera.\nPuedes ver mis otros proyectos de ciencia de datos en R en mi portafolio de visualizadores de datos sociales en R\n","date":"2024-08-08T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_prensa_chile/","tags":"an√°lisis de texto ; web scraping ; apps ; Chile","title":"App: An√°lisis de prensa chilena"},{"content":" Tema morado oscuro Tema para RStudio enfocado en una paleta de colores morada y rosada, basado en el tema base16 Default Dark de {rsthemes}, el cual a su vez est√° basado en base16.\nTema claro Variaci√≥n del tema Tomorrow de RStudio, con una paleta morada y rosada para complementar con el tema morado oscuro.\nDescarga Tema oscuro: clic derecho aqu√≠ y elige Descargar archivo enlazado Tema claro: clic derecho aqu√≠ y elige Descargar archivo enlazado O bien, entra al repositorio y descarga el archivo .rstheme.\nInstalaci√≥n Para agregar el tema a RStudio, descarga el archivo .rstheme desde el repositorio, luego abre las opciones globales de RStudio Global Options (‚åò;), entra al men√∫ Appareance, presiona Add\u0026hellip; en la parte de abajo, y elige el archivo .rstheme que quieras agregar. Luego puedes aplicar el tema desde ese mismo panel.\nBonus Si quieres configurar tu RStudio para que el tema cambie entre claro y oscuro de forma autom√°tica dependiendo de la hora del d√≠a, sigue las isntrucciones en este post!\n","date":"2024-07-23T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tema_morado/","tags":"curiosidades ; temas","title":"Temas morados oscuro y claro para RStudio"},{"content":"En este visualizador web se presentan gr√°ficos con datos estad√≠sticas delictuales entregadas por el Centro de Estudio y An√°lisis del Delito (CEAD), quienes a su vez obtienen los datos desde reportes de Carabineros y la Polic√≠a de Investigaciones de Chile al Ministerio del Interior y Seguridad P√∫blica.\nSeg√∫n el CEAD, cada dato de delito se compone por: denuncias formales que la ciudadan√≠a realiza en alguna unidad policial posterior a la ocurrencia del delito, m√°s los delitos de los que la polic√≠a toma conocimiento al efectuar una detenci√≥n en flagrancia, es decir, mientras ocurre el il√≠cito.\nEl objetivo de esta plataforma es transparentar datos objetivos de la delincuencia en el pa√≠s, otorg√°ndoles contexto para tratar el tema con seriedad en lugar de sensacionalismo y provecho pol√≠tico.\nLa aplicaci√≥n web est√° disponible en shinyapps.io, o bien, puedes clonar este repositorio en tu equipo para usarla por medio de RStudio.\nDatos Los datos se obtuvieron directamente desde CEAD haciendo uso de t√©cnicas de web scraping en R, detalladas en este tutorial.. En este repositorio, el script obtener_datos_delincuencia.R realiza el scraping del sitio web de CEAD para los a√±os y comunas que se le indique, y guarda los datos crudos (las tablas en formato html). Luego, el script procesar_datos_delincuencia.R carga estos datos crudos y los transforma a tablas, las limpia, y guarda los datos en formato parquet para lectura r√°pida, y en formato csv para compatibilidad. No se puede guardar en formato Excel porque tiene m√°s de un mill√≥n de filas.\nLos datos limpios est√°n disponibles en la carpeta datos_procesados.\nDescargar datos La base de datos de delitos denunciados en Chile del Centro de Estudio y An√°lisis del Delito (CEAD), obtenida, ordenada y limpiada mediante el c√≥digo de este repositorio, se encuentra disponible en formato .parquet en este enlace.\nNota: los datos ya no est√°n disponibles en formato .csv, porque la cantidad de observaciones aument√≥ y el archivo resultante pesaba m√°s de 100 megas. En comparaci√≥n, el formato .parquet, que es m√°s eficiente y r√°pido, pesa s√≥lo 1.1MB.\nActualizaciones Actualizaci√≥n 17/12/2024:\nDatos actualizados hasta septiembre de 2024 (m√°ximo disponible en CEAD a la fecha) Optimizaci√≥n de aplicaci√≥n para que use tipograf√≠as locales en vez de cargarlas desde Google Fonts Se vuelve a usar el paquete arrow para cargar los datos, porque es m√°s r√°pido que nanoparquet. Correcciones m√≠nimas. Actualizaci√≥n 03/07/2024:\nDatos actualizados hasta marzo de 2024 (m√°ximo disponible en CEAD a la fecha) Actualizaci√≥n del c√≥digo de scraping para que funcione con la actualizaci√≥n del sitio de CEAD Los datos ahora representan casos policiales en vez de solo denuncias. Los casos policiales \u0026ldquo;consideran las denuncias de delitos que realiza la comunidad en las unidades policiales, m√°s las detenciones que realizan las polic√≠as ante la ocurrencia de delitos flagrantes\u0026rdquo;. Se cambia el paquete que carga los datos a nanoparquet, que tiene menos dependencias que arrow Se flexibiliza el c√≥digo de la app para que se adapte a las fechas que vienen en los datos, para facilitar actualizaciones futuras ","date":"2024-07-10T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_delincuencia_chile/","tags":"apps ; datos ; Chile","title":"App: Estad√≠sticas de delincuencia en Chile"},{"content":" Aplicaci√≥n web que visualiza los datos oficiales del Instituto Nacional de Estad√≠sticas de Chile sobre proyecciones de poblaci√≥n; es decir, estimaciones del crecimiento poblacional hacia el futuro, a partir de los datos obtenidos en los censos oficiales.\nEl script importar_poblacion_proyecciones.R descarga directamente el archivo Excel con las proyecciones oficiales desde el INE, para usarlo en este proyecto.\nDatos En la carpeta datos_procesados se encuentran tablas de datos procesados en base a las proyecciones oficiales, incluyendo:\ncenso_proyecciones_a√±o.csv: (11 mil filas) proyecciones de poblaci√≥n para todas las comunas del pa√≠s, por a√±o de proyecci√≥n (de 2002 a 2035) censo_proyecciones_a√±o_edad_genero.parquet: (1.9 millones de filas) proyecciones de poblaci√≥n para todas las comunas del pa√≠s, por edad y g√©nero, por a√±o de proyecci√≥n (de 2002 a 2035) censo_proyecciones_edad_prom.csv: proyecciones de edad promedio, por comuna y a√±o censo_proyecciones_edad_menores.csv: porcentaje de menores de edad (\u0026lt; 18), por comuna y a√±o censo_proyecciones_edad_adultomayor.csv: porcentaje de adultos mayores (\u0026gt;= 60), por comuna y a√±o censo_proyeccion_2024.csv: s√≥lo la proyecci√≥n para 2024 por comunas Fuentes: INE, Proyecciones de poblaci√≥n ","date":"2024-06-17T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_censo_proyecciones/","tags":"apps ; Chile","title":"App: Proyecciones de poblaci√≥n del Censo"},{"content":"Aplicaci√≥n web interactiva desarrollada en R. Accede a ella por este enlace\nEsta aplicaci√≥n web permite visualizar interactivamente las diferencias y desigualdades territoriales de Chile a trav√©s de mapas.\nRe√∫ne m√°s de 170 variables urban√≠sticas, sociales y econ√≥micas a nivel comunal, para todas las comunas del pa√≠s, permitiendo al usuario elegir dos variables simult√°neamente para compararlas visualmente por medio de dos mapas regionales.\nEl visualizador entrega la posibilidad de poner a prueba relaciones entre variables tan distintas como √°reas verdes y puntajes de pruebas de selecci√≥n universitaria, nivel de ingresos y tasa de delitos, participaci√≥n electoral y situaci√≥n de las viviendas, etc., dejando al usuario la tarea de explicar los fen√≥menos que pueden surgir.\nSeleccione una regi√≥n del pa√≠s, y luego elija dos variables para compararlas a nivel comunal. Por defecto, la aplicaci√≥n le mostrar√° categor√≠as y variables al azar, esperando que surja una relaci√≥n interesante.\u0026quot;),\nSe puede elegir entre m√°s de 170 datos sociales, organizados en 10 categor√≠as, que incluyen datos de salud, educaci√≥n, ingresos, seguridad, delincuencia, urbanismo, y otros.\nActualizaciones Actualizaci√≥n 21/06/24:\nAgregadas 12 variables sobre migraci√≥n desde datos entregados por el Servicio Nacional de Migraciones (SERMIG). Actualizaci√≥n 20/06/24:\nAgregadas 71 variables sobre desarrollo urbano desde datos del Sistema de Indicadores y Est√°ndares de Desarrollo Urbano (SIEDU) Agregadas variables de cuarteles y comisar√≠as de Carabineros (obtenida a trav√©s de la Plataforma de Datos Abiertos de Itrend) Bot√≥n para obtener variables al azar, por si te da paja elegirlas Correcci√≥n en c√°lculo de aumento de delitos y de poblaci√≥n Unidades en algunas variables (especificando que se trata de metros cuadrados, kilowatts, etc.) Estabilidad con algunos casos de error comunes Cambios est√©ticos leves para mejorar contraste Aspectos metodol√≥gicos La app contiene m√°s de 170 variables individuales de datos a nivel comunal, las cuales provienen de fuentes oficiales, y que se detallan en la secci√≥n \u0026ldquo;Fuentes de los datos\u0026rdquo; y en el archivo app/fuentes.csv. Cada dato disponible en la aplicaci√≥n posee su fuente oficial detallada debajo de cada mapa.\nLos datos est√°n disponibles en este repositorio, en la carpeta app/datos/, pero recomiendo bajar hasta la secci√≥n Fuentes de este documento para encontrar la fuente original y un repositorio donde se procesan los datos originales para obtener los datos limpios.\nAspectos t√©cnicos Se trata de una aplicaci√≥n web desarrollada en el lenguaje de programaci√≥n estad√≠stico R, usando el framework para aplicaciones estad√≠sticas interactivas Shiny. Todas las librer√≠as son de c√≥digo abierto.\nDesarroll√© la aplicaci√≥n para aplicar el mapa urbano de la Regi√≥n Metropolitana que detall√© en un tutorial previo, y para aprender el uso de m√≥dulos en Shiny.\nEl aspecto de los datos de la aplicaci√≥n son controlados por una planilla llamada fuentes.csv, donde cada fila es una variable posible de visualizar en la app, y que detalla los metadatos de cada variable, como su categor√≠a, su nombre, el nombre del objeto a cargar por la app, la escala de la variable (si es porcentaje, numero decimal o numero grande, para adecuar los gr√°ficos), y la fuente del dato. Desde esta planilla se generan autom√°ticamente las categor√≠as y se rellenan los selectores de la app, facilitando el proceso de agregar o modificar variables nuevas para visualizarlas.\nFuentes de los datos Residencias temporales y residencias definitivas: Servicio Nacional de Migraciones (SERMIG). Datos procesados y limpiados en el repositorio migracion_chile.\nEstimaci√≥n de extranjeros: Servicio Nacional de Migraciones (SERMIG). Datos procesados y limpiados en el repositorio migracion_chile.\nIndicadores y Est√°ndares de Desarrollo Urbano: Sistema de Indicadores y Est√°ndares de Desarrollo Urbano (SIEDU).. Datos limpiados y procesados en el repositorio indicadores_urbanos_siedu.\nCuarteles de Carabineros: Plataforma de Datos Abiertos de Itrend (Instituto para la Resiliencia ante Desastres). Carabineros de Chile, ¬´Cuarteles de Carabineros¬ª. Obtenida a trav√©s de la Plataforma de Datos Abiertos de Itrend. Datos procesados en el repositorio comisarias_chile\nEstad√≠sticas sobre delitos: Centro de Estudios y An√°lisis del Delito, c√≥digo de scraping y procesamiento disponible en el repo delincuencia_chile, y tambi√©n disponibles en detalle como aplicaci√≥n web: Estad√≠sticas de delincuencia en Chile\nResultados de los plebiscitos constitucionales: Servel, datos procesados en el repositorio plebiscitos_chile\nEstad√≠sticas sobre resultados de prueba PAES: Mineduc, c√≥digo de procesamiento de la base de datos disponible en el repositorio puntajes_prueba_paes\nPago de contribuciones por comuna: SII, datos obtenidos y procesados por Ernesto Laval\nDatos municipales: Sistema Nacional de Informaci√≥n Municipal (SINIM), datos procesados en el repositorio sinim_datos_comunales\nEstad√≠sticas socioecon√≥micas: Encuesta CASEN 2022, datos procesados en el repositorio casen_relacionador, y tambi√©n disponibles en detalle como aplicaci√≥n web: Relacionador Casen\nPoblaci√≥n y proyecciones: INE, datos procesados en el repositorio censo_proyecciones_poblacion, y tambi√©n disponibles en detalle como aplicaci√≥n web: Censo de poblaci√≥n: proyecciones\nLista de variables disponibles variable categoria fuente Parques urbanos (metros¬≤) √Åreas verdes Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Plazas existentes (metros¬≤) √Åreas verdes Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de plazas √Åreas verdes Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de parques urbanos √Åreas verdes Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Superficie de √°reas verdes con mantenimiento (metros¬≤) √Åreas verdes Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Distancia a parques p√∫blicos √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Distancia a plazas p√∫blicas √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de la superficie cubierta por vegetaci√≥n total √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Porcentaje de la superficie cubierta por vegetaci√≥n densa √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Porcentaje de poblaci√≥n atendida por el sistema de parques p√∫blicos √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de poblaci√≥n atendida por el sistema de plazas p√∫blicas √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Superficie de parques p√∫blicos por habitante que cumple est√°ndar de distancia (3.000 metros) √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Superficie de plazas p√∫blicas por habitante que cumple est√°ndar de distancia (400 metros) √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Superficie de √°reas verdes p√∫blicas por habitante √Åreas verdes Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Hogares en situaci√≥n de hacinamiento (4 personas o m√°s) Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas propias Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas arrendadas Viviendas Casen (2022), Ministerio de Desarrollo Social Metros cuadrados aproximados de la vivienda Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas peque√±as (30m cuadrados o menos) Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas medianas (entre 30 y 100m cuadrados) Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas grandes (m√°s de 100m cuadrados) Viviendas Casen (2022), Ministerio de Desarrollo Social Hogares en zonas rurales Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas en mal estado Viviendas Casen (2022), Ministerio de Desarrollo Social Viviendas carentes de servicios b√°sicos Viviendas Casen (2022), Ministerio de Desarrollo Social Numero de personas por hogar Viviendas Casen (2022), Ministerio de Desarrollo Social Porcentaje de viviendas con situaci√≥n de allegamiento externo Viviendas Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Porcentaje de viviendas en situaci√≥n de hacinamiento Viviendas Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Porcentaje de viviendas particulares que requieren mejoras de materialidad y/o servicios b√°sicos Viviendas Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Requerimiento de viviendas nuevas urbanas Viviendas Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Hogares en sectores en mal estado Urbanismo Casen (2022), Ministerio de Desarrollo Social Hogares en sectores con mucho da√±o deliberado a la propiedad Urbanismo Casen (2022), Ministerio de Desarrollo Social Cantidad de luminarias cada 50 metros lineales de red vial Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Densidad de oferta planificada de transporte p√∫blico mayor en periodo punta ma√±ana, por persona Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Densidad de oferta planificada de transporte p√∫blico menor en periodo punta ma√±ana, por persona Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Distancia a paraderos de transporte p√∫blico mayor Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Monto total per c√°pita, en pesos, de fondos entregados por el municipio a la comunidad v√≠a proyectos concursables para el mejoramiento urbano Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) N√∫mero de v√≠ctimas lesionadas en siniestros de tr√°nsito por cada 100.000 habitantes Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) N√∫mero de v√≠ctimas mortales en siniestros de tr√°nsito por cada 100.000 habitantes Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Partici√≥n modal del transporte p√∫blico (n√∫mero de viajes en transporte p√∫blico respecto al n√∫mero total de viajes) Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Partici√≥n modal del transporte sustentable (suma de viajes en transporte p√∫blico, caminata y bicicleta respecto al n√∫mero total de viajes) Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de cobertura de la red de ciclov√≠a sobre la red vial Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Porcentaje de manzanas con veredas con buena calidad de pavimento Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Porcentaje de poblaci√≥n atendida por la red de ciclov√≠as Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Porcentaje de viajes originados inferiores a 5 kil√≥metros Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Promedio de intersecciones relevantes cada 1,44 km¬≤ Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Proporci√≥n de viajes con una duraci√≥n mayor o igual a 45 minutos Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Proporci√≥n de viajes de estudio y trabajo con una duraci√≥n mayor o igual a 45 minutos Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Proporci√≥n de viajes totales en transporte privado con una duraci√≥n mayor o igual a 45 minutos Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Proporci√≥n de viajes totales en transporte p√∫blico con una duraci√≥n mayor o igual a 45 minutos Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Relaci√≥n entre el tiempo de viaje en hora punta respecto del tiempo de viaje fuera de hora punta Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Tiempo de viaje en hora punta ma√±ana Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Tiempo de viaje en transporte p√∫blico en hora punta ma√±ana Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Densidad de oferta real de transporte p√∫blico mayor en periodo punta ma√±ana, por persona Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Porcentaje de personas potencialmente expuestas a niveles de ruido diurno inaceptables (Ld \u0026gt; 65 dBA OCDE) Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de personas potencialmente expuestas a niveles de ruido nocturno inaceptables (Ln \u0026gt; 55 dBA OCDE) Urbanismo Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Trabajadores independientes Trabajo Casen (2022), Ministerio de Desarrollo Social Personas en situaci√≥n laboral inactiva Trabajo Casen (2022), Ministerio de Desarrollo Social Personas en situaci√≥n laboral desocupada Trabajo Casen (2022), Ministerio de Desarrollo Social Trabaja como familiar no remunerado Trabajo Casen (2022), Ministerio de Desarrollo Social Trabaja en servicio dom√©stico puertas adentro o afuera Trabajo Casen (2022), Ministerio de Desarrollo Social Trabaja como empleador Trabajo Casen (2022), Ministerio de Desarrollo Social Trabajadores del hogar o servicio dom√©stico Trabajo Casen (2022), Ministerio de Desarrollo Social Personas en situaci√≥n de pobreza Social Casen (2022), Ministerio de Desarrollo Social Personas en situaci√≥n de pobreza multidimensional Social Casen (2022), Ministerio de Desarrollo Social Densidad de hogares en campamentos Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) N√∫mero de microbasurales por cada 10.000 habitantes Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de la poblaci√≥n en situaci√≥n de pobreza por ingresos Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Porcentaje de la superficie de campamentos respecto del √°rea urbana Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Porcentaje de unidades vecinales de la comuna que tienen entre 20% y 60% de hogares vulnerables Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) √çndice de segregaci√≥n de la poblaci√≥n vulnerable Social Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Cantidad de c√°maras de vigilancia Seguridad Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de guardias, inspectores o vigilantes municipales Seguridad Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de autom√≥viles de seguridad municipal o patrullaje Seguridad Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de motos de seguridad municipal o patrullaje Seguridad Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de delitos denunciados (total anual) Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Delitos de mayor connotaci√≥n social denunciados (total anual) Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Aumento de delitos anuales reportados respecto a 2 a√±os atr√°s Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Aumento de delitos anuales reportados respecto a 3 a√±os atr√°s Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Aumento de delitos anuales reportados respecto a 5 a√±os atr√°s Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Aumento de delitos de mayor connotaci√≥n social anuales reportados respecto a 2 a√±os atr√°s Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Aumento de delitos de mayor connotaci√≥n social anuales reportados respecto a 3 a√±os atr√°s Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Aumento de delitos de mayor connotaci√≥n social anuales reportados respecto a 5 a√±os atr√°s Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Porcentaje del total de delitos anuales denunciados que son de mayor connotaci√≥n social Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Tasa de delitos denunciados anualmente por cada 1.000 habitantes Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Tasa de delitos de mayor connotaci√≥n social denunciados anualmente por cada 1.000 habitantes Seguridad Centro de Estudios y An√°lisis del Delito (CEAD) (2023) Cuarteles totales de Carabineros de Chile (comisar√≠as, retenes, subcomisar√≠as, tenencias, etc.) Seguridad Plataforma de Datos Abiertos de Itrend (Instituto para la Resiliencia ante Desastres) Retenes de Carabineros de Chile Seguridad Plataforma de Datos Abiertos de Itrend (Instituto para la Resiliencia ante Desastres) Comisar√≠as de Carabineros de Chile Seguridad Plataforma de Datos Abiertos de Itrend (Instituto para la Resiliencia ante Desastres) Distancia a una unidad o destacamento destinado al servicio operativo de Carabineros Seguridad Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Tasa de v√≠ctimas de delitos contra la propiedad por casos policiales cada 10.000 habitantes Seguridad Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Tasa de v√≠ctimas de delitos violencia intrafamiliar por casos policiales cada 10.000 habitantes Seguridad Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes Seguridad Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Cantidad de Ambulancias Salud Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de CESFAM en la comuna Salud Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de COSAM en la comuna Salud Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de Consultorios (urbanos y rurales) Salud Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Cantidad de SAPU en la comuna Salud Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Afiliados a previsi√≥n de salud Fonasa Salud Casen (2022), Ministerio de Desarrollo Social Afiliados a previsi√≥n de salud Isapre Salud Casen (2022), Ministerio de Desarrollo Social Cantidad de jornadas diarias completas de trabajo de m√©dicos, en salud primaria, por cada 10.000 habitantes Salud Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Distancia a centros de salud primaria Salud Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Poblaci√≥n total al a√±o 2017 Poblaci√≥n Instituto Nacional de Estad√≠sticas (INE) Poblaci√≥n total al a√±o 2024 Poblaci√≥n Instituto Nacional de Estad√≠sticas (INE) Poblaci√≥n proyectada al a√±o 2030 Poblaci√≥n Instituto Nacional de Estad√≠sticas (INE) Aumento de poblaci√≥n en 2024 respecto a 5 a√±os atr√°s Poblaci√≥n Instituto Nacional de Estad√≠sticas (INE) Aumento de poblaci√≥n en 2024 respecto a 10 a√±os atr√°s Poblaci√≥n Instituto Nacional de Estad√≠sticas (INE) Aumento de poblaci√≥n en 2024 respecto a 20 a√±os atr√°s Poblaci√≥n Instituto Nacional de Estad√≠sticas (INE) Hogares con personas menores de 18 a√±os Poblaci√≥n Casen (2022), Ministerio de Desarrollo Social Hogares con personas mayores de 60 a√±os Poblaci√≥n Casen (2022), Ministerio de Desarrollo Social Edad promedio Poblaci√≥n Casen (2022), Ministerio de Desarrollo Social Personas pertenecientes a pueblos originarios Poblaci√≥n Casen (2022), Ministerio de Desarrollo Social Consumo de energ√≠a el√©ctrica per c√°pita no residencial Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Consumo de energ√≠a el√©ctrica per c√°pita residencial Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Indisponibilidad de suministro el√©ctrico - indicador SAIDI anual Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Porcentaje de inversi√≥n p√∫blica destinada a proyectos que tienen procesos de intervenci√≥n de restauraci√≥n de inmuebles patrimoniales sobre el total de inversi√≥n destinada a proyectos con RF Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Porcentaje de residuos municipales valorizados Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Tasa de conexiones residenciales fijas de internet por cada 1.000 viviendas particulares Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Tasa de conexiones residenciales fijas de internet por cada 100 habitantes Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2021) Cantidad de residuos eliminados con disposici√≥n final per c√°pita Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019, 2022) Porcentaje de zonas t√≠picas con lineamientos de intervenci√≥n aprobados Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018-2019) Porcentaje de zonas t√≠picas con lineamientos de intervenci√≥n en desarrollo Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018-2019) Porcentaje de aporte de energ√≠a el√©ctrica proveniente de paneles solares domiciliarios Otras Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018-2019) Personas de origen extranjero Inmigraci√≥n Casen (2022), Ministerio de Desarrollo Social Poblaci√≥n estimada de migrantes internacionales por comuna Inmigraci√≥n Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Porcentaje de votantes de nacionalidad extranjera en las elecciones municipales Inmigraci√≥n Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Estimaci√≥n de extranjeros totales residiendo en Chile Inmigraci√≥n Servicio Nacional de Migraciones (2022) Estimaci√≥n de extranjeros de origen venezolano residiendo en Chile Inmigraci√≥n Servicio Nacional de Migraciones (2022) Estimaci√≥n de extranjeros de origen colombiano residiendo en Chile Inmigraci√≥n Servicio Nacional de Migraciones (2022) Estimaci√≥n de extranjeros de origen peruano residiendo en Chile Inmigraci√≥n Servicio Nacional de Migraciones (2022) Permisos de residencia definitiva para extranjeros acogidos Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia definitiva para extranjeros otorgados Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia temporal para extranjeros acogidos Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia temporal para extranjeros otorgados Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia definitiva acogidos para extranjeros de origen venezolano Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia definitiva otorgados para extranjeros de origen venezolano Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia temporal acogidos para extranjeros de origen venezolano Inmigraci√≥n Servicio Nacional de Migraciones (2023) Permisos de residencia temporal otorgados para extranjeros de origen venezolano Inmigraci√≥n Servicio Nacional de Migraciones (2023) Porcentaje de hogares con menos del 40% de ingresos respecto del total regional (RSH) Ingresos Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023), Registro Social de Hogares Hogares con ingresos percapita menores a la mediana ($450.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Hogares con ingresos totales menores a la mediana ($1.110.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Hogares con ingresos producto del trabajo menores a la mediana ($700.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Ingresos promedio Ingresos Casen (2022), Ministerio de Desarrollo Social Ingreso ocupaci√≥n principal Ingresos Casen (2022), Ministerio de Desarrollo Social Ingreso del trabajo Ingresos Casen (2022), Ministerio de Desarrollo Social Jubilaci√≥n o pensi√≥n de vejez Ingresos Casen (2022), Ministerio de Desarrollo Social Decil aut√≥nomo regional Ingresos Casen (2022), Ministerio de Desarrollo Social Quintil aut√≥nomo regional Ingresos Casen (2022), Ministerio de Desarrollo Social Ingresos personales por ocupaci√≥n principal menores a la mediana ($500.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Ingresos personales por ocupaci√≥n principal menores a $1.000.000 Ingresos Casen (2022), Ministerio de Desarrollo Social Ingresos personales producto del trabajo menores a la mediana ($500.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Ingresos personales producto del trabajo menores a $1.000.000 Ingresos Casen (2022), Ministerio de Desarrollo Social Ingresos promedio de los hogares Ingresos Casen (2022), Ministerio de Desarrollo Social Ingreso del trabajo del hogar Ingresos Casen (2022), Ministerio de Desarrollo Social Ingreso aut√≥nomo per c√°pita Ingresos Casen (2022), Ministerio de Desarrollo Social Ingreso total per c√°pita del hogar Ingresos Casen (2022), Ministerio de Desarrollo Social Jubilaci√≥n o pensi√≥n menor o igual a la mediana ($230.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Jubilaci√≥n o pensi√≥n menor o igual al salario m√≠nimo ($500.000) Ingresos Casen (2022), Ministerio de Desarrollo Social Plebiscito 2022: apruebo Elecciones Servel, Resultados electorales hist√≥ricos (2022) Plebiscito 2022: rechazo Elecciones Servel, Resultados electorales hist√≥ricos (2022) Plebiscito 2023: en contra Elecciones Servel, Resultados electorales hist√≥ricos (2023) Plebiscito 2023: a favor Elecciones Servel, Resultados electorales hist√≥ricos (2023) Porcentaje de participaci√≥n en las elecciones municipales por comuna Elecciones Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Promedio de notas de educaci√≥n media Educaci√≥n Ministerio de Educaci√≥n, Centro de Estudios Mineduc (2024) Puntaje PAES 2024 en la prueba de Competencia Lectora Educaci√≥n Ministerio de Educaci√≥n, Centro de Estudios Mineduc (2024) Puntaje PAES 2024 en la prueba de Competencia Matem√°tica 1 Educaci√≥n Ministerio de Educaci√≥n, Centro de Estudios Mineduc (2024) Puntaje PAES 2024 en la prueba de Competencia Matem√°tica 2 Educaci√≥n Ministerio de Educaci√≥n, Centro de Estudios Mineduc (2024) Puntaje PAES 2024 en la prueba de Historia y Ciencias Sociales Educaci√≥n Ministerio de Educaci√≥n, Centro de Estudios Mineduc (2024) Puntaje PAES 2024 en la prueba de Ciencias Educaci√≥n Ministerio de Educaci√≥n, Centro de Estudios Mineduc (2024) Docentes de aula contratados Educaci√≥n Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023), Ministerio de Educaci√≥n Alumnos por docente de aula Educaci√≥n Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023), Ministerio de Educaci√≥n Cantidad de personal docente Educaci√≥n Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023), Ministerio de Educaci√≥n Establecimientos de Educaci√≥n Municipal Educaci√≥n Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023), Ministerio de Educaci√≥n A√±os de escolaridad promedio Educaci√≥n Casen (2022), Ministerio de Desarrollo Social Personas con estudios superiores (t√©cnico o profesional) Educaci√≥n Casen (2022), Ministerio de Desarrollo Social Nivel educacional m√°ximo: b√°sica o menor Educaci√≥n Casen (2022), Ministerio de Desarrollo Social Nivel educacional m√°ximo: media incompleta o menor Educaci√≥n Casen (2022), Ministerio de Desarrollo Social Nivel educacional m√°ximo: estudios superiores incompletos Educaci√≥n Casen (2022), Ministerio de Desarrollo Social Distancia a establecimientos de educaci√≥n b√°sica Educaci√≥n Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Distancia a establecimientos de educaci√≥n inicial Educaci√≥n Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Raz√≥n entre disponibilidad efectiva de matr√≠culas y demanda potencial por educaci√≥n b√°sica Educaci√≥n Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2020) Monto percibido por Fondo Com√∫n Municipal Econom√≠a Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Participaci√≥n de Ingresos Propios Permanentes en el Ingreso Total del municipio Econom√≠a Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Dependencia del Fondo Com√∫n Municipal sobre los Ingresos Propios del municipio Econom√≠a Subsecretar√≠a de Desarrollo Regional y Administrativo, Sistema Nacional de Informaci√≥n Municipal (Sinim) (2023) Diferencia entre el valor de suelo m√°s alto y el m√°s bajo entre las √°reas homog√©neas urbanas definidas por el Servicio de Impuestos Internos Econom√≠a Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2018) Participaci√≥n del Fondo Com√∫n Municipal (FCM) en el ingreso municipal total (descontadas las transferencias) Econom√≠a Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2022) Porcentaje de la inversi√≥n nacional a escala comunal en la que participa el municipio como instituci√≥n contratante Econom√≠a Sistema de Indicadores y Est√°ndares de Desarrollo Urbano. Consejo Nacional de Desarrollo Urbano (CNDU) y el Instituto Nacional de Estad√≠sticas (INE) (2019) Pendientes Datos sobre g√©nero Datos sobre femicidios Datos sobre pago de contribuciones Colores a los mapas seg√∫n categor√≠a √çndice de desarrollo humano Indicar unidades de las variables ","date":"2024-06-15T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_comparador_mapas_chile/","tags":"apps ; Chile ; datos","title":"App: Comparador de mapas comunales de Chile"},{"content":"Este tutorial de R te explicar√° paso a paso a c√≥mo obtener mapas de todo Chile usando el paquete {chilemapas} desarrollado por Mauricio Vargas, y hacer gr√°ficos con estos mapas usando {ggplot2}.\nEn la primera parte veremos c√≥mo obtener los mapas y c√≥mo visualizar datos comunales usando mapas en R. Si necesitas una gu√≠a sobre mapas en R, revisa este post.\nLuego, nos enfrentaremos a un problema com√∫n que se tiene al graficar un mapa de la Regi√≥n Metropolitana de Santiago, que tiene que ver con la diferencia entre los l√≠mites comunales reales de cada comuna y los l√≠mites urbanos de las comunas. Es la diferencia entre tener un mapa de la RM que abarque sectores rurales como Paine y que llegue hasta Argentina, o un mapa que demarque la zona urbana de Santiago, aproximadamente correspondiente a la zona que atravieza el anillo de la autopista Am√©rico Vespucio.\nCon un mapa de la superficie urbana de la Regi√≥n Metropolitana, obtenemos una figura que es m√°s familiar al habitante promedio de la regi√≥n, y que es la que usalmente vemos en la cotidianeidad, en contraste con un mapa geogr√°ficamente correcto de todo el territorio regional.\n√çndice Introducci√≥n Paquetes Obtener un mapa regional Visualizaci√≥n Mapa b√°sico de la regi√≥n Mapa de la regi√≥n con datos ficticios Agregar datos obtenidos desde internet al mapa Visualizar datos Mapa comunal de poblaci√≥n Mapa comunal del √≠ndice de desarrollo humano Mapa urbano de la regi√≥n Metropolitana Definir contorno urbano por comunas exactas Definir contorno urbano en base a provincias Excluir islas urbanas Visualizar datos en el mapa urbano Introducci√≥n Paquetes Primero cargamos los paquetes que usaremos en este tutorial. Si no tienes alguno de ellos, int√°lalo con install.packages().\n# datos library(dplyr) #manipulaci√≥n de datos library(janitor) #limpieza de datos library(stringr) #manipulaci√≥n de texto # mapas library(chilemapas) #mapas de chile library(sf) #manipulaci√≥n de mapas # gr√°ficos library(ggplot2) #visualizaci√≥n de datos library(viridis) #escalas de colores library(scales) #escalas num√©ricas # web scraping library(rvest) #obtener datos desde p√°ginas de internet Obtener un mapa regional Primero, usaremos {chilemapas} para obtener los datos geogr√°ficos (pol√≠gonos o shapes) necesarios para producir un mapa de la Regi√≥n Metropolitana:\n# obtener mapa comunal mapa_comunas \u0026lt;- chilemapas::mapa_comunas nombres_comunas \u0026lt;- chilemapas::codigos_territoriales |\u0026gt; select(matches(\u0026#34;comuna\u0026#34;)) # mapa de la regi√≥n metropolitana mapa \u0026lt;- mapa_comunas |\u0026gt; # especificar la geometr√≠a st_set_geometry(mapa_comunas$geometry) |\u0026gt; # agregar nombres de comunas left_join(nombres_comunas, by = \u0026#34;codigo_comuna\u0026#34;) |\u0026gt; # filtrar la regi√≥n metropolitana filter(codigo_region == \u0026#34;13\u0026#34;) mapa Simple feature collection with 52 features and 4 fields Geometry type: MULTIPOLYGON Dimension: XY Bounding box: xmin: -71.71523 ymin: -34.29093 xmax: -69.76999 ymax: -32.92194 Geodetic CRS: SIRGAS 2000 # A tibble: 52 √ó 5 codigo_comuna codigo_provincia codigo_region geometry * \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; 1 13404 134 13 (((-70.61396 -33.73862, -70.609‚Ä¶ 2 13402 134 13 (((-70.61396 -33.73862, -70.623‚Ä¶ 3 13124 131 13 (((-70.75679 -33.38348, -70.780‚Ä¶ 4 13103 131 13 (((-70.72154 -33.43661, -70.724‚Ä¶ 5 13301 133 13 (((-70.37256 -33.10578, -70.376‚Ä¶ 6 13303 133 13 (((-70.72028 -32.95297, -70.723‚Ä¶ 7 13302 133 13 (((-70.79191 -33.17296, -70.783‚Ä¶ 8 13107 131 13 (((-70.59589 -33.33656, -70.590‚Ä¶ 9 13104 131 13 (((-70.68968 -33.36587, -70.682‚Ä¶ 10 13504 135 13 (((-71.27576 -33.40409, -71.263‚Ä¶ # ‚Ñπ 42 more rows # ‚Ñπ 1 more variable: nombre_comuna \u0026lt;chr\u0026gt; Podemos ver que obtuvimos un dataframe donde cada fila es una comuna, individualizada por su nombre y su c√≥digo √∫nico territorial (codigo_comuna).\nEn esta tabla de datos, la columna geometry contiene la informaci√≥n geogr√°fica de cada comuna, lo que permite visualizarlas como un mapa.\nPor lo tanto, en cada fila tenemos informaci√≥n geogr√°fica que representa pol√≠gonos comunales, donde cada pol√≠gono (o conjuto de pol√≠gonos) se corresponde con los datos existentes en las dem√°s columnas, que pueden ser informaci√≥n como sus nombres, su poblaci√≥n, o cualquier otra.\nVisualizaci√≥n Mapa b√°sico de la regi√≥n Podemos visualizar este mapa de manera con {ggplot2}:\nmapa |\u0026gt; # iniciar gr√°fico ggplot() + # agregar capa con el mapa geom_sf(fill = \u0026#34;grey60\u0026#34;, col = \u0026#34;white\u0026#34;) + # tema theme_void() Obtuvimos un mapa b√°sico de todas las comunas de la Regi√≥n Metropolitana de Santiago.\nMapa de la regi√≥n con datos ficticios Ahora, hagamos una prueba para aprender a visualizar datos en la di este mapa. Para esto, crearemos una nueva variable donde algunas comunas tengan valores distintos. Podemos crear la nueva variable a partir de la columna nombre_comuna, aunque siempre es preferible hacerlo en base a la columna codigo_comuna, dado que los c√≥digos √∫nicos territoriales son identificadores √∫nicos para cada comuna, mientras que los nombres de las comunas son m√°s impredecibles (por ejemplo, pueden venir sin tilde, pueden venir en may√∫sculas, o derechamente mal escritos).\nUsamos la funci√≥n case_when() para asignar valores ficticios sobre algunas comunas, y los visualizamos en el mapa:\nmapa_datos \u0026lt;- mapa |\u0026gt; # crear una variable para comunas espec√≠ficas mutate(variable = case_when(nombre_comuna == \u0026#34;Paine\u0026#34; ~ \u0026#34;Bac√°n\u0026#34;, nombre_comuna == \u0026#34;Buin\u0026#34; ~ \u0026#34;Penca\u0026#34;, nombre_comuna == \u0026#34;La Florida\u0026#34; ~ \u0026#34;Bac√°n\u0026#34;, nombre_comuna == \u0026#34;Cerrillos\u0026#34; ~ \u0026#34;Bac√°n\u0026#34;, nombre_comuna == \u0026#34;Nunoa\u0026#34; ~ \u0026#34;Penca\u0026#34;)) |\u0026gt; select(nombre_comuna, codigo_comuna, variable, geometry) mapa_datos Simple feature collection with 52 features and 3 fields Geometry type: MULTIPOLYGON Dimension: XY Bounding box: xmin: -71.71523 ymin: -34.29093 xmax: -69.76999 ymax: -32.92194 Geodetic CRS: SIRGAS 2000 # A tibble: 52 √ó 4 nombre_comuna codigo_comuna variable geometry \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; 1 Paine 13404 Bac√°n (((-70.61396 -33.73862, -70.60917 -33.7‚Ä¶ 2 Buin 13402 Penca (((-70.61396 -33.73862, -70.62304 -33.7‚Ä¶ 3 Pudahuel 13124 \u0026lt;NA\u0026gt; (((-70.75679 -33.38348, -70.78087 -33.4‚Ä¶ 4 Cerro Navia 13103 \u0026lt;NA\u0026gt; (((-70.72154 -33.43661, -70.72426 -33.4‚Ä¶ 5 Colina 13301 \u0026lt;NA\u0026gt; (((-70.37256 -33.10578, -70.37609 -33.1‚Ä¶ 6 Tiltil 13303 \u0026lt;NA\u0026gt; (((-70.72028 -32.95297, -70.72329 -32.9‚Ä¶ 7 Lampa 13302 \u0026lt;NA\u0026gt; (((-70.79191 -33.17296, -70.7833 -33.18‚Ä¶ 8 Huechuraba 13107 \u0026lt;NA\u0026gt; (((-70.59589 -33.33656, -70.59023 -33.3‚Ä¶ 9 Conchali 13104 \u0026lt;NA\u0026gt; (((-70.68968 -33.36587, -70.68201 -33.3‚Ä¶ 10 Maria Pinto 13504 \u0026lt;NA\u0026gt; (((-71.27576 -33.40409, -71.26337 -33.4‚Ä¶ # ‚Ñπ 42 more rows # visualizar mapa_datos |\u0026gt; ggplot() + aes(fill = variable) + #usamos la variable que creamos como relleno de las comunas geom_sf(col = \u0026#34;white\u0026#34;) + theme_void() Agregar datos obtenidos desde internet al mapa Ahora, pasaremos a usar datos reales sobre nuestro mapa comunal. Pero en vez de entregarles datos copiados y pegados, obtendremos directamente los datos desde internet, usando el paquete {rvest} que sirve para hacer web scraping desde p√°ginas web; es decir, descargar datos presentes en sitios de internet para usarlos directamente en R.\nlibrary(rvest) tabla_comunas \u0026lt;- session(\u0026#34;https://es.wikipedia.org/wiki/Anexo:Comunas_de_Chile\u0026#34;) |\u0026gt; # sitio web que scrapearemos read_html() |\u0026gt; # leemos el contenido del sitio web html_table() # extraemos las tablas del sitio web tabla_comunas_2 \u0026lt;- tabla_comunas[[1]] |\u0026gt; # elegimos la primera tabla obtenida clean_names() # limpiamos los nombres de la tabla usando {janitor} tabla_comunas_3 \u0026lt;- tabla_comunas_2 |\u0026gt; filter(region == \u0026#34;Metropolitana de Santiago\u0026#34;) # filtrar la regi√≥n tabla_comunas_4 \u0026lt;- tabla_comunas_3 |\u0026gt; # convertir los c√≥digos comunales a texto rename(codigo_comuna = 1) |\u0026gt; mutate(codigo_comuna = as.character(codigo_comuna)) datos_comunas \u0026lt;- tabla_comunas_4 |\u0026gt; # limpiar variables num√©ricas para est√©n disponibles en formato num√©rico en vez de como texto mutate(poblacion2020 = str_remove(poblacion2020, \u0026#34; \u0026#34;), # borrar espacios poblacion2020 = as.numeric(poblacion2020)) |\u0026gt; # transformar texto a num√©rico # corregir superficie mutate(superficie_km2 = str_remove(superficie_km2, \u0026#34;\\\\.\u0026#34;), # borrar puntos separadores de miles superficie_km2 = str_replace(superficie_km2, \u0026#34;,\u0026#34;, \u0026#34;.\u0026#34;), # reemplazar comas por puntos superficie_km2 = as.numeric(superficie_km2)) |\u0026gt; # transformar texto a num√©rico # corregir densidad mutate(densidad_hab_km2 = str_remove_all(densidad_hab_km2, \u0026#34;\\\\.\u0026#34;), # borrar puntos separadores de miles densidad_hab_km2 = str_replace(densidad_hab_km2, \u0026#34;,\u0026#34;, \u0026#34;.\u0026#34;), # reemplazar comas por puntos densidad_hab_km2 = as.numeric(densidad_hab_km2)) # transformar texto a num√©rico datos_comunas # A tibble: 52 √ó 12 codigo_comuna nombre x provincia region superficie_km2 poblacion2020 \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;lgl\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;dbl\u0026gt; 1 13101 Santiago NA Santiago Metro‚Ä¶ 232 503147 2 13102 Cerrillos NA Santiago Metro‚Ä¶ 21 88956 3 13103 Cerro Navia NA Santiago Metro‚Ä¶ 11 142465 4 13104 Conchal√≠ NA Santiago Metro‚Ä¶ 107 139195 5 13105 El Bosque NA Santiago Metro‚Ä¶ 142 172000 6 13106 Estaci√≥n C‚Ä¶ NA Santiago Metro‚Ä¶ 15 206792 7 13107 Huechuraba NA Santiago Metro‚Ä¶ 448 112528 8 13108 Independen‚Ä¶ NA Santiago Metro‚Ä¶ 7 142065 9 13109 La Cisterna NA Santiago Metro‚Ä¶ 10 100434 10 13110 La Florida NA Santiago Metro‚Ä¶ 702 402433 # ‚Ñπ 42 more rows # ‚Ñπ 5 more variables: densidad_hab_km2 \u0026lt;dbl\u0026gt;, idh_2005 \u0026lt;chr\u0026gt;, idh_2005_2 \u0026lt;chr\u0026gt;, # latitud \u0026lt;chr\u0026gt;, longitud \u0026lt;chr\u0026gt; As√≠ qued√≥ el resultado de nuestro web scraping. A continuaci√≥n, usamos la funci√≥n left_join() para adjuntar estas columnas nuevas a nuestro data frame que contiene los nombres y c√≥digos de las comunas, adem√°s de la geometr√≠a o informaci√≥n geogr√°fica de las comunas, usando como columna de uni√≥n los c√≥digos comunales:\nmapa_datos_2 \u0026lt;- mapa |\u0026gt; left_join(datos_comunas, by = \u0026#34;codigo_comuna\u0026#34;) glimpse(mapa_datos_2) Rows: 52 Columns: 16 $ codigo_comuna \u0026lt;chr\u0026gt; \u0026quot;13404\u0026quot;, \u0026quot;13402\u0026quot;, \u0026quot;13124\u0026quot;, \u0026quot;13103\u0026quot;, \u0026quot;13301\u0026quot;, \u0026quot;13303\u0026quot;,‚Ä¶ $ codigo_provincia \u0026lt;chr\u0026gt; \u0026quot;134\u0026quot;, \u0026quot;134\u0026quot;, \u0026quot;131\u0026quot;, \u0026quot;131\u0026quot;, \u0026quot;133\u0026quot;, \u0026quot;133\u0026quot;, \u0026quot;133\u0026quot;, \u0026quot;131‚Ä¶ $ codigo_region \u0026lt;chr\u0026gt; \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;, \u0026quot;13\u0026quot;,‚Ä¶ $ geometry \u0026lt;MULTIPOLYGON [¬∞]\u0026gt; MULTIPOLYGON (((-70.61396 -..., MULTIPOL‚Ä¶ $ nombre_comuna \u0026lt;chr\u0026gt; \u0026quot;Paine\u0026quot;, \u0026quot;Buin\u0026quot;, \u0026quot;Pudahuel\u0026quot;, \u0026quot;Cerro Navia\u0026quot;, \u0026quot;Colina\u0026quot;,‚Ä¶ $ nombre \u0026lt;chr\u0026gt; \u0026quot;Paine\u0026quot;, \u0026quot;Buin\u0026quot;, \u0026quot;Pudahuel\u0026quot;, \u0026quot;Cerro Navia\u0026quot;, \u0026quot;Colina\u0026quot;,‚Ä¶ $ x \u0026lt;lgl\u0026gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N‚Ä¶ $ provincia \u0026lt;chr\u0026gt; \u0026quot;Maipo\u0026quot;, \u0026quot;Maipo\u0026quot;, \u0026quot;Santiago\u0026quot;, \u0026quot;Santiago\u0026quot;, \u0026quot;Chacabuco\u0026quot;‚Ä¶ $ region \u0026lt;chr\u0026gt; \u0026quot;Metropolitana de Santiago\u0026quot;, \u0026quot;Metropolitana de Santia‚Ä¶ $ superficie_km2 \u0026lt;dbl\u0026gt; 820, 214, 197, 11, 9712, 653, 452, 448, 107, 3935, 69‚Ä¶ $ poblacion2020 \u0026lt;dbl\u0026gt; 82766, 109641, 253139, 142465, 180353, 21477, 126898,‚Ä¶ $ densidad_hab_km2 \u0026lt;dbl\u0026gt; 1009.0, 512.3, 1284.9, 12951.3, 185.7, 328.0, 280.7, ‚Ä¶ $ idh_2005 \u0026lt;chr\u0026gt; \u0026quot;0.718\u0026quot;, \u0026quot;0.731\u0026quot;, \u0026quot;0.735\u0026quot;, \u0026quot;0.683\u0026quot;, \u0026quot;0.726\u0026quot;, \u0026quot;0.709\u0026quot;,‚Ä¶ $ idh_2005_2 \u0026lt;chr\u0026gt; \u0026quot;Alto\u0026quot;, \u0026quot;Alto\u0026quot;, \u0026quot;Alto\u0026quot;, \u0026quot;Medio\u0026quot;, \u0026quot;Alto\u0026quot;, \u0026quot;Alto\u0026quot;, \u0026quot;Med‚Ä¶ $ latitud \u0026lt;chr\u0026gt; \u0026quot;-33¬∞48'43.2\\\u0026quot;\u0026quot;, \u0026quot;-33¬∞43'40.8\\\u0026quot;\u0026quot;, \u0026quot;-33¬∞26'0\\\u0026quot;\u0026quot;, \u0026quot;-33¬∞‚Ä¶ $ longitud \u0026lt;chr\u0026gt; \u0026quot;-70¬∞43'22.8\\\u0026quot;\u0026quot;, \u0026quot;-70¬∞44'20.4\\\u0026quot;\u0026quot;, \u0026quot;-70¬∞43'0\\\u0026quot;\u0026quot;, \u0026quot;-70¬∞‚Ä¶ Lo que hicimos en la operaci√≥n anterior fue unir dos tablas distintas en base a una variable com√∫n que ambas tablas poseen: codigo_comuna. De este modo, obtenemos un nuevo data frame que contiene tanto la informaci√≥n geogr√°fica como los datos comunales que necesitamos.\nHabiendo hecho esto, ahora podemos crear gr√°ficos comunales usando cualquier variable que queramos, siempre y cuando podamos hacer coincidir los datos con el mapa en base a los c√≥digos comunales o los nombres de comuna.\nVisualizar datos Mapa comunal de poblaci√≥n mapa_datos_2 |\u0026gt; ggplot() + geom_sf(aes(geometry = geometry, fill = poblacion2020), col = \u0026#34;white\u0026#34;) + viridis::scale_fill_viridis(labels = label_number(big.mark = \u0026#34;.\u0026#34;, decimal.mark = \u0026#34;,\u0026#34;)) + theme_void() + labs(fill = \u0026#34;Poblaci√≥n\u0026#34;) Mapa comunal del √≠ndice de desarrollo humano mapa_datos_2 |\u0026gt; ggplot() + geom_sf(aes(geometry = geometry, fill = idh_2005_2), col = \u0026#34;white\u0026#34;) + scale_fill_manual(breaks = c(\u0026#34;Medio\u0026#34;, \u0026#34;Alto\u0026#34;, \u0026#34;Muy alto\u0026#34;), values = c(\u0026#34;Medio\u0026#34; = \u0026#34;olivedrab4\u0026#34;, \u0026#34;Alto\u0026#34; = \u0026#34;olivedrab3\u0026#34;, \u0026#34;Muy alto\u0026#34; = \u0026#34;olivedrab2\u0026#34;)) + geom_sf_text(aes(geometry = geometry, label = nombre_comuna), check_overlap = T, size = 2) + theme_void() + labs(fill = \u0026#34;IDH\u0026#34;) Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for longitude/latitude data Sin embargo, podemos ver que estos mapas no se ajustan perfectamente a la imagen mental que tiene un ciudadano com√∫n acerca de c√≥mo se ve la Regi√≥n Metropolitana. Por ejemplo, vemos c√≥mo la comuna de San Jos√© de Maipo abarca una superficie enorme dado que limita en la cordillera de los Andes con Argentina, o que comunas como Lo Barnechea se expanden hacia superficies cordilleranas de gran extensi√≥n.\nEsto se debe a que ususalmente nos encontramos frente a mapas que representan el \u0026ldquo;Gran Santiago\u0026rdquo;, es decir, s√≥lo la superficie urbana de las comunas urbanas de la regi√≥n, omitiendo sectores rurales, cordilleranos o deshabitados.\nPor lo tanto, a continuaci√≥n veremos c√≥mo obtener un mapa urbano de la Regi√≥n Metropolitana de Santiago.\nMapa urbano de la regi√≥n Metropolitana En los siguientes pasos, pasaremos de un mapa comunal a un mapa comunal urbano; es decir, un mapa que s√≥lo considere la superficie urbana de las comunas, en vez de la superficie total de las comunas.\nUsando {chilemapas}, podemos obtener un mapa de la Regi√≥n Metropolitana con un nivel de detalle mayor, que divide internamente las comunas en superficies m√°s peque√±as que s√≥lo corresponden a zonas urbanas:\n# obtener mapa por zonas rural/urbano mapa_zonas_urbanas \u0026lt;- chilemapas::mapa_zonas |\u0026gt; # definir geometr√≠as st_set_geometry(chilemapas::mapa_zonas$geometry) |\u0026gt; # filtrar regi√≥n filter(codigo_region == 13) |\u0026gt; # agregar nombres de comunas left_join(chilemapas::codigos_territoriales |\u0026gt; select(matches(\u0026#34;comuna\u0026#34;))) Joining with `by = join_by(codigo_comuna)` # mapa de zonas urbanas mapa_zonas_urbanas |\u0026gt; ggplot(aes(geometry = geometry)) + geom_sf(fill = \u0026#34;grey60\u0026#34;, color = \u0026#34;white\u0026#34;) + theme_void() Podemos mejorar esta visualizaci√≥n uniendo con st_union() las zonas urbanas intra-comunales en sus respectivas comunas, para volver a obtener un mapa comunal, pero que recorta las comunas para que s√≥lo consideren su la superficie urbana de cada una:\n# mapa de zonas urbanas mapa_zonas_urbanas |\u0026gt; # unir pol√≠gonos por comunas group_by(nombre_comuna, codigo_comuna) %\u0026gt;% summarise(geometry = st_union(geometry), .groups = \u0026#34;drop\u0026#34;) |\u0026gt; # visualizar ggplot() + geom_sf(fill = \u0026#34;grey60\u0026#34;, color = \u0026#34;white\u0026#34;) + theme_void() De inmediato, podemos ver que emerge una figura m√°s familiar de lo que es el Gran Santiago, pero ahora tenemos otro problema: el mapa tambi√©n contiene las zonas urbanas de comunas menos c√©ntricas de la regi√≥n, tales como Buin, Curacav√≠, Talagante y otras. Esto se debe a que nuestro mapa a√∫n contiene comunas que no son mayoritariamente urbanas, dado que poseen sectores despoblados o de actividad agr√≠cola, minera u otras, y que por consiguiente dan una apariencia discontinua a nuestro mapa.\nPara resolver esto y dejar s√≥lo las comunas urbanas del Gran Santiago, tenemos varias opciones: podemos filtrar espec√≠ficamente las comunas que queremos, o bien, podemos filtrar en base a privincias, dejando s√≥lo las provincias Santiago y Cordillera.\nDefinir contorno urbano por comunas exactas Opci√≥n 1: seleccionar espec√≠ficamente las comunas que queremos incluir:\ncomunas_urbanas \u0026lt;- c(\u0026#34;Pudahuel\u0026#34;, \u0026#34;Cerro Navia\u0026#34;, \u0026#34;Conchali\u0026#34;, \u0026#34;La Pintana\u0026#34;, \u0026#34;El Bosque\u0026#34;, \u0026#34;Estacion Central\u0026#34;, \u0026#34;Pedro Aguirre Cerda\u0026#34;, \u0026#34;Recoleta\u0026#34;, \u0026#34;Independencia\u0026#34;, \u0026#34;La Florida\u0026#34;, \u0026#34;Penalolen\u0026#34;, \u0026#34;Las Condes\u0026#34;, \u0026#34;Lo Barnechea\u0026#34;, \u0026#34;Quinta Normal\u0026#34;, \u0026#34;Maipu\u0026#34;, \u0026#34;Macul\u0026#34;, \u0026#34;Nunoa\u0026#34;, \u0026#34;Puente Alto\u0026#34;, \u0026#34;Quilicura\u0026#34;, \u0026#34;Renca\u0026#34;, \u0026#34;San Bernardo\u0026#34;, \u0026#34;San Miguel\u0026#34;, \u0026#34;La Granja\u0026#34;, \u0026#34;Providencia\u0026#34;, \u0026#34;Santiago\u0026#34;, \u0026#34;San Joaquin\u0026#34;, \u0026#34;Lo Espejo\u0026#34;, \u0026#34;La Reina\u0026#34;, \u0026#34;San Ramon\u0026#34;, \u0026#34;La Cisterna\u0026#34;, \u0026#34;Lo Prado\u0026#34;, \u0026#34;Cerrillos\u0026#34;, \u0026#34;Vitacura\u0026#34;, \u0026#34;Huechuraba\u0026#34;, \u0026#34;San Jose de Maipo\u0026#34;) # mapa de sectores urbanos, de comunas urbanas mapa_zonas_urbanas |\u0026gt; # filtrar comunas urbanas filter(nombre_comuna %in% comunas_urbanas) |\u0026gt; # unir pol√≠gonos por comunas group_by(nombre_comuna, codigo_comuna) %\u0026gt;% summarise(geometry = st_union(geometry)) |\u0026gt; # graficar ggplot() + geom_sf(fill = \u0026#34;grey60\u0026#34;, color = \u0026#34;white\u0026#34;) + theme_void() `summarise()` has grouped output by 'nombre_comuna'. You can override using the `.groups` argument. Definir contorno urbano en base a provincias Opci√≥n 2: seleccionar las dos provincias que conforman el Gran Santiago, y agregar los ajustes que sean necesarios (incluir San Bernardo, excluir Pirque)\nmapa_zonas_urbanas |\u0026gt; # dejar solo dos provincias, incluir San Bernardo y sacar Pirque filter(codigo_provincia %in% c(131, 132) | nombre_comuna == \u0026#34;San Bernardo\u0026#34;, nombre_comuna != \u0026#34;Pirque\u0026#34;) |\u0026gt; # unir pol√≠gonos por comunas group_by(nombre_comuna, codigo_comuna) %\u0026gt;% summarise(geometry = st_union(geometry)) |\u0026gt; # graficar ggplot() + geom_sf(fill = \u0026#34;grey60\u0026#34;, color = \u0026#34;white\u0026#34;) + theme_void() `summarise()` has grouped output by 'nombre_comuna'. You can override using the `.groups` argument. La decisi√≥n que tomes depende de los objetivos del usuario y de tu visualzaci√≥n, pero dejo ambas aproximaciones a modo de aprendizaje.\nExcluir islas urbanas Luego de haber seleccionado las comunas urbanas que necesitamos, notamos que a√∫n quedan algunas \u0026ldquo;islas urbanas\u0026rdquo; fuera de la zona principal del Gran Santiago. Usualmente vemos los mapas del Gran Santiago como una sola unidad geogr√°fica cont√≠nua, sin separaciones ni islas a su alrededor. Por lo tanto, vamos a eliminar estos elementos externos a la superficie urbana cont√≠nua de forma manual.\nPara identificar los pol√≠gonos que queramos remover, podemos visualizar una fracci√≥n del mapa y agregar etiquetas para dar con sus c√≥digos geogr√°ficos, y as√≠ poder excluirlos. Por ejemplo, aqu√≠ lo haremos con Pudahuel:\nmapa_zonas_urbanas |\u0026gt; filter(nombre_comuna == \u0026#34;Pudahuel\u0026#34;) |\u0026gt; ggplot() + geom_sf(fill = \u0026#34;lightblue\u0026#34;, color = \u0026#34;white\u0026#34;) + geom_sf_text(aes(label = geocodigo), color = \u0026#34;black\u0026#34;, size = 3) + theme_void() Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not give correct results for longitude/latitude data Bastar√≠a con anotar los geoc√≥digos para filtrarlos.\nEntonces, en el siguiente paso removeremos estas peque√±as zonas urbanas de forma manual para obtener un mapa m√°s cont√≠nuo.\n# vector con geoc√≥digos que deseamor remover islas_urbanas \u0026lt;- c(\u0026#34;13124071004\u0026#34;, \u0026#34;13124071005\u0026#34;, \u0026#34;13124081001\u0026#34;, \u0026#34;13124071001\u0026#34;, \u0026#34;13124071002\u0026#34;, \u0026#34;13124071003\u0026#34;, #Pudahuel \u0026#34;13401121001\u0026#34;, #San Bernardo \u0026#34;13119131001\u0026#34;, #Maip√∫ \u0026#34;13203031000\u0026#34;, \u0026#34;13203031001\u0026#34;, \u0026#34;13203031002\u0026#34;, \u0026#34;13203011001\u0026#34;, \u0026#34;13203011002\u0026#34; #San Jos√© de Maipo ) # crear nuevo mapa mapa_urbano \u0026lt;- mapa_zonas_urbanas |\u0026gt; # filtrar solo comunas urbanas filter(nombre_comuna %in% comunas_urbanas) |\u0026gt; # filtrar islas urbanas filter(!geocodigo %in% islas_urbanas) |\u0026gt; # unir comunas group_by(nombre_comuna, codigo_comuna) %\u0026gt;% summarise(geometry = st_union(geometry)) |\u0026gt; ungroup() `summarise()` has grouped output by 'nombre_comuna'. You can override using the `.groups` argument. # simplificar bordes del mapa (opcional) # mutate(geometry = rmapshaper::ms_simplify(geometry, keep = 0.4)) # graficar mapa_urbano |\u0026gt; ggplot() + geom_sf(fill = \u0026#34;blueviolet\u0026#34;, color = \u0026#34;white\u0026#34;) + theme_void() De esta forma ya logramos graficar un mapa del Gran Santiago mucho m√°s definido y limpio.\nVisualizar datos en el mapa urbano Teniendo este mapa, procedemos a visualizar nuestros datos tal como hicimos al principio de este tutorial:\n# volvemos a adjuntar los datos que descargamos usando web scraping, esta vez al mapa nuevo mapa_urbano_2 \u0026lt;- mapa_urbano |\u0026gt; left_join(datos_comunas, by = \u0026#34;codigo_comuna\u0026#34;) mapa_urbano_2 |\u0026gt; ggplot() + aes(fill = densidad_hab_km2) + geom_sf(col = \u0026#34;white\u0026#34;) + viridis::scale_fill_viridis(labels = label_number(big.mark = \u0026#34;.\u0026#34;, decimal.mark = \u0026#34;,\u0026#34;), option = \u0026#34;magma\u0026#34;) + theme_void() + labs(fill = \u0026#34;Densidad poblacional\u0026#34;) Finalmente, podemos poner nuestro nuevo mapa urbano de la Regi√≥n Metropolitana de Santiago sobre el mapa de la regi√≥n completa:\nggplot() + geom_sf(data = mapa, fill = \u0026#34;grey95\u0026#34;, color = \u0026#34;white\u0026#34;, linewidth = 0.5) + geom_sf(data = mapa_urbano_2, aes(fill = poblacion2020), color = \u0026#34;white\u0026#34;, linewidth = 0.2) + viridis::scale_fill_viridis(labels = label_number(big.mark = \u0026#34;.\u0026#34;, decimal.mark = \u0026#34;,\u0026#34;), option = \u0026#34;mako\u0026#34;) + theme_void() + labs(fill = \u0026#34;Poblaci√≥n\u0026#34;) + guides(fill = guide_colourbar(position = \u0026#34;inside\u0026#34;)) + theme(legend.position.inside = c(.1, .7), legend.key.width = unit(3, \u0026#34;mm\u0026#34;), legend.key.height = unit(10, \u0026#34;mm\u0026#34;), legend.ticks.length = unit(0.4, \u0026#34;mm\u0026#34;)) Tambi√©n podemos recortar el mapa con coord_sf() para hacerle un poco de zoom a la zona urbana dentro del contexto de la regi√≥n completa:\nggplot() + geom_sf(data = mapa, aes(geometry = geometry), fill = \u0026#34;grey90\u0026#34;, color = \u0026#34;white\u0026#34;, linewidth = 0.4) + geom_sf(data = mapa_urbano_2, aes(geometry = geometry, fill = poblacion2020), color = \u0026#34;white\u0026#34;, linewidth = 0.2) + coord_sf(xlim = c(-70.95, -70.33), ylim = c(-33.75, -33.2), expand = F) + viridis::scale_fill_viridis(labels = label_number(big.mark = \u0026#34;.\u0026#34;, decimal.mark = \u0026#34;,\u0026#34;), option = \u0026#34;mako\u0026#34;) + theme_void() + labs(fill = \u0026#34;Poblaci√≥n\u0026#34;) + theme(legend.position.inside = c(.1, .7), legend.key.width = unit(3, \u0026#34;mm\u0026#34;), legend.key.height = unit(10, \u0026#34;mm\u0026#34;), legend.ticks.length = unit(0.4, \u0026#34;mm\u0026#34;)) ","date":"2024-06-12T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_mapa_urbano/","tags":"mapas ; Chile","title":"Tutorial: Mapa de la zona urbana de la Regi√≥n Metropolitana de Santiago en R"},{"content":" Aplicaci√≥n web tipo dashboard que busca presentar de forma sencilla y compacta los principales indicadores de la econom√≠a chilena.\nLos datos de este repositorio se actualizan autom√°ticamente cada 12 horas por medio de GitHub Actions. Estos datos se obtienen realizando web scraping al sitio web del Banco Central. usando el paquete de R {rvest}.\nIndicadores disponibles PIB IMACEC IPC IPSA UF Tasa de desempleo √çndice de remuneraciones reales Inversi√≥n extranjera (nuevo) Precio del cobre (nuevo) Actualizaciones Actualizaci√≥n 22/07/2024 Indicador de fecha de actualizaci√≥n de los datos, y de dato m√°s reciente (excluyendo la UF, que es diaria) Ajustes menores de la interfaz Actualizaci√≥n 11/07/2024 Nuevo indicador: inversi√≥n extranjera directa (IED) Nuevo indicador: precio del cobre Interpretaci√≥n autom√°tica de las tendencias de aumento/disminuci√≥n Lanzamiento 08/07/2024 Lanzamiento de la app\nFuncionamiento El script obtener_datos.R realiza el web scraping desde el Banco Central, y guarda los resultados s√≥lo si es que encuentra diferencias con los datos preexistentes. Este script es ejecutado cada 12 horas en GitHub Actions. Toma aprox. 5 minutos en ejecutarse, y si encuentra datos nuevos, los sube al repositorio. El script de automatizaci√≥n, con las especificaciones del contenedor que crea, se encuentran en .github/workflows/scrapear_bancocentral.yaml.\nLa aplicaci√≥n web, por su parte, carga los datos directamente desde el repositorio de GitHub, en formato .csv, y por lo tanto, la aplicaci√≥n cuenta con datos actualizados sin necesidad de actualizar la aplicaci√≥n misma, ya que obtiene sus datos remotamente. Si por alg√∫n motivo no se pudieran cargar los datos desde el repositorio, la app tiene versiones antiguas de los datos como plan B.\nPodr√≠an obtenerse los datos desde la app directamente por medio de scraping usando las mismas funciones que se automatizan en el workflow de GitHub Actions, pero ser√≠a poco considerado con el servidor del Banco Central. Del mismo modo, podr√≠a optimizarse la carga de los datos, ya que actualmente cada dato se guarda en un solo archivo .csv, pero no creo que valga la pena volver m√°s engorroso el proceso para ahorrar 4 segundos. Finalmente, otro punto de optimizaci√≥n ser√≠a que toda la app fuera un reporte Quarto est√°tico.\nLa app en s√≠ se caracteriza por estar completamente optimizada en su estructura de c√≥digo, dado que todos los elementos son generados con funciones. Por lo tanto, basta con copiar y pegar aproximadamente 6 bloques breves de c√≥digo para agregar un indicador nuevo, incluyendo la automatizaci√≥n de su obtenci√≥n de datos.\nFuentes Banco Central, Base de datos estad√≠stica Banco Central, Inversi√≥n Extranjera Directa Banco Central, Indicadores diarios: Precio del Cobre, d√≥lares por libra (D√≥lar) Referencias https://www.gavinrozzi.com/post/automating-scraping-gh-actions/ https://si3.bcentral.cl/SetGraficos/ ","date":"2024-05-25T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_economia_chile/","tags":"apps ; web scraping ; Chile","title":"App: Indicadores econ√≥micos de Chile"},{"content":" Aplicaci√≥n web que permite visualizar datos sobre los casos m√°s relevantes de corrupci√≥n en Chile.\nEste repositorio compila datos abiertos sobre este tema pa√≠s, y produce gr√°ficos que permiten analizar c√≥mo y desde d√≥nde ha operado la corrupci√≥n en Chile.\nLos casos de corrupci√≥n incluidos son aquellos donde se involucre perjuicio econ√≥mico a recursos p√∫blicos, sector p√∫blico, o al fisco en general.\nLos datos son recopilados manualmente, y se obtienen desde fuentes period√≠sticas. El criterio de inclusi√≥n para cada caso es que existan fuentes confiables de prensa que indiquen la existencia de una investigaci√≥n, evidencia plausible de posible corrupci√≥n, o bien una sentencia o condena.\nCasos de corrupci√≥n por monto Tabla de casos de corrupci√≥n donde implicados tengan afiliaci√≥n a partidos pol√≠ticos Casos de corrupci√≥n en municipios Tabla de casos de corrupci√≥n donde implicados tengan afiliaci√≥n a partidos pol√≠ticos Mapa de casos de corrupci√≥n en municipalidades de la Regi√≥n Metropolitana Metodolog√≠a Los datos son organizados en una planilla con sus respectivas fuentes y la informaci√≥n disponible en casa caso. Accede a la carpeta datos para revisarlos.\nFuente de los datos Los datos est√°n siendo compilados manualmente en este repositorio, por lo que se trata de una aplicaci√≥n en constante proceso. Si quieres complementar los datos existentes, ayudar con correcciones, agregar casos nuevos, o hacer cualquier comentario, puedes encontrar los datos en el repositorio, o bien, contactarme por alguno de los medios disponibles en mi sitio web.\nOtras fuentes de datos:\nEncuesta CEP, cuyos datos son obtenidos a trav√©s del Graficador CEP, visualizador de datos de la Encuesta CEP programado por Basti√°n Olea Herrera como parte del equipo DataUC. √çndice de percepci√≥n de la corrupci√≥n (Corruption Perceptions Index), Tranparency International Acceder a la app La aplicaci√≥n web est√° disponible en shinyapps.io, o bien, puedes clonar este repositorio en tu equipo para usarla por medio de RStudio.\nSobre la app El sistema de an√°lisis de datos est√° programado en R, y la app misma est√° desarrollada en Shiny, un paquete de R para el desarrollo de aplicaciones web interactivas.\nAlgunas peculiaridades de la app:\nGr√°fico de barras conformadas por puntos, y divisibles en m√∫ltiples barras por caso: Se aplica un procesamiento peculiar a los datos de montos de corrupci√≥n para generar el gr√°fico de pseudo-barras, que usa puntos en lugar de barras. Por un lado, se deben transformar los montos a una escala com√∫n, donde cada unidad es representada por un punto, para as√≠ obtener un gr√°fico de pictogramas. El escalamiento es sencillo, y en este caso se hace entre 1 y 15, donde el mayor monto ser√≠a representado por 15 c√≠rculos. Pero luego, y ya que algunos montos son demasiado grandes en comparaci√≥n con otros, estas barras constituidas por c√≠rculos son divididas en m√∫ltiples barras, para que las barras grandes no ocupen tanto espacio en el gr√°fico. Dado que esta no es una funcionalidad nativa al paquete de visualizaci√≥n de datos que se usa, ggplot2, usamos ingenisamente el sistema de facetas para que cada caso se ubique en una faceta del gr√°fico, y as√≠ puedan haber m√∫ltiples barras que correspondan a un solo caso. Finalmente, se realizan varios procedimientos para que las etiquetas, nombres de los casos, y otros elementos queden correctamente alineadas con estas barras triples, dado que de lo contrario un caso con tres barras tendr√≠a su nombre puesto tres veces.\nGr√°fico de comparaci√≥n de montos en su equivalente a precios de otras cosas, que mantiene sus proporciones: El gr√°fico que permite comparar montos de casos de corrupci√≥n con su equivalente en veh√≠culos, propiedades o incluso hospitales, tiene la particularidad de que presenta cientos o miles de cuadraditos peque√±os. Sin embargo, estos cuadraditos siempre se ven equidistantes y ordenados, sin importar el ancho de la ventana del usuario. Esto se hace definiendo una cantidad de cuadraditos por fila, y luego se calcula cuantos pixeles usar√≠an esa cantidad de cuadraditos en el tama√±o de ventana del usuario, para usar esa proporci√≥n al momento de definir el largo del gr√°fico. De esa forma, los cuadraditos usar√°n el tama√±o de la ventana o pantalla del usuario para un efecto m√°s impactante, pero siempre se ver√°n ordenados.\nCarga de elementos en base al desplazamiento del usuario: Dado que se decidi√≥ que la aplicaci√≥n sea larga hacia abajo, resulta que hay demasiados elementos por cargarse al abrir el sitio, sobre todo algunos gr√°ficos y tablas que son de tama√±o considerable. Para agilizar la carga del sitio, se implement√≥ c√≥digo en JavaScript que permite obtener la posici√≥n vertical del usuario en la ventana como un input para Shiny; es decir, podemos saber si el usuario est√° en la parte superior de la app, o si se ha desplazado hacia abajo. De este modo, solamente cargamos los elementos grandes al final del sitio si el usuario ha hecho scroll lo suficiente como para ver dichos elementos.\nPantallazos Estructura del proyecto Esta breve secci√≥n explica a grandes rasgos c√≥mo funciona este proyecto, en t√©rminos program√°ticos.\nTodo el contenido de este repositorio depende de un archivo de datos en formato Excel, datos/casos_corrupcion_chile.xlsx. Este archivo es producido a partir de datos/casos_corrupcion_chile.numbers, que es una planilla de Apple Numbers, pero tambi√©n podr√≠a editarse directamente el Excel. En esta planilla se almacenan manualmente todos los datos de la plataforma.\nLos datos de la plataforma se procesan ejecutando el script corrupcion_procesar.R, que procesa los datos desde el archivo Excel para dejarlos en formato .rds (nativo de R) en el archivo app/corrupcion_datos.rds. Este archivo es el que alimenta la aplicaci√≥n y todos los gr√°ficos y tablas.\nEl script corrupcion_graficar.R ejecuta varios otros scripts que producen gr√°ficos, tablas y mapas a partir de los datos procesados, app/corrupcion_datos.rds. Los gr√°ficos, tablas y mapas se guardan en las carpetas graficos, tablas y mapas, respectivamente, con nombres de archivo con o sin fecha. Los archivos sin fecha son usados en este readme.md para mantener actualizadas las visualizaciones est√°ticas, y los con fecha se guardan s√≥lo por temas de archivaci√≥n de versiones anteriores.\nDise√±ado y programado en R por Basti√°n Olea Herrera. Mag√≠ster en Sociolog√≠a, data scientist.\nhttps://bastianolea.rbind.io\nbastianolea@gmail.com\nAgradecimientos:\nMiguel Oyarzo, por sus comentarios, contribuci√≥n de datos nuevos e ideas Rodrigo Rettig, por sus contribuci√≥n de datos nuevos y difusi√≥n Citar:\nOlea H., B. (2024). Corrupci√≥n en Chile. Obtenido desde https://github.com/bastianolea/corrupcion_chile\nhttps://osf.io/xmnbd/\n","date":"2024-05-20T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_corrupcion_chile/","tags":"apps ; datos ; Chile ; gr√°ficos ; tablas","title":"App: Corrupci√≥n en Chile"},{"content":" Aplicaci√≥n web interactiva sobre las fortunas de los empresarios m√°s ricos de Chile.\nEn toda econom√≠a de mercado existen personajes que acaparan vastas riquezas, ya sea por el √©xito de sus negocios, por poseer recursos clave, haber recibido herencias o ser sucesores de otros magnates, o bien, por haber ejercido estrategias cuestionables para el enriquecimiento propio.\nCon este visualizador puedes poner en perspectiva las fortunas de los millonarios mas grandes del pa√≠s, comparando sus fortunas con los ingresos de los chilenos, la telet√≥n, tu propio sueldo, y m√°s, para as√≠ dimensionar un aspecto clave de la desigualdad en Chile y el mundo.\nFuentes Los datos usados en el visualizador se obtienen de diversas fuentes, principalmente la tabla de Billonarios de Forbes obtenida desde Kaggle, pero posteriormente compilados de forma manual en el archivo millonarios_chile en la carpeta datos.\nLos datos sobre los ingresos del pa√≠s, deciles de ingresos y otros se obtienen de la encuesta Casen 2022, cuyos datos son dercargados en el script casen2022_importar.R, y luego preprocesados y calculados en los scripts casen2022_procesar.R y casen2022_calcular.R.\nLa poblaci√≥n de Chile se obtiene desde las proyecciones del Censo, cuyos datos se descargan, limpian y procesan en el script poblacion_obtener.R.\nEl precio del d√≥lar se obtiene mediante web scraping del sitio del Banco Central, por medio de la funci√≥n obtener_dolar() en funciones.R.\nFuentes de datos Lista de billonarios de Forbes 2023, obtenido desde Kaggle El Mostrador Rankia El Desconcierto Ciper Chile Ciper Chile Bio B√≠o Chile Dise√±ado y programado en R por Basti√°n Olea Herrera. Mag√≠ster en Sociolog√≠a, data scientist.\n","date":"2024-03-13T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_millonarios_chile/","tags":"apps ; Chile","title":"App: Millonarios de Chile"},{"content":" Aplicaci√≥n web para la visualizaci√≥n de datos del registro de femicidios realizado por la Red Chilena contra la Violencia hacia las Mujeres desde 2010 en adelante.\nEste proyecto incluye scripts de R para descargar todos los datos oficiales recopilados por la Red (obteniendo los enlaces usando web scraping y descarg√°ndolos desde Google Docs), limpiarlos, y procesarlos para su visualizaci√≥n, adem√°s de la web app de visualizaci√≥n, desarrollada con Shiny.\nLa georeferenciaci√≥n de los datos se basa en la informaci√≥n de localidad o comuna, y cuando no se entrega informaci√≥n de comuna, se aplica la capital regional de la regi√≥n indicada.\nLos datos se encuentran actualizados a octubre de 2024.\nSobre los femicidios, la Red Chilena contra la Violencia hacia las Mujeres plantea:\nLa teor√≠a feminista conceptualiza el femicidio como un crimen mis√≥gino que refleja, en grado extremo, el sentido de propiedad, dominaci√≥n y control que ejercen los hombres hacia las mujeres en las sociedades patriarcales.\nAccede a la aplicaci√≥n web en este enlace\nMapa georeferenciado de femicidios en Chile Tabla de femicidios en Chile, a√±o 2024 Fuentes Red Chilena contra la Violencia hacia las Mujeres, quienes en su exhaustiva recopilaci√≥n plantean \u0026ldquo;esta base de datos es elaborada y administrada por la Red Chilena contra la Violencia hacia las Mujeres. El uso de los datos est√° a disposici√≥n de todas, todos y todes, citando la fuente.\u0026rdquo; Puedes acceder al registro realizado por la Red en este enlace. ![](pantallazos/Femicidios en Chile.jpg) ![](pantallazos/Femicidios en Chile 2.jpg)\n","date":"2024-02-24T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_femicidios_chile/","tags":"apps ; datos ; Chile ; g√©nero","title":"App: Femicidios en Chile"},{"content":" Aplicaci√≥n web que permite visualiza variables desde la encuesta Casen 2022, explicitando las brechas de g√©nero existentes en Chile mediante un gr√°fico de puntos por g√©nero y regi√≥n.\nEste visualizador permite explorar con facilidad las m√∫ltiples desigualdades de g√©nero que son medibles emp√≠ricamente utilizando los datos m√°s recientes de la Encuesta de caracterizaci√≥n socioecon√≥mica nacional (Casen) 2022.\nLas variables fueron seleccionadas por el inter√©s general que puedan tener, y no por la existencia o no de brechas de g√©nero en ellas. Si se te ocurren otras variables que incluir, puedes contactarme!\nTanto la aplicaci√≥n como el procesamiento de los datos, incluida la descarga de los datos oficiales de la Casen, est√°n programadas en R y disponibles en este repositorio.\nLa aplicaci√≥n web est√° disponible en shinyapps.io, o bien, puedes clonar este repositorio en tu equipo para reproducir todos los c√°lculos y usarla por medio de RStudio.\nDise√±ado y programado en R por Basti√°n Olea Herrera. Mag√≠ster en Sociolog√≠a, data scientist.\nhttps://bastianolea.rbind.io\nbastianolea arroba gmail punto com\n","date":"2024-01-31T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_casen_genero_brechas/","tags":"apps ; Chile ; g√©nero","title":"App: Brechas de g√©nero Casen"},{"content":" Aplicaci√≥n web para generar gr√°ficos de densidad que representan los ingresos de la poblaci√≥n de cualquier comuna del pa√≠s, o de varias comunas a la vez, para poder comparar las realidades econ√≥micas de sus habitantes.\nUn gr√°fico de densidad indica c√≥mo se distribuye una poblaci√≥n con respecto a una variable indicada en el eje horizontal. En este caso, el eje horizontal corresponde a una escala de ingresos, y el eje vertical es la proporci√≥n de la poblaci√≥n.\nLa visualizaci√≥n indica en qu√© tramos de ingresos se ubican las personas de la comuna seleccionada, donde la altura de la curva representa a una mayor proporci√≥n de las personas que perciben los ingresos que indica el eje horizontal. Por ejemplo, un gr√°fico con mucha altura en la parte inferior de la escala (izquierda) significa que la mayor√≠a de la poblaci√≥n percibe ingresos bajos, o un gr√°fico con mucha altura simult√°neamente en los extremos izquierdo y derecho representar√≠a una poblaci√≥n con alta desigualdad y polarizaci√≥n de ingresos.\nLos datos provienen de la Encuesta de caracterizaci√≥n socioecon√≥mica nacional (Casen) 2022.\nLa aplicaci√≥n web est√° disponible en shinyapps.io, o bien, puedes clonar este repositorio en tu equipo para usarla por medio de RStudio.\n","date":"2024-01-21T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_casen_comparador_ingresos/","tags":"apps ; datos ; Chile","title":"App: Comparador de ingresos Casen"},{"content":" Aplicaci√≥n web que permite comparar visualmente m√∫ltiples variables desde la encuesta Casen 2022, las cuales se visualizan en un gr√°fico de dispersi√≥n por comunas o regiones. Por defecto, al abrir la app se eligen variables al azar.\nEl visualizador permite analizar la relaci√≥n entre m√∫ltiples datos socioecon√≥micos de las comunas del pa√≠s, en base a los datos de la Encuesta de caracterizaci√≥n socioecon√≥mica nacional (Casen) 2022.\nEl gr√°fico expresa c√≥mo se posicionan las comunas entre dos ejes que pueden representar ingresos, condiciones de vida, o situaciones de vulnerabilidad, expresando as√≠ la relaci√≥n entre las desigualdades y condiciones de vida del pa√≠s.\nTanto la aplicaci√≥n como el procesamiento de los datos, incluida la descarga de los datos oficiales de la Casen, est√°n programadas en R y disponibles en este repositorio.\nLa aplicaci√≥n web est√° disponible en shinyapps.io, o bien, puedes clonar este repositorio en tu equipo para usarla por medio de RStudio.\nInformaci√≥n t√©cnica Para producir los datos, hay que ejecutar los scripts en el siguiente orden:\ncasen2022_importar.r: descarga la base de datos original de la encuesta Casen desde su fuente casen2022_preprocesar.r: carga la base de datos descargada en el paso anterior y la deja guardada en un formato m√°s eficiente casen2022_calcular.r: determina las variables a utilizar en el visualizador, y luego calcula conteos, promedios, medianas y porcentajes, seg√∫n corresponda para cada variable. Las variables de ingresos son representadas por la mediana comunal, las dem√°s variables num√©ricas son promedios, y las que no son num√©ricas (por ejemplo, nacionalidad, pobreza, etc.) son calculadas como conteo de la poblaci√≥n comunal, y luego transformado en promedio de la poblaci√≥n comunal. Dise√±ado y programado en R por Basti√°n Olea Herrera. Mag√≠ster en Sociolog√≠a, data scientist.\n","date":"2024-01-14T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_casen_relacionador/","tags":"apps ; datos ; Chile ; ciencias sociales","title":"App: Relacionador de datos sociales Casen"},{"content":"En este script detallar√© c√≥mo descargar datos de estad√≠sticas delictuales del Centro de Estudios y An√°lisis del Delito (CEAD) de Chile utilizando t√©cnicas de web scraping en R. Las estad√≠sticas disponibles en el sitio web de CEAD corresponden a los siguientes datos oficiales: Estad√≠sticas Oficiales de Delitos de Mayor Connotaci√≥n Social (DMCS), Violencia Intrafamiliar (VIF), Incivilidades y otros hechos informados por Carabineros y la Polic√≠a de Investigaciones de Chile al Ministerio del Interior y Seguridad P√∫blica.\nEl proceso implica analizar el funcionamiento del sitio web de CEAD para poder replicar su m√©todo de solicitud de datos en R, y as√≠ acceder de forma directa en R a los datos que necesitemos desde el sitio, sin necesidad de entrar al sitio web ni realizar operaciones manuales. Esto resulta conveniente dado que puede ser engorroso utilizar la interfaz del sitio web de CEAD para obtener los datos manualmente, o bien, si se necesita obtener un gran volumen de datos desde el sitio. Por lo dem√°s, obtener los datos de forma manual mediante el sitio web no es una pr√°ctica reproducible, mientras que siguiendo estas instrucciones obtenemos un conjunto de funciones que hacen que el proceso de obtenci√≥n de estad√≠sticas delictuales sea autom√°tico, reproducible y sencillo.\nFuncionamiento del sitio web del CEAD El sitio web del CEAD ofrece una interfaz web donde se pueden obtener tablas con datos delictuales por comuna o regi√≥n, para los delitos o grupos de delitos especificados, y para los a√±os que se le indique. Luego de hacer selecciones para obtener los datos en el sitio de CEAD, podemos ingresar al inspector web de nuestro navegador, y en el apartado de red podemos identificar en el documento get_estadisticas_delictuales.php que las selecciones que hicimos se traducen en una solicitud XML que se env√≠a al servidor de CEAD y retorna los datos correspondientes.\nA modo de ejemplo, realicemos una selecci√≥n sencilla en la web de CEAD:\nEn el inspector web del navegador (en este caso Safari), vamos a red, identificamos get_estadisticas_delictuales.php, y en el men√∫ contextual elegimos copiar como cURL para ver la solicitud que se envi√≥ al servidor de CEAD para obtener los datos:\nAdjunto un ejemplo de cURL:\ncurl \u0026#39;https://cead.spd.gov.cl/wp-content/themes/gobcl-wp-master/data/get_estadisticas_delictuales.php\u0026#39;-X \u0026#39;POST\u0026#39;-H \u0026#39;Content-Type: application/x-www-form-urlencoded; charset=UTF-8\u0026#39;-H \u0026#39;Accept: /\u0026#39;-H \u0026#39;Sec-Fetch-Site: same-origin\u0026#39;-H \u0026#39;Accept-Language: es-419,es;q=0.9\u0026#39;-H \u0026#39;Accept-Encoding: gzip, deflate, br\u0026#39;-H \u0026#39;Sec-Fetch-Mode: cors\u0026#39;-H \u0026#39;Host: cead.spd.gov.cl\u0026#39;-H \u0026#39;Origin: https://cead.spd.gov.cl\u0026#39;-H \u0026#39;Content-Length: 674\u0026#39;-H \u0026#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Safari/605.1.15\u0026#39;-H \u0026#39;Referer: https://cead.spd.gov.cl/estadisticas-delictuales/\u0026#39;-H \u0026#39;Connection: keep-alive\u0026#39;-H \u0026#39;Sec-Fetch-Dest: empty\u0026#39;-H \u0026#39;Cookie: _ga=GA1.3.359881599.1695818071; _gid=GA1.3.1925657744.1695818071; PHPSESSID=p580t8bid8coo6gk46bg7i1162\u0026#39;-H \u0026#39;X-Requested-With: XMLHttpRequest\u0026#39;‚Äìdata \u0026#39;medida=1\u0026amp;tipoVal=2\u0026amp;anio%5B%5D=2022\u0026amp;delitos_agrupados%5B%5D=2\u0026amp;delitos_agrupados%5B%5D=4\u0026amp;delitos_agrupados%5B%5D=3\u0026amp;delitos_agrupados_nombres%5B%5D=Abusos+sexuales+y+otros+delitos+sexuales\u0026amp;delitos_agrupados_nombres%5B%5D=Incivilidades\u0026amp;delitos_agrupados_nombres%5B%5D=Delitos+de+mayor+connotaci%C3%B3n+social\u0026amp;delitos%5B%5D=17\u0026amp;delitos%5B%5D=3\u0026amp;delitos%5B%5D=4\u0026amp;delitos%5B%5D=5\u0026amp;delitos%5B%5D=20\u0026amp;delitos_nombres%5B%5D=Consumo+alcohol+v%C3%ADa+p%C3%BAblica\u0026amp;delitos_nombres%5B%5D=Homicidios\u0026amp;delitos_nombres%5B%5D=Hurtos\u0026amp;delitos_nombres%5B%5D=Lesiones+leves\u0026amp;delitos_nombres%5B%5D=Ebriedad\u0026amp;region%5B%5D=15\u0026amp;region_nombres%5B%5D=Regi%C3%B3n+de+Arica+y+Parinacota\u0026amp;seleccion=2\u0026amp;descarga=false\u0026#39; Nuestro objetivo, entonces, es replicar esta solicitud en R para obtener los datos sin tener que usar la interfaz web de CEAD.\nCrear solicitud de datos Podemos notar que la solicitud cURL se divide, a grandes rasgos, en una primera secci√≥n con el a√±o seleccionado (\u0026amp;anio%5B%5D=2022), luego los delitos elegidos (\u0026amp;delitos_agrupados_nombres%5B%5D=Abusos+sexuales+y+otros+delitos+sexuales...), y una secci√≥n final donde se define la unidad geogr√°fica correspondiente (\u0026amp;region%5B%5D=15\u0026amp;region_nombres%5B%5D=Regi%C3%B3n+de+Arica+y+Parinacota). Por lo tanto, utilizando R podemos replicar una solicitud de un conjunto de delitos copiando el texto que genera la aplicaci√≥n web de CEAD, y cambiando los par√°metros que necesitemos; en este caso, el a√±o y la comuna.\nRealizando previamente una solicitud en el sitio de CEAD, podemos seleccionar los delitos que nos interesen, y copiar la solicitud generada, aislando el texto que corresponde a los delitos, como vemos a continuaci√≥n:\n\u0026amp;delitos_agrupados%5B%5D=3\u0026amp;delitos_agrupados%5B%5D=7\u0026amp;delitos_agrupados_nombres%5B%5D=Delitos+de+mayor+connotaci%C3%B3n+social\u0026amp;delitos_agrupados_nombres%5B%5D=Robo+frustrado\u0026amp;delitos%5B%5D=8\u0026amp;delitos%5B%5D=10\u0026amp;delitos%5B%5D=9\u0026amp;delitos%5B%5D=11\u0026amp;delitos%5B%5D=12\u0026amp;delitos%5B%5D=30\u0026amp;delitos%5B%5D=13\u0026amp;delitos%5B%5D=7\u0026amp;delitos%5B%5D=4\u0026amp;delitos_nombres%5B%5D=Robo+con+violencia+o+intimidaci%C3%B3n\u0026amp;delitos_nombres%5B%5D=Robo+de+veh%C3%ADculo+motorizado\u0026amp;delitos_nombres%5B%5D=Robo+de+objetos+de+o+desde+veh%C3%ADculo\u0026amp;delitos_nombres%5B%5D=Robo+en+lugar+habitado\u0026amp;delitos_nombres%5B%5D=Robo+en+lugar+no+habitado\u0026amp;delitos_nombres%5B%5D=Robo+frustrado\u0026amp;delitos_nombres%5B%5D=Robo+por+sorpresa\u0026amp;delitos_nombres%5B%5D=Otros+robos+con+fuerza\u0026amp;delitos_nombres%5B%5D=Hurtos Puedes usar este mismo texto para realizar tu propia request de delitos relacionados a robos, o bien, puedes realizar tu propia selecci√≥n de delitos/infracciones/incivilidades en el sitio del CEAD y copiar el texto usando el inspector web de tu navegador, teniendo cuidado de extraer el texto correcto y completo, es decir, desde que dice \u0026amp;delitos_agrupados despu√©s del a√±o, hasta que diga el √∫ltimo delito antes de decir \u0026amp;region.\nPor ejemplo, otra string que seleccionar√≠a los delitos de violencia intrafamiliar y violencia sexual ser√≠a la siguiente: \u0026amp;delitos_agrupados%5B%5D=2\u0026amp;delitos_agrupados%5B%5D=8\u0026amp;delitos_agrupados_nombres%5B%5D=Abusos+sexuales+y+otros+delitos+sexuales\u0026amp;delitos_agrupados_nombres%5B%5D=Violencia+intrafamiliar.\nCon esta informaci√≥n, creamos una funci√≥n en R donde repliquemos la solicitud/request que nos interesa, definiendo que queremos obtener la informaci√≥n a escala mensual, con argumentos para poder definir el a√±o y comuna que necesitamos:\ncead_generar_request \u0026lt;- function(a√±o_elegido, comuna_numero) { # todos los meses del a√±o request_fechas = \u0026#34;\u0026amp;trimestre%5B%5D=1\u0026amp;trimestre%5B%5D=2\u0026amp;trimestre%5B%5D=3\u0026amp;trimestre%5B%5D=4\u0026amp;mes%5B%5D=1\u0026amp;mes%5B%5D=2\u0026amp;mes%5B%5D=3\u0026amp;mes%5B%5D=4\u0026amp;mes%5B%5D=5\u0026amp;mes%5B%5D=6\u0026amp;mes%5B%5D=7\u0026amp;mes%5B%5D=8\u0026amp;mes%5B%5D=9\u0026amp;mes%5B%5D=10\u0026amp;mes%5B%5D=11\u0026amp;mes%5B%5D=12\u0026amp;mes_nombres%5B%5D=Enero\u0026amp;mes_nombres%5B%5D=Febrero\u0026amp;mes_nombres%5B%5D=Marzo\u0026amp;mes_nombres%5B%5D=Abril\u0026amp;mes_nombres%5B%5D=Mayo\u0026amp;mes_nombres%5B%5D=Junio\u0026amp;mes_nombres%5B%5D=Julio\u0026amp;mes_nombres%5B%5D=Agosto\u0026amp;mes_nombres%5B%5D=Septiembre\u0026amp;mes_nombres%5B%5D=Octubre\u0026amp;mes_nombres%5B%5D=Noviembre\u0026amp;mes_nombres%5B%5D=Diciembre\u0026#34; # delitos copiados desde una request anterior request_delitos = \u0026#34;\u0026amp;delitos_agrupados%5B%5D=3\u0026amp;delitos_agrupados%5B%5D=7\u0026amp;delitos_agrupados_nombres%5B%5D=Delitos+de+mayor+connotaci%C3%B3n+social\u0026amp;delitos_agrupados_nombres%5B%5D=Robo+frustrado\u0026amp;delitos%5B%5D=8\u0026amp;delitos%5B%5D=10\u0026amp;delitos%5B%5D=9\u0026amp;delitos%5B%5D=11\u0026amp;delitos%5B%5D=12\u0026amp;delitos%5B%5D=30\u0026amp;delitos%5B%5D=13\u0026amp;delitos%5B%5D=7\u0026amp;delitos%5B%5D=4\u0026amp;delitos_nombres%5B%5D=Robo+con+violencia+o+intimidaci%C3%B3n\u0026amp;delitos_nombres%5B%5D=Robo+de+veh%C3%ADculo+motorizado\u0026amp;delitos_nombres%5B%5D=Robo+de+objetos+de+o+desde+veh%C3%ADculo\u0026amp;delitos_nombres%5B%5D=Robo+en+lugar+habitado\u0026amp;delitos_nombres%5B%5D=Robo+en+lugar+no+habitado\u0026amp;delitos_nombres%5B%5D=Robo+frustrado\u0026amp;delitos_nombres%5B%5D=Robo+por+sorpresa\u0026amp;delitos_nombres%5B%5D=Otros+robos+con+fuerza\u0026amp;delitos_nombres%5B%5D=Hurtos\u0026#34; # unir fragmentos en una sola request request \u0026lt;- paste0(\u0026#34;medida=1\u0026amp;tipoVal=2\u0026#34;, \u0026#34;\u0026amp;anio%5B%5D=\u0026#34;, a√±o_elegido, request_fechas, request_delitos, \u0026#34;\u0026amp;comuna%5B%5D=\u0026#34;, comuna_numero, \u0026#34;\u0026amp;seleccion=2\u0026amp;descarga=false\u0026#34; ) return(request) } A continuaci√≥n, realizamos una prueba con esta funci√≥n para crear una solicitud para el a√±o 2022, usando el c√≥digo √∫nico territorial o CUT de una comuna de prueba, en este caso, La Florida. Los c√≥digos √∫nicos territoriales de las comunas podemos obtenerlos del sitio web de la Infraestructura de Datos Geoespaciales de Chile (IDE Chile) u otros (personalmente, suelo crear una funci√≥n que al ingreasrle el nombre de una comuna me retorne el CUT de la misma).\nrequest_prueba = cead_generar_request(a√±o_elegido = 2022, comuna_numero = 13110) print(request_prueba) ## [1] \u0026#34;medida=1\u0026amp;tipoVal=2\u0026amp;anio%5B%5D=2022\u0026amp;trimestre%5B%5D=1\u0026amp;trimestre%5B%5D=2\u0026amp;trimestre%5B%5D=3\u0026amp;trimestre%5B%5D=4\u0026amp;mes%5B%5D=1\u0026amp;mes%5B%5D=2\u0026amp;mes%5B%5D=3\u0026amp;mes%5B%5D=4\u0026amp;mes%5B%5D=5\u0026amp;mes%5B%5D=6\u0026amp;mes%5B%5D=7\u0026amp;mes%5B%5D=8\u0026amp;mes%5B%5D=9\u0026amp;mes%5B%5D=10\u0026amp;mes%5B%5D=11\u0026amp;mes%5B%5D=12\u0026amp;mes_nombres%5B%5D=Enero\u0026amp;mes_nombres%5B%5D=Febrero\u0026amp;mes_nombres%5B%5D=Marzo\u0026amp;mes_nombres%5B%5D=Abril\u0026amp;mes_nombres%5B%5D=Mayo\u0026amp;mes_nombres%5B%5D=Junio\u0026amp;mes_nombres%5B%5D=Julio\u0026amp;mes_nombres%5B%5D=Agosto\u0026amp;mes_nombres%5B%5D=Septiembre\u0026amp;mes_nombres%5B%5D=Octubre\u0026amp;mes_nombres%5B%5D=Noviembre\u0026amp;mes_nombres%5B%5D=Diciembre\u0026amp;delitos_agrupados%5B%5D=3\u0026amp;delitos_agrupados%5B%5D=7\u0026amp;delitos_agrupados_nombres%5B%5D=Delitos+de+mayor+connotaci%C3%B3n+social\u0026amp;delitos_agrupados_nombres%5B%5D=Robo+frustrado\u0026amp;delitos%5B%5D=8\u0026amp;delitos%5B%5D=10\u0026amp;delitos%5B%5D=9\u0026amp;delitos%5B%5D=11\u0026amp;delitos%5B%5D=12\u0026amp;delitos%5B%5D=30\u0026amp;delitos%5B%5D=13\u0026amp;delitos%5B%5D=7\u0026amp;delitos%5B%5D=4\u0026amp;delitos_nombres%5B%5D=Robo+con+violencia+o+intimidaci%C3%B3n\u0026amp;delitos_nombres%5B%5D=Robo+de+veh%C3%ADculo+motorizado\u0026amp;delitos_nombres%5B%5D=Robo+de+objetos+de+o+desde+veh%C3%ADculo\u0026amp;delitos_nombres%5B%5D=Robo+en+lugar+habitado\u0026amp;delitos_nombres%5B%5D=Robo+en+lugar+no+habitado\u0026amp;delitos_nombres%5B%5D=Robo+frustrado\u0026amp;delitos_nombres%5B%5D=Robo+por+sorpresa\u0026amp;delitos_nombres%5B%5D=Otros+robos+con+fuerza\u0026amp;delitos_nombres%5B%5D=Hurtos\u0026amp;comuna%5B%5D=13110\u0026amp;seleccion=2\u0026amp;descarga=false\u0026#34; De este modo, creamos una solicitud que simula a un usuario que accedi√≥ al sitio web de CEAD, realiz√≥ selecciones en los distintos apartados de delitos, comunas y a√±os, y presion√≥ el bot√≥n \u0026ldquo;Buscar\u0026rdquo;.\nRealizar solicitud de datos Teniendo nuestra solicitud hecha, basta con enviarla al servidor para recibir los datos de vuelta, tal como si hubi√©semos entrado al sitio, seleccionado las opciones y presionado el bot√≥n para obtener datos. Para ello, creamos una nueva funci√≥n que env√≠a al servidor la solicitud que creamos:\ncead_realizar_request \u0026lt;- function(request) { RCurl::getURL(url = \u0026#34;https://cead.spd.gov.cl/wp-content/themes/gobcl-wp-master/data/get_estadisticas_delictuales.php\u0026#34;, postfields = request, httpheader = c(Connection = \u0026#34;close\u0026#34;, \u0026#39;Content-Type\u0026#39; = \u0026#34;application/x-www-form-urlencoded; charset=UTF-8\u0026#34;, \u0026#39;Content-length\u0026#39; = nchar(request) ) ) } Entonces, aplicamos la solicitud que creamos a la funci√≥n para realizar la solicitud, y as√≠ obtendremos datos desde el servidor de CEAD. Cuidado, que esta funci√≥n lleva a cabo una conexi√≥n web con el servidor de CEAD, por lo que debemos ser responsables y precavidos con la cantidad de veces que la ejecutamos, y con no solicitar demasiados datos, dado que estamos obteniendo datos de manera gratuita y no queremos causar inconvenientes para otros usuarios, por ejemplo, realizando cientos de requests por minuto.\ndatos_prueba \u0026lt;- cead_realizar_request(request_prueba) #ejecutar solo cuando sea necesario, para no saturar el servidor CEAD datos_prueba |\u0026gt; substr(1, 400) ## [1] \u0026#34;\u0026lt;div class=\\\u0026#34;cont-reportes col-md-12\\\u0026#34;\u0026gt;\u0026lt;table width=\\\u0026#34;100%\\\u0026#34; border=\\\u0026#34;1\\\u0026#34; style=\\\u0026#34;border:1px solid #ccc;min-width: 100px;\\\u0026#34;\u0026gt;\\n\\t\\t\\t\\t \u0026lt;thead\u0026gt;\\n\\t\\t\\t\\t \u0026lt;tr\u0026gt;\\n\\t\\t\\t\\t\\t\u0026lt;th colspan=\\\u0026#34;1\\\u0026#34; style=\\\u0026#34;border:1px solid #ccc;min-width: 100px;background:#1d89c8;\\\u0026#34;\u0026gt;\u0026lt;/th\u0026gt;\u0026lt;th colspan=\\\u0026#34;12\\\u0026#34; style=\\\u0026#34;border:1px solid #ccc;background:#1d89c8;color:#ffffff;\\\u0026#34;\u0026gt;\u0026lt;center\u0026gt;2022\u0026lt;/center\u0026gt;\u0026lt;/th\u0026gt;\\n\\t\\t\\t\\t \u0026lt;/tr\u0026gt;\u0026lt;tr\u0026gt;\\n\\t\\t\\t\\t\\t\u0026lt;th colspan=\\\u0026#34;1\\\u0026#34; style=\\\u0026#34;border:1px so\u0026#34; Sin embargo, los datos que recibimos vienen en formato HTML. Para transformarlos en datos legibles, usamos el paquete {rvest} para transformar el HTML a un data frame:\n#obtener y limpiar datos html usando rvest datos_prueba_2 \u0026lt;- datos_prueba |\u0026gt; rvest::read_html() |\u0026gt; #leer datos html rvest::html_table() |\u0026gt; #extraer tabla desde el c√≥digo purrr::pluck(1) |\u0026gt; #sacar de la lista janitor::row_to_names(2) |\u0026gt; #usar segunda fila como nombre de columnas rename(delitos = 1) #renombrar primera columna print(datos_prueba_2) #| eval: FALSE ## # A tibble: 10 √ó 13 ## delitos `1` `2` `3` `4` `5` `6` `7` `8` `9` `10` `11` ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; ## 1 Delitos de‚Ä¶ 594 551 661 653 705 702 784 854 827 753 775 ## 2 Hurtos 90 68 84 95 100 105 134 125 116 113 93 ## 3 Otros robo‚Ä¶ 11 8 14 14 13 9 13 12 11 14 7 ## 4 Robo con v‚Ä¶ 142 157 155 153 166 164 177 216 165 188 205 ## 5 Robo de ob‚Ä¶ 90 86 118 118 141 137 140 158 165 123 128 ## 6 Robo de ve‚Ä¶ 61 49 70 70 53 57 47 52 60 41 47 ## 7 Robo en lu‚Ä¶ 46 43 42 49 49 43 66 47 56 49 62 ## 8 Robo en lu‚Ä¶ 41 31 28 42 32 43 52 44 40 48 46 ## 9 Robo por s‚Ä¶ 48 52 57 33 70 69 90 115 104 89 84 ## 10 Robo frust‚Ä¶ 13 10 16 17 23 26 20 28 10 18 22 ## # ‚Ñπ 1 more variable: `12` \u0026lt;chr\u0026gt; Listo! Hemos obtenido los datos de delitos directamente del sitio del CEAD desde R. Para finalizar, realizamos una peque√±a manipulaci√≥n de los datos para transformarlos a formato tidy, es decir, una observaci√≥n por fila:\ndatos_prueba_3 \u0026lt;- datos_prueba_2 |\u0026gt; tidyr::pivot_longer(cols = 2:length(datos_prueba_2), names_to = \u0026#34;mes\u0026#34;, values_to = \u0026#34;cifra\u0026#34;) |\u0026gt; #pivotar a formato long mutate(fecha = lubridate::ymd(paste(\u0026#34;2022\u0026#34;, mes, \u0026#34;1\u0026#34;))) |\u0026gt; #crear fecha a partir del mes select(fecha, delito = delitos, delito_n = cifra) |\u0026gt; mutate(delito_n = as.numeric(delito_n)) |\u0026gt; arrange(delito, desc(fecha)) head(datos_prueba_3, 20) #| eval: FALSE ## # A tibble: 20 √ó 3 ## fecha delito delito_n ## \u0026lt;date\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; ## 1 2022-12-01 Delitos de mayor connotaci√≥n social 834 ## 2 2022-11-01 Delitos de mayor connotaci√≥n social 775 ## 3 2022-10-01 Delitos de mayor connotaci√≥n social 753 ## 4 2022-09-01 Delitos de mayor connotaci√≥n social 827 ## 5 2022-08-01 Delitos de mayor connotaci√≥n social 854 ## 6 2022-07-01 Delitos de mayor connotaci√≥n social 784 ## 7 2022-06-01 Delitos de mayor connotaci√≥n social 702 ## 8 2022-05-01 Delitos de mayor connotaci√≥n social 705 ## 9 2022-04-01 Delitos de mayor connotaci√≥n social 653 ## 10 2022-03-01 Delitos de mayor connotaci√≥n social 661 ## 11 2022-02-01 Delitos de mayor connotaci√≥n social 551 ## 12 2022-01-01 Delitos de mayor connotaci√≥n social 594 ## 13 2022-12-01 Hurtos 110 ## 14 2022-11-01 Hurtos 93 ## 15 2022-10-01 Hurtos 113 ## 16 2022-09-01 Hurtos 116 ## 17 2022-08-01 Hurtos 125 ## 18 2022-07-01 Hurtos 134 ## 19 2022-06-01 Hurtos 105 ## 20 2022-05-01 Hurtos 100 Ejecutar para varias comunas y/o a√±os Ahora, probablemente queramos obtener datos para un rango de a√±os m√°s amplio, y quiz√°s para varias comunas. Para ello, podemos realizar un loop que aplique la funci√≥n que creamos consecutivamente a partir de un vector de a√±os y de comunas, a modo de realizar varias solicitudes de una sola vez.\nUsando como ejemplo 4 c√≥digos √∫nicos territoriales y un vector de 5 a√±os, realizamos un loop usando {purrr} que realice las solicitudes al CEAD, procurando mantener un ritmo de scraping que sea respetuoso de la fuente de datos. Notamos que el loop tiene dos niveles: por cada comuna, realiza otro loop para todos los a√±os. Esto tambi√©n se puede realizar en un solo loop con la funci√≥n map2()` , pero personalmente encuentro que usar un loop dentro de otro es m√°s intuitivo.\n#definir comunas y a√±os que queremos scrapear comunas_por_calcular = c(14104, 13110, 13112, 05604) |\u0026gt; set_names() a√±os_elegidos = 2018:2022 |\u0026gt; set_names() #loop por cada comuna datos_cead \u0026lt;- map(comunas_por_calcular, \\(comuna_numero) { message(\u0026#34;inciando comuna \u0026#34;, comuna_numero) #loop dentro del loop: para la comuna, por cada a√±o especificado data_comuna \u0026lt;- map(a√±os_elegidos, \\(a√±o) { message(\u0026#34;a√±o \u0026#34;, a√±o) #generar request xml.request = cead_generar_request(a√±o_elegido = a√±o, comuna_numero) #obtener datos usando la funci√≥n de request inicio = Sys.time() data_a√±o = cead_realizar_request(xml.request) final = Sys.time() #dar tiempo de espera en base al tiempo que tom√≥ descargar los datos, para no saturar el servidor Sys.sleep((final-inicio)*10) return(data_a√±o) }) return(data_comuna) }) datos_cead |\u0026gt; substr(1, 400) Esto puede tomar un par de minutos. En todo caso, el c√≥digo va arrojando mensajes en la consola para que no pensemos que se qued√≥ pegado.\nPosteriormente, realizamos el mismo proceso de limpieza de datos que antes, obteniendo las tablas desde el c√≥digo html que retorn√≥ el CEAD, y ordenamos los datos en formato tidy, donde cada variable es una columna y cada observaci√≥n es una fila. Ojo, que este loop recorre los datos obtenidos en el paso anterior en base al vector de comunas que usamos para obtener los datos, comunas_por_calcular, ya que los datos fueron recibidos como una lista donde cada elemento de la lista tiene como t√≠tulo el c√≥digo de la comuna.\n#por cada comuna cead_limpiada \u0026lt;- map_df(comunas_por_calcular, \\(.comuna) { # message(\u0026#34;obteniendo comuna \u0026#34;, .comuna) #extraer la comuna desde los datos usando el nombre de cada elemento de la lista cead_comuna \u0026lt;- datos_cead |\u0026gt; pluck(as.character(.comuna)) #por cada a√±o, usando los nombres del objeto anterior, dado que cada comuna es, a su vez, una lista cuyos elementos son los a√±os obtenidos para esa comuna datos_comuna_a√±o \u0026lt;- map(names(cead_comuna), \\(.a√±o) { # message(\u0026#34;obteniendo a√±o \u0026#34;, .a√±o) #obtener tablas cead_comuna_a√±o \u0026lt;- cead_comuna |\u0026gt; pluck(.a√±o) |\u0026gt; rvest::read_html() |\u0026gt; rvest::html_table() |\u0026gt; purrr::pluck(1) |\u0026gt; janitor::row_to_names(2) |\u0026gt; rename(delitos = 1) #pivotar a formato tidy (una observaci√≥n por fila) cead_datos \u0026lt;- cead_comuna_a√±o |\u0026gt; tidyr::pivot_longer(cols = 2:length(cead_comuna_a√±o), names_to = \u0026#34;mes\u0026#34;, values_to = \u0026#34;cifra\u0026#34;) |\u0026gt; mutate(a√±o = .a√±o, comuna = .comuna) |\u0026gt; mutate(fecha = lubridate::ymd(paste(a√±o, mes, \u0026#34;1\u0026#34;))) return(cead_datos) }) return(datos_comuna_a√±o) }) head(cead_limpiada) ## # A tibble: 6 √ó 6 ## delitos mes cifra a√±o comuna fecha ## \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;chr\u0026gt; \u0026lt;dbl\u0026gt; \u0026lt;date\u0026gt; ## 1 Delitos de mayor connotaci√≥n social 1 34 2018 14104 2018-01-01 ## 2 Delitos de mayor connotaci√≥n social 2 25 2018 14104 2018-02-01 ## 3 Delitos de mayor connotaci√≥n social 3 26 2018 14104 2018-03-01 ## 4 Delitos de mayor connotaci√≥n social 4 37 2018 14104 2018-04-01 ## 5 Delitos de mayor connotaci√≥n social 5 20 2018 14104 2018-05-01 ## 6 Delitos de mayor connotaci√≥n social 6 20 2018 14104 2018-06-01 Listo, hemos obtenido los datos para las comunas que definimos y en los a√±os que fijamos, y lo mejor es que podemos volver a usar este proceso para obtener los datos de cualquier comuna, o incluso de todas las comunas, de forma r√°pida y reproducible. Si bien hay otras formas de automatizar este tipo de procesos, considero que usando R resulta m√°s confiable dado que nos comunicamos directamente con el funcionamiento de la plataforma web, y es bastante conveniente tener estos scripts en caso de que necesites replicar el proceso para otras comunas o rangos temporales.\nBasti√°n Olea Herrera\nMag√≠ster en sociolog√≠a, data scientist\nhttps://bastianolea.rbind.io\nContacto: bastianolea arroba gmail punto com\n","date":"2023-09-27T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/tutorial_delitos_cead/","tags":"web scraping ; Chile ; datos ; ciencias sociales","title":"Tutorial: Scraping de estad√≠sticas delictuales del Centro de Estudios y An√°lisis del Delito con R"},{"content":"Aplicaci√≥n web que permite visualizar gr√°ficos de los resultados de las encuestas del Centro de Estudios P√∫blicos. Adem√°s, permite desagregar resultados en base a categor√≠as sociodemogr√°ficas, filtrar grupos, configurar los gr√°ficos y descargar los datos.\n","date":"2023-06-15T00:00:00Z","href":"https://bastianoleah.netlify.app/blog/app_cep_graficador/","tags":"apps ; Chile ; ciencias sociales","title":"App: Graficador encuesta CEP"},{"content":"** No content below YAML for the talk _index. This file provides front matter for the listing page layout and sidebar content. It is also a branch bundle, and all settings under cascade provide front matter for all pages inside talk/. You may still override any of these by changing them in a page\u0026rsquo;s front matter.**\n","date":null,"href":"https://bastianoleah.netlify.app/tutoriales/","tags":"","title":"Tutoriales de R"}]